AUI.add("aui-diagram-builder-base",function(ad){var T=ad.Lang,d=T.isArray,ap=T.isBoolean,M=T.isNumber,B=T.isObject,at=T.isString,I=function(A){return(A instanceof ad.ArrayList);},R=function(A){return(A instanceof ad.Node);},D=function(A){return(A instanceof ad.AvailableField);},aD=ad.Array,V="add",k="addNode",aC="auto",N="availableField",Q="availableFields",az="availableFieldsDragConfig",am="base",s="boundingBox",aw="builder",Z="cancel",aq="clearfix",a="container",ab="content",u="contentBox",J="viewport",P="contentNode",E="createDocumentFragment",z="diagram",F="diagram-builder-base",aa="disk",o="draggable",ay="drop",ak="dropConfig",X="dropContainer",ao="field",t="fields",n="fieldsContainer",an="height",p="helper",W="icon",v="iconClass",aj="id",af="label",ai="list",r="node",y="nodeSettings",ac="propertyList",ax="rendered",al="save",q="settings",O="tab",b="tabs",e="tabview",G="tabView",L="toolbar",j="toolbarContainer",w=ad.getClassName,aB=" ",g=".",H="$",h="#",aE=w(z,aw,am,ay,a),x=w(z,aw,am,J),C=w(z,aw,am,ao),f=w(z,aw,am,t,a),ag=w(z,aw,am,ao,o),c=w(z,aw,am,ao,W),U=w(z,aw,am,ao,af),m=w(z,aw,am,b,a),Y=w(z,aw,am,b,a,ab),ah=w(z,aw,am,O,V),K=w(z,aw,am,O,q),au=w(z,aw,am,L,a),ae=w(p,aq),l=w(W),av=w(e,ab),aA=w(e,ai);var i=ad.Component.create({NAME:N,ATTRS:{draggable:{value:true,validator:ap},label:{validator:at},iconClass:{validator:at},id:{value:ad.guid(),setter:"_setId",validator:at},node:{valueFn:function(aF){var A=this;if(!R(aF)){aF=ad.Node.create(ad.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(v)}));aF.setData(N,A);}return aF;},validator:R,writeOnce:true},type:{value:r,validator:at}},EXTENDS:ad.Base,buildNodeId:function(A){return Q+H+ao+H+A;},getAvailableFieldByNode:function(A){return ad.one(A).getData(N);},getAvailableFieldById:function(A){return ad.AvailableField.getAvailableFieldByNode(h+ad.AvailableField.buildNodeId(A));},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+C+'">'+'<span class="'+[l,c].join(aB)+' {iconClass}"></span>'+'<span class="'+U+'"></span>'+"</li>",initializer:function(){var A=this;var aF=A.get(r);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aF.one(g+U);A._uiSetDraggable(A.get(o));A._uiSetId(A.get(aj));A._uiSetLabel(A.get(af));},_afterDraggableChange:function(aF){var A=this;A._uiSetDraggable(aF.newVal);},_afterIdChange:function(aF){var A=this;A._uiSetId(aF.newVal);},_afterLabelChange:function(aF){var A=this;A._uiSetLabel(aF.newVal);},_setId:function(A){return ad.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aF){var A=this;A.get(r).toggleClass(ag,aF);},_uiSetLabel:function(aF){var A=this;A.labelNode.setContent(aF);},_uiSetId:function(aF){var A=this;A.get(r).set(aj,aF);}}});ad.AvailableField=i;var S=function(){};S.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||I(A);}}};ad.mix(S.prototype,{createFields:function(aG){var aF=this;var A=[];aD.each(aG,function(aH){A.push(aF.createField(aH));});return new ad.ArrayList(A);},addField:function(aF){var A=this;var aG=A.createField(aF);A._updateFields(A.get(t).add(aG));return aG;},removeField:function(aF){var A=this;A._updateFields(A.get(t).remove(aF));},_updateFields:function(aF){var A=this;A.set(t,aF);},_setFields:function(aF){var A=this;if(I(aF)){return aF;}else{return A.createFields(aF);}},createField:function(A){return A;}});ad.FieldSupport=S;var ar=ad.Component.create({NAME:F,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},viewport:{valueFn:function(){return ad.Node.create(this.VIEWPORT_TEMPLATE);}},dropContainer:{valueFn:function(){return ad.Node.create(this.DROP_CONTAINER_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:B},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:B},fieldsContainer:{valueFn:function(){return ad.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:B,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",nodeSettings:"Node settings",propertyName:"Property Name",save:"Save",value:"Value"}},tabView:{setter:"_setTabView",validator:B,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:B,value:null},toolbarContainer:{valueFn:function(){return ad.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{dropContainer:g+aE,fieldsContainer:g+f,toolbarContainer:g+au,viewport:g+x},UI_ATTRS:[Q,t],AUGMENTS:[ad.FieldSupport],prototype:{DROP_CONTAINER_TEMPLATE:'<div class="'+aE+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+au+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+f+'"></ul>',VIEWPORT_TEMPLATE:'<div tabindex="1" class="'+x+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.viewport=A.get(J);A.dropContainer=A.get(X);A.fieldsContainer=A.get(n);A.toolbarContainer=A.get(j);},isAvailableFieldsDrag:function(aG){var A=this;var aF=A.availableFieldsDrag;return(aG===aF.dd);},plotFields:function(){var aF=this;var A=aF.get(t);A.each(function(aG){aF.plotField(aG);});},renderUI:function(){var A=this;A._renderTabs();A._renderViewport();A._uiSetAvailableFields(A.get(Q));},syncUI:function(){var A=this;var aF=A.get(u);A._setupDrop();A._setupAvailableFieldsDrag();aF.addClass(ae);},_afterActiveTabChange:function(aG){var A=this;var aF=aG.newVal.get(P);if(A.get(ax)&&(aF===A.settingsNode)){A._renderSettings();}},_afterRender:function(aF){var A=this;A.plotFields();},_afterUiSetHeight:function(aF){var A=this;A.dropContainer.setStyle(an,M(aF)?aF+A.DEF_UNIT:aF);},_defCancelFn:function(aF){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(Z);},_handleSaveEvent:function(){var A=this;A.fire(al);},_renderViewport:function(){var aF=this;var aG=aF.get(u);var A=aF.viewport;A.appendChild(aF.dropContainer);aG.appendChild(A);},_renderPropertyList:function(){var A=this;
if(!A.propertyList){A.propertyList=new ad.PropertyList(A.get(ac)).render(A.settingsNode);A.propertyList.get(s).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aF=new ad.TabView(A.get(G));A.tabView=aF;A.fieldsNode=aF.getTab(0).get(P);A.settingsNode=aF.getTab(1).get(P);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ad.Toolbar(A.get(L)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ad.DD.Drop(A.get(ak));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ad.DD.Delegate(A.get(az));},_setAvailableFields:function(aG){var aF=this;var A=[];aD.each(aG,function(aI,aH){A.push(D(aI)?aI:new ad.AvailableField(aI));});return A;},_setDropConfig:function(aF){var A=this;return ad.merge({bubbleTargets:A,groups:[Q],node:A.dropContainer},aF||{});},_setAvailableFieldsDragConfig:function(aF){var A=this;return ad.merge({bubbleTargets:A,container:A.get(s),dragConfig:{groups:[Q],plugins:[{cfg:{moveOnEnd:false},fn:ad.Plugin.DDProxy}]},nodes:g+ag},aF||{});},_setPropertyList:function(aF){var A=this;return ad.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aC}},aF);},_setTabView:function(aI){var aF=this;var aH=aF.get(s);var aJ=aH.one(g+aA);var aG={after:{activeTabChange:ad.bind(aF._afterActiveTabChange,aF)},boundingBox:aH.one(g+m),contentBox:aH.one(g+Y),bubbleTargets:aF,contentNode:aH.one(g+av),cssClass:m,listNode:aJ,render:aF.get(u)};if(!aJ){var A=aF.getStrings();aG.items=[{cssClass:ah,label:A[k]},{cssClass:K,label:A[y]}];}return ad.merge(aG,aI);},_setToolbar:function(aG){var aF=this;var A=aF.getStrings();return ad.merge({activeState:false,bubbleTargets:aF,children:[{handler:ad.bind(aF._handleSaveEvent,aF),label:A[al],icon:aa},{handler:ad.bind(aF._handleCancelEvent,aF),label:A[Z]}]},aG);},_uiSetAvailableFields:function(aH){var A=this;var aG=A.fieldsNode;if(aG){var aF=ad.getDoc().invoke(E);aD.each(aH,function(aI){aF.appendChild(aI.get(r));});aG.setContent(A.fieldsContainer.setContent(aF));}},_uiSetFields:function(aF){var A=this;if(A.get(ax)){A.plotFields();}}}});ad.DiagramBuilderBase=ar;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});