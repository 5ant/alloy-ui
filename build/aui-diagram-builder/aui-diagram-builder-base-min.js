AUI.add("aui-diagram-builder-base",function(ae){var U=ae.Lang,d=U.isArray,aq=U.isBoolean,M=U.isNumber,B=U.isObject,au=U.isString,I=function(A){return(A instanceof ae.ArrayList);},S=function(A){return(A instanceof ae.Node);},D=function(A){return(A instanceof ae.AvailableField);},aE=ae.Array,P="maxFields",W="add",k="addNode",aD="auto",N="availableField",R="availableFields",aA="availableFieldsDragConfig",an="base",s="boundingBox",ax="builder",aa="cancel",ar="clearfix",a="container",ac="content",u="contentBox",J="viewport",Q="contentNode",E="createDocumentFragment",z="diagram",F="diagram-builder-base",ab="disk",o="draggable",az="drop",al="dropConfig",Z="dropContainer",ap="field",t="fields",n="fieldsContainer",ao="height",p="helper",X="icon",v="iconClass",ak="id",ag="label",aj="list",r="node",y="nodeSettings",ad="propertyList",ay="rendered",am="save",q="settings",O="tab",b="tabs",e="tabview",G="tabView",L="toolbar",j="toolbarContainer",w=ae.getClassName,aC=" ",g=".",H="$",h="#",aF=w(z,ax,an,az,a),x=w(z,ax,an,J),C=w(z,ax,an,ap),f=w(z,ax,an,t,a),ah=w(z,ax,an,ap,o),c=w(z,ax,an,ap,X),V=w(z,ax,an,ap,ag),m=w(z,ax,an,b,a),Y=w(z,ax,an,b,a,ac),ai=w(z,ax,an,O,W),K=w(z,ax,an,O,q),av=w(z,ax,an,L,a),af=w(p,ar),l=w(X),aw=w(e,ac),aB=w(e,aj);var i=ae.Component.create({NAME:N,ATTRS:{draggable:{value:true,validator:aq},label:{validator:au},iconClass:{validator:au},id:{value:ae.guid(),setter:"_setId",validator:au},node:{valueFn:function(aG){var A=this;if(!S(aG)){aG=ae.Node.create(ae.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(v)}));aG.setData(N,A);}return aG;},validator:S,writeOnce:true},type:{value:r,validator:au}},EXTENDS:ae.Base,buildNodeId:function(A){return R+H+ap+H+A;},getAvailableFieldByNode:function(A){return ae.one(A).getData(N);},getAvailableFieldById:function(A){return ae.AvailableField.getAvailableFieldByNode(h+ae.AvailableField.buildNodeId(A));},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+C+'">'+'<span class="'+[l,c].join(aC)+' {iconClass}"></span>'+'<span class="'+V+'"></span>'+"</li>",initializer:function(){var A=this;var aG=A.get(r);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aG.one(g+V);A._uiSetDraggable(A.get(o));A._uiSetId(A.get(ak));A._uiSetLabel(A.get(ag));},_afterDraggableChange:function(aG){var A=this;A._uiSetDraggable(aG.newVal);},_afterIdChange:function(aG){var A=this;A._uiSetId(aG.newVal);},_afterLabelChange:function(aG){var A=this;A._uiSetLabel(aG.newVal);},_setId:function(A){return ae.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aG){var A=this;A.get(r).toggleClass(ah,aG);},_uiSetLabel:function(aG){var A=this;A.labelNode.setContent(aG);},_uiSetId:function(aG){var A=this;A.get(r).set(ak,aG);}}});ae.AvailableField=i;var T=function(){};T.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||I(A);}},maxFields:{value:Infinity,validator:M}};ae.mix(T.prototype,{createFields:function(aH){var aG=this;var A=[];aE.each(aH,function(aJ,aI){if(aI<aG.get(P)){A.push(aG.createField(aJ));}});return new ae.ArrayList(A);},addField:function(aG){var A=this;if(A.get(t).size()<A.get(P)){var aH=A.createField(aG);if(aH){A._updateFields(A.get(t).add(aH));}return aH;}return null;},removeField:function(aG){var A=this;A._updateFields(A.get(t).remove(aG));},_updateFields:function(aG){var A=this;A.set(t,aG);},_setFields:function(aG){var A=this;if(I(aG)){return aG;}else{return A.createFields(aG);}},createField:function(A){return A;}});ae.FieldSupport=T;var at=ae.Component.create({NAME:F,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},viewport:{valueFn:function(){return ae.Node.create(this.VIEWPORT_TEMPLATE);}},dropContainer:{valueFn:function(){return ae.Node.create(this.DROP_CONTAINER_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:B},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:B},fieldsContainer:{valueFn:function(){return ae.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:B,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",nodeSettings:"Node settings",propertyName:"Property Name",save:"Save",value:"Value"}},tabView:{setter:"_setTabView",validator:B,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:B,value:null},toolbarContainer:{valueFn:function(){return ae.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{dropContainer:g+aF,fieldsContainer:g+f,toolbarContainer:g+av,viewport:g+x},UI_ATTRS:[R,t],AUGMENTS:[ae.FieldSupport],prototype:{DROP_CONTAINER_TEMPLATE:'<div class="'+aF+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+av+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+f+'"></ul>',VIEWPORT_TEMPLATE:'<div tabindex="1" class="'+x+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.viewport=A.get(J);A.dropContainer=A.get(Z);A.fieldsContainer=A.get(n);A.toolbarContainer=A.get(j);},isAvailableFieldsDrag:function(aH){var A=this;var aG=A.availableFieldsDrag;return(aH===aG.dd);},plotFields:function(){var aG=this;var A=aG.get(t);A.each(function(aH){aG.plotField(aH);});},renderUI:function(){var A=this;A._renderTabs();A._renderViewport();A._uiSetAvailableFields(A.get(R));},syncUI:function(){var A=this;var aG=A.get(u);A._setupDrop();A._setupAvailableFieldsDrag();aG.addClass(af);},_afterActiveTabChange:function(aH){var A=this;var aG=aH.newVal.get(Q);if(A.get(ay)&&(aG===A.settingsNode)){A._renderSettings();}},_afterRender:function(aG){var A=this;A.plotFields();},_afterUiSetHeight:function(aG){var A=this;A.dropContainer.setStyle(ao,M(aG)?aG+A.DEF_UNIT:aG);},_defCancelFn:function(aG){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(aa);},_handleSaveEvent:function(){var A=this;A.fire(am);},_renderViewport:function(){var aG=this;
var aH=aG.get(u);var A=aG.viewport;A.appendChild(aG.dropContainer);aH.appendChild(A);},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ae.PropertyList(A.get(ad)).render(A.settingsNode);A.propertyList.get(s).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aG=new ae.TabView(A.get(G));A.tabView=aG;A.fieldsNode=aG.getTab(0).get(Q);A.settingsNode=aG.getTab(1).get(Q);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ae.Toolbar(A.get(L)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ae.DD.Drop(A.get(al));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ae.DD.Delegate(A.get(aA));},_setAvailableFields:function(aH){var aG=this;var A=[];aE.each(aH,function(aJ,aI){A.push(D(aJ)?aJ:new ae.AvailableField(aJ));});return A;},_setDropConfig:function(aG){var A=this;return ae.merge({bubbleTargets:A,groups:[R],node:A.dropContainer},aG||{});},_setAvailableFieldsDragConfig:function(aG){var A=this;return ae.merge({bubbleTargets:A,container:A.get(s),dragConfig:{groups:[R],plugins:[{cfg:{moveOnEnd:false},fn:ae.Plugin.DDProxy}]},nodes:g+ah},aG||{});},_setPropertyList:function(aG){var A=this;return ae.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aD}},aG);},_setTabView:function(aJ){var aG=this;var aI=aG.get(s);var aK=aI.one(g+aB);var aH={after:{activeTabChange:ae.bind(aG._afterActiveTabChange,aG)},boundingBox:aI.one(g+m),contentBox:aI.one(g+Y),bubbleTargets:aG,contentNode:aI.one(g+aw),cssClass:m,listNode:aK,render:aG.get(u)};if(!aK){var A=aG.getStrings();aH.items=[{cssClass:ai,label:A[k]},{cssClass:K,label:A[y]}];}return ae.merge(aH,aJ);},_setToolbar:function(aH){var aG=this;var A=aG.getStrings();return ae.merge({activeState:false,bubbleTargets:aG,children:[{handler:ae.bind(aG._handleSaveEvent,aG),label:A[am],icon:ab},{handler:ae.bind(aG._handleCancelEvent,aG),label:A[aa]}]},aH);},_uiSetAvailableFields:function(aI){var A=this;var aH=A.fieldsNode;if(aH){var aG=ae.getDoc().invoke(E);aE.each(aI,function(aJ){aG.appendChild(aJ.get(r));});aH.setContent(A.fieldsContainer.setContent(aG));}},_uiSetFields:function(aG){var A=this;if(A.get(ay)){A.plotFields();}}}});ae.DiagramBuilderBase=at;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});