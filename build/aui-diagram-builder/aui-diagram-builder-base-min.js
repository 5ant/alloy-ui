AUI.add("aui-diagram-builder-base",function(aj){var Y=aj.Lang,d=Y.isArray,ax=Y.isBoolean,Q=Y.isNumber,G=Y.isObject,aA=Y.isString,N=function(A){return(A instanceof aj.ArrayList);},W=function(A){return(A instanceof aj.Node);},I=function(A){return(A instanceof aj.AvailableField);},aK=aj.Array,aa="add",o="addNode",aJ="auto",R="availableField",V="availableFields",aG="availableFieldsDragConfig",au="base",w="boundingBox",aD="builder",ae="cancel",ag="canvas",ay="clearfix",f="column",a="container",ah="content",z="contentBox",e="contentContainer",U="contentNode",J="createDocumentFragment",E="diagram",K="diagram-builder-base",af="disk",s="draggable",aF="drop",aq="dropConfig",ad="dropContainer",aw="field",x="fields",r="fieldsContainer",av="height",t="helper",ab="icon",B="iconClass",ap="id",al="label",y="layout",ao="list",T="maxFields",v="node",g="parentNode",ai="propertyList",aE="rendered",ar="save",u="settings",S="tab",M="tabView",b="tabs",h="tabview",P="toolbar",m="toolbarContainer",C=aj.getClassName,aI=" ",j=".",k="#",aI=" ",F="_",n=C(f),D=C(E,aD,au,ag),at=C(E,aD,au,ah,a),aL=C(E,aD,au,aF,a),H=C(E,aD,au,aw),am=C(E,aD,au,aw,s),c=C(E,aD,au,aw,ab),Z=C(E,aD,au,aw,al),i=C(E,aD,au,x,a),an=C(E,aD,au,S,aa),O=C(E,aD,au,S,u),q=C(E,aD,au,b,a),ac=C(E,aD,au,b,a,ah),aB=C(E,aD,au,P,a),ak=C(t,ay),p=C(ab),L=C(y),aC=C(h,ah),aH=C(h,ao);var l=aj.Component.create({NAME:R,ATTRS:{draggable:{value:true,validator:ax},label:{validator:aA},iconClass:{validator:aA},id:{value:aj.guid(),setter:"_setId",validator:aA},node:{valueFn:function(aM){var A=this;if(!W(aM)){aM=aj.Node.create(aj.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(B)}));aM.setData(R,A);}return aM;},validator:W,writeOnce:true},type:{value:v,validator:aA}},EXTENDS:aj.Base,buildNodeId:function(A){return V+F+aw+F+A;},getAvailableFieldById:function(A){return aj.AvailableField.getAvailableFieldByNode(k+aj.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){return aj.one(A).getData(R);},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+H+'">'+'<span class="'+[p,c].join(aI)+' {iconClass}"></span>'+'<div class="'+Z+'"></div>'+"</li>",initializer:function(){var A=this;var aM=A.get(v);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aM.one(j+Z);A._uiSetDraggable(A.get(s));A._uiSetId(A.get(ap));A._uiSetLabel(A.get(al));},_afterDraggableChange:function(aM){var A=this;A._uiSetDraggable(aM.newVal);},_afterIdChange:function(aM){var A=this;A._uiSetId(aM.newVal);},_afterLabelChange:function(aM){var A=this;A._uiSetLabel(aM.newVal);},_setId:function(A){return aj.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aM){var A=this;A.get(v).toggleClass(am,aM);},_uiSetId:function(aM){var A=this;A.get(v).set(ap,aM);},_uiSetLabel:function(aM){var A=this;A.labelNode.setContent(aM);}}});aj.AvailableField=l;var X=function(){};X.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||N(A);}},maxFields:{value:Infinity,validator:Q}};aj.mix(X.prototype,{_setFields:function(aM){var A=this;if(N(aM)){return aM;}else{return A.createFields(aM);}},_updateFields:function(aM){var A=this;A.set(x,aM);},addField:function(aM){var A=this;if(A.get(x).size()<A.get(T)){var aN=A.createField(aM);if(aN){A._updateFields(A.get(x).add(aN));}return aN;}return null;},createFields:function(aN){var aM=this;var A=[];aK.each(aN,function(aP,aO){if(aO<aM.get(T)){A.push(aM.createField(aP));}});return new aj.ArrayList(A);},removeField:function(aM){var A=this;A._updateFields(A.get(x).remove(aM));},createField:function(A){return A;}});aj.FieldSupport=X;var az=aj.Component.create({NAME:K,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:G},canvas:{valueFn:function(){return aj.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:G},contentContainer:{valueFn:function(){return aj.Node.create(this.CONTENT_CONTAINER_TEMPLATE);}},dropContainer:{valueFn:function(){return aj.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return aj.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:G,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:G,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:G,value:null},toolbarContainer:{valueFn:function(){return aj.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{contentContainer:j+at,dropContainer:j+aL,fieldsContainer:j+i,toolbarContainer:j+aB,canvas:j+D},UI_ATTRS:[V,x],AUGMENTS:[aj.FieldSupport],prototype:{CONTENT_CONTAINER_TEMPLATE:'<div class="'+at+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+aL+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+aB+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[i,ak].join(aI)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+D+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(ag);A.contentContainer=A.get(e);A.dropContainer=A.get(ad);A.fieldsContainer=A.get(r);A.toolbarContainer=A.get(m);},isAvailableFieldsDrag:function(aN){var A=this;var aM=A.availableFieldsDrag;return(aN===aM.dd);},plotFields:function(){var aM=this;var A=aM.get(x);A.each(function(aN){aM.plotField(aN);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(V));},syncUI:function(){var A=this;var aM=A.get(z);A._setupDrop();A._setupAvailableFieldsDrag();aM.addClass(L);},_afterActiveTabChange:function(aN){var A=this;var aM=aN.newVal.get(U);if(A.get(aE)&&(aM===A.settingsNode)){A._renderSettings();}},_afterRender:function(aM){var A=this;A.plotFields();},_afterUiSetHeight:function(aM){var A=this;
A.contentContainer.setStyle(av,Q(aM)?aM+A.DEF_UNIT:aM);A.dropContainer.setStyle(av,Q(aM)?aM+A.DEF_UNIT:aM);},_defCancelFn:function(aM){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(ae);},_handleSaveEvent:function(){var A=this;A.fire(ar);},_renderCanvas:function(){var A=this;var aM=A.get(z);var aN=A.canvas;var aO=A.contentContainer;var aP=A.dropContainer;if(!aN.inDoc()){aO.appendChild(aN);}if(!aP.inDoc()){aN.appendChild(aP);}if(aO.inDoc()){aO.get(g).append(aO);}else{aM.appendChild(aO);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new aj.PropertyList(A.get(ai)).render(A.settingsNode);A.propertyList.get(w).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aM=new aj.TabView(A.get(M));aM.get(w);A.tabView=aM;A.fieldsNode=aM.getTab(0).get(U);A.settingsNode=aM.getTab(1).get(U);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new aj.Toolbar(A.get(P)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new aj.DD.Drop(A.get(aq));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new aj.DD.Delegate(A.get(aG));},_setAvailableFields:function(aN){var aM=this;var A=[];aK.each(aN,function(aP,aO){A.push(I(aP)?aP:new aj.AvailableField(aP));});return A;},_setDropConfig:function(aM){var A=this;return aj.merge({bubbleTargets:A,groups:[V],node:A.dropContainer},aM||{});},_setAvailableFieldsDragConfig:function(aM){var A=this;return aj.merge({bubbleTargets:A,container:A.get(w),dragConfig:{groups:[V],plugins:[{cfg:{moveOnEnd:false},fn:aj.Plugin.DDProxy}]},nodes:j+am},aM||{});},_setPropertyList:function(aM){var A=this;return aj.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aJ}},aM);},_setTabView:function(aP){var aM=this;var aO=aM.get(w);var aQ=aO.one(j+aH);var aN={after:{activeTabChange:aj.bind(aM._afterActiveTabChange,aM)},boundingBox:aO.one(j+q),contentBox:aO.one(j+ac),bubbleTargets:aM,contentNode:aO.one(j+aC),cssClass:q,listNode:aQ,render:aM.get(z)};if(!aQ){var A=aM.getStrings();aN.items=[{cssClass:an,label:A[o]},{cssClass:O,label:A[u]}];}return aj.merge(aN,aP);},_setToolbar:function(aN){var aM=this;var A=aM.getStrings();return aj.merge({activeState:false,bubbleTargets:aM,children:[{handler:aj.bind(aM._handleSaveEvent,aM),label:A[ar],icon:af},{handler:aj.bind(aM._handleCancelEvent,aM),label:A[ae]}]},aN);},_uiSetAvailableFields:function(aO){var A=this;var aN=A.fieldsNode;if(aN){var aM=aj.getDoc().invoke(J);aK.each(aO,function(aP){aM.appendChild(aP.get(v));});aN.setContent(A.fieldsContainer.setContent(aM));}},_uiSetFields:function(aM){var A=this;if(A.get(aE)){A.plotFields();}}}});aj.DiagramBuilderBase=az;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});