AUI.add("aui-diagram-builder-base",function(ad){var S=ad.Lang,d=S.isArray,ap=S.isBoolean,K=S.isNumber,z=S.isObject,at=S.isString,H=function(A){return(A instanceof ad.ArrayList);},Q=function(A){return(A instanceof ad.Node);},C=function(A){return(A instanceof ad.AvailableField);},aD=ad.Array,U="add",k="addNode",aC="auto",L="availableField",P="availableFields",az="availableFieldsDragConfig",am="base",s="boundingBox",aw="builder",Y="cancel",aa="canvas",aq="clearfix",a="container",ab="content",u="contentBox",O="contentNode",D="createDocumentFragment",y="diagram",E="diagram-builder-base",Z="disk",o="draggable",ay="drop",ak="dropConfig",W="dropContainer",ao="field",t="fields",n="fieldsContainer",an="height",p="helper",V="icon",v="iconClass",aj="id",af="label",ai="list",N="maxFields",r="node",ac="propertyList",ax="rendered",al="save",q="settings",M="tab",F="tabView",b="tabs",e="tabview",J="toolbar",j="toolbarContainer",w=ad.getClassName,aB=" ",g=".",G="$",h="#",aE=w(y,aw,am,ay,a),x=w(y,aw,am,aa),B=w(y,aw,am,ao),f=w(y,aw,am,t,a),ag=w(y,aw,am,ao,o),c=w(y,aw,am,ao,V),T=w(y,aw,am,ao,af),m=w(y,aw,am,b,a),X=w(y,aw,am,b,a,ab),ah=w(y,aw,am,M,U),I=w(y,aw,am,M,q),au=w(y,aw,am,J,a),ae=w(p,aq),l=w(V),av=w(e,ab),aA=w(e,ai);var i=ad.Component.create({NAME:L,ATTRS:{draggable:{value:true,validator:ap},label:{validator:at},iconClass:{validator:at},id:{value:ad.guid(),setter:"_setId",validator:at},node:{valueFn:function(aF){var A=this;if(!Q(aF)){aF=ad.Node.create(ad.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(v)}));aF.setData(L,A);}return aF;},validator:Q,writeOnce:true},type:{value:r,validator:at}},EXTENDS:ad.Base,buildNodeId:function(A){return P+G+ao+G+A;},getAvailableFieldById:function(A){return ad.AvailableField.getAvailableFieldByNode(h+ad.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){return ad.one(A).getData(L);},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+B+'">'+'<span class="'+[l,c].join(aB)+' {iconClass}"></span>'+'<span class="'+T+'"></span>'+"</li>",initializer:function(){var A=this;var aF=A.get(r);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aF.one(g+T);A._uiSetDraggable(A.get(o));A._uiSetId(A.get(aj));A._uiSetLabel(A.get(af));},_afterDraggableChange:function(aF){var A=this;A._uiSetDraggable(aF.newVal);},_afterIdChange:function(aF){var A=this;A._uiSetId(aF.newVal);},_afterLabelChange:function(aF){var A=this;A._uiSetLabel(aF.newVal);},_setId:function(A){return ad.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aF){var A=this;A.get(r).toggleClass(ag,aF);},_uiSetId:function(aF){var A=this;A.get(r).set(aj,aF);},_uiSetLabel:function(aF){var A=this;A.labelNode.setContent(aF);}}});ad.AvailableField=i;var R=function(){};R.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||H(A);}},maxFields:{value:Infinity,validator:K}};ad.mix(R.prototype,{_setFields:function(aF){var A=this;if(H(aF)){return aF;}else{return A.createFields(aF);}},_updateFields:function(aF){var A=this;A.set(t,aF);},addField:function(aF){var A=this;if(A.get(t).size()<A.get(N)){var aG=A.createField(aF);if(aG){A._updateFields(A.get(t).add(aG));}return aG;}return null;},createFields:function(aG){var aF=this;var A=[];aD.each(aG,function(aI,aH){if(aH<aF.get(N)){A.push(aF.createField(aI));}});return new ad.ArrayList(A);},removeField:function(aF){var A=this;A._updateFields(A.get(t).remove(aF));},createField:function(A){return A;}});ad.FieldSupport=R;var ar=ad.Component.create({NAME:E,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:z},canvas:{valueFn:function(){return ad.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:z},dropContainer:{valueFn:function(){return ad.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return ad.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:z,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:z,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:z,value:null},toolbarContainer:{valueFn:function(){return ad.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{dropContainer:g+aE,fieldsContainer:g+f,toolbarContainer:g+au,canvas:g+x},UI_ATTRS:[P,t],AUGMENTS:[ad.FieldSupport],prototype:{DROP_CONTAINER_TEMPLATE:'<div class="'+aE+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+au+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+f+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+x+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(aa);A.dropContainer=A.get(W);A.fieldsContainer=A.get(n);A.toolbarContainer=A.get(j);},isAvailableFieldsDrag:function(aG){var A=this;var aF=A.availableFieldsDrag;return(aG===aF.dd);},plotFields:function(){var aF=this;var A=aF.get(t);A.each(function(aG){aF.plotField(aG);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(P));},syncUI:function(){var A=this;var aF=A.get(u);A._setupDrop();A._setupAvailableFieldsDrag();aF.addClass(ae);},_afterActiveTabChange:function(aG){var A=this;var aF=aG.newVal.get(O);if(A.get(ax)&&(aF===A.settingsNode)){A._renderSettings();}},_afterRender:function(aF){var A=this;A.plotFields();},_afterUiSetHeight:function(aF){var A=this;A.dropContainer.setStyle(an,K(aF)?aF+A.DEF_UNIT:aF);},_defCancelFn:function(aF){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(Y);},_handleSaveEvent:function(){var A=this;A.fire(al);},_renderCanvas:function(){var A=this;var aF=A.get(u);var aG=A.canvas;
aG.appendChild(A.dropContainer);aF.appendChild(aG);},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ad.PropertyList(A.get(ac)).render(A.settingsNode);A.propertyList.get(s).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aF=new ad.TabView(A.get(F));A.tabView=aF;A.fieldsNode=aF.getTab(0).get(O);A.settingsNode=aF.getTab(1).get(O);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ad.Toolbar(A.get(J)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ad.DD.Drop(A.get(ak));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ad.DD.Delegate(A.get(az));},_setAvailableFields:function(aG){var aF=this;var A=[];aD.each(aG,function(aI,aH){A.push(C(aI)?aI:new ad.AvailableField(aI));});return A;},_setDropConfig:function(aF){var A=this;return ad.merge({bubbleTargets:A,groups:[P],node:A.dropContainer},aF||{});},_setAvailableFieldsDragConfig:function(aF){var A=this;return ad.merge({bubbleTargets:A,container:A.get(s),dragConfig:{groups:[P],plugins:[{cfg:{moveOnEnd:false},fn:ad.Plugin.DDProxy}]},nodes:g+ag},aF||{});},_setPropertyList:function(aF){var A=this;return ad.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aC}},aF);},_setTabView:function(aI){var aF=this;var aH=aF.get(s);var aJ=aH.one(g+aA);var aG={after:{activeTabChange:ad.bind(aF._afterActiveTabChange,aF)},boundingBox:aH.one(g+m),contentBox:aH.one(g+X),bubbleTargets:aF,contentNode:aH.one(g+av),cssClass:m,listNode:aJ,render:aF.get(u)};if(!aJ){var A=aF.getStrings();aG.items=[{cssClass:ah,label:A[k]},{cssClass:I,label:A[q]}];}return ad.merge(aG,aI);},_setToolbar:function(aG){var aF=this;var A=aF.getStrings();return ad.merge({activeState:false,bubbleTargets:aF,children:[{handler:ad.bind(aF._handleSaveEvent,aF),label:A[al],icon:Z},{handler:ad.bind(aF._handleCancelEvent,aF),label:A[Y]}]},aG);},_uiSetAvailableFields:function(aH){var A=this;var aG=A.fieldsNode;if(aG){var aF=ad.getDoc().invoke(D);aD.each(aH,function(aI){aF.appendChild(aI.get(r));});aG.setContent(A.fieldsContainer.setContent(aF));}},_uiSetFields:function(aF){var A=this;if(A.get(ax)){A.plotFields();}}}});ad.DiagramBuilderBase=ar;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});