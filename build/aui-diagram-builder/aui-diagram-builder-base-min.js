AUI.add("aui-diagram-builder-base",function(ai){var X=ai.Lang,d=X.isArray,aw=X.isBoolean,P=X.isNumber,F=X.isObject,az=X.isString,M=function(A){return(A instanceof ai.ArrayList);},V=function(A){return(A instanceof ai.Node);},H=function(A){return(A instanceof ai.AvailableField);},aK=ai.Array,Z="add",n="addNode",aJ="auto",Q="availableField",U="availableFields",aG="availableFieldsDragConfig",at="base",v="boundingBox",aD="builder",ad="cancel",af="canvas",ax="clearfix",ax="clearfix",e="column",a="container",ag="content",y="contentBox",T="contentNode",I="createDocumentFragment",D="diagram",J="diagram-builder-base",ae="disk",r="draggable",aF="drop",aq="dropConfig",ac="dropContainer",av="field",w="fields",q="fieldsContainer",au="height",s="helper",s="helper",aa="icon",z="iconClass",ap="id",ak="label",x="layout",ao="list",S="maxFields",u="node",f="parentNode",ah="propertyList",aE="rendered",ar="save",t="settings",R="tab",L="tabView",b="tabs",g="tabview",O="toolbar",l="toolbarContainer",B=ai.getClassName,aI=" ",i=".",j="#",aI=" ",E="_",m=B(e),C=B(D,aD,at,af),aL=B(D,aD,at,aF,a),G=B(D,aD,at,av),al=B(D,aD,at,av,r),c=B(D,aD,at,av,aa),Y=B(D,aD,at,av,ak),h=B(D,aD,at,w,a),an=B(D,aD,at,R,Z),N=B(D,aD,at,R,t),p=B(D,aD,at,b,a),ab=B(D,aD,at,b,a,ag),aB=B(D,aD,at,O,a),aj=B(s,ax),aj=B(s,ax),o=B(aa),K=B(x),aC=B(g,ag),aH=B(g,ao),aA=B("w15"),am=B("w85");var k=ai.Component.create({NAME:Q,ATTRS:{draggable:{value:true,validator:aw},label:{validator:az},iconClass:{validator:az},id:{value:ai.guid(),setter:"_setId",validator:az},node:{valueFn:function(aM){var A=this;if(!V(aM)){aM=ai.Node.create(ai.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(z)}));aM.setData(Q,A);}return aM;},validator:V,writeOnce:true},type:{value:u,validator:az}},EXTENDS:ai.Base,buildNodeId:function(A){return U+E+av+E+A;},getAvailableFieldById:function(A){return ai.AvailableField.getAvailableFieldByNode(j+ai.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){return ai.one(A).getData(Q);},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+[G,aj].join(aI)+'">'+'<span class="'+[o,c].join(aI)+' {iconClass}"></span>'+'<div class="'+Y+'"></div>'+"</li>",initializer:function(){var A=this;var aM=A.get(u);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aM.one(i+Y);A._uiSetDraggable(A.get(r));A._uiSetId(A.get(ap));A._uiSetLabel(A.get(ak));},_afterDraggableChange:function(aM){var A=this;A._uiSetDraggable(aM.newVal);},_afterIdChange:function(aM){var A=this;A._uiSetId(aM.newVal);},_afterLabelChange:function(aM){var A=this;A._uiSetLabel(aM.newVal);},_setId:function(A){return ai.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aM){var A=this;A.get(u).toggleClass(al,aM);},_uiSetId:function(aM){var A=this;A.get(u).set(ap,aM);},_uiSetLabel:function(aM){var A=this;A.labelNode.setContent(aM);}}});ai.AvailableField=k;var W=function(){};W.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||M(A);}},maxFields:{value:Infinity,validator:P}};ai.mix(W.prototype,{_setFields:function(aM){var A=this;if(M(aM)){return aM;}else{return A.createFields(aM);}},_updateFields:function(aM){var A=this;A.set(w,aM);},addField:function(aM){var A=this;if(A.get(w).size()<A.get(S)){var aN=A.createField(aM);if(aN){A._updateFields(A.get(w).add(aN));}return aN;}return null;},createFields:function(aN){var aM=this;var A=[];aK.each(aN,function(aP,aO){if(aO<aM.get(S)){A.push(aM.createField(aP));}});return new ai.ArrayList(A);},removeField:function(aM){var A=this;A._updateFields(A.get(w).remove(aM));},createField:function(A){return A;}});ai.FieldSupport=W;var ay=ai.Component.create({NAME:J,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:F},canvas:{valueFn:function(){return ai.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:F},dropContainer:{valueFn:function(){return ai.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return ai.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:F,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:F,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:F,value:null},toolbarContainer:{valueFn:function(){return ai.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{dropContainer:i+aL,fieldsContainer:i+h,toolbarContainer:i+aB,canvas:i+C},UI_ATTRS:[U,w],AUGMENTS:[ai.FieldSupport],prototype:{DROP_CONTAINER_TEMPLATE:'<div class="'+aL+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+aB+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[h,aj].join(aI)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+[am,m,C].join(aI)+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(af);A.dropContainer=A.get(ac);A.fieldsContainer=A.get(q);A.toolbarContainer=A.get(l);},isAvailableFieldsDrag:function(aN){var A=this;var aM=A.availableFieldsDrag;return(aN===aM.dd);},plotFields:function(){var aM=this;var A=aM.get(w);A.each(function(aN){aM.plotField(aN);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(U));},syncUI:function(){var A=this;var aM=A.get(y);A._setupDrop();A._setupAvailableFieldsDrag();aM.addClass(aj).addClass(K);},_afterActiveTabChange:function(aN){var A=this;var aM=aN.newVal.get(T);if(A.get(aE)&&(aM===A.settingsNode)){A._renderSettings();}},_afterRender:function(aM){var A=this;A.plotFields();},_afterUiSetHeight:function(aM){var A=this;A.dropContainer.setStyle(au,P(aM)?aM+A.DEF_UNIT:aM);},_defCancelFn:function(aM){var A=this;A.tabView.selectTab(0);
},_handleCancelEvent:function(){var A=this;A.fire(ad);},_handleSaveEvent:function(){var A=this;A.fire(ar);},_renderCanvas:function(){var A=this;var aM=A.get(y);var aN=A.canvas;aN.appendChild(A.dropContainer);if(aN.inDoc()){aN.get(f).appendChild(aN);}else{aM.appendChild(aN);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ai.PropertyList(A.get(ah)).render(A.settingsNode);A.propertyList.get(v).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aM=new ai.TabView(A.get(L));aM.get(v).addClass(m).addClass(aA);A.tabView=aM;A.fieldsNode=aM.getTab(0).get(T);A.settingsNode=aM.getTab(1).get(T);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ai.Toolbar(A.get(O)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ai.DD.Drop(A.get(aq));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ai.DD.Delegate(A.get(aG));},_setAvailableFields:function(aN){var aM=this;var A=[];aK.each(aN,function(aP,aO){A.push(H(aP)?aP:new ai.AvailableField(aP));});return A;},_setDropConfig:function(aM){var A=this;return ai.merge({bubbleTargets:A,groups:[U],node:A.dropContainer},aM||{});},_setAvailableFieldsDragConfig:function(aM){var A=this;return ai.merge({bubbleTargets:A,container:A.get(v),dragConfig:{groups:[U],plugins:[{cfg:{moveOnEnd:false},fn:ai.Plugin.DDProxy}]},nodes:i+al},aM||{});},_setPropertyList:function(aM){var A=this;return ai.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aJ}},aM);},_setTabView:function(aP){var aM=this;var aO=aM.get(v);var aQ=aO.one(i+aH);var aN={after:{activeTabChange:ai.bind(aM._afterActiveTabChange,aM)},boundingBox:aO.one(i+p),contentBox:aO.one(i+ab),bubbleTargets:aM,contentNode:aO.one(i+aC),cssClass:p,listNode:aQ,render:aM.get(y)};if(!aQ){var A=aM.getStrings();aN.items=[{cssClass:an,label:A[n]},{cssClass:N,label:A[t]}];}return ai.merge(aN,aP);},_setToolbar:function(aN){var aM=this;var A=aM.getStrings();return ai.merge({activeState:false,bubbleTargets:aM,children:[{handler:ai.bind(aM._handleSaveEvent,aM),label:A[ar],icon:ae},{handler:ai.bind(aM._handleCancelEvent,aM),label:A[ad]}]},aN);},_uiSetAvailableFields:function(aO){var A=this;var aN=A.fieldsNode;if(aN){var aM=ai.getDoc().invoke(I);aK.each(aO,function(aP){aM.appendChild(aP.get(u));});aN.setContent(A.fieldsContainer.setContent(aM));}},_uiSetFields:function(aM){var A=this;if(A.get(aE)){A.plotFields();}}}});ai.DiagramBuilderBase=ay;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});