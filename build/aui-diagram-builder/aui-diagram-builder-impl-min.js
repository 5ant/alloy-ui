AUI.add("aui-diagram-builder-impl",function(au){var aj=au.Lang,c=aj.isArray,aR=aj.isBoolean,J=aj.isObject,aV=aj.isString,ao=au.WidgetStdMod,a5=au.Array,ah="activeElement",X="availableField",Y="availableFields",z="backspace",ag="boolean",v="boundary",r="boundingBox",a1="builder",an="cancel",ap="canvas",aH="click",aW="closeEvent",G="closeMessage",aY="condition",N="connector",k="connectors",ar="content",Q="controls",aE="controlsToolbar",O="createDocumentFragment",aC="data",aa="delete",aA="deleteConnectorsMessage",p="deleteNodesMessage",aK="description",H="diagram",aq="diagram-builder",ax="diagramNode",aZ="diagram-node-manager",C="diagram-node",aO="dragNode",D="editEvent",M="editMessage",S="editing",aJ="end",a="esc",aQ="field",s="fields",av="fieldsDragConfig",at="fork",ae="graphic",aP="height",aG="id",t="join",T="keydown",o="name",q="node",az="p1",ay="p2",e="parentNode",m="pencil",aD="radius",al="records",l="recordset",a2="rendered",L="required",aU="selected",aN="shape",Z="shapeBoundary",i="shapeInvite",K="showSuggestConnector",U="source",aB="start",af="state",aM="suggest",aF="suggestConnectorOverlay",j="target",F="task",R="connector",n="transition",W="transitions",f="type",ak="visible",P="width",y="xy",x="zIndex",a4="-",h=".",V="",g="#",I="_",w=au.getClassName,u=w(H,a1,Q),aT=w(H,a1,aQ),ai=w(H,q),b=w(H,q,ar),aI=w(H,q,S),a3=w(H,q,aU),aL=w(H,q,aN,v),d=w(H,q,aM,N),am=function(a8,A){var a7=c(a8)?a8:a8.get(r).getXY();return[a7[0]+A[0],a7[1]+A[1]];},a0=function(a9,a8){var a7=a8[0]-a9[0],A=a8[1]-a9[1];return Math.sqrt(a7*a7+A*A);},ad=function(bh,bf){var bd=bh.hotPoints,bc=bf.hotPoints,bk=bh.get(r).getXY(),bi=bf.get(r).getXY(),a9,a7,ba,a8,bj=Infinity,bb=[[0,0],[0,0]];for(ba=0,a9=bd.length;ba<a9;ba++){var bg=bd[ba],bm=am(bk,bg);for(a8=0,a7=bc.length;a8<a7;a8++){var be=bc[a8],bl=am(bi,be),A=a0(bl,bm);if(A<bj){bb[0]=bg;bb[1]=be;bj=A;}}}return bb;},aw=function(A,a8){var a7=c(a8)?a8:a8.getXY();var a9=c(A)?A:A.getXY();return a5.map(a9,function(bb,ba){return Math.max(0,bb-a7[ba]);});},E=function(A){return(A instanceof au.Connector);},aX=function(A){return(A instanceof au.DataSet);},ab=function(A){return(A instanceof au.DiagramBuilderBase);},aS=function(A){return(A instanceof au.DiagramNode);};var B=au.Component.create({NAME:aq,ATTRS:{connector:{setter:"_setConnector",value:null},fieldsDragConfig:{value:null,setter:"_setFieldsDragConfig",validator:J},graphic:{valueFn:function(){return new au.Graphic();},validator:J},strings:{value:{addNode:"Add node",cancel:"Cancel",deleteConnectorsMessage:"Are you sure you want to delete the selected connector(s)?",deleteNodesMessage:"Are you sure you want to delete the selected node(s)?",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},showSuggestConnector:{validator:aR,value:true},suggestConnectorOverlay:{value:null,setter:"_setSuggestConnectorOverlay"}},EXTENDS:au.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{editingConnector:null,editingNode:null,publishedSource:null,publishedTarget:null,selectedConnector:null,selectedNode:null,initializer:function(){var A=this;A.after({render:A.syncConnectionsUI});A.on({cancel:A._onCancel,"drag:drag":A._onDrag,"drag:end":A._onDragEnd,"drop:hit":A._onDropHit,save:A._onSave});au.DiagramNodeManager.on({publishedSource:function(a7){A.publishedTarget=null;A.publishedSource=a7.publishedSource;}});A.handlerKeyDown=au.getDoc().on(T,au.bind(A._afterKeyEvent,A));A.dropContainer.delegate(aH,au.bind(A._onNodeClick,A),h+ai);},renderUI:function(){var A=this;au.DiagramBuilder.superclass.renderUI.apply(this,arguments);A._renderGraphic();},syncUI:function(){var A=this;au.DiagramBuilder.superclass.syncUI.apply(this,arguments);A._setupFieldsDrag();A.connector=A.get(R);},syncConnectionsUI:function(){var A=this;A.get(s).each(function(a7){a7.syncConnectionsUI();});},clearFields:function(){var a7=this;var A=[];a7.get(s).each(function(a8){A.push(a8);});a5.each(A,function(a8){a8.destroy();});A=a7.editingConnector=a7.editingNode=a7.selectedNode=null;},closeEditProperties:function(){var A=this;var a7=A.editingNode;var a8=A.tabView;a8.selectTab(au.DiagramBuilder.FIELDS_TAB);a8.disableTab(au.DiagramBuilder.SETTINGS_TAB);if(a7){a7.get(r).removeClass(aI);}A.editingConnector=A.editingNode=null;},connect:function(a7,a9,a8){var A=this;if(aV(a7)){a7=au.Widget.getByNode(g+au.DiagramNode.buildNodeId(a7));}if(aV(a9)){a9=au.Widget.getByNode(g+au.DiagramNode.buildNodeId(a9));}if(a7&&a9){a7.connect(a9.get(o),a8);}return A;},connectAll:function(a7){var A=this;a5.each(a7,function(a8){if(a8.hasOwnProperty(U)&&a8.hasOwnProperty(j)){A.connect(a8.source,a8.target,a8.connector);}});return A;},createField:function(a7){var A=this;if(!aS(a7)){a7.builder=A;a7.bubbleTargets=A;a7=new (A.getFieldClass(a7.type||q))(a7);}return a7;},deleteSelectedConnectors:function(){var a7=this;var A=a7.getStrings();var a8=a7.getSelectedConnectors();if(a8.length&&confirm(A[aA])){a5.each(a8,function(a9){var ba=a9.get(n);au.DiagramNode.getNodeByName(ba.source).disconnect(ba);});a7.stopEditing();}},deleteSelectedNode:function(){var a7=this;var A=a7.getStrings();var a8=a7.selectedNode;if(a8&&!a8.get(L)&&confirm(A[p])){a8.close();a7.editingNode=a7.selectedNode=null;a7.stopEditing();}},destructor:function(a7){var A=this;A.get(aF).destroy();},eachConnector:function(a7){var A=this;A.get(s).each(function(a8){a8.get(W).each(function(a9){a7.call(A,a8.getConnector(a9),a9,a8);});});},editConnector:function(a7){var A=this;if(a7){var a8=A.tabView;A.closeEditProperties();a8.enableTab(au.DiagramBuilder.SETTINGS_TAB);a8.selectTab(au.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(l,a7.getProperties());A.editingConnector=A.selectedConnector=a7;}},editNode:function(a8){var A=this;if(a8){var a7=A.tabView;A.closeEditProperties();a7.enableTab(au.DiagramBuilder.SETTINGS_TAB);a7.selectTab(au.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(l,a8.getProperties());a8.get(r).addClass(aI);A.editingNode=A.selectedNode=a8;}},getFieldClass:function(a8){var A=this;var a7=au.DiagramBuilder.types[a8];if(a7){return a7;
}else{au.log("The field type: ["+a8+"] couldn't be found.");return null;}},getNodesByTransitionProperty:function(a9,a8){var A=this;var a7=[];A.get(s).each(function(ba){ba.get(W).each(function(bb){if(bb[a9]===a8){a7.push(ba);return false;}});});return a7;},getSelectedConnectors:function(){var A=this;var a7=[];A.eachConnector(function(a8){if(a8.get(aU)){a7.push(a8);}});return a7;},getSourceNodes:function(a7){var A=this;return A.getNodesByTransitionProperty(j,a7.get(o));},hideSuggestConnetorOverlay:function(a8,a7){var A=this;A.connector.hide();A.get(aF).hide();},isFieldsDrag:function(a7){var A=this;return(a7===A.fieldsDrag.dd);},plotField:function(a7){var A=this;if(!a7.get(a2)){a7.render(A.dropContainer);}},select:function(a7){var A=this;A.unselectNodes();A.selectedNode=a7.set(aU,true).focus();},showSuggestConnetorOverlay:function(a7){var A=this;A.get(aF).setAttrs({xy:a7||A.connector.get(ay)}).show().get(r).addClass(d);},stopEditing:function(){var A=this;A.unselectConnectors();A.unselectNodes();A.closeEditProperties();},toJSON:function(){var A=this;var a7={nodes:[]};A.get(s).each(function(a9){var a8={transitions:[]};a5.each(a9.SERIALIZABLE_ATTRS,function(ba){a8[ba]=a9.get(ba);});a9.get(W).each(function(bb){var ba=a9.getConnector(bb);bb.connector=ba.toJSON();a8.transitions.push(bb);});a7.nodes.push(a8);});return a7;},unselectConnectors:function(){var A=this;a5.each(A.getSelectedConnectors(),function(a7){a7.set(aU,false);});},unselectNodes:function(){var A=this;var a7=A.selectedNode;if(a7){a7.set(aU,false);}A.selectedNode=null;},_afterKeyEvent:function(a7){var A=this;if(a7.hasModifier()||au.getDoc().get(ah).test(":input,td")){return;}if(a7.isKey(a)){A._onEscKey(a7);}else{if(a7.isKey(z)||a7.isKey(aa)){A._onDeleteKey(a7);}}},_onCancel:function(a7){var A=this;A.closeEditProperties();},_onDeleteKey:function(a7){var A=this;A.deleteSelectedConnectors();A.deleteSelectedNode();a7.halt();},_onDrag:function(a8){var A=this;var a7=a8.target;if(A.isFieldsDrag(a7)){var a9=au.Widget.getByNode(a7.get(aO));a9.alignTransitions();a5.each(A.getSourceNodes(a9),function(ba){ba.alignTransitions();});}},_onDragEnd:function(a8){var A=this;var a7=a8.target;var a9=au.Widget.getByNode(a7.get(aO));if(a9&&A.isFieldsDrag(a7)){a9.set(y,a9.getLeftTop());}},_onDropHit:function(a8){var A=this;var a7=a8.drag;if(A.isAvailableFieldsDrag(a7)){var ba=a7.get(q).getData(X);var a9=A.addField({xy:aw(a7.lastXY,A.dropContainer),type:ba.get(f)});A.select(a9);}},_onEscKey:function(a7){var A=this;A.hideSuggestConnetorOverlay();A.stopEditing();a7.halt();},_onNodeClick:function(a7){var A=this;var a8=au.Widget.getByNode(a7.currentTarget);A.select(a8);A._onNodeEdit(a7);},_onNodeEdit:function(a7){var A=this;if(!a7.target.ancestor(h+b,true)){return;}var a8=au.Widget.getByNode(a7.currentTarget);if(a8){A.editNode(a8);}},_onSave:function(a8){var A=this;var a7=A.editingNode;var a9=A.editingConnector;var ba=A.propertyList.get(l);if(a7){a5.each(ba.get(al),function(bb){var bc=bb.get(aC);a7.set(bc.attributeName,bc.value);});}else{if(a9){a5.each(ba.get(al),function(bb){var bc=bb.get(aC);a9.set(bc.attributeName,bc.value);});}}},_onSuggestConnectorNodeClick:function(a9){var A=this;var ba=a9.currentTarget.getData(X);var a7=A.connector;var a8=A.addField({type:ba.get(f),xy:a7.getCoordinate(a7.get(ay))});A.hideSuggestConnetorOverlay();A.publishedSource.connectNode(a8);},_renderGraphic:function(){var A=this;A.get(ae).render(A.get(ap));},_setConnector:function(a8){var A=this;if(!E(a8)){var a7=A.get(ap).getXY();a8=new au.Connector(au.merge({builder:A,graphic:A.get(ae),lazyDraw:true,p1:a7,p2:a7,shapeHover:null},a8));}return a8;},_setFieldsDragConfig:function(a8){var A=this;var a7=A.dropContainer;return au.merge({bubbleTargets:A,container:a7,dragConfig:{plugins:[{cfg:{constrain:a7},fn:au.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:au.Plugin.DDWinScroll}]},nodes:h+ai},a8||{});},_setSuggestConnectorOverlay:function(a8){var A=this;if(!a8){var a7=au.getDoc().invoke(O);a5.each(A.get(Y),function(ba){var a9=ba.get(q);a7.appendChild(a9.clone().setData(X,a9.getData(X)));});a8=new au.Overlay({bodyContent:a7,render:true,visible:false,zIndex:10000});a8.get(r).delegate(aH,au.bind(A._onSuggestConnectorNodeClick,A),h+aT);}return a8;},_setupFieldsDrag:function(){var A=this;A.fieldsDrag=new au.DD.Delegate(A.get(av));}}});au.DiagramBuilder=B;au.DiagramBuilder.types={};var ac=au.Component.create({NAME:aZ,EXTENDS:au.Base});au.DiagramNodeManager=new ac();var a6=au.Component.create({NAME:C,UI_ATTRS:[o,L,aU],ATTRS:{builder:{validator:ab},connectors:{valueFn:"_createDataSet",writeOnce:true},controlsToolbar:{validator:J,valueFn:"_valueControlsToolbar"},description:{value:V,validator:aV},graphic:{writeOnce:true,validator:J},height:{value:60},name:{valueFn:function(){var A=this;return A.get(f)+(++au.Env._uidx);},validator:aV},required:{value:false,validator:aR},selected:{value:false,validator:aR},shapeBoundary:{validator:J,valueFn:"_valueShapeBoundary"},shapeInvite:{validator:J,value:{radius:12,type:"circle",stroke:{weight:6,color:"#ff6600",opacity:0.8},fill:{color:"#ffd700",opacity:0.8}}},strings:{value:{closeMessage:"Close",description:"Description",editMessage:"Edit",name:"Name",type:"Type"}},tabIndex:{value:1},transitions:{value:null,writeOnce:true,setter:"_setTransitions"},type:{value:q,validator:aV},width:{value:60},zIndex:{value:100}},EXTENDS:au.Overlay,CIRCLE_POINTS:[[35,20],[28,33],[14,34],[5,22],[10,9],[24,6],[34,16],[31,30],[18,35],[6,26],[7,12],[20,5],[33,12],[34,26],[22,35],[9,30],[6,16],[16,6],[30,9],[35,22],[26,34],[12,33],[5,20],[12,7],[26,6],[35,18],[30,31],[16,34],[6,24],[9,10],[22,5],[34,14],[33,28],[20,35],[7,28],[6,14],[18,5],[31,10],[34,24],[24,34],[10,31],[5,18],[14,6],[28,8],[35,20],[28,33],[14,34],[5,22],[10,8],[25,6],[34,16],[31,30],[18,35],[6,26],[8,12],[20,5],[33,12],[33,27],[22,35],[8,30],[6,15],[16,6],[30,9],[35,23],[26,34],[12,32],[5,20],[12,7],[27,7],[35,18],[29,32],[15,34]],DIAMOND_POINTS:[[30,5],[35,10],[40,15],[45,20],[50,25],[55,30],[50,35],[45,40],[40,45],[35,50],[30,55],[25,50],[20,45],[15,40],[10,35],[5,30],[10,25],[15,20],[20,15],[25,10]],SQUARE_POINTS:[[5,5],[10,5],[15,5],[20,5],[25,5],[30,5],[35,5],[40,5],[50,5],[55,5],[60,5],[65,5],[65,10],[65,15],[65,20],[65,25],[65,30],[65,35],[65,40],[65,45],[65,50],[65,55],[65,60],[65,65],[60,65],[55,65],[50,65],[45,65],[40,65],[35,65],[30,65],[25,65],[20,65],[15,65],[10,65],[5,65],[5,60],[5,55],[5,50],[5,45],[5,40],[5,35],[5,30],[5,25],[5,20],[5,15],[5,10]],getNodeByName:function(A){return au.Widget.getByNode(g+au.DiagramNode.buildNodeId(A));
},buildNodeId:function(A){return ax+I+aQ+I+A.replace(/[^a-z0-9.:_\-]/ig,"_");},prototype:{boundary:null,hotPoints:[[0,0]],CONTROLS_TEMPLATE:'<div class="'+u+'"></div>',SERIALIZABLE_ATTRS:[aK,o,L,f,P,aP,x,y],initializer:function(){var A=this;A.after({"dataset:remove":au.bind(A._afterDataSetRemove,A),render:A._afterRender});A.on({nameChange:A._onNameChange});A.publish({boundaryDrag:{defaultFn:A._defBoundaryDrag},boundaryDragEnd:{defaultFn:A._defBoundaryDragEnd},boundaryDragOut:{defaultFn:A._defBoundaryDragOut},boundaryDragOver:{defaultFn:A._defBoundaryDragOver},boundaryDragStart:{defaultFn:A._defBoundaryDragStart},boundaryDrop:{defaultFn:A._defBoundaryDrop},boundaryMouseEnter:{},boundaryMouseLeave:{}});A.get(r).addClass(ai+a4+A.get(f));},destructor:function(){var A=this;A.eachConnector(function(a7,a8,a9){a9.removeTransition(a7.get(n));});A.invite.destroy();A.get(ae).destroy();A.get(a1).removeField(A);},addTransition:function(a8){var A=this;var a7=A.get(W);a8=A.prepareTransition(a8);if(!a7.containsKey(a8.uid)){a8.uid=au.guid();a7.add(a8.uid,a8);}return a8;},alignTransition:function(a8){var A=this;var a9=au.DiagramNode.getNodeByName(a8.target);if(a9){var a7=ad(A,a9);a8=au.merge(a8,{sourceXY:a7[0],targetXY:a7[1]});A.getConnector(a8).setAttrs({p1:am(A,a8.sourceXY),p2:am(a9,a8.targetXY)});}},alignTransitions:function(){var A=this;A.get(W).each(au.bind(A.alignTransition,A));},close:function(){var A=this;return A.destroy();},connect:function(bb,a9){var A=this;bb=A.addTransition(bb);var a7=null;var bc=au.DiagramNode.getNodeByName(bb.target);if(bc){if(!A.isTransitionConnected(bb)){var a8=A.get(a1);var ba=ad(A,bc);au.mix(bb,{sourceXY:ba[0],targetXY:ba[1]});a7=new au.Connector(au.merge({builder:a8,graphic:a8.get(ae),transition:bb},a9));A.get(k).add(bb.uid,a7);}}A.alignTransition(bb);return a7;},connectNode:function(a8){var a7=this;var A=a7.boundaryDragDelegate.dd;a7.connect(a7.prepareTransition({sourceXY:aw(A.startXY,a7.get(r)),target:a8.get(o),targetXY:aw(A.mouseXY,a8.get(r))}));},disconnect:function(a7){var A=this;if(A.isTransitionConnected(a7)){A.removeTransition(a7);}},eachConnector:function(a9){var A=this;var ba=[],a7=[].concat(A.get(k).values),a8=a7.length;a5.each(A.get(a1).getSourceNodes(A),function(bb){bb.get(k).each(function(bc){if(A.get(o)===bc.get(n).target){ba.push(bb);a7.push(bc);}});});a5.each(a7,function(bb,bc){a9.call(A,bb,bc,(bc<a8)?A:ba[bc-a8]);});a7=ba=null;return a7;},getConnector:function(a7){var A=this;return A.get(k).item(a7.uid);},getContainer:function(){var A=this;return(A.get(a1).dropContainer||A.get(r).get(e));},getLeftTop:function(){var A=this;return aw(A.get(r),A.getContainer());},getProperties:function(){var A=this;var a7=A.getPropertyModel();a5.each(a7,function(ba){var a9=A.get(ba.attributeName),a8=aj.type(a9);if(a8===ag){a9=String(a9);}ba.value=a9;});return a7;},getPropertyModel:function(){var a7=this;var A=a7.getStrings();return[{attributeName:aK,editor:new au.TextAreaCellEditor(),name:A[aK]},{attributeName:o,editor:new au.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[o]},{attributeName:f,editor:false,name:A[f]}];},isBoundaryDrag:function(a7){var A=this;return(a7===A.boundaryDragDelegate.dd);},isTransitionConnected:function(a7){var A=this;return A.get(k).containsKey(a7.uid);},prepareTransition:function(a8){var A=this;var a7={source:A.get(o),target:null,uid:au.guid()};if(aV(a8)){a7.target=a8;}else{if(J(a8)){a7=au.merge(a7,a8);}}return a7;},removeTransition:function(a7){var A=this;return A.get(W).removeKey(a7.uid);},renderShapeBoundary:function(){var A=this;var a7=A.boundary=A.get(ae).addShape(A.get(Z));a7.end();return a7;},renderShapeInvite:function(){var A=this;var a7=A.invite=A.get(a1).get(ae).addShape(A.get(i));a7.set(ak,false);a7.end();return a7;},syncConnectionsUI:function(){var A=this;A.get(W).each(au.bind(A.connect,A));},_afterDataSetRemove:function(a8){var A=this;var a7=a8.target;if(a7===A.get(W)){A.get(k).removeKey(a8.prevVal.uid);}else{if(a7===A.get(k)){a8.prevVal.destroy();}}},_afterRender:function(a7){var A=this;A.setStdModContent(ao.BODY,V,ao.AFTER);A._renderGraphic();A._renderControls();},_bindBoundaryEvents:function(){var A=this;A.boundary.detachAll().on({mouseenter:au.bind(A._onBoundaryMouseEnter,A),mouseleave:au.bind(A._onBoundaryMouseLeave,A)});},_createDataSet:function(){var A=this;return new au.DataSet({bubbleTargets:A});},_defBoundaryDrag:function(a9){var A=this;var a8=A.get(a1);var ba=A.boundaryDragDelegate.dd.mouseXY;a8.connector.set(ay,ba);if(a8.publishedTarget){var a7=A.invite;var bb=a7.get(aD)||0;if(!a7.get(ak)){a7.set(ak,true);}a7.setXY([ba[0]-bb,ba[1]-bb]);}},_defBoundaryDragEnd:function(bb){var A=this;var ba=bb.target;var a7=A.get(a1);var a8=a7.publishedSource;var a9=a8&&a7.publishedTarget;if(!a9&&a7.get(K)){a7.showSuggestConnetorOverlay();}else{a7.connector.hide();a8.invite.set(ak,false);}},_defBoundaryDragOut:function(a8){var A=this;var a7=A.get(a1);a7.publishedTarget=null;a7.publishedSource.invite.set(ak,false);},_defBoundaryDragOver:function(a8){var A=this;var a7=A.get(a1);if(a7.publishedSource!==A){a7.publishedTarget=A;}},_defBoundaryDragStart:function(a8){var A=this;var a7=A.get(a1);var a9=A.boundaryDragDelegate.dd.startXY;a7.connector.show().set(az,a9);au.DiagramNodeManager.fire("publishedSource",{publishedSource:A});},_defBoundaryDrop:function(a7){var A=this;A.connectNode(a7.publishedTarget);},_handleCloseEvent:function(a7){var A=this;if(!A.get(L)){A.close();}},_handleEditEvent:function(a7){var A=this;A.get(a1).editNode(A);},_onBoundaryDrag:function(a8){var A=this;var a7=A.get(a1);A.fire("boundaryDrag",{dragEvent:a8,publishedSource:a7.publishedSource});},_onBoundaryDragEnd:function(ba){var A=this;var a7=A.get(a1);var a8=a7.publishedSource;var a9=a7.publishedTarget;if(a8&&a9){A.fire("boundaryDrop",{dragEvent:ba,publishedSource:a8,publishedTarget:a9});}A.fire("boundaryDragEnd",{dragEvent:ba,publishedSource:a8});ba.target.get(aO).show();},_onBoundaryDragStart:function(a7){var A=this;A.fire("boundaryDragStart",{dragEvent:a7});
a7.target.get(aO).hide();},_onBoundaryMouseEnter:function(a9){var A=this;var a7=A.get(a1);var a8=a7.publishedSource;A.fire("boundaryMouseEnter",{domEvent:a9});if(a8){A.fire("boundaryDragOver",{domEvent:a9,publishedSource:a8});}},_onBoundaryMouseLeave:function(a9){var A=this;var a7=A.get(a1);var a8=a7.publishedSource;A.fire("boundaryMouseLeave",{domEvent:a9});if(a8){A.fire("boundaryDragOut",{domEvent:a9,publishedSource:a8});}},_onNameChange:function(a7){var A=this;A.eachConnector(function(a8,a9,ba){var bb=a8.get(n);bb[(A===ba)?U:j]=a7.newVal;a8.set(n,bb);});},_renderControls:function(){var A=this;var a7=A.get(r);A.controlsNode=au.Node.create(A.CONTROLS_TEMPLATE).appendTo(a7);},_renderControlsToolbar:function(a7){var A=this;A.controlsToolbar=new au.Toolbar(A.get(aE)).render(A.controlsNode);A._uiSetRequired(A.get(L));},_renderGraphic:function(){var A=this;A.set(ae,new au.Graphic({height:A.get(aP),render:A.bodyNode,width:A.get(P)}));A.renderShapeInvite();A.renderShapeBoundary().addClass(aL);A._bindBoundaryEvents();A._setupBoundaryDrag();},_setTransitions:function(a8){var A=this;if(!aX(a8)){var a7=A._createDataSet();au.Array.each(a8,function(ba){var a9=au.guid();ba=J(ba)?au.mix(ba,{uid:a9}):{uid:a9,target:ba};a7.add(a9,A.prepareTransition(ba));});a8=a7;}return a8;},_setupBoundaryDrag:function(){var A=this;var a7=A.get(a1);A.boundaryDragDelegate=new au.DD.Delegate({bubbleTargets:A,container:A.bodyNode,nodes:h+aL,dragConfig:{useShim:false,plugins:[{cfg:{constrain:(a7?a7.get(ap):null)},fn:au.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:au.Plugin.DDWinScroll},{cfg:{borderStyle:"0px",moveOnEnd:false,resizeFrame:false},fn:au.Plugin.DDProxy}]},on:{"drag:drag":au.bind(A._onBoundaryDrag,A),"drag:end":au.bind(A._onBoundaryDragEnd,A),"drag:start":au.bind(A._onBoundaryDragStart,A)}});au.Do.after(A._bindBoundaryEvents,A.boundaryDragDelegate.dd,"_unprep",A);},_uiSetName:function(a8){var A=this;var a7=A.get(r);a7.set(aG,au.DiagramNode.buildNodeId(a8));},_uiSetRequired:function(a9){var a8=this;var a7=a8.getStrings();var A=a8.controlsToolbar;if(A){if(a9){A.remove(aW);}else{A.add({handler:au.bind(a8._handleCloseEvent,a8),icon:an,id:aW,title:a7[G]});}}},_uiSetSelected:function(a7){var A=this;A.get(r).toggleClass(a3,a7);if(a7&&!A.controlsToolbar){A._renderControlsToolbar();}},_uiSetXY:function(a8){var A=this;var a7=A.getContainer().getXY();this._posNode.setXY([a8[0]+a7[0],a8[1]+a7[1]]);},_valueControlsToolbar:function(a8){var a7=this;var A=a7.getStrings();return{activeState:false,children:[{handler:au.bind(a7._handleEditEvent,a7),icon:m,id:D,title:A[M]},{handler:au.bind(a7._handleCloseEvent,a7),icon:an,id:aW,title:A[G]}]};},_valueShapeBoundary:function(){var A=this;return{height:40,type:"rect",stroke:{weight:7,color:"transparent"},width:40};}}});au.DiagramNode=a6;au.DiagramBuilder.types[q]=au.DiagramNode;au.DiagramNodeState=au.Component.create({NAME:C,ATTRS:{height:{value:40},type:{value:af},width:{value:40}},EXTENDS:au.DiagramNode,prototype:{hotPoints:au.DiagramNode.CIRCLE_POINTS,renderShapeBoundary:function(){var A=this;var a7=A.boundary=A.get(ae).addShape(A.get(Z));a7.translate(5,5);a7.end();return a7;},_valueShapeBoundary:function(){var A=this;return{radius:15,type:"circle",stroke:{weight:7,color:"transparent"}};}}});au.DiagramBuilder.types[af]=au.DiagramNodeState;au.DiagramNodeCondition=au.Component.create({NAME:C,ATTRS:{height:{value:60},type:{value:aY},width:{value:60}},EXTENDS:au.DiagramNodeState,prototype:{hotPoints:au.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:function(){var A=this;var a7=A.boundary=A.get(ae).addShape(A.get(Z));a7.translate(10,10);a7.rotate(45);a7.end();return a7;},_valueShapeBoundary:au.DiagramNode.prototype._valueShapeBoundary}});au.DiagramBuilder.types[aY]=au.DiagramNodeCondition;au.DiagramNodeStart=au.Component.create({NAME:C,ATTRS:{type:{value:aB}},EXTENDS:au.DiagramNodeState});au.DiagramBuilder.types[aB]=au.DiagramNodeStart;au.DiagramNodeEnd=au.Component.create({NAME:C,ATTRS:{type:{value:aJ}},EXTENDS:au.DiagramNodeState});au.DiagramBuilder.types[aJ]=au.DiagramNodeEnd;au.DiagramNodeJoin=au.Component.create({NAME:C,ATTRS:{height:{value:60},type:{value:t},width:{value:60}},EXTENDS:au.DiagramNodeState,prototype:{hotPoints:au.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:au.DiagramNodeCondition.prototype.renderShapeBoundary,_valueShapeBoundary:au.DiagramNode.prototype._valueShapeBoundary}});au.DiagramBuilder.types[t]=au.DiagramNodeJoin;au.DiagramNodeFork=au.Component.create({NAME:C,ATTRS:{height:{value:60},type:{value:at},width:{value:60}},EXTENDS:au.DiagramNodeState,prototype:{hotPoints:au.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:au.DiagramNodeCondition.prototype.renderShapeBoundary,_valueShapeBoundary:au.DiagramNode.prototype._valueShapeBoundary}});au.DiagramBuilder.types[at]=au.DiagramNodeFork;au.DiagramNodeTask=au.Component.create({NAME:C,ATTRS:{height:{value:70},type:{value:F},width:{value:70}},EXTENDS:au.DiagramNodeState,prototype:{hotPoints:au.DiagramNode.SQUARE_POINTS,renderShapeBoundary:function(){var A=this;var a7=A.boundary=A.get(ae).addShape(A.get(Z));a7.translate(8,8);a7.end();return a7;},_valueShapeBoundary:function(){var A=this;return{height:55,type:"rect",stroke:{weight:7,color:"transparent"},width:55};}}});au.DiagramBuilder.types[F]=au.DiagramNodeTask;},"@VERSION@",{requires:["aui-data-set","aui-diagram-builder-base","aui-diagram-builder-connector","overlay"],skinnable:true});