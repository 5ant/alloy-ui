AUI.add("aui-diagram-builder-impl",function(an){var ad=an.Lang,c=ad.isArray,aJ=ad.isBoolean,I=ad.isObject,aM=ad.isString,ai=an.WidgetStdMod,aW=an.Array,ab="activeElement",T="availableField",y="backspace",Z="boolean",u="boundary",q="boundingBox",aS="builder",ah="cancel",aj="canvas",aA="click",aN="closeEvent",F="closeMessage",aP="condition",j="connectors",al="content",M="controls",ay="controlsToolbar",aw="data",V="delete",au="deleteConnectorsMessage",o="deleteNodesMessage",aD="description",G="diagram",ak="diagram-builder",aq="diagramNode",aQ="diagram-node-manager",B="diagram-node",aG="dragNode",O="editing",C="editEvent",K="editMessage",aC="end",a="esc",aI="field",r="fields",ao="fieldsDragConfig",am="fork",Y="graphic",aH="height",az="id",s="join",P="keydown",n="name",p="node",at="p1",ar="p2",d="parentNode",l="pencil",ax="radius",af="records",k="recordset",aT="rendered",J="required",aL="selected",aF="shape",U="shapeBoundary",h="shapeInvite",Q="source",av="start",aa="state",i="target",E="task",N="connector",m="transition",S="transitions",e="type",ae="visible",L="width",x="xy",w="zIndex",aV="-",g=".",R="",f="#",H="_",v=an.getClassName,t=v(G,aS,M),ac=v(G,p),aE=v(G,p,aF,u),b=v(G,p,al),aB=v(G,p,O),aU=v(G,p,aL),ag=function(a0,A){var aZ=c(a0)?a0:a0.get(q).getXY();return[aZ[0]+A[0],aZ[1]+A[1]];},aR=function(a1,a0){var aZ=a0[0]-a1[0],A=a0[1]-a1[1];return Math.sqrt(aZ*aZ+A*A);},aY=function(a9,a7){var a5=a9.hotPoints,a4=a7.hotPoints,bc=a9.get(q).getXY(),ba=a7.get(q).getXY(),a1,aZ,a2,a0,bb=Infinity,a3=[[0,0],[0,0]];for(a2=0,a1=a5.length;a2<a1;a2++){var a8=a5[a2],be=ag(bc,a8);for(a0=0,aZ=a4.length;a0<aZ;a0++){var a6=a4[a0],bd=ag(ba,a6),A=aR(bd,be);if(A<bb){a3[0]=a8;a3[1]=a6;bb=A;}}}return a3;},ap=function(A,a0){var aZ=c(a0)?a0:a0.getXY();var a1=c(A)?A:A.getXY();return aW.map(a1,function(a3,a2){return Math.max(0,a3-aZ[a2]);});},D=function(A){return(A instanceof an.Connector);},aO=function(A){return(A instanceof an.DataSet);},W=function(A){return(A instanceof an.DiagramBuilderBase);},aK=function(A){return(A instanceof an.DiagramNode);};var z=an.Component.create({NAME:ak,ATTRS:{connector:{setter:"_setConnector",value:null},fieldsDragConfig:{value:null,setter:"_setFieldsDragConfig",validator:I},graphic:{valueFn:function(){return new an.Graphic();},validator:I},strings:{value:{addNode:"Add node",cancel:"Cancel",deleteConnectorsMessage:"Are you sure you want to delete the selected connector(s)?",deleteNodesMessage:"Are you sure you want to delete the selected node(s)?",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}}},EXTENDS:an.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{editingConnector:null,editingNode:null,selectedConnector:null,selectedNode:null,initializer:function(){var A=this;A.after({render:A.syncConnectionsUI});A.on({cancel:A._onCancel,"drag:drag":A._onDrag,"drag:end":A._onDragEnd,"drop:hit":A._onDropHit,save:A._onSave});A.handlerKeyDown=an.getDoc().on(P,an.bind(A._afterKeyEvent,A));A.dropContainer.delegate(aA,an.bind(A._onNodeClick,A),g+ac);},renderUI:function(){var A=this;an.DiagramBuilder.superclass.renderUI.apply(this,arguments);A._renderGraphic();},syncUI:function(){var A=this;an.DiagramBuilder.superclass.syncUI.apply(this,arguments);A._setupFieldsDrag();A.connector=A.get(N);},syncConnectionsUI:function(){var A=this;A.get(r).each(function(aZ){aZ.syncConnectionsUI();});},clearFields:function(){var aZ=this;var A=[];aZ.get(r).each(function(a0){A.push(a0);});aW.each(A,function(a0){a0.destroy();});A=aZ.editingConnector=aZ.editingNode=aZ.selectedNode=null;},closeEditProperties:function(){var A=this;var aZ=A.editingNode;var a0=A.tabView;a0.selectTab(an.DiagramBuilder.FIELDS_TAB);a0.disableTab(an.DiagramBuilder.SETTINGS_TAB);if(aZ){aZ.get(q).removeClass(aB);}A.editingConnector=A.editingNode=null;},connect:function(aZ,a0){var A=this;if(aM(aZ)){aZ=an.Widget.getByNode(f+an.DiagramNode.buildNodeId(aZ));}if(aM(a0)){a0=an.Widget.getByNode(f+an.DiagramNode.buildNodeId(a0));}if(aZ&&a0){aZ.connect(a0.get(n));}return A;},connectAll:function(aZ){var A=this;aW.each(aZ,function(a0){if(a0.hasOwnProperty(Q)&&a0.hasOwnProperty(i)){A.connect(a0.source,a0.target,a0.connector);}});return A;},createField:function(aZ){var A=this;if(!aK(aZ)){aZ.builder=A;aZ.bubbleTargets=A;aZ=new (A.getFieldClass(aZ.type||p))(aZ);}return aZ;},deleteSelectedConnectors:function(){var aZ=this;var A=aZ.getStrings();var a0=aZ.getSelectedConnectors();if(a0.length&&confirm(A[au])){aW.each(a0,function(a1){var a2=a1.get(m);an.DiagramNode.getNodeByName(a2.source).disconnect(a2);});aZ.stopEditing();}},deleteSelectedNode:function(){var aZ=this;var A=aZ.getStrings();var a0=aZ.selectedNode;if(a0&&!a0.get(J)&&confirm(A[o])){a0.close();aZ.editingNode=aZ.selectedNode=null;aZ.stopEditing();}},eachConnector:function(aZ){var A=this;A.get(r).each(function(a0){a0.get(S).each(function(a1){aZ.call(A,a0.getConnector(a1),a1,a0);});});},editConnector:function(aZ){var A=this;if(aZ){var a0=A.tabView;A.closeEditProperties();a0.enableTab(an.DiagramBuilder.SETTINGS_TAB);a0.selectTab(an.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(k,aZ.getProperties());A.editingConnector=A.selectedConnector=aZ;}},editNode:function(a0){var A=this;if(a0){var aZ=A.tabView;A.closeEditProperties();aZ.enableTab(an.DiagramBuilder.SETTINGS_TAB);aZ.selectTab(an.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(k,a0.getProperties());a0.get(q).addClass(aB);A.editingNode=A.selectedNode=a0;}},getFieldClass:function(a0){var A=this;var aZ=an.DiagramBuilder.types[a0];if(aZ){return aZ;}else{an.log("The field type: ["+a0+"] couldn't be found.");return null;}},getNodesByTransitionProperty:function(a1,a0){var A=this;var aZ=[];A.get(r).some(function(a2){a2.get(S).each(function(a3){if(a3[a1]===a0){aZ.push(a2);return false;}});});return aZ;},getSelectedConnectors:function(){var A=this;var aZ=[];A.eachConnector(function(a0){if(a0.get(aL)){aZ.push(a0);}});return aZ;},getSourceNodes:function(aZ){var A=this;return A.getNodesByTransitionProperty(i,aZ.get(n));},isFieldsDrag:function(a0){var A=this;
var aZ=A.fieldsDrag;return(a0===aZ.dd);},plotField:function(aZ){var A=this;if(!aZ.get(aT)){aZ.render(A.dropContainer);}},select:function(aZ){var A=this;A.unselectNodes();A.selectedNode=aZ.set(aL,true).focus();},stopEditing:function(){var A=this;A.unselectConnectors();A.unselectNodes();A.closeEditProperties();},toJSON:function(){var A=this;var aZ={nodes:[]};A.get(r).each(function(a1){var a0={transitions:[]};aW.each(a1.SERIALIZABLE_ATTRS,function(a2){a0[a2]=a1.get(a2);});a1.get(S).each(function(a3){var a2=a1.getConnector(a3);a3.connector=a2.toJSON();a0.transitions.push(a3);});aZ.nodes.push(a0);});return aZ;},unselectConnectors:function(){var A=this;aW.each(A.getSelectedConnectors(),function(aZ){aZ.set(aL,false);});},unselectNodes:function(){var A=this;var aZ=A.selectedNode;if(aZ){aZ.set(aL,false);}A.selectedNode=null;},_afterKeyEvent:function(aZ){var A=this;if(aZ.hasModifier()||an.getDoc().get(ab).test(":input,td")){return;}if(aZ.isKey(a)){A._onEscKey(aZ);}else{if(aZ.isKey(y)||aZ.isKey(V)){A._onDeleteKey(aZ);}}},_onCancel:function(aZ){var A=this;A.closeEditProperties();},_onDeleteKey:function(aZ){var A=this;A.deleteSelectedConnectors();A.deleteSelectedNode();aZ.halt();},_onDrag:function(a0){var A=this;var aZ=a0.target;if(A.isFieldsDrag(aZ)){var a1=an.Widget.getByNode(aZ.get(aG));a1.alignTransitions();aW.each(A.getSourceNodes(a1),function(a2){a2.alignTransitions();});}},_onDragEnd:function(a0){var A=this;var aZ=a0.target;if(A.isFieldsDrag(aZ)){var a1=an.Widget.getByNode(aZ.get(aG));a1.set(x,a1.getLeftTop());}},_onDropHit:function(a0){var A=this;var aZ=a0.drag;if(A.isAvailableFieldsDrag(aZ)){var a2=aZ.get(p).getData(T);var a1=A.addField({xy:ap(aZ.lastXY,A.dropContainer),type:a2.get(e)});A.select(a1);}},_onEscKey:function(aZ){var A=this;A.stopEditing();aZ.halt();},_onNodeClick:function(aZ){var A=this;var a0=an.Widget.getByNode(aZ.currentTarget);A.select(a0);A._onNodeEdit(aZ);},_onNodeEdit:function(aZ){var A=this;if(!aZ.target.ancestor(g+b,true)){return;}var a0=an.Widget.getByNode(aZ.currentTarget);if(a0){A.editNode(a0);}},_onSave:function(a0){var A=this;var aZ=A.editingNode;var a1=A.editingConnector;var a2=A.propertyList.get(k);if(aZ){aW.each(a2.get(af),function(a3){var a4=a3.get(aw);aZ.set(a4.attributeName,a4.value);});}else{if(a1){aW.each(a2.get(af),function(a3){var a4=a3.get(aw);a1.set(a4.attributeName,a4.value);});}}},_renderGraphic:function(){var A=this;A.get(Y).render(A.get(aj));},_setConnector:function(a0){var A=this;if(!D(a0)){var aZ=A.get(aj).getXY();a0=new an.Connector(an.merge({builder:A,graphic:A.get(Y),lazyDraw:true,p1:aZ,p2:aZ,shapeHover:null},a0));}return a0;},_setFieldsDragConfig:function(a0){var A=this;var aZ=A.dropContainer;return an.merge({bubbleTargets:A,container:aZ,dragConfig:{plugins:[{cfg:{constrain:aZ},fn:an.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:an.Plugin.DDWinScroll}]},nodes:g+ac},a0||{});},_setupFieldsDrag:function(){var A=this;A.fieldsDrag=new an.DD.Delegate(A.get(ao));}}});an.DiagramBuilder=z;an.DiagramBuilder.types={};var X=an.Component.create({NAME:aQ,EXTENDS:an.Base});an.DiagramNodeManager=new X();var aX=an.Component.create({NAME:B,UI_ATTRS:[n,J,aL],ATTRS:{builder:{validator:W},connectors:{valueFn:"_createDataSet",writeOnce:true},controlsToolbar:{validator:I,valueFn:"_valueControlsToolbar"},description:{value:R,validator:aM},graphic:{writeOnce:true,validator:I},height:{value:60},name:{valueFn:function(){var A=this;return A.get(e)+(++an.Env._uidx);},validator:aM},required:{value:false,validator:aJ},selected:{value:false,validator:aJ},shapeBoundary:{validator:I,valueFn:"_valueShapeBoundary"},shapeInvite:{validator:I,value:{radius:12,type:"circle",stroke:{weight:6,color:"#ff6600",opacity:0.8},fill:{color:"#ffd700",opacity:0.8}}},strings:{value:{closeMessage:"Close",description:"Description",editMessage:"Edit",name:"Name",type:"Type"}},tabIndex:{value:1},transitions:{value:null,writeOnce:true,setter:"_setTransitions"},type:{value:p,validator:aM},width:{value:60},zIndex:{value:100}},EXTENDS:an.Overlay,CIRCLE_POINTS:[[35,20],[28,33],[14,34],[5,22],[10,9],[24,6],[34,16],[31,30],[18,35],[6,26],[7,12],[20,5],[33,12],[34,26],[22,35],[9,30],[6,16],[16,6],[30,9],[35,22],[26,34],[12,33],[5,20],[12,7],[26,6],[35,18],[30,31],[16,34],[6,24],[9,10],[22,5],[34,14],[33,28],[20,35],[7,28],[6,14],[18,5],[31,10],[34,24],[24,34],[10,31],[5,18],[14,6],[28,8],[35,20],[28,33],[14,34],[5,22],[10,8],[25,6],[34,16],[31,30],[18,35],[6,26],[8,12],[20,5],[33,12],[33,27],[22,35],[8,30],[6,15],[16,6],[30,9],[35,23],[26,34],[12,32],[5,20],[12,7],[27,7],[35,18],[29,32],[15,34]],DIAMOND_POINTS:[[30,5],[35,10],[40,15],[45,20],[50,25],[55,30],[50,35],[45,40],[40,45],[35,50],[30,55],[25,50],[20,45],[15,40],[10,35],[5,30],[10,25],[15,20],[20,15],[25,10]],SQUARE_POINTS:[[5,5],[10,5],[15,5],[20,5],[25,5],[30,5],[35,5],[40,5],[50,5],[55,5],[60,5],[65,5],[65,10],[65,15],[65,20],[65,25],[65,30],[65,35],[65,40],[65,45],[65,50],[65,55],[65,60],[65,65],[60,65],[55,65],[50,65],[45,65],[40,65],[35,65],[30,65],[25,65],[20,65],[15,65],[10,65],[5,65],[5,60],[5,55],[5,50],[5,45],[5,40],[5,35],[5,30],[5,25],[5,20],[5,15],[5,10]],getNodeByName:function(A){return an.Widget.getByNode(f+an.DiagramNode.buildNodeId(A));},buildNodeId:function(A){return aq+H+aI+H+A.replace(/[^a-z0-9.:_\-]/ig,"_");},prototype:{boundary:null,hotPoints:[[0,0]],publishedTarget:null,publishedSource:null,CONTROLS_TEMPLATE:'<div class="'+t+'"></div>',SERIALIZABLE_ATTRS:[aD,n,J,e,L,aH,w,x],initializer:function(){var A=this;A.after({"dataset:remove":an.bind(A._afterDataSetRemove,A),render:A._afterRender});A.on({nameChange:A._onNameChange});A.publish({boundaryDrag:{defaultFn:A._defBoundaryDrag},boundaryDragEnd:{defaultFn:A._defBoundaryDragEnd},boundaryDragOut:{defaultFn:A._defBoundaryDragOut},boundaryDragOver:{defaultFn:A._defBoundaryDragOver},boundaryDragStart:{defaultFn:A._defBoundaryDragStart},boundaryDrop:{defaultFn:A._defBoundaryDrop},boundaryMouseEnter:{},boundaryMouseLeave:{}});an.DiagramNodeManager.on({publishedSource:function(aZ){A.publishedSource=aZ.publishedSource;
},releasedSource:function(aZ){A.publishedSource.publishedTarget=null;A.publishedSource=null;}});A.get(q).addClass(ac+aV+A.get(e));},destructor:function(){var A=this;A.eachConnector(function(aZ,a0,a1){a1.removeTransition(aZ.get(m));});A.invite.destroy();A.get(Y).destroy();A.get(aS).removeField(A);},addTransition:function(a0){var A=this;var aZ=A.get(S);a0=A.prepareTransition(a0);if(!aZ.containsKey(a0.uid)){a0.uid=an.guid();aZ.add(a0.uid,a0);}return a0;},alignTransition:function(a0){var A=this;var a1=an.DiagramNode.getNodeByName(a0.target);if(a1){var aZ=aY(A,a1);a0=an.merge(a0,{sourceXY:aZ[0],targetXY:aZ[1]});A.getConnector(a0).setAttrs({p1:ag(A,a0.sourceXY),p2:ag(a1,a0.targetXY)});}},alignTransitions:function(){var A=this;A.get(S).each(an.bind(A.alignTransition,A));},close:function(){var A=this;return A.destroy();},connect:function(a2){var A=this;a2=A.addTransition(a2);var aZ=null;var a3=an.DiagramNode.getNodeByName(a2.target);if(a3){if(!A.isTransitionConnected(a2)){var a0=A.get(aS);var a1=aY(A,a3);an.mix(a2,{sourceXY:a1[0],targetXY:a1[1]});aZ=new an.Connector({builder:a0,graphic:a0.get(Y),transition:a2});A.get(j).add(a2.uid,aZ);}}A.alignTransition(a2);return aZ;},disconnect:function(aZ){var A=this;if(A.isTransitionConnected(aZ)){A.removeTransition(aZ);}__dump();},eachConnector:function(a1){var A=this;var a2=[],aZ=[].concat(A.get(j).values),a0=aZ.length;aW.each(A.get(aS).getSourceNodes(A),function(a3){a3.get(j).each(function(a4){if(A.get(n)===a4.get(m).target){a2.push(a3);aZ.push(a4);}});});aW.each(aZ,function(a3,a4){a1.call(A,a3,a4,(a4<a0)?A:a2[a4-a0]);});aZ=a2=null;return aZ;},getConnector:function(aZ){var A=this;return A.get(j).item(aZ.uid);},getContainer:function(){var A=this;return(A.get(aS).dropContainer||A.get(q).get(d));},getLeftTop:function(){var A=this;return ap(A.get(q),A.getContainer());},getProperties:function(){var A=this;var aZ=A.getPropertyModel();aW.each(aZ,function(a2){var a1=A.get(a2.attributeName),a0=ad.type(a1);if(a0===Z){a1=String(a1);}a2.value=a1;});return aZ;},getPropertyModel:function(){var aZ=this;var A=aZ.getStrings();return[{attributeName:aD,editor:new an.TextAreaCellEditor(),name:A[aD]},{attributeName:n,editor:new an.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[n]},{attributeName:e,editor:false,name:A[e]}];},isTransitionConnected:function(aZ){var A=this;return A.get(j).containsKey(aZ.uid);},prepareTransition:function(a0){var A=this;var aZ={source:A.get(n),target:null,uid:an.guid()};if(aM(a0)){aZ.target=a0;}else{if(I(a0)){aZ=an.merge(aZ,a0);}}return aZ;},removeTransition:function(aZ){var A=this;return A.get(S).removeKey(aZ.uid);},renderShapeBoundary:function(){var A=this;var aZ=A.boundary=A.get(Y).addShape(A.get(U));aZ.end();return aZ;},renderShapeInvite:function(){var A=this;var aZ=A.invite=A.get(aS).get(Y).addShape(A.get(h));aZ.set(ae,false);aZ.end();return aZ;},syncConnectionsUI:function(){var A=this;A.get(S).each(an.bind(A.connect,A));},_afterDataSetRemove:function(a0){var A=this;var aZ=a0.target;if(aZ===A.get(S)){A.get(j).removeKey(a0.prevVal.uid);}else{if(aZ===A.get(j)){a0.prevVal.destroy();}}},_afterRender:function(aZ){var A=this;A.setStdModContent(ai.BODY,R,ai.AFTER);A._renderGraphic();A._renderControls();},_bindBoundaryEvents:function(){var A=this;A.boundary.detachAll().on({mouseenter:an.bind(A._onBoundaryMouseEnter,A),mouseleave:an.bind(A._onBoundaryMouseLeave,A)});},_createDataSet:function(){var A=this;return new an.DataSet({bubbleTargets:A});},_defBoundaryDrag:function(a1){var A=this;var a0=A.get(aS);var a2=A.boundaryDragDelegate.dd.mouseXY;a0.connector.set(ar,a2);if(A.publishedTarget){var aZ=A.invite;var a3=aZ.get(ax)||0;if(!aZ.get(ae)){aZ.set(ae,true);}aZ.setXY([a2[0]-a3,a2[1]-a3]);}},_defBoundaryDragEnd:function(aZ){var A=this;A.get(aS).connector.hide();A.publishedSource.invite.set(ae,false);an.DiagramNodeManager.fire("releasedSource",{releasedSource:A});},_defBoundaryDragOut:function(a0){var A=this;var aZ=A.publishedSource;aZ.publishedTarget=null;aZ.invite.set(ae,false);},_defBoundaryDragOver:function(a0){var A=this;var aZ=A.publishedSource;if(aZ!==A){aZ.publishedTarget=A;}},_defBoundaryDragStart:function(a0){var A=this;var aZ=A.get(aS);var a1=A.boundaryDragDelegate.dd.startXY;aZ.connector.show().set(at,a1);an.DiagramNodeManager.fire("publishedSource",{publishedSource:A});},_defBoundaryDrop:function(a2){var aZ=this;var A=aZ.boundaryDragDelegate.dd;var a1=a2.publishedSource;var a0=a2.publishedTarget;a1.connect(a1.prepareTransition({sourceXY:ap(A.startXY,a1.get(q)),target:a0.get(n),targetXY:ap(A.mouseXY,a0.get(q))}));},_handleCloseEvent:function(aZ){var A=this;if(!A.get(J)){A.close();}},_handleEditEvent:function(aZ){var A=this;A.get(aS).editNode(A);},_onBoundaryDrag:function(aZ){var A=this;A.fire("boundaryDrag",{dragEvent:aZ,publishedSource:A.publishedSource});},_onBoundaryDragEnd:function(a1){var A=this;var aZ=A.publishedSource;var a0=A.publishedTarget;if(aZ&&a0){A.fire("boundaryDrop",{dragEvent:a1,publishedSource:aZ,publishedTarget:a0});}A.fire("boundaryDragEnd",{dragEvent:a1,publishedSource:aZ});a1.target.get(aG).show();},_onBoundaryDragStart:function(aZ){var A=this;A.fire("boundaryDragStart",{dragEvent:aZ});aZ.target.get(aG).hide();},_onBoundaryMouseEnter:function(a0){var A=this;var aZ=A.publishedSource;A.fire("boundaryMouseEnter",{domEvent:a0});if(aZ){A.fire("boundaryDragOver",{domEvent:a0,publishedSource:aZ});}},_onBoundaryMouseLeave:function(a0){var A=this;var aZ=A.publishedSource;A.fire("boundaryMouseLeave",{domEvent:a0});if(aZ){A.fire("boundaryDragOut",{domEvent:a0,publishedSource:aZ});}},_onNameChange:function(aZ){var A=this;A.eachConnector(function(a0,a1,a2){var a3=a0.get(m);a3[(A===a2)?Q:i]=aZ.newVal;a0.set(m,a3);});},_renderControls:function(){var A=this;var aZ=A.get(q);A.controlsNode=an.Node.create(A.CONTROLS_TEMPLATE).appendTo(aZ);},_renderControlsToolbar:function(aZ){var A=this;A.controlsToolbar=new an.Toolbar(A.get(ay)).render(A.controlsNode);A._uiSetRequired(A.get(J));},_renderGraphic:function(){var A=this;A.set(Y,new an.Graphic({height:A.get(aH),render:A.bodyNode,width:A.get(L)}));
A.renderShapeInvite();A.renderShapeBoundary().addClass(aE);A._bindBoundaryEvents();A._setupBoundaryDrag();},_setTransitions:function(a0){var A=this;if(!aO(a0)){var aZ=A._createDataSet();an.Array.each(a0,function(a2){var a1=an.guid();a2=I(a2)?an.mix(a2,{uid:a1}):{uid:a1,target:a2};aZ.add(a1,A.prepareTransition(a2));});a0=aZ;}return a0;},_setupBoundaryDrag:function(){var A=this;var aZ=A.get(aS);A.boundaryDragDelegate=new an.DD.Delegate({container:A.bodyNode,nodes:g+aE,dragConfig:{useShim:false,plugins:[{cfg:{constrain:(aZ?aZ.get(aj):null)},fn:an.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:an.Plugin.DDWinScroll},{cfg:{borderStyle:"0px",moveOnEnd:false,resizeFrame:false},fn:an.Plugin.DDProxy}]},on:{"drag:drag":an.bind(A._onBoundaryDrag,A),"drag:end":an.bind(A._onBoundaryDragEnd,A),"drag:start":an.bind(A._onBoundaryDragStart,A)}});an.Do.after(A._bindBoundaryEvents,A.boundaryDragDelegate.dd,"_unprep",A);},_uiSetName:function(a0){var A=this;var aZ=A.get(q);aZ.set(az,an.DiagramNode.buildNodeId(a0));},_uiSetRequired:function(a1){var a0=this;var aZ=a0.getStrings();var A=a0.controlsToolbar;if(A){if(a1){A.remove(aN);}else{A.add({handler:an.bind(a0._handleCloseEvent,a0),icon:ah,id:aN,title:aZ[F]});}}},_uiSetSelected:function(aZ){var A=this;A.get(q).toggleClass(aU,aZ);if(aZ&&!A.controlsToolbar){A._renderControlsToolbar();}},_uiSetXY:function(a0){var A=this;var aZ=A.getContainer().getXY();this._posNode.setXY([a0[0]+aZ[0],a0[1]+aZ[1]]);},_valueControlsToolbar:function(a0){var aZ=this;var A=aZ.getStrings();return{activeState:false,children:[{handler:an.bind(aZ._handleEditEvent,aZ),icon:l,id:C,title:A[K]},{handler:an.bind(aZ._handleCloseEvent,aZ),icon:ah,id:aN,title:A[F]}]};},_valueShapeBoundary:function(){var A=this;return{height:40,type:"rect",stroke:{weight:7,color:"transparent"},width:40};}}});an.DiagramNode=aX;an.DiagramBuilder.types[p]=an.DiagramNode;an.DiagramNodeState=an.Component.create({NAME:B,ATTRS:{height:{value:40},type:{value:aa},width:{value:40}},EXTENDS:an.DiagramNode,prototype:{hotPoints:an.DiagramNode.CIRCLE_POINTS,renderShapeBoundary:function(){var A=this;var aZ=A.boundary=A.get(Y).addShape(A.get(U));aZ.translate(5,5);aZ.end();return aZ;},_valueShapeBoundary:function(){var A=this;return{radius:15,type:"circle",stroke:{weight:7,color:"transparent"}};}}});an.DiagramBuilder.types[aa]=an.DiagramNodeState;an.DiagramNodeCondition=an.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:aP},width:{value:60}},EXTENDS:an.DiagramNodeState,prototype:{hotPoints:an.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:function(){var A=this;var aZ=A.boundary=A.get(Y).addShape(A.get(U));aZ.translate(10,10);aZ.rotate(45);aZ.end();return aZ;},_valueShapeBoundary:function(){var A=this;return an.DiagramNodeState.superclass._valueShapeBoundary.apply(A,arguments);}}});an.DiagramBuilder.types[aP]=an.DiagramNodeCondition;an.DiagramNodeStart=an.Component.create({NAME:B,ATTRS:{type:{value:av}},EXTENDS:an.DiagramNodeState});an.DiagramBuilder.types[av]=an.DiagramNodeStart;an.DiagramNodeEnd=an.Component.create({NAME:B,ATTRS:{type:{value:aC}},EXTENDS:an.DiagramNodeState});an.DiagramBuilder.types[aC]=an.DiagramNodeEnd;an.DiagramNodeJoin=an.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:s},width:{value:60}},EXTENDS:an.DiagramNodeState,prototype:{hotPoints:an.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:function(){var A=this;return an.DiagramNodeCondition.prototype.renderShapeBoundary.apply(A,arguments);},_valueShapeBoundary:function(){var A=this;return an.DiagramNodeState.superclass._valueShapeBoundary.apply(A,arguments);}}});an.DiagramBuilder.types[s]=an.DiagramNodeJoin;an.DiagramNodeFork=an.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:am},width:{value:60}},EXTENDS:an.DiagramNodeState,prototype:{hotPoints:an.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:function(){var A=this;return an.DiagramNodeCondition.prototype.renderShapeBoundary.apply(A,arguments);},_valueShapeBoundary:function(){var A=this;return an.DiagramNodeState.superclass._valueShapeBoundary.apply(A,arguments);}}});an.DiagramBuilder.types[am]=an.DiagramNodeFork;an.DiagramNodeTask=an.Component.create({NAME:B,ATTRS:{height:{value:70},type:{value:E},width:{value:70}},EXTENDS:an.DiagramNodeState,prototype:{hotPoints:an.DiagramNode.SQUARE_POINTS,renderShapeBoundary:function(){var A=this;var aZ=A.boundary=A.get(Y).addShape(A.get(U));aZ.translate(8,8);aZ.end();return aZ;},_valueShapeBoundary:function(){var A=this;return{height:55,type:"rect",stroke:{weight:7,color:"transparent"},width:55};}}});an.DiagramBuilder.types[E]=an.DiagramNodeTask;},"@VERSION@",{requires:["aui-data-set","aui-diagram-builder-base","aui-diagram-builder-connector","overlay"],skinnable:true});