AUI.add("aui-diagram-builder-impl",function(aA){var ap=aA.Lang,d=ap.isArray,aY=ap.isBoolean,N=ap.isObject,a2=ap.isString,av=aA.WidgetStdMod,bc=aA.Array,an="activeElement",ab="availableField",ad="availableFields",E="backspace",al="boolean",y="boundary",s="boundingBox",a8="builder",au="cancel",aw="canvas",aO="click",a3="closeEvent",K="closeMessage",a5="condition",S="connector",l="connectors",ay="content",V="controls",aL="controlsToolbar",T="createDocumentFragment",aJ="data",af="delete",aH="deleteConnectorsMessage",q="deleteNodesMessage",aR="description",L="diagram",ax="diagram-builder",aD="diagramNode",a6="diagram-node-manager",G="diagram-node",aV="dragNode",ac="dragging",H="editEvent",Q="editMessage",W="editing",aQ="end",a="esc",aX="field",t="fields",aB="fieldsDragConfig",az="fork",aj="graphic",aW="height",aF="highlightBoundaryStroke",R="highlightDropZones",c="highlighted",aN="id",v="join",Y="keydown",B="lock",u="mouseenter",am="mouseleave",p="name",r="node",aG="p1",aE="p2",f="parentNode",n="pencil",aK="radius",ar="records",m="recordset",a9="rendered",P="required",a1="selected",aU="shape",ae="shapeBoundary",j="shapeInvite",O="showSuggestConnector",X="source",aI="start",ak="state",x="stroke",aT="suggest",aM="suggestConnectorOverlay",k="target",J="task",o="transition",aa="transitions",g="type",aq="visible",U="width",D="xy",C="zIndex",bb="-",i=".",Z="",h="#",M="_",z=aA.getClassName,w=z(L,a8,V),a0=z(L,a8,aX),ao=z(L,r),b=z(L,r,ay),aP=z(L,r,W),ba=z(L,r,a1),aS=z(L,r,aU,y),e=z(L,r,aT,S),at=function(bf,A){var be=d(bf)?bf:bf.get(s).getXY();return[be[0]+A[0],be[1]+A[1]];},a7=function(bg,bf){var be=bf[0]-bg[0],A=bf[1]-bg[1];return Math.sqrt(be*be+A*A);},ai=function(bo,bm){var bk=bo.hotPoints,bj=bm.hotPoints,br=bo.get(s).getXY(),bp=bm.get(s).getXY(),bg,be,bh,bf,bq=Infinity,bi=[[0,0],[0,0]];for(bh=0,bg=bk.length;bh<bg;bh++){var bn=bk[bh],bt=at(br,bn);for(bf=0,be=bj.length;bf<be;bf++){var bl=bj[bf],bs=at(bp,bl),A=a7(bs,bt);if(A<bq){bi[0]=bn;bi[1]=bl;bq=A;}}}return bi;},aC=function(A,bf){var be=d(bf)?bf:bf.getXY();var bg=d(A)?A:A.getXY();return bc.map(bg,function(bi,bh){return Math.max(0,bi-be[bh]);});},I=function(A){return aA.instanceOf(A,aA.Connector);},a4=function(A){return aA.instanceOf(A,aA.DataSet);},ag=function(A){return aA.instanceOf(A,aA.DiagramBuilderBase);},aZ=function(A){return aA.instanceOf(A,aA.DiagramNode);};var F=aA.Component.create({NAME:ax,ATTRS:{connector:{setter:"_setConnector",value:null},fieldsDragConfig:{value:null,setter:"_setFieldsDragConfig",validator:N},graphic:{valueFn:function(){return new aA.Graphic();},validator:N},highlightDropZones:{validator:aY,value:true},strings:{value:{addNode:"Add node",cancel:"Cancel",deleteConnectorsMessage:"Are you sure you want to delete the selected connector(s)?",deleteNodesMessage:"Are you sure you want to delete the selected node(s)?",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},showSuggestConnector:{validator:aY,value:true},suggestConnectorOverlay:{value:null,setter:"_setSuggestConnectorOverlay"}},EXTENDS:aA.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{editingConnector:null,editingNode:null,publishedSource:null,publishedTarget:null,selectedConnector:null,selectedNode:null,initializer:function(){var A=this;A.after({render:A.syncConnectionsUI});A.on({cancel:A._onCancel,"drag:drag":A._onDrag,"drag:end":A._onDragEnd,"drop:hit":A._onDropHit,save:A._onSave});aA.DiagramNodeManager.on({publishedSource:function(be){A.publishedTarget=null;A.publishedSource=be.publishedSource;}});A.handlerKeyDown=aA.getDoc().on(Y,aA.bind(A._afterKeyEvent,A));A.dropContainer.delegate(aO,aA.bind(A._onNodeClick,A),i+ao);A.dropContainer.delegate(u,aA.bind(A._onNodeMouseEnter,A),i+ao);A.dropContainer.delegate(am,aA.bind(A._onNodeMouseLeave,A),i+ao);},renderUI:function(){var A=this;aA.DiagramBuilder.superclass.renderUI.apply(this,arguments);A._renderGraphic();},syncUI:function(){var A=this;aA.DiagramBuilder.superclass.syncUI.apply(this,arguments);A._setupFieldsDrag();A.connector=A.get(S);},syncConnectionsUI:function(){var A=this;A.get(t).each(function(be){be.syncConnectionsUI();});},clearFields:function(){var be=this;var A=[];be.get(t).each(function(bf){A.push(bf);});bc.each(A,function(bf){bf.destroy();});A=be.editingConnector=be.editingNode=be.selectedNode=null;},closeEditProperties:function(){var A=this;var be=A.editingNode;var bf=A.tabView;bf.selectTab(aA.DiagramBuilder.FIELDS_TAB);bf.disableTab(aA.DiagramBuilder.SETTINGS_TAB);if(be){be.get(s).removeClass(aP);}A.editingConnector=A.editingNode=null;},connect:function(be,bg,bf){var A=this;if(a2(be)){be=aA.Widget.getByNode(h+aA.DiagramNode.buildNodeId(be));}if(a2(bg)){bg=aA.Widget.getByNode(h+aA.DiagramNode.buildNodeId(bg));}if(be&&bg){be.connect(bg.get(p),bf);}return A;},connectAll:function(be){var A=this;bc.each(be,function(bf){if(bf.hasOwnProperty(X)&&bf.hasOwnProperty(k)){A.connect(bf.source,bf.target,bf.connector);}});return A;},createField:function(be){var A=this;if(!aZ(be)){be.builder=A;be.bubbleTargets=A;be=new (A.getFieldClass(be.type||r))(be);}return be;},deleteSelectedConnectors:function(){var be=this;var A=be.getStrings();var bf=be.getSelectedConnectors();if(bf.length&&confirm(A[aH])){bc.each(bf,function(bg){var bh=bg.get(o);aA.DiagramNode.getNodeByName(bh.source).disconnect(bh);});be.stopEditing();}},deleteSelectedNode:function(){var be=this;var A=be.getStrings();var bf=be.selectedNode;if(bf&&!bf.get(P)&&confirm(A[q])){bf.close();be.editingNode=be.selectedNode=null;be.stopEditing();}},destructor:function(be){var A=this;A.get(aM).destroy();},eachConnector:function(be){var A=this;A.get(t).each(function(bf){bf.get(aa).each(function(bg){be.call(A,bf.getConnector(bg),bg,bf);});});},editConnector:function(be){var A=this;if(be){var bf=A.tabView;A.closeEditProperties();bf.enableTab(aA.DiagramBuilder.SETTINGS_TAB);bf.selectTab(aA.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(m,be.getProperties());A.editingConnector=A.selectedConnector=be;}},editNode:function(bf){var A=this;if(bf){var be=A.tabView;
A.closeEditProperties();be.enableTab(aA.DiagramBuilder.SETTINGS_TAB);be.selectTab(aA.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(m,bf.getProperties());bf.get(s).addClass(aP);A.editingNode=A.selectedNode=bf;}},getFieldClass:function(bf){var A=this;var be=aA.DiagramBuilder.types[bf];if(be){return be;}else{aA.log("The field type: ["+bf+"] couldn't be found.");return null;}},getNodesByTransitionProperty:function(bg,bf){var A=this;var be=[];A.get(t).each(function(bh){bh.get(aa).each(function(bi){if(bi[bg]===bf){be.push(bh);return false;}});});return be;},getSelectedConnectors:function(){var A=this;var be=[];A.eachConnector(function(bf){if(bf.get(a1)){be.push(bf);}});return be;},getSourceNodes:function(be){var A=this;return A.getNodesByTransitionProperty(k,be.get(p));},hideSuggestConnetorOverlay:function(bf,be){var A=this;A.connector.hide();A.get(aM).hide();A.fieldsDrag.dd.set(B,false);},isAbleToConnect:function(){var A=this;return !!(A.publishedSource&&A.publishedTarget);},isFieldsDrag:function(be){var A=this;return(be===A.fieldsDrag.dd);},plotField:function(be){var A=this;if(!be.get(a9)){be.render(A.dropContainer);}},select:function(be){var A=this;A.unselectNodes();A.selectedNode=be.set(a1,true).focus();},showSuggestConnetorOverlay:function(be){var A=this;A.get(aM).set(D,be||A.connector.get(aE)).show().get(s).addClass(e);A.fieldsDrag.dd.set(B,true);},stopEditing:function(){var A=this;A.unselectConnectors();A.unselectNodes();A.closeEditProperties();},toJSON:function(){var A=this;var be={nodes:[]};A.get(t).each(function(bg){var bf={transitions:[]};bc.each(bg.SERIALIZABLE_ATTRS,function(bh){bf[bh]=bg.get(bh);});bg.get(aa).each(function(bi){var bh=bg.getConnector(bi);bi.connector=bh.toJSON();bf.transitions.push(bi);});be.nodes.push(bf);});return be;},unselectConnectors:function(){var A=this;bc.each(A.getSelectedConnectors(),function(be){be.set(a1,false);});},unselectNodes:function(){var A=this;var be=A.selectedNode;if(be){be.set(a1,false);}A.selectedNode=null;},_afterKeyEvent:function(be){var A=this;if(be.hasModifier()||aA.getDoc().get(an).test(":input,td")){return;}if(be.isKey(a)){A._onEscKey(be);}else{if(be.isKey(E)||be.isKey(af)){A._onDeleteKey(be);}}},_onCancel:function(be){var A=this;A.closeEditProperties();},_onDeleteKey:function(be){var A=this;A.deleteSelectedConnectors();A.deleteSelectedNode();be.halt();},_onDrag:function(bf){var A=this;var be=bf.target;if(A.isFieldsDrag(be)){var bg=aA.Widget.getByNode(be.get(aV));bg.alignTransitions();bc.each(A.getSourceNodes(bg),function(bh){bh.alignTransitions();});}},_onDragEnd:function(bf){var A=this;var be=bf.target;var bg=aA.Widget.getByNode(be.get(aV));if(bg&&A.isFieldsDrag(be)){bg.set(D,bg.getLeftTop());}},_onDropHit:function(bf){var A=this;var be=bf.drag;if(A.isAvailableFieldsDrag(be)){var bh=be.get(r).getData(ab);var bg=A.addField({xy:aC(be.lastXY,A.dropContainer),type:bh.get(g)});A.select(bg);}},_onEscKey:function(be){var A=this;A.hideSuggestConnetorOverlay();A.stopEditing();be.halt();},_onCanvasClick:function(be){var A=this;A.stopEditing();A.hideSuggestConnetorOverlay();},_onNodeClick:function(be){var A=this;var bf=aA.Widget.getByNode(be.currentTarget);A.select(bf);A._onNodeEdit(be);},_onNodeEdit:function(be){var A=this;if(!be.target.ancestor(i+b,true)){return;}var bf=aA.Widget.getByNode(be.currentTarget);if(bf){A.editNode(bf);}},_onNodeMouseEnter:function(be){var A=this;var bf=aA.Widget.getByNode(be.currentTarget);bf.set(c,true);},_onNodeMouseLeave:function(bf){var A=this;var be=A.publishedSource;var bg=aA.Widget.getByNode(bf.currentTarget);if(!be||!be.boundaryDragDelegate.dd.get(ac)){bg.set(c,false);}},_onSave:function(bf){var A=this;var be=A.editingNode;var bg=A.editingConnector;var bh=A.propertyList.get(m);if(be){bc.each(bh.get(ar),function(bi){var bj=bi.get(aJ);be.set(bj.attributeName,bj.value);});}else{if(bg){bc.each(bh.get(ar),function(bi){var bj=bi.get(aJ);bg.set(bj.attributeName,bj.value);});}}},_onSuggestConnectorNodeClick:function(bg){var A=this;var bh=bg.currentTarget.getData(ab);var be=A.connector;var bf=A.addField({type:bh.get(g),xy:be.toCoordinate(be.get(aE))});A.hideSuggestConnetorOverlay();A.publishedSource.connectNode(bf);},_renderGraphic:function(){var A=this;var be=A.get(aj);be.render(A.get(aw));aA.one(be.get(r)).on(aO,aA.bind(A._onCanvasClick,A));},_setConnector:function(bf){var A=this;if(!I(bf)){var be=A.get(aw).getXY();bf=new aA.Connector(aA.merge({builder:A,graphic:A.get(aj),lazyDraw:true,p1:be,p2:be,shapeHover:null,showName:false},bf));}return bf;},_setFieldsDragConfig:function(bf){var A=this;var be=A.dropContainer;return aA.merge({bubbleTargets:A,container:be,dragConfig:{plugins:[{cfg:{constrain:be},fn:aA.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:aA.Plugin.DDWinScroll}]},nodes:i+ao},bf||{});},_setSuggestConnectorOverlay:function(bf){var A=this;if(!bf){var be=aA.getDoc().invoke(T);bc.each(A.get(ad),function(bh){var bg=bh.get(r);be.appendChild(bg.clone().setData(ab,bg.getData(ab)));});bf=new aA.Overlay({bodyContent:be,render:true,visible:false,zIndex:10000});bf.get(s).delegate(aO,aA.bind(A._onSuggestConnectorNodeClick,A),i+a0);}return bf;},_setupFieldsDrag:function(){var A=this;A.fieldsDrag=new aA.DD.Delegate(A.get(aB));}}});aA.DiagramBuilder=F;aA.DiagramBuilder.types={};var ah=aA.Component.create({NAME:a6,EXTENDS:aA.Base});aA.DiagramNodeManager=new ah();var bd=aA.Component.create({NAME:G,UI_ATTRS:[c,p,P,a1],ATTRS:{builder:{validator:ag},connectors:{valueFn:"_createDataSet",writeOnce:true},controlsToolbar:{validator:N,valueFn:"_valueControlsToolbar"},description:{value:Z,validator:a2},graphic:{writeOnce:true,validator:N},height:{value:60},highlighted:{validator:aY,value:false},name:{valueFn:function(){var A=this;return A.get(g)+(++aA.Env._uidx);},validator:a2},required:{value:false,validator:aY},selected:{value:false,validator:aY},shapeBoundary:{validator:N,valueFn:"_valueShapeBoundary"},highlightBoundaryStroke:{validator:N,value:{weight:7,color:"#484B4C",opacity:0.25}},shapeInvite:{validator:N,value:{radius:12,type:"circle",stroke:{weight:6,color:"#ff6600",opacity:0.8},fill:{color:"#ffd700",opacity:0.8}}},strings:{value:{closeMessage:"Close",connectMessage:"Connect",description:"Description",editMessage:"Edit",name:"Name",type:"Type"}},tabIndex:{value:1},transitions:{value:null,writeOnce:true,setter:"_setTransitions"},type:{value:r,validator:a2},width:{value:60},zIndex:{value:100}},EXTENDS:aA.Overlay,CIRCLE_POINTS:[[35,20],[28,33],[14,34],[5,22],[10,9],[24,6],[34,16],[31,30],[18,35],[6,26],[7,12],[20,5],[33,12],[34,26],[22,35],[9,30],[6,16],[16,6],[30,9],[35,22],[26,34],[12,33],[5,20],[12,7],[26,6],[35,18],[30,31],[16,34],[6,24],[9,10],[22,5],[34,14],[33,28],[20,35],[7,28],[6,14],[18,5],[31,10],[34,24],[24,34],[10,31],[5,18],[14,6],[28,8],[35,20],[28,33],[14,34],[5,22],[10,8],[25,6],[34,16],[31,30],[18,35],[6,26],[8,12],[20,5],[33,12],[33,27],[22,35],[8,30],[6,15],[16,6],[30,9],[35,23],[26,34],[12,32],[5,20],[12,7],[27,7],[35,18],[29,32],[15,34]],DIAMOND_POINTS:[[30,5],[35,10],[40,15],[45,20],[50,25],[55,30],[50,35],[45,40],[40,45],[35,50],[30,55],[25,50],[20,45],[15,40],[10,35],[5,30],[10,25],[15,20],[20,15],[25,10]],SQUARE_POINTS:[[5,5],[10,5],[15,5],[20,5],[25,5],[30,5],[35,5],[40,5],[50,5],[55,5],[60,5],[65,5],[65,10],[65,15],[65,20],[65,25],[65,30],[65,35],[65,40],[65,45],[65,50],[65,55],[65,60],[65,65],[60,65],[55,65],[50,65],[45,65],[40,65],[35,65],[30,65],[25,65],[20,65],[15,65],[10,65],[5,65],[5,60],[5,55],[5,50],[5,45],[5,40],[5,35],[5,30],[5,25],[5,20],[5,15],[5,10]],getNodeByName:function(A){return aA.Widget.getByNode(h+aA.DiagramNode.buildNodeId(A));
},buildNodeId:function(A){return aD+M+aX+M+A.replace(/[^a-z0-9.:_\-]/ig,"_");},prototype:{boundary:null,hotPoints:[[0,0]],CONTROLS_TEMPLATE:'<div class="'+w+'"></div>',SERIALIZABLE_ATTRS:[aR,p,P,g,U,aW,C,D],initializer:function(){var A=this;A.after({"dataset:remove":aA.bind(A._afterDataSetRemove,A),render:A._afterRender});A.on({nameChange:A._onNameChange});A.publish({connectDrop:{defaultFn:A.connectDrop},connectEnd:{defaultFn:A.connectEnd},connectMove:{defaultFn:A.connectMove},connectOutTarget:{defaultFn:A.connectOutTarget},connectOverTarget:{defaultFn:A.connectOverTarget},connectStart:{defaultFn:A.connectStart},boundaryMouseEnter:{},boundaryMouseLeave:{}});A.get(s).addClass(ao+bb+A.get(g));},destructor:function(){var A=this;A.eachConnector(function(be,bf,bg){bg.removeTransition(be.get(o));});A.invite.destroy();A.get(aj).destroy();A.get(a8).removeField(A);},addTransition:function(bf){var A=this;var be=A.get(aa);bf=A.prepareTransition(bf);if(!be.containsKey(bf.uid)){bf.uid=aA.guid();be.add(bf.uid,bf);}return bf;},alignTransition:function(bf){var A=this;var bg=aA.DiagramNode.getNodeByName(bf.target);if(bg){var be=ai(A,bg);bf=aA.merge(bf,{sourceXY:be[0],targetXY:be[1]});A.getConnector(bf).setAttrs({p1:at(A,bf.sourceXY),p2:at(bg,bf.targetXY)});}},alignTransitions:function(){var A=this;A.get(aa).each(aA.bind(A.alignTransition,A));},close:function(){var A=this;return A.destroy();},connect:function(bi,bg){var A=this;bi=A.addTransition(bi);var be=null;var bj=aA.DiagramNode.getNodeByName(bi.target);if(bj){if(!A.isTransitionConnected(bi)){var bf=A.get(a8);var bh=ai(A,bj);aA.mix(bi,{sourceXY:bh[0],targetXY:bh[1]});be=new aA.Connector(aA.merge({builder:bf,graphic:bf.get(aj),transition:bi},bg));A.get(l).add(bi.uid,be);}}A.alignTransition(bi);return be;},connectDrop:function(be){var A=this;A.connectNode(be.publishedTarget);},connectEnd:function(bh){var A=this;var bg=bh.target;var be=A.get(a8);var bf=be.publishedSource;if(!be.isAbleToConnect()&&be.get(O)&&be.connector.get(aq)){be.showSuggestConnetorOverlay();}else{be.connector.hide();bf.invite.set(aq,false);}if(be.get(R)){be.get(t).each(function(bi){bi.set(c,false);});}},connectMove:function(bg){var A=this;var bf=A.get(a8);var bh=bg.mouseXY;bf.connector.set(aE,bh);if(bf.publishedTarget){var be=A.invite;var bi=be.get(aK)||0;if(!be.get(aq)){be.set(aq,true);}be.setXY([bh[0]-bi,bh[1]-bi]);}},connectNode:function(bf){var be=this;var A=be.boundaryDragDelegate.dd;be.connect(be.prepareTransition({sourceXY:aC(A.startXY,be.get(s)),target:bf.get(p),targetXY:aC(A.mouseXY,bf.get(s))}));},connectOutTarget:function(bf){var A=this;var be=A.get(a8);be.publishedTarget=null;be.publishedSource.invite.set(aq,false);},connectOverTarget:function(bf){var A=this;var be=A.get(a8);if(be.publishedSource!==A){be.publishedTarget=A;}},connectStart:function(bf){var A=this;var be=A.get(a8);be.connector.show().set(aG,bf.startXY);if(be.get(R)){be.get(t).each(function(bg){bg.set(c,true);});}aA.DiagramNodeManager.fire("publishedSource",{publishedSource:A});},disconnect:function(be){var A=this;if(A.isTransitionConnected(be)){A.removeTransition(be);}},eachConnector:function(bg){var A=this;var bh=[],be=[].concat(A.get(l).values),bf=be.length;bc.each(A.get(a8).getSourceNodes(A),function(bi){bi.get(l).each(function(bj){if(A.get(p)===bj.get(o).target){bh.push(bi);be.push(bj);}});});bc.each(be,function(bi,bj){bg.call(A,bi,bj,(bj<bf)?A:bh[bj-bf]);});be=bh=null;return be;},getConnector:function(be){var A=this;return A.get(l).item(be.uid);},getContainer:function(){var A=this;return(A.get(a8).dropContainer||A.get(s).get(f));},getLeftTop:function(){var A=this;return aC(A.get(s),A.getContainer());},getProperties:function(){var A=this;var be=A.getPropertyModel();bc.each(be,function(bh){var bg=A.get(bh.attributeName),bf=ap.type(bg);if(bf===al){bg=String(bg);}bh.value=bg;});return be;},getPropertyModel:function(){var be=this;var A=be.getStrings();return[{attributeName:aR,editor:new aA.TextAreaCellEditor(),name:A[aR]},{attributeName:p,editor:new aA.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[p]},{attributeName:g,editor:false,name:A[g]}];},isBoundaryDrag:function(be){var A=this;return(be===A.boundaryDragDelegate.dd);},isTransitionConnected:function(be){var A=this;return A.get(l).containsKey(be.uid);},prepareTransition:function(bf){var A=this;var be={source:A.get(p),target:null,uid:aA.guid()};if(a2(bf)){be.target=bf;}else{if(N(bf)){be=aA.merge(be,bf);}}return be;},removeTransition:function(be){var A=this;return A.get(aa).removeKey(be.uid);},renderShapeBoundary:function(){var A=this;var be=A.boundary=A.get(aj).addShape(A.get(ae));return be;},renderShapeInvite:function(){var A=this;var be=A.invite=A.get(a8).get(aj).addShape(A.get(j));be.set(aq,false);return be;},syncConnectionsUI:function(){var A=this;A.get(aa).each(aA.bind(A.connect,A));},_afterDataSetRemove:function(bf){var A=this;var be=bf.target;if(be===A.get(aa)){A.get(l).removeKey(bf.prevVal.uid);}else{if(be===A.get(l)){bf.prevVal.destroy();}}},_afterRender:function(be){var A=this;A.setStdModContent(av.BODY,Z,av.AFTER);A._renderGraphic();A._renderControls();A._uiSetHighlighted(A.get(c));},_bindBoundaryEvents:function(){var A=this;A.boundary.detachAll().on({mouseenter:aA.bind(A._onBoundaryMouseEnter,A),mouseleave:aA.bind(A._onBoundaryMouseLeave,A)});},_createDataSet:function(){var A=this;return new aA.DataSet({bubbleTargets:A});},_handleCloseEvent:function(be){var A=this;A.get(a8).deleteSelectedNode();},_handleConnectStart:function(be){var A=this;A.fire("connectStart",{startXY:be});},_handleConnectMove:function(bf){var A=this;var be=A.get(a8);A.fire("connectMove",{mouseXY:bf,publishedSource:be.publishedSource});},_handleConnectEnd:function(){var A=this;var be=A.get(a8);var bf=be.publishedSource;var bg=be.publishedTarget;if(bf&&bg){A.fire("connectDrop",{publishedSource:bf,publishedTarget:bg});}A.fire("connectEnd",{publishedSource:bf});},_handleConnectOutTarget:function(bg){var A=this;var be=A.get(a8);var bf=be.publishedSource;if(bf){A.fire("connectOutTarget",{publishedSource:bf});
}},_handleConnectOverTarget:function(){var A=this;var be=A.get(a8);var bf=be.publishedSource;if(bf){A.fire("connectOverTarget",{publishedSource:bf});}},_handleEditEvent:function(be){var A=this;A.get(a8).editNode(A);},_onBoundaryDrag:function(be){var A=this;A._handleConnectMove(A.boundaryDragDelegate.dd.mouseXY);},_onBoundaryDragEnd:function(be){var A=this;A._handleConnectEnd();be.target.get(aV).show();},_onBoundaryDragStart:function(be){var A=this;A._handleConnectStart(A.boundaryDragDelegate.dd.startXY);be.target.get(aV).hide();},_onBoundaryMouseEnter:function(be){var A=this;A.fire("boundaryMouseEnter",{domEvent:be});A._handleConnectOverTarget();},_onBoundaryMouseLeave:function(be){var A=this;A.fire("boundaryMouseLeave",{domEvent:be});A._handleConnectOutTarget();},_onNameChange:function(be){var A=this;A.eachConnector(function(bf,bg,bh){var bi=bf.get(o);bi[(A===bh)?X:k]=be.newVal;bf.set(o,bi);});},_renderControls:function(){var A=this;var be=A.get(s);A.controlsNode=aA.Node.create(A.CONTROLS_TEMPLATE).appendTo(be);},_renderControlsToolbar:function(be){var A=this;A.controlsToolbar=new aA.Toolbar(A.get(aL)).render(A.controlsNode);A._uiSetRequired(A.get(P));},_renderGraphic:function(){var A=this;A.set(aj,new aA.Graphic({height:A.get(aW),render:A.bodyNode,width:A.get(U)}));A.renderShapeInvite();A.renderShapeBoundary().addClass(aS);A._bindBoundaryEvents();A._setupBoundaryDrag();},_setTransitions:function(bf){var A=this;if(!a4(bf)){var be=A._createDataSet();aA.Array.each(bf,function(bh){var bg=aA.guid();bh=N(bh)?aA.mix(bh,{uid:bg}):{uid:bg,target:bh};be.add(bg,A.prepareTransition(bh));});bf=be;}return bf;},_setupBoundaryDrag:function(){var A=this;var be=A.get(a8);A.boundaryDragDelegate=new aA.DD.Delegate({bubbleTargets:A,container:A.bodyNode,nodes:i+aS,dragConfig:{useShim:false,plugins:[{cfg:{constrain:(be?be.get(aw):null)},fn:aA.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:aA.Plugin.DDWinScroll},{cfg:{borderStyle:"0px",moveOnEnd:false,resizeFrame:false},fn:aA.Plugin.DDProxy}]},on:{"drag:drag":aA.bind(A._onBoundaryDrag,A),"drag:end":aA.bind(A._onBoundaryDragEnd,A),"drag:start":aA.bind(A._onBoundaryDragStart,A)}});aA.Do.after(A._bindBoundaryEvents,A.boundaryDragDelegate.dd,"_unprep",A);},_uiSetHighlighted:function(bf){var A=this;if(A.get(a9)){var be=bf?A.get(aF):A.get(ae+i+x);if(be){A.boundary.set(x,be);}}},_uiSetName:function(bf){var A=this;var be=A.get(s);be.set(aN,aA.DiagramNode.buildNodeId(bf));},_uiSetRequired:function(bg){var bf=this;var be=bf.getStrings();var A=bf.controlsToolbar;if(A){if(bg){A.remove(a3);}else{A.add({handler:aA.bind(bf._handleCloseEvent,bf),icon:au,id:a3,title:be[K]});}}},_uiSetSelected:function(be){var A=this;A.get(s).toggleClass(ba,be);if(be&&!A.controlsToolbar){A._renderControlsToolbar();}},_uiSetXY:function(bf){var A=this;var be=A.getContainer().getXY();this._posNode.setXY([bf[0]+be[0],bf[1]+be[1]]);},_valueControlsToolbar:function(bf){var be=this;var A=be.getStrings();return{activeState:false,children:[{handler:aA.bind(be._handleEditEvent,be),icon:n,id:H,title:A[Q]},{handler:aA.bind(be._handleCloseEvent,be),icon:au,id:a3,title:A[K]}]};},_valueShapeBoundary:function(){var A=this;return{height:41,type:"rect",stroke:{weight:7,color:"transparent"},width:41};}}});aA.DiagramNode=bd;aA.DiagramBuilder.types[r]=aA.DiagramNode;aA.DiagramNodeState=aA.Component.create({NAME:G,ATTRS:{height:{value:40},type:{value:ak},width:{value:40}},EXTENDS:aA.DiagramNode,prototype:{hotPoints:aA.DiagramNode.CIRCLE_POINTS,renderShapeBoundary:function(){var A=this;var be=A.boundary=A.get(aj).addShape(A.get(ae));be.translate(5,5);return be;},_valueShapeBoundary:function(){var A=this;return{radius:15,type:"circle",stroke:{weight:7,color:"transparent"}};}}});aA.DiagramBuilder.types[ak]=aA.DiagramNodeState;aA.DiagramNodeCondition=aA.Component.create({NAME:G,ATTRS:{height:{value:60},type:{value:a5},width:{value:60}},EXTENDS:aA.DiagramNodeState,prototype:{hotPoints:aA.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:function(){var A=this;var be=A.boundary=A.get(aj).addShape(A.get(ae));be.translate(10,10);be.rotate(45);return be;},_valueShapeBoundary:aA.DiagramNode.prototype._valueShapeBoundary}});aA.DiagramBuilder.types[a5]=aA.DiagramNodeCondition;aA.DiagramNodeStart=aA.Component.create({NAME:G,ATTRS:{type:{value:aI}},EXTENDS:aA.DiagramNodeState});aA.DiagramBuilder.types[aI]=aA.DiagramNodeStart;aA.DiagramNodeEnd=aA.Component.create({NAME:G,ATTRS:{type:{value:aQ}},EXTENDS:aA.DiagramNodeState});aA.DiagramBuilder.types[aQ]=aA.DiagramNodeEnd;aA.DiagramNodeJoin=aA.Component.create({NAME:G,ATTRS:{height:{value:60},type:{value:v},width:{value:60}},EXTENDS:aA.DiagramNodeState,prototype:{hotPoints:aA.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:aA.DiagramNodeCondition.prototype.renderShapeBoundary,_valueShapeBoundary:aA.DiagramNode.prototype._valueShapeBoundary}});aA.DiagramBuilder.types[v]=aA.DiagramNodeJoin;aA.DiagramNodeFork=aA.Component.create({NAME:G,ATTRS:{height:{value:60},type:{value:az},width:{value:60}},EXTENDS:aA.DiagramNodeState,prototype:{hotPoints:aA.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:aA.DiagramNodeCondition.prototype.renderShapeBoundary,_valueShapeBoundary:aA.DiagramNode.prototype._valueShapeBoundary}});aA.DiagramBuilder.types[az]=aA.DiagramNodeFork;aA.DiagramNodeTask=aA.Component.create({NAME:G,ATTRS:{height:{value:70},type:{value:J},width:{value:70}},EXTENDS:aA.DiagramNodeState,prototype:{hotPoints:aA.DiagramNode.SQUARE_POINTS,renderShapeBoundary:function(){var A=this;var be=A.boundary=A.get(aj).addShape(A.get(ae));be.translate(8,8);return be;},_valueShapeBoundary:function(){var A=this;return{height:55,type:"rect",stroke:{weight:7,color:"transparent"},width:55};}}});aA.DiagramBuilder.types[J]=aA.DiagramNodeTask;},"@VERSION@",{skinnable:true,requires:["aui-data-set","aui-diagram-builder-base","aui-diagram-builder-connector","overlay"]});