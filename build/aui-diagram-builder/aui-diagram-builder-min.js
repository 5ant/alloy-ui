AUI.add("aui-diagram-builder-base",function(ai){var X=ai.Lang,d=X.isArray,ax=X.isBoolean,O=X.isNumber,F=X.isObject,aB=X.isString,M=function(A){return(A instanceof ai.ArrayList);},V=function(A){return(A instanceof ai.Node);},H=function(A){return(A instanceof ai.AvailableField);},aK=ai.Array,Y="add",o="addNode",aJ="auto",P="availableField",T="availableFields",aG="availableFieldsDragConfig",v="boundingBox",aD="builder",ac="cancel",af="canvas",az="clearfix",f="column",a="container",ag="content",y="contentBox",e="contentContainer",S="contentNode",I="createDocumentFragment",D="diagram",ao="diagram-builder",ad="disk",r="draggable",aF="drop",ar="dropConfig",ab="dropContainer",aw="field",w="fields",q="fieldsContainer",av="height",s="helper",aa="icon",z="iconClass",aq="id",am="label",x="layout",ap="list",R="maxFields",u="node",g="parentNode",ah="propertyList",aE="rendered",at="save",t="settings",Q="tab",K="tabView",b="tabs",h="tabview",N="toolbar",m="toolbarContainer",C=ai.getClassName,aI=" ",i=".",j="#",aI=" ",E="_",n=C(f),B=C(D,aD,af),aj=C(D,aD,ag,a),G=C(D,aD,aF,a),ay=C(D,aD,aw),l=C(D,aD,aw,r),c=C(D,aD,aw,aa),ae=C(D,aD,aw,am),Z=C(D,aD,w,a),ak=C(D,aD,Q,Y),L=C(D,aD,Q,t),au=C(D,aD,b),U=C(D,aD,b,ag),an=C(D,aD,N,a),al=C(s,az),p=C(aa),J=C(x),aC=C(h,ag),aH=C(h,ap);var k=ai.Component.create({NAME:P,ATTRS:{draggable:{value:true,validator:ax},label:{validator:aB},iconClass:{validator:aB},id:{value:ai.guid(),setter:"_setId",validator:aB},node:{valueFn:function(aL){var A=this;if(!V(aL)){aL=ai.Node.create(ai.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(z)}));aL.setData(P,A);}return aL;},validator:V,writeOnce:true},type:{value:u,validator:aB}},EXTENDS:ai.Base,buildNodeId:function(A){return T+E+aw+E+A;},getAvailableFieldById:function(A){return ai.AvailableField.getAvailableFieldByNode(j+ai.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){var A=ai.one(A);if(V(ai.one(A))){return A.getData(P);}return null;},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+ay+'">'+'<span class="'+[p,c].join(aI)+' {iconClass}"></span>'+'<div class="'+ae+'"></div>'+"</li>",initializer:function(){var A=this;var aL=A.get(u);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aL.one(i+ae);A._uiSetDraggable(A.get(r));A._uiSetId(A.get(aq));A._uiSetLabel(A.get(am));},_afterDraggableChange:function(aL){var A=this;A._uiSetDraggable(aL.newVal);},_afterIdChange:function(aL){var A=this;A._uiSetId(aL.newVal);},_afterLabelChange:function(aL){var A=this;A._uiSetLabel(aL.newVal);},_setId:function(A){return ai.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aL){var A=this;A.get(u).toggleClass(l,aL);},_uiSetId:function(aL){var A=this;A.get(u).set(aq,aL);},_uiSetLabel:function(aL){var A=this;A.labelNode.setContent(aL);}}});ai.AvailableField=k;var W=function(){};W.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||M(A);}},maxFields:{value:Infinity,validator:O}};ai.mix(W.prototype,{_setFields:function(aL){var A=this;if(M(aL)){return aL;}else{return A.createFields(aL);}},_updateFields:function(aL){var A=this;A.set(w,aL);},addField:function(aM,aL){var A=this;if(A.get(w).size()<A.get(R)){var aN=A.createField(aM);if(aN){A._updateFields(A.get(w).add(aN,aL));}return aN;}return null;},createFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){if(aN<aL.get(R)){A.push(aL.createField(aO));}});return new ai.ArrayList(A);},removeField:function(aL){var A=this;A._updateFields(A.get(w).remove(aL));},createField:function(A){return A;}});ai.FieldSupport=W;var aA=ai.Component.create({NAME:ao,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:F},canvas:{valueFn:function(){return ai.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:F},contentContainer:{valueFn:function(){return ai.Node.create(this.CONTENT_CONTAINER_TEMPLATE);}},dropContainer:{valueFn:function(){return ai.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return ai.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:F,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:F,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:F,value:null},toolbarContainer:{valueFn:function(){return ai.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{contentContainer:i+aj,dropContainer:i+G,fieldsContainer:i+Z,toolbarContainer:i+an,canvas:i+B},UI_ATTRS:[T,w],AUGMENTS:[ai.FieldSupport],prototype:{CONTENT_CONTAINER_TEMPLATE:'<div class="'+aj+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+G+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+an+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[Z,al].join(aI)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+B+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender,"recordset:update":A._afterRecordsetUpdate});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(af);A.contentContainer=A.get(e);A.dropContainer=A.get(ab);A.fieldsContainer=A.get(q);A.toolbarContainer=A.get(m);},isAvailableFieldsDrag:function(aM){var A=this;var aL=A.availableFieldsDrag;return(aM===aL.dd);},plotFields:function(){var aL=this;var A=aL.get(w);A.each(function(aM){aL.plotField(aM);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(T));},syncUI:function(){var A=this;var aL=A.get(y);A._setupDrop();A._setupAvailableFieldsDrag();aL.addClass(J);},_afterActiveTabChange:function(aM){var A=this;var aL=aM.newVal.get(S);if(A.get(aE)&&(aL===A.settingsNode)){A._renderSettings();}},_afterRecordsetUpdate:function(aL){var A=this;
A._handleSaveEvent();},_afterRender:function(aL){var A=this;A.plotFields();},_afterUiSetHeight:function(aL){var A=this;A.contentContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);A.dropContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);},_defCancelFn:function(aL){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(ac);},_handleSaveEvent:function(){var A=this;A.fire(at);},_renderCanvas:function(){var A=this;var aL=A.get(y);var aM=A.canvas;var aN=A.contentContainer;var aO=A.dropContainer;if(!aM.inDoc()){aN.appendChild(aM);}if(!aO.inDoc()){aM.appendChild(aO);}if(aN.inDoc()){aN.get(g).append(aN);}else{aL.appendChild(aN);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ai.PropertyList(A.get(ah)).render(A.settingsNode);A.propertyList.get(v).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aL=new ai.TabView(A.get(K));aL.get(v);A.tabView=aL;A.fieldsNode=aL.getTab(0).get(S);A.settingsNode=aL.getTab(1).get(S);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ai.Toolbar(A.get(N)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ai.DD.Drop(A.get(ar));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ai.DD.Delegate(A.get(aG));},_setAvailableFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){A.push(H(aO)?aO:new ai.AvailableField(aO));});return A;},_setDropConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,groups:[T],node:A.dropContainer},aL||{});},_setAvailableFieldsDragConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,container:A.get(v),dragConfig:{groups:[T],plugins:[{cfg:{moveOnEnd:false},fn:ai.Plugin.DDProxy}]},nodes:i+l},aL||{});},_setPropertyList:function(aL){var A=this;return ai.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aJ}},aL);},_setTabView:function(aO){var aL=this;var aN=aL.get(v);var aP=aN.one(i+aH);var aM={after:{activeTabChange:ai.bind(aL._afterActiveTabChange,aL)},boundingBox:aN.one(i+au),contentBox:aN.one(i+U),bubbleTargets:aL,contentNode:aN.one(i+aC),cssClass:au,listNode:aP,render:aL.get(y)};if(!aP){var A=aL.getStrings();aM.items=[{cssClass:ak,label:A[o]},{cssClass:L,label:A[t]}];}return ai.merge(aM,aO);},_setToolbar:function(aM){var aL=this;var A=aL.getStrings();return ai.merge({activeState:false,bubbleTargets:aL,children:[{handler:ai.bind(aL._handleCancelEvent,aL),label:A[ac]}]},aM);},_uiSetAvailableFields:function(aN){var A=this;var aM=A.fieldsNode;if(aM){var aL=ai.getDoc().invoke(I);aK.each(aN,function(aO){aL.appendChild(aO.get(u));});aM.setContent(A.fieldsContainer.setContent(aL));}},_uiSetFields:function(aL){var A=this;if(A.get(aE)){A.plotFields();}}}});ai.DiagramBuilderBase=aA;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});AUI.add("aui-diagram-builder-impl",function(am){var ad=am.Lang,c=ad.isArray,aI=ad.isBoolean,I=ad.isObject,aL=ad.isString,ah=am.WidgetStdMod,aU=am.Array,ao=function(A,aX){var aW=c(aX)?aX:aX.getXY();var aY=c(A)?A:A.getXY();return aU.map(aY,function(a0,aZ){return Math.max(0,a0-aW[aZ]);});},D=function(A){return(A instanceof am.Connector);},aP=function(A){return(A instanceof am.DataSet);},W=function(A){return(A instanceof am.DiagramBuilderBase);},aJ=function(A){return(A instanceof am.DiagramNode);},ab="activeElement",T="availableField",y="backspace",aa="boolean",u="boundary",q="boundingBox",aQ="builder",ag="cancel",ai="canvas",az="click",aM="closeEvent",F="closeMessage",aN="condition",j="connectors",ak="content",M="controls",ax="controlsToolbar",av="data",V="delete",at="deleteConnectorsMessage",o="deleteNodesMessage",aC="description",G="diagram",aj="diagram-builder",ap="diagramNode",aO="diagram-node-manager",B="diagram-node",aF="dragNode",O="editing",C="editEvent",K="editMessage",aB="end",a="esc",aH="field",r="fields",an="fieldsDragConfig",al="fork",Y="graphic",aG="height",ay="id",s="join",P="keydown",n="name",p="node",ar="p1",aq="p2",d="parentNode",l="pencil",aw="radius",af="records",k="recordset",aR="rendered",J="required",aK="selected",aE="shape",U="shapeBoundary",h="shapeInvite",Q="source",au="start",Z="state",i="target",E="task",N="connector",m="transition",S="transitions",e="type",ae="visible",L="width",x="xy",w="zIndex",aT="-",g=".",R="",f="#",H="_",v=am.getClassName,t=v(G,aQ,M),ac=v(G,p),aD=v(G,p,aE,u),b=v(G,p,ak),aA=v(G,p,O),aS=v(G,p,aK);window.__dump=function(){var aW="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",A="<br/>";am.all(".aui-diagram-node").each(function(a2){var aX=R,aZ=am.Widget.getByNode(a2),aY=aZ.get("name"),a1=aZ.get("boundingBox"),a0=a1.one(".log")||am.Node.create("<div class=log />").appendTo(a1);aX+=aY+A;aZ.get("transitions").each(function(a3){aX+=aW+aW+"t: "+am.Object.values(a3)+A;});a0.setContent(aX);});};var z=am.Component.create({NAME:aj,ATTRS:{connector:{setter:"_setConnector",value:null},fieldsDragConfig:{value:null,setter:"_setFieldsDragConfig",validator:I},graphic:{valueFn:function(){return new am.Graphic();},validator:I},strings:{value:{addNode:"Add node",cancel:"Cancel",deleteConnectorsMessage:"Are you sure you want to delete the selected connector(s)?",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}}},EXTENDS:am.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{selectedConnector:null,selectedNode:null,initializer:function(){var A=this;A.after({render:A.syncConnectionsUI});A.on({cancel:A._onCancel,"drag:drag":A._onDrag,"drag:end":A._onDragEnd,"drop:hit":A._onDropHit,save:A._onSave});A.handlerKeyDown=am.getDoc().on(P,am.bind(A._afterKeyEvent,A));A.dropContainer.delegate(az,am.bind(A._onNodeClick,A),g+ac);},renderUI:function(){var A=this;am.DiagramBuilder.superclass.renderUI.apply(this,arguments);A._renderGraphic();},syncUI:function(){var A=this;am.DiagramBuilder.superclass.syncUI.apply(this,arguments);A._setupFieldsDrag();A.connector=A.get(N);},syncConnectionsUI:function(){var A=this;
A.get(r).each(function(aW){aW.syncConnectionsUI();});},clearFields:function(){var aW=this;var A=[];aW.get(r).each(function(aX){A.push(aX);});aU.each(A,function(aX){aX.destroy();});A=aW.editingConnector=aW.editingNode=aW.selectedNode=null;},closeEditProperties:function(){var A=this;var aW=A.editingNode;var aX=A.tabView;aX.selectTab(am.DiagramBuilder.FIELDS_TAB);aX.disableTab(am.DiagramBuilder.SETTINGS_TAB);if(aW){aW.get(q).removeClass(aA);}A.editingConnector=null;A.editingNode=null;},connect:function(aW,aX){var A=this;if(aL(aW)){aW=am.Widget.getByNode(f+am.DiagramNode.buildNodeId(aW));}if(aL(aX)){aX=am.Widget.getByNode(f+am.DiagramNode.buildNodeId(aX));}if(aW&&aX){aW.connect(aX.get(n));}return A;},connectAll:function(aW){var A=this;aU.each(aW,function(aX){if(aX.hasOwnProperty(Q)&&aX.hasOwnProperty(i)){A.connect(aX.source,aX.target,aX.connector);}});return A;},createField:function(aW){var A=this;if(!aJ(aW)){aW.builder=A;aW.bubbleTargets=A;aW=new (A.getFieldClass(aW.type||p))(aW);}return aW;},deleteSelectedConnectors:function(){var aW=this;var A=aW.getStrings();var aX=aW.getSelectedConnectors();if(aX.length&&confirm(A[at])){aU.each(aX,function(aY){var aZ=aY.get(m);am.DiagramNode.getNodeByName(aZ.source).disconnect(aZ);});}},deleteSelectedNode:function(){var A=this;var aW=A.selectedNode;if(aW&&!aW.get(J)){aW.close();}},eachConnector:function(aW){var A=this;A.get(r).each(function(aX){aX.get(S).each(function(aY){aW.call(A,aX.getConnector(aY),aY,aX);});});},editConnector:function(aW){var A=this;if(aW){var aX=A.tabView;A.closeEditProperties();aX.enableTab(am.DiagramBuilder.SETTINGS_TAB);aX.selectTab(am.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(k,aW.getProperties());A.editingConnector=A.selectedConnector=aW;}},editNode:function(aX){var A=this;if(aX){var aW=A.tabView;A.closeEditProperties();aW.enableTab(am.DiagramBuilder.SETTINGS_TAB);aW.selectTab(am.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(k,aX.getProperties());aX.get(q).addClass(aA);A.editingNode=A.selectedNode=aX;}},getFieldClass:function(aX){var A=this;var aW=am.DiagramBuilder.types[aX];if(aW){return aW;}else{am.log("The field type: ["+aX+"] couldn't be found.");return null;}},getNodesByTransitionProperty:function(aY,aX){var A=this;var aW=[];A.get(r).some(function(aZ){aZ.get(S).each(function(a0){if(a0[aY]===aX){aW.push(aZ);return false;}});});return aW;},getSelectedConnectors:function(){var A=this;var aW=[];A.eachConnector(function(aX){if(aX.get(aK)){aW.push(aX);}});return aW;},getSourceNodes:function(aW){var A=this;return A.getNodesByTransitionProperty(i,aW.get(n));},isFieldsDrag:function(aX){var A=this;var aW=A.fieldsDrag;return(aX===aW.dd);},plotField:function(aW){var A=this;if(!aW.get(aR)){aW.render(A.dropContainer);}},select:function(aW){var A=this;A.unselectNodes();A.selectedNode=aW.set(aK,true).focus();},stopEditing:function(){var A=this;A.unselectConnectors();A.unselectNodes();A.closeEditProperties();},toJSON:function(){var A=this;var aW={nodes:[]};A.get(r).each(function(aY){var aX={transitions:[]};aU.each(aY.SERIALIZABLE_ATTRS,function(aZ){aX[aZ]=aY.get(aZ);});aY.get(S).each(function(a0){var aZ=aY.getConnector(a0);a0.connector=aZ.toJSON();aX.transitions.push(a0);});aW.nodes.push(aX);});return aW;},unselectConnectors:function(){var A=this;aU.each(A.getSelectedConnectors(),function(aW){aW.set(aK,false);});},unselectNodes:function(){var A=this;var aW=A.selectedNode;if(aW){aW.set(aK,false);}A.selectedNode=null;},_afterKeyEvent:function(aW){var A=this;if(aW.hasModifier()||am.getDoc().get(ab).test(":input,td")){return;}if(aW.isKey(a)){A._onEscKey(aW);}else{if(aW.isKey(y)||aW.isKey(V)){A._onDeleteKey(aW);}}},_onCancel:function(aW){var A=this;A.closeEditProperties();},_onDeleteKey:function(aW){var A=this;A.deleteSelectedConnectors();A.deleteSelectedNode();aW.halt();},_onDrag:function(aX){var A=this;var aW=aX.target;if(A.isFieldsDrag(aW)){var aY=am.Widget.getByNode(aW.get(aF));aY.alignTransitions();aU.each(A.getSourceNodes(aY),function(aZ){aZ.alignTransitions();});}},_onDragEnd:function(aX){var A=this;var aW=aX.target;if(A.isFieldsDrag(aW)){var aY=am.Widget.getByNode(aW.get(aF));aY.set(x,aY.getLeftTop());}},_onDropHit:function(aX){var A=this;var aW=aX.drag;if(A.isAvailableFieldsDrag(aW)){var aZ=aW.get(p).getData(T);var aY=A.addField({xy:ao(aW.lastXY,A.dropContainer),type:aZ.get(e)});A.select(aY);}},_onEscKey:function(aW){var A=this;A.stopEditing();aW.halt();},_onNodeClick:function(aW){var A=this;var aX=am.Widget.getByNode(aW.currentTarget);A.select(aX);A._onNodeEdit(aW);},_onNodeEdit:function(aW){var A=this;if(!aW.target.ancestor(g+b,true)){return;}var aX=am.Widget.getByNode(aW.currentTarget);if(aX){A.editNode(aX);}},_onSave:function(aX){var A=this;var aW=A.editingNode;var aY=A.editingConnector;var aZ=A.propertyList.get(k);if(aW){aU.each(aZ.get(af),function(a0){var a1=a0.get(av);aW.set(a1.attributeName,a1.value);});}else{if(aY){aU.each(aZ.get(af),function(a0){var a1=a0.get(av);aY.set(a1.attributeName,a1.value);});}}},_renderGraphic:function(){var A=this;A.get(Y).render(A.get(ai));},_setConnector:function(aX){var A=this;if(!D(aX)){var aW=A.get(ai).getXY();aX=new am.Connector(am.merge({graphic:A.get(Y),lazyDraw:true,p1:aW,p2:aW,shapeHover:null},aX));}return aX;},_setFieldsDragConfig:function(aX){var A=this;var aW=A.dropContainer;return am.merge({bubbleTargets:A,container:aW,dragConfig:{plugins:[{cfg:{constrain:aW},fn:am.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:am.Plugin.DDWinScroll}]},nodes:g+ac},aX||{});},_setupFieldsDrag:function(){var A=this;A.fieldsDrag=new am.DD.Delegate(A.get(an));}}});am.DiagramBuilder=z;am.DiagramBuilder.types={};var X=am.Component.create({NAME:aO,EXTENDS:am.Base});am.DiagramNodeManager=new X();var aV=am.Component.create({NAME:B,UI_ATTRS:[n,J,aK],ATTRS:{builder:{validator:W},connectors:{valueFn:"_createDataSet",writeOnce:true},controlsToolbar:{validator:I,valueFn:"_valueControlsToolbar"},description:{value:R,validator:aL},graphic:{writeOnce:true,validator:I},height:{value:60},name:{valueFn:function(){var A=this;
return A.get(e)+(++am.Env._uidx);},validator:aL},required:{value:false,validator:aI},selected:{value:false,validator:aI},shapeBoundary:{validator:I,value:{height:40,type:"rect",stroke:{weight:10,color:"#f00"},width:40}},shapeInvite:{validator:I,value:{radius:10,type:"circle",stroke:{weight:5,color:"#ff6600",opacity:0.8},fill:{color:"#ffd700",opacity:0.8}}},strings:{value:{closeMessage:"Close",deleteNodesMessage:"Are you sure you want to delete the selected node(s)?",description:"Description",editMessage:"Edit",name:"Name",type:"Type"}},tabIndex:{value:1},transitions:{value:null,writeOnce:true,setter:"_setTransitions"},type:{value:p,validator:aL},width:{value:60},zIndex:{value:100}},EXTENDS:am.Overlay,getNodeByName:function(A){return am.Widget.getByNode(f+am.DiagramNode.buildNodeId(A));},buildNodeId:function(A){return ap+H+aH+H+A.replace(/[^a-z0-9.:_\-]/ig,"_");},prototype:{boundary:null,publishedTarget:null,publishedSource:null,CONTROLS_TEMPLATE:'<div class="'+t+'"></div>',SERIALIZABLE_ATTRS:[aC,n,J,e,L,aG,w,x],initializer:function(){var A=this;A.after({"dataset:remove":am.bind(A._afterDataSetRemove,A),render:A._afterRender});A.publish({boundaryDrag:{defaultFn:A._defBoundaryDrag},boundaryDragEnd:{defaultFn:A._defBoundaryDragEnd},boundaryDragOut:{defaultFn:A._defBoundaryDragOut},boundaryDragOver:{defaultFn:A._defBoundaryDragOver},boundaryDragStart:{defaultFn:A._defBoundaryDragStart},boundaryDrop:{defaultFn:A._defBoundaryDrop},boundaryMouseEnter:{},boundaryMouseLeave:{}});am.DiagramNodeManager.on({publishedSource:function(aW){A.publishedSource=aW.publishedSource;},releasedSource:function(aW){A.publishedSource.publishedTarget=null;A.publishedSource=null;}});A.get(q).addClass(ac+aT+A.get(e));},destructor:function(){var A=this;A.invite.destroy();A.get(Y).destroy();A.get(aQ).removeField(A);},addTransition:function(aX){var A=this;var aW=A.get(S);aX=A.prepareTransition(aX);if(!aW.containsKey(aX.uid)){aX.uid=am.guid();aW.add(aX.uid,aX);}return aX;},alignTransition:function(aW){var A=this;var aX=am.DiagramNode.getNodeByName(aW.target);if(aX){A.getConnector(aW).setAttrs({p1:A._adjustDiagramNodeOffset(A,aW.sourceXY),p2:A._adjustDiagramNodeOffset(aX,aW.targetXY)});}},alignTransitions:function(){var A=this;A.get(S).each(am.bind(A.alignTransition,A));},close:function(){var aW=this;var A=aW.getStrings();if(confirm(A[o])){aW.destroy();}return aW;},connect:function(aX){var A=this;aX=A.addTransition(aX);var aW=null;var aY=am.DiagramNode.getNodeByName(aX.target);if(aY){if(!A.isTransitionConnected(aX)){aW=new am.Connector({graphic:A.get(aQ).get(Y),transition:aX});A.get(j).add(aX.uid,aW);}}A.alignTransition(aX);return aW;},disconnect:function(aW){var A=this;if(A.isTransitionConnected(aW)){A.removeTransition(aW);}__dump();},getConnector:function(aW){var A=this;return A.get(j).item(aW.uid);},getContainer:function(){var A=this;return(A.get(aQ).dropContainer||A.get(q).get(d));},getLeftTop:function(){var A=this;return ao(A.get(q),A.getContainer());},getProperties:function(){var A=this;var aW=A.getPropertyModel();aU.each(aW,function(aZ){var aY=A.get(aZ.attributeName),aX=ad.type(aY);if(aX===aa){aY=String(aY);}aZ.value=aY;});return aW;},getPropertyModel:function(){var aW=this;var A=aW.getStrings();return[{attributeName:aC,editor:new am.TextAreaCellEditor(),name:A[aC]},{attributeName:n,editor:new am.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[n]},{attributeName:e,editor:false,name:A[e]}];},isTransitionConnected:function(aW){var A=this;return A.get(j).containsKey(aW.uid);},prepareTransition:function(aX){var A=this;var aW={source:A.get(n),sourceXY:[0,0],target:null,targetXY:[0,0],uid:am.guid()};if(aL(aX)){aW.target=aX;}else{if(I(aX)){aW=am.merge(aW,aX);}}return aW;},removeTransition:function(aW){var A=this;return A.get(S).removeKey(aW.uid);},renderShapeBoundary:function(){var A=this;var aW=A.boundary=A.get(Y).addShape(A.get(U));aW.end();return aW;},renderShapeInvite:function(){var A=this;var aW=A.invite=A.get(aQ).get(Y).addShape(A.get(h));aW.set(ae,false);aW.end();return aW;},syncConnectionsUI:function(){var A=this;A.get(S).each(am.bind(A.connect,A));},_adjustDiagramNodeOffset:function(aY,aW){var A=this;var aX=aY.get(q).getXY();return[aX[0]+aW[0],aX[1]+aW[1]];},_afterDataSetRemove:function(aX){var A=this;var aW=aX.target;if(aW===A.get(S)){A.get(j).removeKey(aX.prevVal.uid);}else{if(aW===A.get(j)){aX.prevVal.destroy();}}},_afterRender:function(aW){var A=this;A.setStdModContent(ah.BODY,R,ah.AFTER);A._renderGraphic();A._renderControls();},_bindBoundaryEvents:function(){var A=this;A.boundary.detachAll().on({mouseenter:am.bind(A._onBoundaryMouseEnter,A),mouseleave:am.bind(A._onBoundaryMouseLeave,A)});},_createDataSet:function(){var A=this;return new am.DataSet({bubbleTargets:A});},_defBoundaryDrag:function(aY){var A=this;var aX=A.get(aQ);var aZ=A.boundaryDragDelegate.dd.mouseXY;aX.connector.set(aq,aZ);if(A.publishedTarget){var aW=A.invite;var a0=aW.get(aw)||0;if(!aW.get(ae)){aW.set(ae,true);}aW.setXY([aZ[0]-a0,aZ[1]-a0]);}},_defBoundaryDragEnd:function(aW){var A=this;A.get(aQ).connector.hide();A.publishedSource.invite.set(ae,false);am.DiagramNodeManager.fire("releasedSource",{releasedSource:A});},_defBoundaryDragOut:function(aX){var A=this;var aW=A.publishedSource;aW.publishedTarget=null;aW.invite.set(ae,false);},_defBoundaryDragOver:function(aX){var A=this;var aW=A.publishedSource;if(aW!==A){aW.publishedTarget=A;}},_defBoundaryDragStart:function(aX){var A=this;var aW=A.get(aQ);var aY=A.boundaryDragDelegate.dd.startXY;aW.connector.show().set(ar,aY);am.DiagramNodeManager.fire("publishedSource",{publishedSource:A});},_defBoundaryDrop:function(aZ){var aW=this;var A=aW.boundaryDragDelegate.dd;var aY=aZ.publishedSource;var aX=aZ.publishedTarget;aY.connect(aY.prepareTransition({sourceXY:ao(A.startXY,aY.get(q)),target:aX.get(n),targetXY:ao(A.mouseXY,aX.get(q))}));},_handleCloseEvent:function(aW){var A=this;if(!A.get(J)){A.close();}},_handleEditEvent:function(aW){var A=this;A.get(aQ).editNode(A);},_onBoundaryDrag:function(aW){var A=this;
A.fire("boundaryDrag",{dragEvent:aW,publishedSource:A.publishedSource});},_onBoundaryDragEnd:function(aY){var A=this;var aW=A.publishedSource;var aX=A.publishedTarget;if(aW&&aX){A.fire("boundaryDrop",{dragEvent:aY,publishedSource:aW,publishedTarget:aX});}A.fire("boundaryDragEnd",{dragEvent:aY,publishedSource:aW});},_onBoundaryDragStart:function(aW){var A=this;A.fire("boundaryDragStart",{dragEvent:aW});},_onBoundaryMouseEnter:function(aX){var A=this;var aW=A.publishedSource;A.fire("boundaryMouseEnter",{domEvent:aX});if(aW){A.fire("boundaryDragOver",{domEvent:aX,publishedSource:aW});}},_onBoundaryMouseLeave:function(aX){var A=this;var aW=A.publishedSource;A.fire("boundaryMouseLeave",{domEvent:aX});if(aW){A.fire("boundaryDragOut",{domEvent:aX,publishedSource:aW});}},_renderControls:function(){var A=this;var aW=A.get(q);A.controlsNode=am.Node.create(A.CONTROLS_TEMPLATE).appendTo(aW);},_renderControlsToolbar:function(aW){var A=this;A.controlsToolbar=new am.Toolbar(A.get(ax)).render(A.controlsNode);A._uiSetRequired(A.get(J));},_renderGraphic:function(){var A=this;A.set(Y,new am.Graphic({height:A.get(aG),render:A.bodyNode,width:A.get(L)}));A.renderShapeInvite();A.renderShapeBoundary().addClass(aD);A._bindBoundaryEvents();A._setupBoundaryDrag();},_setTransitions:function(aX){var A=this;if(!aP(aX)){var aW=A._createDataSet();am.Array.each(aX,function(aZ){var aY=am.guid();aZ=I(aZ)?am.mix(aZ,{uid:aY}):{uid:aY,target:aZ};aW.add(aY,A.prepareTransition(aZ));});aX=aW;}return aX;},_setupBoundaryDrag:function(){var A=this;var aW=A.get(aQ);A.boundaryDragDelegate=new am.DD.Delegate({container:A.bodyNode,nodes:g+aD,dragConfig:{useShim:false,plugins:[{cfg:{constrain:(aW?aW.get(ai):null)},fn:am.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:am.Plugin.DDWinScroll},{cfg:{borderStyle:"0px",moveOnEnd:false,resizeFrame:false},fn:am.Plugin.DDProxy}]},on:{"drag:drag":am.bind(A._onBoundaryDrag,A),"drag:end":am.bind(A._onBoundaryDragEnd,A),"drag:start":am.bind(A._onBoundaryDragStart,A)}});am.Do.after(A._bindBoundaryEvents,A.boundaryDragDelegate.dd,"_unprep",A);},_uiSetName:function(aX){var A=this;var aW=A.get(q);aW.set(ay,am.DiagramNode.buildNodeId(aX));},_uiSetRequired:function(aY){var aX=this;var aW=aX.getStrings();var A=aX.controlsToolbar;if(A){if(aY){A.remove(aM);}else{A.add({handler:am.bind(aX._handleCloseEvent,aX),icon:ag,id:aM,title:aW[F]});}}},_uiSetSelected:function(aW){var A=this;A.get(q).toggleClass(aS,aW);if(aW&&!A.controlsToolbar){A._renderControlsToolbar();}},_uiSetXY:function(aX){var A=this;var aW=A.getContainer().getXY();this._posNode.setXY([aX[0]+aW[0],aX[1]+aW[1]]);},_valueControlsToolbar:function(aX){var aW=this;var A=aW.getStrings();return{activeState:false,children:[{handler:am.bind(aW._handleEditEvent,aW),icon:l,id:C,title:A[K]},{handler:am.bind(aW._handleCloseEvent,aW),icon:ag,id:aM,title:A[F]}]};}}});am.DiagramNode=aV;am.DiagramBuilder.types[p]=am.DiagramNode;am.DiagramNodeState=am.Component.create({NAME:B,ATTRS:{height:{value:40},type:{value:Z},width:{value:40}},EXTENDS:am.DiagramNode});am.DiagramBuilder.types[Z]=am.DiagramNodeState;am.DiagramNodeCondition=am.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:aN},width:{value:60}},EXTENDS:am.DiagramNodeState,prototype:{renderShapeBoundary:function(){var A=this;var aW=A.boundary=A.get(Y).addShape(A.get(U));aW.translate(10,10);aW.rotate(45);aW.end();return aW;}}});am.DiagramBuilder.types[aN]=am.DiagramNodeCondition;am.DiagramNodeStart=am.Component.create({NAME:B,ATTRS:{type:{value:au}},EXTENDS:am.DiagramNodeState});am.DiagramBuilder.types[au]=am.DiagramNodeStart;am.DiagramNodeEnd=am.Component.create({NAME:B,ATTRS:{type:{value:aB}},EXTENDS:am.DiagramNodeState});am.DiagramBuilder.types[aB]=am.DiagramNodeEnd;am.DiagramNodeJoin=am.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:s},width:{value:60}},EXTENDS:am.DiagramNodeState});am.DiagramBuilder.types[s]=am.DiagramNodeJoin;am.DiagramNodeFork=am.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:al},width:{value:60}},EXTENDS:am.DiagramNodeState});am.DiagramBuilder.types[al]=am.DiagramNodeFork;am.DiagramNodeTask=am.Component.create({NAME:B,ATTRS:{height:{value:70},type:{value:E},width:{value:70}},EXTENDS:am.DiagramNodeState});am.DiagramBuilder.types[E]=am.DiagramNodeTask;},"@VERSION@",{requires:["aui-data-set","aui-diagram-builder-base","aui-diagram-builder-connector","overlay"],skinnable:true});AUI.add("aui-diagram-builder-connector",function(w){var h=w.Lang,s=h.isArray,p=h.isBoolean,q=h.isObject,t=h.isString,D=w.Array,b=function(A){return(A instanceof w.Graphic);},o="anchor",r="arrowPoints",k="builder",j="click",l="color",g="connector",c="diagramNode",a="fill",d="graphic",C="lazyDraw",z="mouseenter",n="mouseleave",m="name",f="p1",e="p2",E="path",i="selected",x="shape",u="shapeHover",v="shapeSelected",B="stroke",y="visible";w.PolygonUtil={ARROW_POINTS:[[-12,-6],[-8,0],[-12,6],[6,0]],drawLineArrow:function(G,H,J,F,I,K){var A=this;G.moveTo(H,J);G.lineTo(F,I);var L=Math.atan2(I-J,F-H);F=F-5*Math.cos(L);I=I-5*Math.sin(L);A.drawPolygon(G,A.translatePoints(A.rotatePoints(K||A.ARROW_POINTS,L),F,I));},drawPolygon:function(F,G){var A=this;F.moveTo(G[0][0],G[0][1]);D.each(G,function(I,H){if(H>0){F.lineTo(G[H][0],G[H][1]);}});F.lineTo(G[0][0],G[0][1]);},translatePoints:function(G,F,I){var A=this;var H=[];D.each(G,function(K,J){H.push([G[J][0]+F,G[J][1]+I]);});return H;},rotatePoints:function(F,H){var A=this;var G=[];D.each(F,function(J,I){G.push(A.rotatePoint(H,F[I][0],F[I][1]));});return G;},rotatePoint:function(F,A,G){return[(A*Math.cos(F))-(G*Math.sin(F)),(A*Math.sin(F))+(G*Math.cos(F))];}};w.Connector=w.Base.create("line",w.Base,[],{SERIALIZABLE_ATTRS:[l,C,m,v,u,f,e],shape:null,initializer:function(G){var A=this;var F=A.get(C);A.after({p1Change:A.draw,p2Change:A.draw,selectedChange:A._afterSelectedChange});A._initShapes();if(!F){A.draw();}A._uiSetSelected(A.get(i),!F);},destroy:function(){var A=this;A.shape.destroy();},draw:function(){var A=this;var F=A.shape;var H=A.getCoordinate(A.get(f));
var G=A.getCoordinate(A.get(e));F.clear();w.PolygonUtil.drawLineArrow(F,H[0],H[1],G[0],G[1],A.get(r));F.end();return A;},getCoordinate:function(G){var A=this;var F=A.get(d).getXY();return[G[0]-F[0],G[1]-F[1]];},getProperties:function(){var A=this;var F=A.getPropertyModel();D.each(F,function(G){G.value=A.get(G.attributeName);});return F;},getPropertyModel:function(){var F=this;var G=F.get(o);var A=G?G.get(c).getStrings():{};return[{attributeName:m,editor:new w.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[m]}];},hide:function(){var A=this;A.shape.set(y,false);return A;},show:function(){var A=this;A.shape.set(y,true);return A;},toJSON:function(){var A=this;var F={};D.each(A.SERIALIZABLE_ATTRS,function(G){F[G]=A.get(G);});return F;},_afterSelectedChange:function(F){var A=this;A._uiSetSelected(F.newVal);},_initShapes:function(){var A=this;var F=A.shape=A.get(d).addShape(A.get(x));F.on(j,w.bind(A._onShapeClick,A));F.on(z,w.bind(A._onShapeMouseEnter,A));F.on(n,w.bind(A._onShapeMouseLeave,A));},_onShapeClick:function(H){var A=this;var F=A.get(k);var G=A.get(i);if(F){if(H.hasModifier()){F.closeEditProperties();}else{F.unselectConnectors();if(G){F.closeEditProperties();}else{F.editConnector(A);}}}A.set(i,!G);},_onShapeMouseEnter:function(G){var A=this;if(!A.get(i)){var F=A.get(u);if(F){A._updateShape(F);}}},_onShapeMouseLeave:function(F){var A=this;if(!A.get(i)){A._updateShape(A.get(x));}},_setShape:function(F){var A=this;return w.merge({type:E,stroke:{color:A.get(l),weight:3},fill:{color:A.get(l)}},F);},_uiSetSelected:function(G,F){var A=this;A._updateShape(G?A.get(v):A.get(x),F);},_updateShape:function(H,F){var A=this;var G=A.shape;if(H.hasOwnProperty(a)){G.set(a,H[a]);}if(H.hasOwnProperty(B)){G.set(B,H[B]);}if(F!==false){A.draw();}}},{ATTRS:{arrowPoints:{value:w.PolygonUtil.ARROW_POINTS},builder:{},color:{value:"#27aae1",validator:t},graphic:{validator:b},lazyDraw:{value:false,validator:p},name:{valueFn:function(){var A=this;return g+(++w.Env._uidx);},validator:t},p1:{value:[0,0],validator:s},p2:{value:[0,0],validator:s},selected:{value:false,validator:p},shape:{value:null,setter:"_setShape"},shapeHover:{value:{fill:{color:"#666"},stroke:{color:"#666",weight:5}}},shapeSelected:{value:{fill:{color:"#000"},stroke:{color:"#000",weight:5}}},transition:{value:{},validator:q}}});},"@VERSION@",{requires:["aui-base","arraylist-add","arraylist-filter","json","graphics","dd"],skinnable:true});AUI.add("aui-diagram-builder",function(a){},"@VERSION@",{use:["aui-diagram-builder-base","aui-diagram-builder-impl"],skinnable:true});