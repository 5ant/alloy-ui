AUI.add("aui-diagram-builder-base",function(ai){var X=ai.Lang,d=X.isArray,ax=X.isBoolean,O=X.isNumber,F=X.isObject,aB=X.isString,M=function(A){return(A instanceof ai.ArrayList);},V=function(A){return(A instanceof ai.Node);},H=function(A){return(A instanceof ai.AvailableField);},aK=ai.Array,Y="add",o="addNode",aJ="auto",P="availableField",T="availableFields",aG="availableFieldsDragConfig",v="boundingBox",aD="builder",ac="cancel",af="canvas",az="clearfix",f="column",a="container",ag="content",y="contentBox",e="contentContainer",S="contentNode",I="createDocumentFragment",D="diagram",ao="diagram-builder",ad="disk",r="draggable",aF="drop",ar="dropConfig",ab="dropContainer",aw="field",w="fields",q="fieldsContainer",av="height",s="helper",aa="icon",z="iconClass",aq="id",am="label",x="layout",ap="list",R="maxFields",u="node",g="parentNode",ah="propertyList",aE="rendered",at="save",t="settings",Q="tab",K="tabView",b="tabs",h="tabview",N="toolbar",m="toolbarContainer",C=ai.getClassName,aI=" ",i=".",j="#",aI=" ",E="_",n=C(f),B=C(D,aD,af),aj=C(D,aD,ag,a),G=C(D,aD,aF,a),ay=C(D,aD,aw),l=C(D,aD,aw,r),c=C(D,aD,aw,aa),ae=C(D,aD,aw,am),Z=C(D,aD,w,a),ak=C(D,aD,Q,Y),L=C(D,aD,Q,t),au=C(D,aD,b),U=C(D,aD,b,ag),an=C(D,aD,N,a),al=C(s,az),p=C(aa),J=C(x),aC=C(h,ag),aH=C(h,ap);var k=ai.Component.create({NAME:P,ATTRS:{draggable:{value:true,validator:ax},label:{validator:aB},iconClass:{validator:aB},id:{value:ai.guid(),setter:"_setId",validator:aB},node:{valueFn:function(aL){var A=this;if(!V(aL)){aL=ai.Node.create(ai.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(z)}));aL.setData(P,A);}return aL;},validator:V,writeOnce:true},type:{value:u,validator:aB}},EXTENDS:ai.Base,buildNodeId:function(A){return T+E+aw+E+A;},getAvailableFieldById:function(A){return ai.AvailableField.getAvailableFieldByNode(j+ai.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){var A=ai.one(A);if(V(ai.one(A))){return A.getData(P);}return null;},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+ay+'">'+'<span class="'+[p,c].join(aI)+' {iconClass}"></span>'+'<div class="'+ae+'"></div>'+"</li>",initializer:function(){var A=this;var aL=A.get(u);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aL.one(i+ae);A._uiSetDraggable(A.get(r));A._uiSetId(A.get(aq));A._uiSetLabel(A.get(am));},_afterDraggableChange:function(aL){var A=this;A._uiSetDraggable(aL.newVal);},_afterIdChange:function(aL){var A=this;A._uiSetId(aL.newVal);},_afterLabelChange:function(aL){var A=this;A._uiSetLabel(aL.newVal);},_setId:function(A){return ai.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aL){var A=this;A.get(u).toggleClass(l,aL);},_uiSetId:function(aL){var A=this;A.get(u).set(aq,aL);},_uiSetLabel:function(aL){var A=this;A.labelNode.setContent(aL);}}});ai.AvailableField=k;var W=function(){};W.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||M(A);}},maxFields:{value:Infinity,validator:O}};ai.mix(W.prototype,{_setFields:function(aL){var A=this;if(M(aL)){return aL;}else{return A.createFields(aL);}},_updateFields:function(aL){var A=this;A.set(w,aL);},addField:function(aM,aL){var A=this;if(A.get(w).size()<A.get(R)){var aN=A.createField(aM);if(aN){A._updateFields(A.get(w).add(aN,aL));}return aN;}return null;},createFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){if(aN<aL.get(R)){A.push(aL.createField(aO));}});return new ai.ArrayList(A);},removeField:function(aL){var A=this;A._updateFields(A.get(w).remove(aL));},createField:function(A){return A;}});ai.FieldSupport=W;var aA=ai.Component.create({NAME:ao,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:F},canvas:{valueFn:function(){return ai.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:F},contentContainer:{valueFn:function(){return ai.Node.create(this.CONTENT_CONTAINER_TEMPLATE);}},dropContainer:{valueFn:function(){return ai.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return ai.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:F,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:F,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:F,value:null},toolbarContainer:{valueFn:function(){return ai.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{contentContainer:i+aj,dropContainer:i+G,fieldsContainer:i+Z,toolbarContainer:i+an,canvas:i+B},UI_ATTRS:[T,w],AUGMENTS:[ai.FieldSupport],prototype:{CONTENT_CONTAINER_TEMPLATE:'<div class="'+aj+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+G+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+an+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[Z,al].join(aI)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+B+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender,"recordset:update":A._afterRecordsetUpdate});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(af);A.contentContainer=A.get(e);A.dropContainer=A.get(ab);A.fieldsContainer=A.get(q);A.toolbarContainer=A.get(m);},isAvailableFieldsDrag:function(aM){var A=this;var aL=A.availableFieldsDrag;return(aM===aL.dd);},plotFields:function(){var aL=this;var A=aL.get(w);A.each(function(aM){aL.plotField(aM);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(T));},syncUI:function(){var A=this;var aL=A.get(y);A._setupDrop();A._setupAvailableFieldsDrag();aL.addClass(J);},_afterActiveTabChange:function(aM){var A=this;var aL=aM.newVal.get(S);if(A.get(aE)&&(aL===A.settingsNode)){A._renderSettings();}},_afterRecordsetUpdate:function(aL){var A=this;
A._handleSaveEvent();},_afterRender:function(aL){var A=this;A.plotFields();},_afterUiSetHeight:function(aL){var A=this;A.contentContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);A.dropContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);},_defCancelFn:function(aL){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(ac);},_handleSaveEvent:function(){var A=this;A.fire(at);},_renderCanvas:function(){var A=this;var aL=A.get(y);var aM=A.canvas;var aN=A.contentContainer;var aO=A.dropContainer;if(!aM.inDoc()){aN.appendChild(aM);}if(!aO.inDoc()){aM.appendChild(aO);}if(aN.inDoc()){aN.get(g).append(aN);}else{aL.appendChild(aN);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ai.PropertyList(A.get(ah)).render(A.settingsNode);A.propertyList.get(v).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aL=new ai.TabView(A.get(K));aL.get(v);A.tabView=aL;A.fieldsNode=aL.getTab(0).get(S);A.settingsNode=aL.getTab(1).get(S);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ai.Toolbar(A.get(N)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ai.DD.Drop(A.get(ar));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ai.DD.Delegate(A.get(aG));},_setAvailableFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){A.push(H(aO)?aO:new ai.AvailableField(aO));});return A;},_setDropConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,groups:[T],node:A.dropContainer},aL||{});},_setAvailableFieldsDragConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,container:A.get(v),dragConfig:{groups:[T],plugins:[{cfg:{moveOnEnd:false},fn:ai.Plugin.DDProxy}]},nodes:i+l},aL||{});},_setPropertyList:function(aL){var A=this;return ai.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aJ}},aL);},_setTabView:function(aO){var aL=this;var aN=aL.get(v);var aP=aN.one(i+aH);var aM={after:{activeTabChange:ai.bind(aL._afterActiveTabChange,aL)},boundingBox:aN.one(i+au),contentBox:aN.one(i+U),bubbleTargets:aL,contentNode:aN.one(i+aC),cssClass:au,listNode:aP,render:aL.get(y)};if(!aP){var A=aL.getStrings();aM.items=[{cssClass:ak,label:A[o]},{cssClass:L,label:A[t]}];}return ai.merge(aM,aO);},_setToolbar:function(aM){var aL=this;var A=aL.getStrings();return ai.merge({activeState:false,bubbleTargets:aL,children:[{handler:ai.bind(aL._handleCancelEvent,aL),label:A[ac]}]},aM);},_uiSetAvailableFields:function(aN){var A=this;var aM=A.fieldsNode;if(aM){var aL=ai.getDoc().invoke(I);aK.each(aN,function(aO){aL.appendChild(aO.get(u));});aM.setContent(A.fieldsContainer.setContent(aL));}},_uiSetFields:function(aL){var A=this;if(A.get(aE)){A.plotFields();}}}});ai.DiagramBuilderBase=aA;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});AUI.add("aui-diagram-builder-impl",function(aH){var at=aH.Lang,c=at.isArray,Q=at.isObject,bb=at.isString,a7=at.isBoolean,p=at.emptyFn,az=aH.WidgetStdMod,bm=aH.Array,ak=function(A){return(A instanceof aH.DiagramBuilderBase);},a8=function(A){return(A instanceof aH.DiagramNode);},K=function(A){return(A instanceof aH.Connector);},Y=function(A){return(A instanceof aH.ArrayList);},bh=function(A){return(A instanceof aH.DataSet);},aM=function(A,bp){var bo=c(bp)?bp:bp.getXY();var bq=c(A)?A:A.getXY();return bm.map(bq,function(bs,br){return Math.max(0,bs-bo[br]);});},aq="activeElement",aK="addAnchor",be="addAnchorMessage",m="addNode",aO="anchor",aI="anchors",g="sourceUID",e="targetUID",aU="radius",aC="anchorsDragConfig",ae="shapeDragConfig",ad="availableField",G="backspace",D="lock",ao="boolean",t="boundingBox",bi="builder",ay="cancel",ba="sources",U="targets",au="visible",aA="canvas",aX="click",bc="closeEvent",N="closeMessage",bf="condition",aF="content",W="controls",aV="controlsToolbar",aT="data",aB="dblclick",aj="delete",aR="deleteConnectorsMessage",r="deleteNodesMessage",a1="description",O="diagram",aE="diagram-builder",aN="diagramNode",I="diagram-node",bg="diagram-node-manager",a4="dragNode",J="editEvent",T="editMessage",Z="editing",a0="end",a="esc",a6="field",w="fields",aL="fieldsDragConfig",aG="fork",am="graphic",a5="height",u="hover",aW="id",x="join",ab="keydown",aD="link",aw="max",af="maxFields",z="maxSources",v="mouseenter",ap="mouseleave",q="name",s="node",aQ="p1",aP="p2",d="parentNode",o="pencil",ax="records",n="recordset",k="region",bj="rendered",S="required",a9="selected",R="shuffle",aa="source",ba="sources",aS="start",an="state",l="target",U="targets",L="task",X="connector",f="type",V="width",bd="wrapper",F="xy",E="zIndex",a3="shape",ag="shapeBoundary",j="shapeInvite",B="boundary",bl="-",i=".",ac="",h="#",P="_",C=aH.getClassName,ah=C(O,bi,aO,s,aw,U),aJ=C(O,bi,aO,u),aZ=C(O,bi,aO,s),M=C(O,bi,aO,s,bd),y=C(O,bi,W),ar=C(O,s),a2=C(O,s,a3,B),b=C(O,s,aF),aY=C(O,s,Z),bk=C(O,s,a9);var av=function(){var bo="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",A="<br/>";aH.all(".aui-diagram-node").each(function(bu){var bp=ac,br=aH.Widget.getByNode(bu),bq=br.get("name"),bt=br.get("boundingBox"),bs=bt.one(".log")||aH.Node.create("<div class=log />").appendTo(bt);bp+=bq+A;br.get(w).each(function(bv){bp+=bo+"a: "+bv.get("id")+A;bv.get("targets").each(function(bw){var bx=bw.get(aN);bw.get("node").setContent(bw.get("id"));bp+=bo+bo+"t: "+bx.get("name")+" (s: "+bw.get("id")+")"+A;});bv.get("sources").each(function(bx){var bw=bx.get(aN);bx.get("node").setContent(bx.get("id"));bp+=bo+bo+"s: "+bw.get("name")+" (t: "+bx.get("id")+")"+A;});});bs.setContent(bp);});};var H=aH.Component.create({NAME:aE,ATTRS:{fieldsDragConfig:{value:null,setter:"_setFieldsDragConfig",validator:Q},graphic:{valueFn:function(){return new aH.Graphic();},validator:Q},strings:{value:{addNode:"Add node",cancel:"Cancel",deleteConnectorsMessage:"Are you sure you want to delete the selected connector(s)?",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},connector:{setter:"_setConnector",value:null}},EXTENDS:aH.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{selectedConnector:null,selectedNode:null,initializer:function(){var A=this;
A.after({render:A.syncConnectionsUI});A.on({cancel:A._onCancel,"drag:drag":A._onDrag,"drag:end":A._onDragEnd,"drop:hit":A._onDropHit,save:A._onSave});A.handlerKeyDown=aH.getDoc().on(ab,aH.bind(A._afterKeyEvent,A));A.dropContainer.delegate(aX,aH.bind(A._onNodeClick,A),i+ar);A.dropContainer.delegate(v,aH.bind(A._onMouseenterAnchors,A),i+aZ);A.dropContainer.delegate(ap,aH.bind(A._onMouseleaveAnchors,A),i+aZ);},renderUI:function(){var A=this;aH.DiagramBuilder.superclass.renderUI.apply(this,arguments);A._renderGraphic();},syncUI:function(){var A=this;aH.DiagramBuilder.superclass.syncUI.apply(this,arguments);A._setupFieldsDrag();A.connector=A.get(X);},syncConnectionsUI:function(){var A=this;A.get(w).each(function(bo){bo.syncConnectionsUI();});},clearFields:function(){var bo=this;var A=[];bo.get(w).each(function(bp){A.push(bp);});bm.each(A,function(bp){bp.destroy();});A=bo.editingConnector=bo.editingNode=bo.selectedNode=null;},closeEditProperties:function(){var A=this;var bo=A.editingNode;var bp=A.tabView;bp.selectTab(aH.DiagramBuilder.FIELDS_TAB);bp.disableTab(aH.DiagramBuilder.SETTINGS_TAB);if(bo){bo.get(t).removeClass(aY);}A.editingConnector=null;A.editingNode=null;},connect:function(bo,bp){var A=this;if(bb(bo)){bo=aH.Widget.getByNode(h+aH.DiagramNode.buildNodeId(bo));}if(bb(bp)){bp=aH.Widget.getByNode(h+aH.DiagramNode.buildNodeId(bp));}if(bo&&bp){bo.connect(bp.toTarget());}return A;},connectAll:function(bo){var A=this;bm.each(bo,function(bp){if(bp.hasOwnProperty(aa)&&bp.hasOwnProperty(l)){A.connect(bp.source,bp.target,bp.connector);}});return A;},createField:function(bo){var A=this;if(!a8(bo)){bo.builder=A;bo.bubbleTargets=A;bo=new (A.getFieldClass(bo.type||s))(bo);}return bo;},deleteSelectedConnectors:function(bp){var bo=this;var A=bo.getStrings();var bq=bo.getSelectedConnectors();if(bq.length&&confirm(A[aR])){bm.each(bq,function(br){});}},deleteSelectedNode:function(){var A=this;var bo=A.selectedNode;if(bo){if(!bo.get(S)){bo.close();}}},eachConnector:function(bp){var A=this;var bo=false;A.get(w).each(function(bq){bq.get(U).each(function(br){bp.call(A,bq.getConnector(br),br,bq);});});},editConnector:function(bo){var A=this;if(bo){var bp=A.tabView;A.closeEditProperties();bp.enableTab(aH.DiagramBuilder.SETTINGS_TAB);bp.selectTab(aH.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(n,bo.getProperties());A.editingConnector=A.selectedConnector=bo;}},editNode:function(bp){var A=this;if(bp){var bo=A.tabView;A.closeEditProperties();bo.enableTab(aH.DiagramBuilder.SETTINGS_TAB);bo.selectTab(aH.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(n,bp.getProperties());bp.get(t).addClass(aY);A.editingNode=A.selectedNode=bp;}},getSelectedConnectors:function(){var A=this;var bo=[];A.eachConnector(function(bp){if(bp.get(a9)){bo.push(bp);}});return bo;},getFieldClass:function(bp){var A=this;var bo=aH.DiagramBuilder.types[bp];if(bo){return bo;}else{aH.log("The field type: ["+bp+"] couldn't be found.");return null;}},isFieldsDrag:function(bp){var A=this;var bo=A.fieldsDrag;return(bp===bo.dd);},plotField:function(bo){var A=this;if(!bo.get(bj)){bo.render(A.dropContainer);}},unselectConnectors:function(){var A=this;bm.each(A.getSelectedConnectors(),function(bo){bo.set(a9,false);});},unselectNodes:function(){var A=this;var bo=A.selectedNode;if(bo){bo.set(a9,false);}A.selectedNode=null;},select:function(bo){var A=this;A.unselectNodes();A.selectedNode=bo.set(a9,true).focus();},stopEditing:function(){var A=this;A.unselectConnectors();A.unselectNodes();A.closeEditProperties();},toJSON:function(){var A=this;var bo={nodes:[]};A.get(w).each(function(bq){var br=bq.get(q);var bp={transitions:[]};bm.each(bq.SERIALIZABLE_ATTRS,function(bs){bp[bs]=bq.get(bs);});bq.get(w).each(function(bs){bs.get(U).each(function(bt){bp.transitions.push({connector:bs.getConnector(bt).toJSON(),source:br,target:bt.get(aN).get(q)});});});bo.nodes.push(bp);});return bo;},_afterKeyEvent:function(bo){var A=this;if(bo.hasModifier()||aH.getDoc().get(aq).test(":input,td")){return;}if(bo.isKey(a)){A._onEscKey(bo);}else{if(bo.isKey(G)||bo.isKey(aj)){A._onDeleteKey(bo);}}},_onCancel:function(bo){var A=this;A.closeEditProperties();},_onDrag:function(bp){var A=this;var bo=bp.target;if(A.isFieldsDrag(bo)){var bq=aH.Widget.getByNode(bo.get(a4));bq.alignSources();bq.alignTargets();}},_onDragEnd:function(bp){var A=this;var bo=bp.target;if(A.isFieldsDrag(bo)){var bq=aH.Widget.getByNode(bo.get(a4));bq.set(F,bq.getLeftTop());}},_onDropHit:function(bp){var A=this;var bo=bp.drag;if(A.isAvailableFieldsDrag(bo)){var br=bo.get(s).getData(ad);var bq=A.addField({xy:aM(bo.lastXY,A.dropContainer),type:br.get(f),fields:[{}]});A.select(bq);}},_onDeleteKey:function(bo){var A=this;A.deleteSelectedConnectors();A.deleteSelectedNode();bo.halt();},_onEscKey:function(bo){var A=this;A.stopEditing();bo.halt();},_onMouseenterAnchors:function(bo){var A=this;bo.currentTarget.addClass(aJ);},_onMouseleaveAnchors:function(bo){var A=this;bo.currentTarget.removeClass(aJ);},_onNodeClick:function(bo){var A=this;var bp=aH.Widget.getByNode(bo.currentTarget);A.select(bp);A._onNodeEdit(bo);},_onNodeEdit:function(bo){var A=this;if(!bo.target.ancestor(i+b,true)){return;}var bp=aH.Widget.getByNode(bo.currentTarget);if(bp){A.editNode(bp);}},_onSave:function(bp){var A=this;var bo=A.editingNode;var bq=A.editingConnector;var br=A.propertyList.get(n);if(bo){bm.each(br.get(ax),function(bs){var bt=bs.get(aT);bo.set(bt.attributeName,bt.value);});}else{if(bq){bm.each(br.get(ax),function(bs){var bt=bs.get(aT);bq.set(bt.attributeName,bt.value);});}}},_renderGraphic:function(){var A=this;A.get(am).render(A.get(aA));},_setConnector:function(bp){var A=this;if(!K(bp)){var bo=A.get(aA).getXY();bp=new aH.Connector(aH.merge({graphic:A.get(am),lazyDraw:true,p1:bo,p2:bo,shapeHover:null},bp));}return bp;},_setFieldsDragConfig:function(bp){var A=this;var bo=A.dropContainer;return aH.merge({bubbleTargets:A,container:bo,dragConfig:{plugins:[{cfg:{constrain:bo},fn:aH.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:aH.Plugin.DDWinScroll}]},nodes:i+ar},bp||{});
},_setupFieldsDrag:function(){var A=this;A.fieldsDrag=new aH.DD.Delegate(A.get(aL));}}});aH.DiagramBuilder=H;aH.DiagramBuilder.types={};var al=aH.Component.create({NAME:bg,EXTENDS:aH.Base});aH.DiagramNodeManager=new al();var ai=aH.Component.create({NAME:I,EXTENDS:aH.Overlay,});var bn=aH.Component.create({NAME:I,UI_ATTRS:[q,S,a9],ATTRS:{builder:{validator:ak},graphic:{writeOnce:true,validator:Q},shapeBoundary:{validator:Q,value:{height:40,type:"rect",stroke:{weight:10,color:"transparent"},width:40}},shapeInvite:{validator:Q,value:{radius:10,type:"circle",stroke:{weight:5,color:"#ff6600",opacity:0.8},fill:{color:"#ffd700",opacity:0.8}}},sources:{value:null,writeOnce:true,setter:"_setSources"},targets:{value:null,writeOnce:true,setter:"_setTargets"},required:{value:false,validator:a7},description:{value:ac,validator:bb},height:{value:60},name:{valueFn:function(){var A=this;return A.get(f)+(++aH.Env._uidx);},validator:bb},selected:{value:false,validator:a7},strings:{value:{addAnchorMessage:"Add Anchor",closeMessage:"Close",deleteNodesMessage:"Are you sure you want to delete the selected node(s)?",description:"Description",editMessage:"Edit",name:"Name",type:"Type"}},type:{value:s,validator:bb},controlsToolbar:{validator:Q,valueFn:"_valueControlsToolbar"},width:{value:60},zIndex:{value:100},tabIndex:{value:1}},EXTENDS:ai,getNodeByName:function(A){return aH.Widget.getByNode(h+aH.DiagramNode.buildNodeId(A));},buildNodeId:function(A){return aN+P+a6+P+A.replace(/[^a-z0-9.:_-]/ig,"_");},prototype:{boundary:null,connectors:null,isOverBoundary:false,publishedSource:null,CONTROLS_TEMPLATE:'<div class="'+y+'"></div>',SERIALIZABLE_ATTRS:[a1,q,S,f,V,a5,E,F],initializer:function(){var A=this;A.connectors={};A.after({render:A._afterRender});A.publish({boundaryDrag:{defaultFn:A._defBoundaryDrag},boundaryDragEnd:{defaultFn:A._defBoundaryDragEnd},boundaryDragOut:{defaultFn:A._defBoundaryDragOut},boundaryDragOver:{defaultFn:A._defBoundaryDragOver},boundaryDragStart:{defaultFn:A._defBoundaryDragStart},boundaryDrop:{defaultFn:A._defBoundaryDrop},boundaryMouseEnter:{defaultFn:A._defBoundaryMouseEnter},boundaryMouseLeave:{defaultFn:A._defBoundaryMouseLeave}});aH.DiagramNodeManager.on({publishedSource:function(bo){A.publishedSource=bo.source;},sourceReleased:function(bo){A.publishedSource.isOverBoundary=false;A.publishedSource=null;}});A.get(t).addClass(ar+bl+A.get(f));},destructor:function(){var A=this;A.invite.destroy();A.get(am).destroy();A.get(bi).removeField(A);},alignTargets:function(){var A=this;A.get(U).each(aH.bind(A.alignTarget,A));},alignSources:function(){var A=this;A.get(ba).each(aH.bind(A.alignSource,A));},alignSource:function(bo){var A=this;var bp=aH.DiagramNode.getNodeByName(bo.name);if(bp){bp.alignTargets();}},alignTarget:function(bp){var A=this;var bq=aH.DiagramNode.getNodeByName(bp.name);if(bq){var bo=A.getConnector(bp);if(bo){bo.set(aQ,A._normalizeDiagramNodeXY(A,bp.xy));bo.set(aP,A._normalizeDiagramNodeXY(bq,bp.destXY));}}},getConnector:function(bo){var A=this;return A.connectors[bo.uid];},close:function(){var bo=this;var A=bo.getStrings();if(confirm(A[r])){bo.destroy();}return bo;},getContainer:function(){var A=this;return(A.get(bi).dropContainer||A.get(t).get(d));},getLeftTop:function(){var A=this;return aM(A.get(t),A.getContainer());},getProperties:function(){var A=this;var bo=A.getPropertyModel();bm.each(bo,function(br){var bq=A.get(br.attributeName),bp=at.type(bq);if(bp===ao){bq=String(bq);}br.value=bq;});return bo;},getPropertyModel:function(){var bo=this;var A=bo.getStrings();return[{attributeName:a1,editor:new aH.TextAreaCellEditor(),name:A[a1]},{attributeName:q,editor:new aH.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[q]},{attributeName:f,editor:false,name:A[f]}];},renderShapeBoundary:function(){var A=this;var bo=A.boundary=A.get(am).addShape(A.get(ag));bo.end();return bo;},renderShapeInvite:function(){var A=this;var bo=A.invite=A.get(bi).get(am).addShape(A.get(j));bo.set(au,false);bo.end();return bo;},syncConnectionsUI:function(){var A=this;A.get(U).each(aH.bind(A.connect,A));},addNodeSource:function(bp){var A=this;var bo=A.get(ba);bp=A.createSourceOrTargetObj(bp);if(!bo.containsKey(bp.uid)){bp.uid=aH.guid();bo.add(bp.uid,bp);}},createSourceOrTargetObj:function(bp){var A=this;var bo={xy:[0,0],destXY:[0,0],uid:aH.guid()};if(bb(bp)){bo.name=bp;}else{if(Q(bp)){bo=aH.mix(bp,bo);}}return bo;},addNodeTarget:function(bp){var A=this;var bo=A.get(U);bp=A.createSourceOrTargetObj(bp);if(!bo.containsKey(bp.uid)){bp.uid=aH.guid();bo.add(bp.uid,bp);}},removeNodeSource:function(bo){var A=this;return A.get(ba).removeKey(bo.uid);},removeNodeTarget:function(bo){var A=this;return A.get(U).removeKey(bo.uid);},isTargetConnected:function(bo){var A=this;return A.connectors.hasOwnProperty(bo.uid);},toTarget:function(){var A=this;return A.createSourceOrTargetObj({name:A.get(q)});},connect:function(bq){var A=this;var bo=null;bq=A.createSourceOrTargetObj(bq);var br=aH.DiagramNode.getNodeByName(bq.name);if(br){if(!A.isTargetConnected(bq)){var bp=A.createSourceOrTargetObj({name:A.get(q)});br.addNodeSource(bp);A.addNodeTarget(bq);bo=new aH.Connector({graphic:A.get(bi).get(am),sourceUID:bp.uid,targetUID:bq.uid});console.log("CONNECT",bq);A.connectors[bq.uid]=bo;}}A.alignTarget(bq);return bo;},disconnect:function(bp){var A=this;var bo=bp.get(e);var bq=A.get(U).item(bo);var br=aH.DiagramNode.getNodeByName(bq.name);if(br&&A.isTargetConnected(bq)){br.removeNodeSource(bp.get(g));A.removeNodeTarget(bo);bp.destroy();}},_normalizeDiagramNodeXY:function(bq,bo){var A=this;var bp=bq.get(t).getXY();return[bp[0]+bo[0],bp[1]+bo[1]];},_afterRender:function(bo){var A=this;A.setStdModContent(az.BODY,ac,az.AFTER);A._renderGraphic();A._renderControls();},_bindBoundaryEvents:function(){var A=this;A.boundary.detachAll().on({mouseenter:aH.bind(A._onBoundaryMouseEnter,A),mouseleave:aH.bind(A._onBoundaryMouseLeave,A)});},_defBoundaryDrag:function(bq){var A=this;var bp=A.get(bi);var br=A.boundaryDragDelegate.dd.mouseXY;
bp.connector.set(aP,br);if(A.isOverBoundary){var bo=A.invite;var bs=bo.get(aU)||0;var br=A.boundaryDragDelegate.dd.mouseXY;if(!bo.get(au)){bo.set(au,true);}bo.setXY([br[0]-bs,br[1]-bs]);}},_defBoundaryDragEnd:function(bo){var A=this;A.get(bi).connector.hide();A.publishedSource.invite.set(au,false);aH.DiagramNodeManager.fire("sourceReleased",{source:A});console.log("_defBoundaryDragEnd",bo);},_defBoundaryDragOut:function(bp){var A=this;var bo=A.publishedSource;bo.isOverBoundary=false;bo.invite.set(au,false);console.log("_defBoundaryDragOut",bp,A.invite);},_defBoundaryDragOver:function(bp){var A=this;var bo=A.publishedSource;if(bo!==A){bo.isOverBoundary=true;}console.log("_defBoundaryDragOver",bp);},_defBoundaryDragStart:function(bp){var A=this;var bo=A.get(bi);var bq=A.boundaryDragDelegate.dd.startXY;bo.connector.show().set(aQ,bq);aH.DiagramNodeManager.fire("publishedSource",{source:A});console.log("_defBoundaryDragStart",bp);},_defBoundaryDrop:function(bo){var A=this;console.log("_defBoundaryDrop",bo);},_defBoundaryMouseEnter:function(bo){var A=this;console.log("_defBoundaryMouseEnter",bo);},_defBoundaryMouseLeave:function(bo){var A=this;console.log("_defBoundaryMouseLeave",bo);},_handleCloseEvent:function(bo){var A=this;if(!A.get(S)){A.close();}},_handleEditEvent:function(bo){var A=this;A.get(bi).editNode(A);},_onBoundaryDrag:function(bo){var A=this;A.fire("boundaryDrag",{dragEvent:bo,source:A.publishedSource});},_onBoundaryDragEnd:function(bp){var A=this;var bo=A.publishedSource;if(bo&&A.isOverBoundary){A.fire("boundaryDrop",{dragEvent:bp,source:bo});}A.fire("boundaryDragEnd",{dragEvent:bp,source:bo});},_onBoundaryDragStart:function(bo){var A=this;A.fire("boundaryDragStart",{dragEvent:bo});},_onBoundaryMouseEnter:function(bp){var A=this;var bo=A.publishedSource;A.fire("boundaryMouseEnter",{domEvent:bp});if(bo){A.fire("boundaryDragOver",{domEvent:bp,source:bo});}},_onBoundaryMouseLeave:function(bp){var A=this;var bo=A.publishedSource;A.fire("boundaryMouseLeave",{domEvent:bp});if(bo){A.fire("boundaryDragOut",{domEvent:bp,source:bo});}},_renderControls:function(){var A=this;var bo=A.get(t);A.controlsNode=aH.Node.create(A.CONTROLS_TEMPLATE).appendTo(bo);},_renderControlsToolbar:function(bo){var A=this;A.controlsToolbar=new aH.Toolbar(A.get(aV)).render(A.controlsNode);A._uiSetRequired(A.get(S));},_renderGraphic:function(){var A=this;A.set(am,new aH.Graphic({height:A.get(a5),render:A.bodyNode,width:A.get(V)}));A.renderShapeInvite();A.renderShapeBoundary().addClass(a2);A._bindBoundaryEvents();A._setupBoundaryDrag();},_setSources:function(bo){var A=this;if(!bh(bo)){bo=A._createDataSet();}return bo;},_setTargets:function(bp){var A=this;if(!bh(bp)){var bo=A._createDataSet();aH.Array.each(bp,function(br){var bq=aH.guid();br=Q(br)?aH.mix(br,{uid:bq}):{uid:bq,name:br};bo.add(bq,A.createSourceOrTargetObj(br));});bp=bo;}return bp;},_setupBoundaryDrag:function(){var A=this;var bo=A.get(bi);A.boundaryDragDelegate=new aH.DD.Delegate({container:A.bodyNode,nodes:i+a2,dragConfig:{useShim:false,plugins:[{cfg:{constrain:(bo?bo.get(aA):null)},fn:aH.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:aH.Plugin.DDWinScroll},{cfg:{borderStyle:"0px",moveOnEnd:false,resizeFrame:false},fn:aH.Plugin.DDProxy}]},on:{"drag:drag":aH.bind(A._onBoundaryDrag,A),"drag:end":aH.bind(A._onBoundaryDragEnd,A),"drag:start":aH.bind(A._onBoundaryDragStart,A)}});aH.Do.after(A._bindBoundaryEvents,A.boundaryDragDelegate.dd,"_unprep",A);},_uiSetName:function(bp){var A=this;var bo=A.get(t);bo.set(aW,aH.DiagramNode.buildNodeId(bp));},_uiSetRequired:function(bq){var bp=this;var bo=bp.getStrings();var A=bp.controlsToolbar;if(A){if(bq){A.remove(bc);}else{A.add({handler:aH.bind(bp._handleCloseEvent,bp),icon:ay,id:bc,title:bo[N]});}}},_uiSetSelected:function(bo){var A=this;A.get(t).toggleClass(bk,bo);if(bo&&!A.controlsToolbar){A._renderControlsToolbar();}},_uiSetXY:function(bp){var A=this;var bo=A.getContainer().getXY();this._posNode.setXY([bp[0]+bo[0],bp[1]+bo[1]]);},_createDataSet:function(){var A=this;return new aH.DataSet({bubbleTargets:A});},_valueControlsToolbar:function(bp){var bo=this;var A=bo.getStrings();return{activeState:false,children:[{handler:aH.bind(bo._handleEditEvent,bo),icon:o,id:J,title:A[T]},{handler:aH.bind(bo._handleCloseEvent,bo),icon:ay,id:bc,title:A[N]}]};}}});aH.DiagramNode=bn;aH.DiagramBuilder.types[s]=aH.DiagramNode;aH.DiagramNodeState=aH.Component.create({NAME:I,ATTRS:{height:{value:40},type:{value:an},width:{value:40}},EXTENDS:aH.DiagramNode});aH.DiagramBuilder.types[an]=aH.DiagramNodeState;aH.DiagramNodeCondition=aH.Component.create({NAME:I,ATTRS:{height:{value:60},type:{value:bf},width:{value:60}},EXTENDS:aH.DiagramNodeState,prototype:{renderShapeBoundary:function(){var A=this;var bo=A.boundary=A.get(am).addShape(A.get(ag));bo.translate(10,10);bo.rotate(45);bo.end();return bo;}}});aH.DiagramBuilder.types[bf]=aH.DiagramNodeCondition;aH.DiagramNodeStart=aH.Component.create({NAME:I,ATTRS:{type:{value:aS}},EXTENDS:aH.DiagramNodeState});aH.DiagramBuilder.types[aS]=aH.DiagramNodeStart;aH.DiagramNodeEnd=aH.Component.create({NAME:I,ATTRS:{type:{value:a0}},EXTENDS:aH.DiagramNodeState});aH.DiagramBuilder.types[a0]=aH.DiagramNodeEnd;aH.DiagramNodeJoin=aH.Component.create({NAME:I,ATTRS:{height:{value:60},type:{value:x},width:{value:60}},EXTENDS:aH.DiagramNodeState});aH.DiagramBuilder.types[x]=aH.DiagramNodeJoin;aH.DiagramNodeFork=aH.Component.create({NAME:I,ATTRS:{height:{value:60},type:{value:aG},width:{value:60}},EXTENDS:aH.DiagramNodeState});aH.DiagramBuilder.types[aG]=aH.DiagramNodeFork;aH.DiagramNodeTask=aH.Component.create({NAME:I,ATTRS:{height:{value:70},type:{value:L},width:{value:70}},EXTENDS:aH.DiagramNodeState});aH.DiagramBuilder.types[L]=aH.DiagramNodeTask;},"@VERSION@",{requires:["aui-data-set","aui-diagram-builder-base","aui-diagram-builder-connector","overlay"],skinnable:true});AUI.add("aui-diagram-builder-connector",function(o){var aa=o.Lang,B=aa.isArray,F=aa.isBoolean,Z=aa.isNumber,N=aa.isObject,l=aa.isString,t=o.Array,c=function(A){return(A instanceof o.Anchor);
},Q=function(A){return(A instanceof o.ArrayList);},u=function(A){return(A instanceof o.DiagramNode);},P=function(A){return(A instanceof o.Graphic);},L="anchor",R="arrowPoints",S="boundingBox",ab="builder",O="click",H="color",w="connector",a="dataAnchor",K="diagram",C="diagramNode",J="fill",I="graphic",y="id",U="lazyDraw",V="max",n="maxSources",m="maxTargets",f="mouseenter",p="mouseleave",G="name",X="node",s="p1",Y="visible",r="p2",g="path",E="selected",z="shape",M="shapeHover",q="shapeSelected",k="sources",h="stroke",i="targets",W="wrapper",x=".",v="",j="#",D=o.getClassName,b=D(K,ab,L,X,V,i),e=D(K,ab,L,X,V,k),d=D(K,ab,L,X,W),T=D(K,ab,L,X);o.PolygonUtil={ARROW_POINTS:[[-12,-6],[-8,0],[-12,6],[6,0]],drawLineArrow:function(ad,ae,ag,ac,af,ah){var A=this;ad.moveTo(ae,ag);ad.lineTo(ac,af);var ai=Math.atan2(af-ag,ac-ae);ac=ac-5*Math.cos(ai);af=af-5*Math.sin(ai);A.drawPolygon(ad,A.translatePoints(A.rotatePoints(ah||A.ARROW_POINTS,ai),ac,af));},drawPolygon:function(ac,ad){var A=this;ac.moveTo(ad[0][0],ad[0][1]);t.each(ad,function(af,ae){if(ae>0){ac.lineTo(ad[ae][0],ad[ae][1]);}});ac.lineTo(ad[0][0],ad[0][1]);},translatePoints:function(ad,ac,af){var A=this;var ae=[];t.each(ad,function(ah,ag){ae.push([ad[ag][0]+ac,ad[ag][1]+af]);});return ae;},rotatePoints:function(ac,ae){var A=this;var ad=[];t.each(ac,function(ag,af){ad.push(A.rotatePoint(ae,ac[af][0],ac[af][1]));});return ad;},rotatePoint:function(ac,A,ad){return[(A*Math.cos(ac))-(ad*Math.sin(ac)),(A*Math.sin(ac))+(ad*Math.cos(ac))];}};o.Connector=o.Base.create("line",o.Base,[],{SERIALIZABLE_ATTRS:[H,U,G,q,M,s,r],shape:null,initializer:function(ad){var A=this;var ac=A.get(U);A.after({p1Change:A.draw,p2Change:A.draw,selectedChange:A._afterSelectedChange});A._initShapes();if(!ac){A.draw();}A._uiSetSelected(A.get(E),!ac);},destroy:function(){var A=this;A.get(I).removeShape(A.shape);},draw:function(){var A=this;var ac=A.shape;var ae=A.getCoordinate(A.get(s));var ad=A.getCoordinate(A.get(r));ac.clear();o.PolygonUtil.drawLineArrow(ac,ae[0],ae[1],ad[0],ad[1],A.get(R));ac.end();return A;},getCoordinate:function(ad){var A=this;var ac=A.get(I).getXY();return[ad[0]-ac[0],ad[1]-ac[1]];},getProperties:function(){var A=this;var ac=A.getPropertyModel();t.each(ac,function(ad){ad.value=A.get(ad.attributeName);});return ac;},getPropertyModel:function(){var ac=this;var ad=ac.get(L);var A=ad?ad.get(C).getStrings():{};return[{attributeName:G,editor:new o.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[G]}];},hide:function(){var A=this;A.shape.set(Y,false);return A;},show:function(){var A=this;A.shape.set(Y,true);return A;},toJSON:function(){var A=this;var ac={};t.each(A.SERIALIZABLE_ATTRS,function(ad){ac[ad]=A.get(ad);});return ac;},_afterSelectedChange:function(ac){var A=this;A._uiSetSelected(ac.newVal);},_initShapes:function(){var A=this;var ac=A.shape=A.get(I).addShape(A.get(z));ac.on(O,o.bind(A._onShapeClick,A));ac.on(f,o.bind(A._onShapeMouseEnter,A));ac.on(p,o.bind(A._onShapeMouseLeave,A));},_onShapeClick:function(ae){var A=this;var ac=A.get(ab);var ad=A.get(E);if(ac){if(ae.hasModifier()){ac.closeEditProperties();}else{ac.unselectConnectors();if(ad){ac.closeEditProperties();}else{ac.editConnector(A);}}}A.set(E,!ad);},_onShapeMouseEnter:function(ad){var A=this;if(!A.get(E)){var ac=A.get(M);if(ac){A._updateShape(ac);}}},_onShapeMouseLeave:function(ac){var A=this;if(!A.get(E)){A._updateShape(A.get(z));}},_setShape:function(ac){var A=this;return o.merge({type:g,stroke:{color:A.get(H),weight:3},fill:{color:A.get(H)}},ac);},_updateShape:function(ae,ac){var A=this;var ad=A.shape;if(ae.hasOwnProperty(J)){ad.set(J,ae[J]);}if(ae.hasOwnProperty(h)){ad.set(h,ae[h]);}if(ac!==false){A.draw();}},_uiSetSelected:function(ad,ac){var A=this;A._updateShape(ad?A.get(q):A.get(z),ac);}},{ATTRS:{builder:{},color:{value:"#27aae1",validator:l},lazyDraw:{value:false,validator:F},name:{valueFn:function(){var A=this;return w+(++o.Env._uidx);},validator:l},graphic:{validator:P},shapeHover:{value:{fill:{color:"#666"},stroke:{color:"#666",weight:5}}},selected:{value:false,validator:F},shape:{value:null,setter:"_setShape"},shapeSelected:{value:{fill:{color:"#000"},stroke:{color:"#000",weight:5}}},sourceUID:{value:v,validator:l},targetUID:{value:v,validator:l},arrowPoints:{value:o.PolygonUtil.ARROW_POINTS},p1:{value:[0,0],validator:B},p2:{value:[0,0],validator:B}}});},"@VERSION@",{requires:["aui-base","arraylist-add","arraylist-filter","json","graphics","dd"],skinnable:true});AUI.add("aui-diagram-builder",function(a){},"@VERSION@",{use:["aui-diagram-builder-base","aui-diagram-builder-impl"],skinnable:true});