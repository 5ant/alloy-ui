AUI.add("aui-diagram-builder-base",function(ai){var X=ai.Lang,d=X.isArray,ax=X.isBoolean,O=X.isNumber,F=X.isObject,aB=X.isString,M=function(A){return(A instanceof ai.ArrayList);},V=function(A){return(A instanceof ai.Node);},H=function(A){return(A instanceof ai.AvailableField);},aK=ai.Array,Y="add",o="addNode",aJ="auto",P="availableField",T="availableFields",aG="availableFieldsDragConfig",v="boundingBox",aD="builder",ac="cancel",af="canvas",az="clearfix",f="column",a="container",ag="content",y="contentBox",e="contentContainer",S="contentNode",I="createDocumentFragment",D="diagram",ao="diagram-builder",ad="disk",r="draggable",aF="drop",ar="dropConfig",ab="dropContainer",aw="field",w="fields",q="fieldsContainer",av="height",s="helper",aa="icon",z="iconClass",aq="id",am="label",x="layout",ap="list",R="maxFields",u="node",g="parentNode",ah="propertyList",aE="rendered",at="save",t="settings",Q="tab",K="tabView",b="tabs",h="tabview",N="toolbar",m="toolbarContainer",C=ai.getClassName,aI=" ",i=".",j="#",aI=" ",E="_",n=C(f),B=C(D,aD,af),aj=C(D,aD,ag,a),G=C(D,aD,aF,a),ay=C(D,aD,aw),l=C(D,aD,aw,r),c=C(D,aD,aw,aa),ae=C(D,aD,aw,am),Z=C(D,aD,w,a),ak=C(D,aD,Q,Y),L=C(D,aD,Q,t),au=C(D,aD,b),U=C(D,aD,b,ag),an=C(D,aD,N,a),al=C(s,az),p=C(aa),J=C(x),aC=C(h,ag),aH=C(h,ap);var k=ai.Component.create({NAME:P,ATTRS:{draggable:{value:true,validator:ax},label:{validator:aB},iconClass:{validator:aB},id:{value:ai.guid(),setter:"_setId",validator:aB},node:{valueFn:function(aL){var A=this;if(!V(aL)){aL=ai.Node.create(ai.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(z)}));aL.setData(P,A);}return aL;},validator:V,writeOnce:true},type:{value:u,validator:aB}},EXTENDS:ai.Base,buildNodeId:function(A){return T+E+aw+E+A;},getAvailableFieldById:function(A){return ai.AvailableField.getAvailableFieldByNode(j+ai.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){return ai.one(A).getData(P);},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+ay+'">'+'<span class="'+[p,c].join(aI)+' {iconClass}"></span>'+'<div class="'+ae+'"></div>'+"</li>",initializer:function(){var A=this;var aL=A.get(u);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aL.one(i+ae);A._uiSetDraggable(A.get(r));A._uiSetId(A.get(aq));A._uiSetLabel(A.get(am));},_afterDraggableChange:function(aL){var A=this;A._uiSetDraggable(aL.newVal);},_afterIdChange:function(aL){var A=this;A._uiSetId(aL.newVal);},_afterLabelChange:function(aL){var A=this;A._uiSetLabel(aL.newVal);},_setId:function(A){return ai.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aL){var A=this;A.get(u).toggleClass(l,aL);},_uiSetId:function(aL){var A=this;A.get(u).set(aq,aL);},_uiSetLabel:function(aL){var A=this;A.labelNode.setContent(aL);}}});ai.AvailableField=k;var W=function(){};W.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||M(A);}},maxFields:{value:Infinity,validator:O}};ai.mix(W.prototype,{_setFields:function(aL){var A=this;if(M(aL)){return aL;}else{return A.createFields(aL);}},_updateFields:function(aL){var A=this;A.set(w,aL);},addField:function(aL){var A=this;if(A.get(w).size()<A.get(R)){var aM=A.createField(aL);if(aM){A._updateFields(A.get(w).add(aM));}return aM;}return null;},createFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){if(aN<aL.get(R)){A.push(aL.createField(aO));}});return new ai.ArrayList(A);},removeField:function(aL){var A=this;A._updateFields(A.get(w).remove(aL));},createField:function(A){return A;}});ai.FieldSupport=W;var aA=ai.Component.create({NAME:ao,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:F},canvas:{valueFn:function(){return ai.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:F},contentContainer:{valueFn:function(){return ai.Node.create(this.CONTENT_CONTAINER_TEMPLATE);}},dropContainer:{valueFn:function(){return ai.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return ai.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:F,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:F,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:F,value:null},toolbarContainer:{valueFn:function(){return ai.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{contentContainer:i+aj,dropContainer:i+G,fieldsContainer:i+Z,toolbarContainer:i+an,canvas:i+B},UI_ATTRS:[T,w],AUGMENTS:[ai.FieldSupport],prototype:{CONTENT_CONTAINER_TEMPLATE:'<div class="'+aj+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+G+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+an+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[Z,al].join(aI)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+B+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(af);A.contentContainer=A.get(e);A.dropContainer=A.get(ab);A.fieldsContainer=A.get(q);A.toolbarContainer=A.get(m);},isAvailableFieldsDrag:function(aM){var A=this;var aL=A.availableFieldsDrag;return(aM===aL.dd);},plotFields:function(){var aL=this;var A=aL.get(w);A.each(function(aM){aL.plotField(aM);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(T));},syncUI:function(){var A=this;var aL=A.get(y);A._setupDrop();A._setupAvailableFieldsDrag();aL.addClass(J);},_afterActiveTabChange:function(aM){var A=this;var aL=aM.newVal.get(S);if(A.get(aE)&&(aL===A.settingsNode)){A._renderSettings();}},_afterRender:function(aL){var A=this;A.plotFields();},_afterUiSetHeight:function(aL){var A=this;A.contentContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);
A.dropContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);},_defCancelFn:function(aL){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(ac);},_handleSaveEvent:function(){var A=this;A.fire(at);},_renderCanvas:function(){var A=this;var aL=A.get(y);var aM=A.canvas;var aN=A.contentContainer;var aO=A.dropContainer;if(!aM.inDoc()){aN.appendChild(aM);}if(!aO.inDoc()){aM.appendChild(aO);}if(aN.inDoc()){aN.get(g).append(aN);}else{aL.appendChild(aN);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ai.PropertyList(A.get(ah)).render(A.settingsNode);A.propertyList.get(v).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aL=new ai.TabView(A.get(K));aL.get(v);A.tabView=aL;A.fieldsNode=aL.getTab(0).get(S);A.settingsNode=aL.getTab(1).get(S);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ai.Toolbar(A.get(N)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ai.DD.Drop(A.get(ar));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ai.DD.Delegate(A.get(aG));},_setAvailableFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){A.push(H(aO)?aO:new ai.AvailableField(aO));});return A;},_setDropConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,groups:[T],node:A.dropContainer},aL||{});},_setAvailableFieldsDragConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,container:A.get(v),dragConfig:{groups:[T],plugins:[{cfg:{moveOnEnd:false},fn:ai.Plugin.DDProxy}]},nodes:i+l},aL||{});},_setPropertyList:function(aL){var A=this;return ai.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aJ}},aL);},_setTabView:function(aO){var aL=this;var aN=aL.get(v);var aP=aN.one(i+aH);var aM={after:{activeTabChange:ai.bind(aL._afterActiveTabChange,aL)},boundingBox:aN.one(i+au),contentBox:aN.one(i+U),bubbleTargets:aL,contentNode:aN.one(i+aC),cssClass:au,listNode:aP,render:aL.get(y)};if(!aP){var A=aL.getStrings();aM.items=[{cssClass:ak,label:A[o]},{cssClass:L,label:A[t]}];}return ai.merge(aM,aO);},_setToolbar:function(aM){var aL=this;var A=aL.getStrings();return ai.merge({activeState:false,bubbleTargets:aL,children:[{handler:ai.bind(aL._handleSaveEvent,aL),label:A[at],icon:ad},{handler:ai.bind(aL._handleCancelEvent,aL),label:A[ac]}]},aM);},_uiSetAvailableFields:function(aN){var A=this;var aM=A.fieldsNode;if(aM){var aL=ai.getDoc().invoke(I);aK.each(aN,function(aO){aL.appendChild(aO.get(u));});aM.setContent(A.fieldsContainer.setContent(aL));}},_uiSetFields:function(aL){var A=this;if(A.get(aE)){A.plotFields();}}}});ai.DiagramBuilderBase=aA;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});AUI.add("aui-diagram-builder-impl",function(au){var ag=au.Lang,c=ag.isArray,I=ag.isObject,aV=ag.isString,aR=ag.isBoolean,a4=au.Array,Z=function(A){return(A instanceof au.DiagramBuilderBase);},aS=function(A){return(A instanceof au.DiagramNode);},ao=function(A){return(A instanceof au.Anchor);},az=function(A,a7){var a6=c(a7)?a7:a7.getXY();var a8=c(A)?A:A.getXY();return a4.map(a8,function(ba,a9){return Math.max(0,ba-a6[a9]);});},ae="activeElement",ax="addAnchor",aY="addAnchorMessage",j="addNode",aB="anchor",av="anchors",an="anchorsDragConfig",U="availableField",ac="boolean",p="boundingBox",a0="builder",ak="cancel",al="canvas",aJ="click",aW="closeEvent",F="closeMessage",aZ="condition",aq="content",O="controls",aH="controlsToolbar",aG="data",am="dblclick",Y="delete",aE="deleteConnectorsMessage",n="deleteNodesMessage",aN="description",G="diagram",ap="diagram-builder",aA="diagramNode",B="diagram-node",aO="dragNode",C="editEvent",L="editMessage",Q="editing",aM="end",a="esc",aQ="field",r="fields",ay="fieldsDragConfig",at="fork",aa="graphic",aP="height",q="hover",aI="id",t="join",S="keydown",ar="link",ai="max",V="maxFields",v="maxSources",s="mouseenter",ad="mouseleave",m="name",o="node",aD="p1",aC="p2",d="parentNode",l="pencil",aj="records",k="recordset",h="region",a1="rendered",K="required",aU="selected",J="shuffle",R="source",aT="sources",aF="start",ab="state",i="target",M="targets",D="task",P="tmpConnector",e="type",N="width",aX="wrapper",y="xy",x="zIndex",a3="-",g=".",T="",f="#",H="_",w=au.getClassName,W=w(G,a0,aB,o,ai,M),aw=w(G,a0,aB,q),aL=w(G,a0,aB,o),E=w(G,a0,aB,o,aX),u=w(G,a0,O),af=w(G,o),b=w(G,o,aq),aK=w(G,o,Q),a2=w(G,o,aU);var ah=function(){var a6="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",A="<br/>";au.all(".aui-diagram-node").each(function(bc){var a7=T,a9=au.Widget.getByNode(bc),a8=a9.get("name"),bb=a9.get("boundingBox"),ba=bb.one(".log")||au.Node.create("<div class=log />").appendTo(bb);a7+=a8+A;a9.get(r).each(function(bd){a7+=a6+"a: "+bd.get("id")+A;bd.get("targets").each(function(be){var bf=be.get(aA);be.get("node").setContent(be.get("id"));a7+=a6+a6+"t: "+bf.get("name")+" (s: "+be.get("id")+")"+A;});bd.get("sources").each(function(bf){var be=bf.get(aA);bf.get("node").setContent(bf.get("id"));a7+=a6+a6+"s: "+be.get("name")+" (t: "+bf.get("id")+")"+A;});});ba.setContent(a7);});};var z=au.Component.create({NAME:ap,ATTRS:{fieldsDragConfig:{value:null,setter:"_setFieldsDragConfig",validator:I},graphic:{valueFn:function(){return new au.Graphic();},validator:I},strings:{value:{addNode:"Add node",cancel:"Cancel",deleteConnectorsMessage:"Are you sure you want to delete the selected connector(s)?",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tmpConnector:{setter:"_setTmpConnector",value:{},validator:I}},EXTENDS:au.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{selectedConnector:null,selectedNode:null,initializer:function(){var A=this;A.on({cancel:A._onCancel,"drag:drag":A._onDrag,"drag:end":A._onDragEnd,"drop:hit":A._onDropHit,save:A._onSave});A.handlerKeyDown=au.getDoc().on(S,au.bind(A._afterKeyEvent,A));A.dropContainer.delegate(aJ,au.bind(A._onNodeClick,A),g+af);A.dropContainer.delegate(am,au.bind(A._onNodeEdit,A),g+af);
A.dropContainer.delegate(s,au.bind(A._onMouseenterAnchors,A),g+aL);A.dropContainer.delegate(ad,au.bind(A._onMouseleaveAnchors,A),g+aL);},renderUI:function(){var A=this;au.DiagramBuilder.superclass.renderUI.apply(this,arguments);A._renderGraphic();},syncUI:function(){var A=this;au.DiagramBuilder.superclass.syncUI.apply(this,arguments);A._setupFieldsDrag();A.tmpConnector=new au.Connector(A.get(P));},clearFields:function(){var a6=this;var A=[];a6.get(r).each(function(a7){A.push(a7);});a4.each(A,function(a7){a7.destroy();});A=null;},closeEditProperties:function(){var A=this;var a6=A.editingNode;A.tabView.selectTab(au.DiagramBuilder.FIELDS_TAB);if(a6){a6.get(p).removeClass(aK);}A.editingConnector=null;A.editingNode=null;},connect:function(a7,ba,a9){var a6=this;if(aV(a7)){a7=au.Widget.getByNode(f+au.DiagramNode.buildNodeId(a7));}if(aV(ba)){ba=au.Widget.getByNode(f+au.DiagramNode.buildNodeId(ba));}if(a7&&ba){var a8=a7.findAvailableAnchor();var A=ba.findAvailableAnchor();if(a8&&A){a8.connect(A,a9);}}return a6;},connectAll:function(a6){var A=this;a4.each(a6,function(a7){if(a7.hasOwnProperty(R)&&a7.hasOwnProperty(i)){A.connect(a7.source,a7.target,a7.connector);}});return A;},createField:function(a6){var A=this;if(!aS(a6)){a6.builder=A;a6=new (A.getFieldClass(a6.type||o))(a6);}a6.set(a0,A);return a6;},deleteConnectors:function(a6){var A=this;a4.each(a6,function(a7){var a8=a7.get(aB);if(a8){var a9=a8.findConnectorTarget(a7);if(a9){a8.disconnect(a9);}}});},eachConnetor:function(a7){var A=this;var a6=false;A.get(r).some(function(a8){a8.get(r).some(function(a9){au.some(a9.connectors,function(ba){a6=a7.call(A,ba,a9,a8);return a6;});return a6;});return a6;});},editConnector:function(a6){var A=this;if(a6){A.closeEditProperties();A.tabView.selectTab(au.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(k,a6.getProperties());A.editingConnector=A.selectedConnector=a6;}},editNode:function(a6){var A=this;if(a6){A.closeEditProperties();A.tabView.selectTab(au.DiagramBuilder.SETTINGS_TAB);A.propertyList.set(k,a6.getProperties());a6.get(p).addClass(aK);A.editingNode=A.selectedNode=a6;}},getSelectedConnectors:function(){var A=this;var a6=[];A.eachConnetor(function(a7){if(a7.get(aU)){a6.push(a7);}});return a6;},getFieldClass:function(a7){var A=this;var a6=au.DiagramBuilder.types[a7];if(a6){return a6;}else{au.log("The field type: ["+a7+"] couldn't be found.");return null;}},isFieldsDrag:function(a7){var A=this;var a6=A.fieldsDrag;return(a7===a6.dd);},plotField:function(a6){var A=this;if(!a6.get(a1)){a6.render(A.dropContainer);}},unselectConnectors:function(){var A=this;a4.each(A.getSelectedConnectors(),function(a6){a6.set(aU,false);});},unselectNodes:function(){var A=this;var a6=A.selectedNode;if(a6){a6.set(aU,false);}A.selectedNode=null;},select:function(a6){var A=this;A.unselectNodes();A.selectedNode=a6.set(aU,true).focus();},stopEditing:function(){var A=this;A.unselectConnectors();A.unselectNodes();A.closeEditProperties();},toJSON:function(){var A=this;var a6={nodes:[]};A.get(r).each(function(a8){var a9=a8.get(m);var a7={transitions:[]};a4.each(a8.SERIALIZABLE_ATTRS,function(ba){a7[ba]=a8.get(ba);});a8.get(r).each(function(ba){ba.get(M).each(function(bb){a7.transitions.push({connector:ba.getConnector(bb).toJSON(),source:a9,target:bb.get(aA).get(m)});});});a6.nodes.push(a7);});return a6;},_afterKeyEvent:function(a6){var A=this;if(a6.hasModifier()||au.getDoc().get(ae).test(":input,td")){return;}if(a6.isKey(a)){A._onEscKey(a6);}else{if(a6.isKey(Y)){A._onDeleteKey(a6);}}},_onCancel:function(a6){var A=this;A.closeEditProperties();},_onDrag:function(a7){var A=this;var a6=a7.target;if(A.isFieldsDrag(a6)){var a8=au.Widget.getByNode(a6.get(aO));a8.get(r).each(function(a9){a9.alignConnectors();});}},_onDragEnd:function(a7){var A=this;var a6=a7.target;if(A.isFieldsDrag(a6)){var a8=au.Widget.getByNode(a6.get(aO));a8.set(y,a8.getLeftTop());}},_onDropHit:function(a7){var A=this;var a6=a7.drag;if(A.isAvailableFieldsDrag(a6)){var a9=a6.get(o).getData(U);var a8=A.addField({xy:az(a6.lastXY,A.dropContainer),type:a9.get(e),fields:[{}]});A.select(a8);}},_onDeleteKey:function(a8){var a6=this;var A=a6.getStrings();var a7=a6.getSelectedConnectors();if(a7.length&&confirm(A[aE])){a6.deleteConnectors(a7);}var a9=a6.selectedNode;if(a9){if(!a9.get(K)){a9.close();}}a8.halt();},_onEscKey:function(a6){var A=this;A.stopEditing();a6.halt();},_onMouseenterAnchors:function(a6){var A=this;a6.currentTarget.addClass(aw);},_onMouseleaveAnchors:function(a6){var A=this;a6.currentTarget.removeClass(aw);},_onNodeClick:function(a6){var A=this;var a7=au.Widget.getByNode(a6.currentTarget);A.select(a7);},_onNodeEdit:function(a6){var A=this;if(!a6.target.ancestor(g+b,true)){return;}var a7=au.Widget.getByNode(a6.currentTarget);if(a7){A.editNode(a7);}},_onSave:function(a7){var A=this;var a6=A.editingNode;var a8=A.editingConnector;var a9=A.propertyList.get(k);if(a6){a4.each(a9.get(aj),function(ba){var bb=ba.get(aG);a6.set(bb.attributeName,bb.value);});}else{if(a8){a4.each(a9.get(aj),function(ba){var bb=ba.get(aG);a8.set(bb.attributeName,bb.value);});}}A.closeEditProperties();},_renderGraphic:function(){var A=this;A.get(aa).render(A.get(al));},_setTmpConnector:function(a7){var A=this;var a6=A.get(al).getXY();return au.merge({p1:a6,p2:a6,lazyDraw:true,graphic:A.get(aa)},a7);},_setFieldsDragConfig:function(a7){var A=this;var a6=A.dropContainer;return au.merge({bubbleTargets:A,container:a6,dragConfig:{plugins:[{cfg:{constrain:a6},fn:au.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:au.Plugin.DDWinScroll}]},nodes:g+af},a7||{});},_setupFieldsDrag:function(){var A=this;A.fieldsDrag=new au.DD.Delegate(A.get(ay));}}});au.DiagramBuilder=z;au.DiagramBuilder.types={};var X=au.Component.create({NAME:B,EXTENDS:au.Overlay,AUGMENTS:[au.FieldSupport]});var a5=au.Component.create({NAME:B,UI_ATTRS:[r,m,K,aU],ATTRS:{anchorsDragConfig:{value:null,setter:"_setAnchorsDragConfig",validator:I},builder:{validator:Z},required:{value:false,validator:aR},description:{value:T,validator:aV},height:{value:60},name:{valueFn:function(){var A=this;
return A.get(e)+(++au.Env._uidx);},validator:aV},selected:{value:false,validator:aR},strings:{value:{addAnchorMessage:"Add Anchor",closeMessage:"Close",deleteNodesMessage:"Are you sure you want to delete the selected node(s)?",description:"Description",editMessage:"Edit",name:"Name",type:"Type"}},type:{value:o,validator:aV},controlsToolbar:{validator:I,valueFn:"_valueControlsToolbar"},width:{value:60},zIndex:{value:100},tabIndex:{value:1}},EXTENDS:X,buildNodeId:function(A){return aA+H+aQ+H+A;},prototype:{ANCHOR_WRAPPER_TEMPLATE:'<div class="'+E+'"></div>',CONTROLS_TEMPLATE:'<div class="'+u+'"></div>',SERIALIZABLE_ATTRS:[aN,m,K,e,N,aP,x,y,V],initializer:function(){var A=this;A._renderNodes();A._setupAnchorsDrag();A.after({render:A._afterRender});A.on({"drag:drag":A._onAnchorDrag,"drag:end":A._onAnchorDragEnd,"drag:start":A._onAnchorDragStart,"drop:hit":A._onAnchorDropHit});A.get(p).addClass(af+a3+A.get(e));},destructor:function(){var A=this;A.get(r).each(function(a6){a6.destroy();});A.get(a0).removeField(A);},alignAnchors:function(){var a6=this;var ba=a6.get(r);var a8=a6.get(p).get(h),a9=Math.floor(360/ba.size()),a7=a8.width/2,A=a8.height/2,bc=a8.left+a8.width/2,bb=a8.top+a8.height/2;ba.each(function(bg,bf){var be=bg.get(o);var bh=be.get(h);var bd=a6._getEllipseXY(a7,A,bc,bb,bf*a9);be.setXY([bd[0]-bh.width/2,bd[1]-bh.height/2]);bg.alignConnectors();});return a6;},close:function(){var a6=this;var A=a6.getStrings();if(confirm(A[n])){a6.destroy();}return a6;},createField:function(a7){var A=this;if(!ao(a7)){var a6=A.get(a0);a7.diagramNode=A;a7=new au.Anchor(a7);}return a7;},findAvailableAnchor:function(){var A=this;var a6=null;A.get(r).some(function(a7){if(!a7.hasConnection()){a6=a7;return true;}});if(!a6){a6=A.addField({});}return a6;},getConnectionNode:function(){var A=this;return new au.DiagramNode({xy:[100,100]});},getLeftTop:function(){var A=this;return az(A.get(p),A._getContainer());},getProperties:function(){var A=this;var a6=A.getPropertyModel();a4.each(a6,function(a9){var a8=A.get(a9.attributeName),a7=ag.type(a8);if(a7===ac){a8=String(a8);}a9.value=a8;});return a6;},getPropertyModel:function(){var a6=this;var A=a6.getStrings();return[{attributeName:aN,editor:new au.TextAreaCellEditor(),name:A[aN]},{attributeName:m,editor:new au.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[m]},{attributeName:e,editor:false,name:A[e]}];},syncDragTargets:function(){var A=this;A.anchorsDrag.syncTargets();},syncDropTargets:function(a6){var A=this;A.get(r).each(function(a8){var a7=au.DD.DDM.getDrop(a8.get(o));if(a7){if(a8.get(aT).size()===a8.get(v)){a7.removeFromGroup(av);}else{a7.addToGroup(av);}}});},_afterRender:function(a6){var A=this;A.alignAnchors();A._renderControls();},_getContainer:function(){var A=this;return(A.get(a0).dropContainer||A.get(p).get(d));},_getEllipseXY:function(a6,A,a9,a8,ba){var a7=ba*Math.PI/180;return[a9+a6*Math.cos(a7),a8-A*Math.sin(a7)];},_handleAddAnchorEvent:function(a6){var A=this;A.addField({});},_handleAddNodeEvent:function(a7){var A=this;var a6=A.get(a0);var a8=A.findAvailableAnchor();if(a8){var a9=A.getConnectionNode();a6.addField(a9);a8.connect(a9.addField({}));}},_handleEditEvent:function(a6){var A=this;A.get(a0).editNode(A);},_handleCloseEvent:function(a6){var A=this;if(!A.get(K)){A.close();}},_onAnchorDrag:function(a7){var A=this;var a6=A.get(a0);a6.tmpConnector.set(aC,a7.target.get(aO).getCenterXY());},_onAnchorDragEnd:function(a7){var A=this;var a6=A.get(a0).tmpConnector.shape;a6.clear();a6.end();},_onAnchorDragStart:function(a7){var A=this;var a6=A.get(a0);a6.tmpConnector.set(aD,a7.target.get(o).getCenterXY());},_onAnchorDropHit:function(a6){var A=this;var a7=au.Anchor.getAnchorByNode(a6.drag.get(o));var a8=au.Anchor.getAnchorByNode(a6.drop.get(o));a7.connect(a8);},_renderControls:function(){var A=this;var a6=A.get(p);A.controlsNode=au.Node.create(A.CONTROLS_TEMPLATE).appendTo(a6);},_renderNodes:function(){var A=this;var a6=A.get(p);A.anchorWrapper=au.Node.create(A.ANCHOR_WRAPPER_TEMPLATE).appendTo(a6);},_renderControlsToolbar:function(a6){var A=this;A.controlsToolbar=new au.Toolbar(A.get(aH)).render(A.controlsNode);A._uiSetRequired(A.get(K));},_setAnchorsDragConfig:function(a7){var A=this;var a6=A.get(a0);return au.merge({bubbleTargets:A,container:A.anchorWrapper,dragConfig:{groups:[av],plugins:[{cfg:{constrain:(a6?a6.get(al):null)},fn:au.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:au.Plugin.DDWinScroll},{cfg:{moveOnEnd:false},fn:au.Plugin.DDProxy}]},nodes:g+aL,target:true},a7||{});},_setupAnchorsDrag:function(){var A=this;A.anchorsDrag=new au.DD.Delegate(A.get(an));A.anchorsDrag.dd.addInvalid(g+W);},_uiSetFields:function(a6){var A=this;if(A.get(a1)){A.alignAnchors();A.syncDragTargets();A.syncDropTargets();}},_uiSetName:function(a7){var A=this;var a6=A.get(p);a6.set(aI,au.DiagramNode.buildNodeId(a7));},_uiSetRequired:function(a8){var a7=this;var a6=a7.getStrings();var A=a7.controlsToolbar;if(A){if(a8){A.remove(aW);}else{A.add({handler:au.bind(a7._handleCloseEvent,a7),icon:ak,id:aW,title:a6[F]});}}},_uiSetSelected:function(a6){var A=this;A.get(p).toggleClass(a2,a6);if(a6&&!A.controlsToolbar){A._renderControlsToolbar();}},_uiSetXY:function(a7){var A=this;var a6=A._getContainer().getXY();this._posNode.setXY([a7[0]+a6[0],a7[1]+a6[1]]);},_valueControlsToolbar:function(a7){var a6=this;var A=a6.getStrings();return{activeState:false,children:[{handler:au.bind(a6._handleEditEvent,a6),icon:l,id:C,title:A[L]},{handler:au.bind(a6._handleAddAnchorEvent,a6),icon:ar,id:ax,title:A[aY]},{handler:au.bind(a6._handleAddNodeEvent,a6),icon:J,id:j},{handler:au.bind(a6._handleCloseEvent,a6),icon:ak,id:aW,title:A[F]}]};}}});au.DiagramNode=a5;au.DiagramBuilder.types[o]=au.DiagramNode;au.DiagramNodeState=au.Component.create({NAME:B,ATTRS:{height:{value:40},type:{value:ab},width:{value:40}},EXTENDS:au.DiagramNode,});au.DiagramBuilder.types[ab]=au.DiagramNodeState;au.DiagramNodeCondition=au.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:aZ},width:{value:60}},EXTENDS:au.DiagramNodeState,});
au.DiagramBuilder.types[aZ]=au.DiagramNodeCondition;au.DiagramNodeStart=au.Component.create({NAME:B,ATTRS:{type:{value:aF}},EXTENDS:au.DiagramNodeState,});au.DiagramBuilder.types[aF]=au.DiagramNodeStart;au.DiagramNodeEnd=au.Component.create({NAME:B,ATTRS:{type:{value:aM}},EXTENDS:au.DiagramNodeState,});au.DiagramBuilder.types[aM]=au.DiagramNodeEnd;au.DiagramNodeJoin=au.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:t},width:{value:60}},EXTENDS:au.DiagramNodeState,});au.DiagramBuilder.types[t]=au.DiagramNodeJoin;au.DiagramNodeFork=au.Component.create({NAME:B,ATTRS:{height:{value:60},type:{value:at},width:{value:60}},EXTENDS:au.DiagramNodeState,});au.DiagramBuilder.types[at]=au.DiagramNodeFork;au.DiagramNodeTask=au.Component.create({NAME:B,ATTRS:{height:{value:70},type:{value:D},width:{value:70}},EXTENDS:au.DiagramNodeState,});au.DiagramBuilder.types[D]=au.DiagramNodeTask;},"@VERSION@",{requires:["aui-diagram-builder-base","overlay"],skinnable:true});AUI.add("aui-diagram-builder-connector",function(p){var aa=p.Lang,C=aa.isArray,G=aa.isBoolean,Z=aa.isNumber,O=aa.isObject,m=aa.isString,u=p.Array,d=function(A){return(A instanceof p.Anchor);},R=function(A){return(A instanceof p.ArrayList);},v=function(A){return(A instanceof p.DiagramNode);},Q=function(A){return(A instanceof p.Graphic);},M="anchor",S="arrowPoints",T="boundingBox",ab="builder",P="click",I="color",x="connector",a="dataAnchor",b="description",L="diagram",D="diagramNode",K="fill",J="graphic",z="id",V="lazyDraw",W="max",o="maxSources",n="maxTargets",g="mouseenter",q="mouseleave",H="name",Y="node",t="p1",s="p2",h="path",F="selected",B="shape",N="shapeHover",r="shapeSelected",l="sources",i="stroke",j="targets",X="wrapper",y=".",w="",k="#",E=p.getClassName,c=E(L,ab,M,Y,W,j),f=E(L,ab,M,Y,W,l),e=E(L,ab,M,Y,X),U=E(L,ab,M,Y);p.PolygonUtil={ARROW_POINTS:[[-12,-6],[-8,0],[-12,6],[6,0]],drawLineArrow:function(ah,ac,aj,A,ai,af){var ak=this;ah.moveTo(ac,aj);ah.lineTo(A,ai);var ad=Math.atan2(ai-aj,A-ac),ag=(A+ac)/2,ae=(ai+aj)/2;A=A-15*Math.cos(ad);ai=ai-15*Math.sin(ad);ak.drawPolygon(ah,ak.translatePoints(ak.rotatePoints(af||ak.ARROW_POINTS,ad),A,ai));},drawPolygon:function(ac,ad){var A=this;ac.moveTo(ad[0][0],ad[0][1]);u.each(ad,function(af,ae){if(ae>0){ac.lineTo(ad[ae][0],ad[ae][1]);}});ac.lineTo(ad[0][0],ad[0][1]);},translatePoints:function(ad,ac,af){var A=this;var ae=[];u.each(ad,function(ah,ag){ae.push([ad[ag][0]+ac,ad[ag][1]+af]);});return ae;},rotatePoints:function(ac,ae){var A=this;var ad=[];u.each(ac,function(ag,af){ad.push(A.rotatePoint(ae,ac[af][0],ac[af][1]));});return ad;},rotatePoint:function(ac,A,ad){return[(A*Math.cos(ac))-(ad*Math.sin(ac)),(A*Math.sin(ac))+(ad*Math.cos(ac))];}};p.Connector=p.Base.create("line",p.Base,[],{SERIALIZABLE_ATTRS:[I,b,V,H,r,N,t,s],shape:null,initializer:function(ad){var A=this;var ac=A.get(V);A.after({p1Change:A.draw,p2Change:A.draw,selectedChange:A._afterSelectedChange});A._initShapes();if(!ac){A.draw();}A._uiSetSelected(A.get(F),!ac);},destroy:function(){var A=this;A.get(J).removeShape(A.shape);},draw:function(){var A=this;var ac=A.shape;var ae=A.getCoordinate(A.get(t));var ad=A.getCoordinate(A.get(s));ac.clear();p.PolygonUtil.drawLineArrow(ac,ae[0],ae[1],ad[0],ad[1],A.get(S));ac.end();},getCoordinate:function(ad){var A=this;var ac=A.get(J).getXY();return[ad[0]-ac[0],ad[1]-ac[1]];},getProperties:function(){var A=this;var ac=A.getPropertyModel();u.each(ac,function(ad){ad.value=A.get(ad.attributeName);});return ac;},getPropertyModel:function(){var ac=this;var ad=ac.get(M);var A=ad?ad.get(D).getStrings():{};return[{attributeName:b,editor:new p.TextAreaCellEditor(),name:A[b]},{attributeName:H,editor:new p.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[H]}];},toJSON:function(){var A=this;var ac={};u.each(A.SERIALIZABLE_ATTRS,function(ad){ac[ad]=A.get(ad);});return ac;},_afterSelectedChange:function(ac){var A=this;A._uiSetSelected(ac.newVal);},_initShapes:function(){var A=this;var ac=A.shape=A.get(J).addShape(A.get(B));ac.on(P,p.bind(A._onShapeClick,A));ac.on(g,p.bind(A._onShapeMouseEnter,A));ac.on(q,p.bind(A._onShapeMouseLeave,A));},_onShapeClick:function(af){var A=this;var ad=A.get(M);var ae=A.get(F);if(ad){var ac=ad.getBuilder();if(af.hasModifier()){ac.closeEditProperties();}else{ac.unselectConnectors();if(ae){ac.closeEditProperties();}else{ac.editConnector(A);}}}A.set(F,!ae);},_onShapeMouseEnter:function(ac){var A=this;if(!A.get(F)){A._updateShape(A.get(N));}},_onShapeMouseLeave:function(ac){var A=this;if(!A.get(F)){A._updateShape(A.get(B));}},_setShape:function(ac){var A=this;return p.merge({type:h,stroke:{color:A.get(I),weight:3},fill:{color:A.get(I)}},ac);},_updateShape:function(ae,ac){var A=this;var ad=A.shape;if(ae.hasOwnProperty(K)){ad.set(K,ae[K]);}if(ae.hasOwnProperty(i)){ad.set(i,ae[i]);}if(ac!==false){A.draw();}},_uiSetSelected:function(ad,ac){var A=this;A._updateShape(ad?A.get(r):A.get(B),ac);}},{ATTRS:{anchor:{},color:{value:"#27aae1",validator:m},description:{value:w,validator:m},lazyDraw:{value:false,validator:G},name:{valueFn:function(){var A=this;return x+(++p.Env._uidx);},validator:m},graphic:{validator:Q},shapeHover:{value:{fill:{color:"#666"},stroke:{color:"#666",weight:5}}},selected:{value:false,validator:G},shape:{value:null,setter:"_setShape"},shapeSelected:{value:{fill:{color:"#000"},stroke:{color:"#000",weight:5}}},arrowPoints:{value:p.PolygonUtil.ARROW_POINTS},p1:{value:[0,0],validator:C},p2:{value:[0,0],validator:C}}});p.Anchor=p.Base.create("anchor",p.Base,[],{ANCHOR_WRAPPER_TEMPLATE:'<div class="'+e+'"></div>',NODE_TEMPLATE:'<div class="'+U+'"></div>',connectors:null,initializer:function(){var A=this;A.connectors={};A._renderNode();A.connectTargets();A.after({sourcesChange:A._afterSourcesChange,targetsChange:A._afterTargetsChange});A._uiSetMaxTargets(A.get(n));},addSource:function(ac){var A=this;if(A.get(l).size()<A.get(o)){A.set(l,A.get(l).remove(ac).add(ac));}return A;},addTarget:function(ac){var A=this;if(A.get(j).size()<A.get(n)){A.set(j,A.get(j).remove(ac).add(ac));
}return A;},alignConnectors:function(){var A=this;A.get(j).each(function(ac){var ad=A.getConnector(ac);if(ad){ad.set(t,A.getCenterXY());ad.set(s,ac.getCenterXY());}});A.get(l).each(function(ac){var ad=ac.getConnector(A);if(ad){ad.set(t,ac.getCenterXY());ad.set(s,A.getCenterXY());}});return A;},destroy:function(){var A=this;A.disconnectTargets();A.disconnectSources();A.get(Y).remove();},connect:function(ad,ac){var A=this;if(v(ad)){ad=ad.findAvailableAnchor();}A.addTarget(ad);ad.addSource(A);if(!A.isConnected(ad)){var ae=p.merge(ad.get(x),ac);ae.anchor=A;ae.p1=A.getCenterXY();ae.p2=ad.getCenterXY();A.connectors[ad.get(z)]=new p.Connector(ae);}setTimeout(function(){ad.get(D).syncDropTargets();},50);return A;},connectTargets:function(){var A=this;A.get(j).each(p.bind(A.connect,A));return A;},disconnect:function(ac){var A=this;A.getConnector(ac).destroy();A.removeTarget(ac);ac.removeSource(A);setTimeout(function(){ac.get(D).syncDropTargets();},50);},disconnectTargets:function(){var A=this;A.get(j).each(function(ac){A.disconnect(ac);});return A;},disconnectSources:function(){var A=this;A.get(l).each(function(ac){ac.disconnect(A);});return A;},findConnectorTarget:function(ac){var A=this;var ad=null;p.some(A.connectors,function(af,ae){if(af===ac){ad=p.Anchor.getAnchorByNode(k+ae);return true;}});return ad;},getBuilder:function(){var A=this;return A.get(D).get(ab);},getCenterXY:function(){var A=this;return A.get(Y).getCenterXY();},getConnector:function(ac){var A=this;return A.connectors[ac.get(z)];},hasConnection:function(){var A=this;return((A.get(j).size()>0)||(A.get(l).size()>0));},isConnected:function(ac){var A=this;return A.connectors.hasOwnProperty(ac.get(z));},removeSource:function(ac){var A=this;A.set(l,A.get(l).remove(ac));return A;},removeTarget:function(ac){var A=this;A.set(j,A.get(j).remove(ac));delete A.connectors[ac.get(z)];return A;},_afterSourcesChange:function(ac){var A=this;A._uiSetSources(ac.newVal);},_afterTargetsChange:function(ac){var A=this;ac.prevVal.each(function(ad){ad.removeSource(A);});ac.newVal.each(function(ad){ad.addSource(A);});A._uiSetTargets(ac.newVal);},_renderNode:function(){var A=this;var ad=A.get(D);var ac=ad.get(T);A.wrapper=ac.one(y+e)||p.Node.create(A.ANCHOR_WRAPPER_TEMPLATE);A.wrapper.appendTo(ac).appendChild(A.get(Y));},_setConnector:function(ac){var A=this;return p.merge({graphic:A.getBuilder().get(J)},ac);},_setSources:function(ac){var A=this;return A._setAnchors(ac);},_setTargets:function(ac){var A=this;ac=A._setAnchors(ac,true);ac.each(function(ad){ad.addSource(A);});return ac;},_setAnchors:function(ae,ad){var A=this;if(!R(ae)){var ac=[];p.Array.some(ae,function(ag,af){if(af>=A.get(ag?n:o)){return true;}ac.push(d(ag)?ag:new p.Anchor(ag));});ae=new p.ArrayList(ac);}return ae;},_setMaxSources:function(ac){var A=this;A._uiSetMaxSources(A.get(o));return ac;},_setMaxTargets:function(ac){var A=this;A._uiSetMaxTargets(A.get(n));return ac;},_setNode:function(ac){var A=this;var ad=A.get(z);return p.one(ac).set(z,ad).setData(a,A);},_uiSetSources:function(ac){var A=this;A._uiSetMaxSources(A.get(o));},_uiSetMaxSources:function(ad){var A=this;var ac=A.get(Y);ac.toggleClass(f,(A.get(l).size()===ad));},_uiSetMaxTargets:function(ad){var A=this;var ac=A.get(Y);ac.toggleClass(c,(A.get(j).size()===ad));},_uiSetTargets:function(ac){var A=this;A._uiSetMaxTargets(A.get(n));}},{ATTRS:{diagramNode:{},connector:{setter:"_setConnector",value:{},validator:O},id:{readOnly:true,valueFn:function(){return p.guid();}},maxSources:{setter:"_setMaxSources",value:1,validator:Z},maxTargets:{setter:"_setMaxTargets",value:1,validator:Z},node:{setter:"_setNode",valueFn:function(){var A=this;return p.Node.create(A.NODE_TEMPLATE);}},sources:{value:[],setter:"_setSources",validator:function(A){return C(A)||R(A);}},targets:{value:[],setter:"_setTargets",validator:function(A){return C(A)||R(A);}}},getAnchorByNode:function(A){return d(A)?A:p.one(A).getData(a);}});},"@VERSION@",{requires:["aui-base","arraylist-add","arraylist-filter","json","graphics","dd"],skinnable:true});AUI.add("aui-diagram-builder",function(a){},"@VERSION@",{use:["aui-diagram-builder-base","aui-diagram-builder-impl","aui-diagram-builder-connector"],skinnable:true});