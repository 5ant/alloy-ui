AUI.add("aui-diagram-builder-connector",function(o){var aa=o.Lang,B=aa.isArray,F=aa.isBoolean,Z=aa.isNumber,N=aa.isObject,l=aa.isString,t=o.Array,c=function(A){return(A instanceof o.Anchor);},Q=function(A){return(A instanceof o.ArrayList);},u=function(A){return(A instanceof o.DiagramNode);},P=function(A){return(A instanceof o.Graphic);},L="anchor",R="arrowPoints",S="boundingBox",ab="builder",O="click",H="color",w="connector",a="dataAnchor",K="diagram",C="diagramNode",J="fill",I="graphic",y="id",U="lazyDraw",V="max",n="maxSources",m="maxTargets",f="mouseenter",p="mouseleave",G="name",X="node",s="p1",Y="visible",r="p2",g="path",E="selected",z="shape",M="shapeHover",q="shapeSelected",k="sources",h="stroke",i="targets",W="wrapper",x=".",v="",j="#",D=o.getClassName,b=D(K,ab,L,X,V,i),e=D(K,ab,L,X,V,k),d=D(K,ab,L,X,W),T=D(K,ab,L,X);o.PolygonUtil={ARROW_POINTS:[[-12,-6],[-8,0],[-12,6],[6,0]],drawLineArrow:function(ad,ae,ag,ac,af,ah){var A=this;ad.moveTo(ae,ag);ad.lineTo(ac,af);var ai=Math.atan2(af-ag,ac-ae);ac=ac-5*Math.cos(ai);af=af-5*Math.sin(ai);A.drawPolygon(ad,A.translatePoints(A.rotatePoints(ah||A.ARROW_POINTS,ai),ac,af));},drawPolygon:function(ac,ad){var A=this;ac.moveTo(ad[0][0],ad[0][1]);t.each(ad,function(af,ae){if(ae>0){ac.lineTo(ad[ae][0],ad[ae][1]);}});ac.lineTo(ad[0][0],ad[0][1]);},translatePoints:function(ad,ac,af){var A=this;var ae=[];t.each(ad,function(ah,ag){ae.push([ad[ag][0]+ac,ad[ag][1]+af]);});return ae;},rotatePoints:function(ac,ae){var A=this;var ad=[];t.each(ac,function(ag,af){ad.push(A.rotatePoint(ae,ac[af][0],ac[af][1]));});return ad;},rotatePoint:function(ac,A,ad){return[(A*Math.cos(ac))-(ad*Math.sin(ac)),(A*Math.sin(ac))+(ad*Math.cos(ac))];}};o.Connector=o.Base.create("line",o.Base,[],{SERIALIZABLE_ATTRS:[H,U,G,q,M,s,r],shape:null,initializer:function(ad){var A=this;var ac=A.get(U);A.after({p1Change:A.draw,p2Change:A.draw,selectedChange:A._afterSelectedChange});A._initShapes();if(!ac){A.draw();}A._uiSetSelected(A.get(E),!ac);},destroy:function(){var A=this;A.get(I).removeShape(A.shape);},draw:function(){var A=this;var ac=A.shape;var ae=A.getCoordinate(A.get(s));var ad=A.getCoordinate(A.get(r));ac.clear();o.PolygonUtil.drawLineArrow(ac,ae[0],ae[1],ad[0],ad[1],A.get(R));ac.end();return A;},getCoordinate:function(ad){var A=this;var ac=A.get(I).getXY();return[ad[0]-ac[0],ad[1]-ac[1]];},getProperties:function(){var A=this;var ac=A.getPropertyModel();t.each(ac,function(ad){ad.value=A.get(ad.attributeName);});return ac;},getPropertyModel:function(){var ac=this;var ad=ac.get(L);var A=ad?ad.get(C).getStrings():{};return[{attributeName:G,editor:new o.TextCellEditor({validator:{rules:{value:{required:true}}}}),name:A[G]}];},hide:function(){var A=this;A.shape.set(Y,false);return A;},show:function(){var A=this;A.shape.set(Y,true);return A;},toJSON:function(){var A=this;var ac={};t.each(A.SERIALIZABLE_ATTRS,function(ad){ac[ad]=A.get(ad);});return ac;},_afterSelectedChange:function(ac){var A=this;A._uiSetSelected(ac.newVal);},_initShapes:function(){var A=this;var ac=A.shape=A.get(I).addShape(A.get(z));ac.on(O,o.bind(A._onShapeClick,A));ac.on(f,o.bind(A._onShapeMouseEnter,A));ac.on(p,o.bind(A._onShapeMouseLeave,A));},_onShapeClick:function(ae){var A=this;var ac=A.get(ab);var ad=A.get(E);if(ac){if(ae.hasModifier()){ac.closeEditProperties();}else{ac.unselectConnectors();if(ad){ac.closeEditProperties();}else{ac.editConnector(A);}}}A.set(E,!ad);},_onShapeMouseEnter:function(ad){var A=this;if(!A.get(E)){var ac=A.get(M);if(ac){A._updateShape(ac);}}},_onShapeMouseLeave:function(ac){var A=this;if(!A.get(E)){A._updateShape(A.get(z));}},_setShape:function(ac){var A=this;return o.merge({type:g,stroke:{color:A.get(H),weight:3},fill:{color:A.get(H)}},ac);},_updateShape:function(ae,ac){var A=this;var ad=A.shape;if(ae.hasOwnProperty(J)){ad.set(J,ae[J]);}if(ae.hasOwnProperty(h)){ad.set(h,ae[h]);}if(ac!==false){A.draw();}},_uiSetSelected:function(ad,ac){var A=this;A._updateShape(ad?A.get(q):A.get(z),ac);}},{ATTRS:{builder:{},color:{value:"#27aae1",validator:l},lazyDraw:{value:false,validator:F},name:{valueFn:function(){var A=this;return w+(++o.Env._uidx);},validator:l},graphic:{validator:P},shapeHover:{value:{fill:{color:"#666"},stroke:{color:"#666",weight:5}}},selected:{value:false,validator:F},shape:{value:null,setter:"_setShape"},shapeSelected:{value:{fill:{color:"#000"},stroke:{color:"#000",weight:5}}},sourceUID:{value:v,validator:l},targetUID:{value:v,validator:l},arrowPoints:{value:o.PolygonUtil.ARROW_POINTS},p1:{value:[0,0],validator:B},p2:{value:[0,0],validator:B}}});},"@VERSION@",{requires:["aui-base","arraylist-add","arraylist-filter","json","graphics","dd"],skinnable:true});