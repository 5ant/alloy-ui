AUI.add("aui-autocomplete",function(M){var s=M.Lang,R=s.isArray,J=s.isString,h=s.isNull,r=M.ClassNameManager.getClassName,b="bindUI",d="content",j="helper",k="hidden",p="item",e="list",a="autocomplete",X="renderUI",l="reset",n="results",V="selected",C=r(a,V),m=r(j,k),G=r(a,e,p),i=r(j,l),B=r(a,n),Q=r(a,n,d),O=8,f=9,Y=13,K=16,D=17,E=18,N=20,Z=27,I=33,L=35,U=36,g=38,T=40,S=39,P=37,c=44,q=44,F=229,o="boundingBox",W="contentBox";var H=function(){var A=this;A.on(X,A._renderUIAutoCompleteView,A);A.on(b,A._bindUIAutoCompleteView,A);};H.ATTRS={alwaysShowContainer:{value:false},applyLocalFilter:{value:null},autoHighlight:{value:true},maxResultsDisplayed:{value:10}};H.prototype={_renderUIAutoCompleteView:function(){var A=this;A._renderOverlay();},_bindUIAutoCompleteView:function(){var A=this;var t=A.overlay.get(o);t.on("click",A._onContainerClick,A);t.on("mouseout",A._onContainerMouseout,A);t.on("mouseover",A._onContainerMouseover,A);t.on("scroll",A._onContainerScroll,A);A.on("textboxBlur",A._onTextboxBlurView,A);A.on("textboxKeyDown",A._onTextboxKeyDownView,A);A.on("textboxKeyPress",A._onTextboxKeyPressView,A);A.on("textboxKeyUp",A._onTextboxKeyUpView,A);A.on("handleResponse",A._populateView,A);A.on("invalidQueryLength",A._onInvalidQueryLengthView,A);A.on("sendQueryDisabled",A._onSendQueryDisabledView,A);A.overlay.after("visibleChange",A._realignContainer,A);A._queryTask=new M.DelayedTask(A.sendQuery,A);if(A.get("dataSourceType")=="dataSourceLocal"){A.set("applyLocalFilter",true);}},doBeforeExpandContainer:function(){return true;},filterResults:function(A){var AE=this;var AH=A.callback;var AC=A.request;var x=A.response;if(AH&&AH.argument&&AH.argument.query){AC=AH.argument.query;}if(AC){var y=x.results;var AD=[];var u=false;var AG=AE.get("matchKey");var v=AE.get("queryMatchCase");var AB=AE.get("queryMatchContains");var w=(AC=="*");var AA=AE.get("schema.resultFields");for(var z=y.length-1;z>=0;z--){var AI=y[z];var AF=null;if(J(AI)){AF=AI;}else{if(R(AI)){AF=AI[0];}else{if(AA){AF=AI[AG||AA[0]];}}}if(J(AF)){var t=-1;if(v){t=AF.indexOf(decodeURIComponent(AC));}else{t=AF.toLowerCase().indexOf(decodeURIComponent(AC).toLowerCase());}if((w)||(!AB&&(t===0))||(AB&&(t>-1))){AD.unshift(AI);}}}x.results=AD;}return x;},sendQuery:function(t){var A=this;A.set("focused",null);var u=t;if(A.get("delimChar")){t=A.inputNode.get("value")+t;}A._sendQuery(u);},_jumpSelection:function(){var A=this;if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}},_moveSelection:function(AF){var AC=this;if(AC.overlay.get("visible")){var AG=AC._elCurListItem;var t=-1;if(AG){t=Number(AG.getAttribute("data-listItemIndex"));}var u=t-1;if(AF==T){u=t+1;}if(u==-1){u=AC._displayedItems-1;}if(u>=AC._displayedItems){u=0;}if(u<-2){return;}if(AG){AC._toggleHighlight(AG,"from");AC.fire("itemArrowFrom",AG);}if(u==-1){if(AC.get("delimChar")){AC.inputNode.set("value",AC._pastSelections+AC._currentQuery);}else{AC.inputNode.set("value",AC._currentQuery);}return;}if(u==-2){AC._toggleContainer(false);return;}var y=AC.resultList.get("childNodes").item(u);var w=AC.overlay.get(W);var AA=w.getStyle("overflow");var AD=w.getStyle("overflowY");var v=(AA=="auto")||(AA=="scroll")||(AD=="auto")||(AD=="scroll");if(v&&(u>-1)&&(u<AC._displayedItems)){var A=-1;var AH=y.get("offsetTop");var x=AH+y.get("offsetHeight");var AB=w.get("offsetHeight");var z=w.get("scrollTop");var AE=AB+z;if(AF==T){if(x>AE){A=(x-AB);}else{if(x<z){A=AH;}}}else{if(AH<AB){A=AH;}else{if(AH>AE){A=(x-AB);}}}if(A>-1){w.set("scrollTop",A);}}AC._toggleHighlight(y,"to");AC.fire("itemArrowTo",y);if(AC.get("typeAhead")){AC._updateValue(y);}}},_onContainerClick:function(u){var A=this;var v=u.target;var t=v.get("nodeName").toLowerCase();u.halt();while(v&&(t!="table")){switch(t){case"body":return;case"li":A._toggleHighlight(v,"to");A._selectItem(v);return;default:break;}v=v.get("parentNode");if(v){t=v.get("nodeName").toLowerCase();}}},_onContainerMouseout:function(u){var A=this;var v=u.target;var t=v.get("nodeName").toLowerCase();while(v&&(t!="table")){switch(t){case"body":return;case"li":A._toggleHighlight(v,"from");A.fire("itemMouseOut",v);break;case"ul":A._toggleHighlight(A._elCurListItem,"to");break;case"div":if(v.hasClass(B)){A._overContainer=false;return;}break;default:break;}v=v.get("parentNode");if(v){t=v.get("nodeName").toLowerCase();}}},_onContainerMouseover:function(u){var A=this;var v=u.target;var t=v.get("nodeName").toLowerCase();while(v&&(t!="table")){switch(t){case"body":return;case"li":A._toggleHighlight(v,"to");A.fire("itemMouseOut",v);break;case"div":if(v.hasClass(B)){A._overContainer=true;return;}break;default:break;}v=v.get("parentNode");if(v){t=v.get("nodeName").toLowerCase();}}},_onContainerScroll:function(t){var A=this;A._focus();},_onInvalidQueryLengthView:function(){var A=this;A._queryTask.cancel();A._toggleContainer(false);},_onSendQueryDisabledView:function(){var A=this;A._toggleContainer(false);},_onTextboxBlurView:function(){var A=this;if(!A._itemSelected){var u=A._textMatchesOption();var t=A.overlay.get("visible");if(!t||(t&&h(u))){if(A.get("forceSelection")){A._clearSelection();}else{A.fire("unmatchedItemSelect",A._currentQuery);}}else{if(A.get("forceSelection")){A._selectItem(u);}}}A._clearInterval();A.blur();if(A._initInputValue!==A.inputNode.get("value")){A.fire("textboxChange");}A._toggleContainer(false);},_onTextboxKeyDownView:function(t){var A=this;var u=t.keyCode;switch(u){case f:if(A._elCurListItem){if(A.get("delimChar")&&A._keyCode!=u){if(A.overlay.get("visible")){t.halt();}}A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}break;case Y:if(A._elCurListItem){if(A._keyCode!=u){if(A.overlay.get("visible")){t.halt();}}A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}break;case Z:A._toggleContainer(false);return;case g:if(A.overlay.get("visible")){t.halt();A._moveSelection(u);}break;case S:A._jumpSelection();break;case T:if(A.overlay.get("visible")){t.halt();A._moveSelection(u);}break;default:A._itemSelected=false;
A._toggleHighlight(A._elCurListItem,"from");A.fire("textboxKey",u);break;}},_onTextboxKeyPressView:function(t){var A=this;var u=t.keyCode;switch(u){case f:if(A.overlay.get("visible")){if(A.get("delimChar")){t.halt();}if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}}break;case 13:if(A.overlay.get("visible")){t.halt();if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}}break;default:break;}},_onTextboxKeyUpView:function(u){var A=this;var t=A.inputNode;var v=t.get("value");A._queryTask.delay(A.get("queryDelay"),null,null,[v]);},_populateView:function(A){var AE=this;if(AE._typeAheadDelayId!=-1){clearTimeout(AE._typeAheadDelayId);}var z=A.request;var w=A.response;var AH=A.callback;var v=(z=="*");if(AH&&AH.argument&&AH.argument.query){A.request=z=AH.argument.query;}var y=AE._filterResultsHandle;if(AE.get("applyLocalFilter")){AE.filterResults(A);}var AC=AE.doBeforeLoadData(A);if(AC&&!A.error){AE.fire("dataReturn",A);var AB=AE.get("focused");if(v||AB||AB===null){var AA=decodeURIComponent(z);AE._currentQuery=AA;AE._itemSelected=false;var u=A.response.results;var AG=Math.min(u.length,AE.get("maxResultsDisplayed"));var x=AE.get("schema.resultFields");var AF=AE.get("matchKey");if(!AF&&x){AF=x[0];}else{AF=AF||0;}if(AG>0){var AD=AE.resultList.get("childNodes");AD.each(function(AM,AL,AK){if(AL<AG){var AJ=u[AL];var AI="";if(J(AJ)){AI=AJ;}else{if(R(AJ)){AI=AJ[0];}else{AI=AJ[AF];}}AM._resultMatch=AI;AM._resultData=AJ;AM.html(AE.formatResult(AJ,AA,AI));AM.removeClass(m);}else{AM.addClass(m);}});AE._displayedItems=AG;AE.fire("containerPopulate",z,u);if(z!="*"&&AE.get("autoHighlight")){var t=AE.resultList.get("firstChild");AE._toggleHighlight(t,"to");AE.fire("itemArrowTo",t);AE._typeAhead(t,z);}else{AE._toggleHighlight(AE._elCurListItem,"from");}AC=AE.doBeforeExpandContainer(z,u);AE._toggleContainer(AC);}else{AE._toggleContainer(false);}return;}}else{AE.fire("dataError",z);}},_realignContainer:function(t){var A=this;var u=A._overlayAlign;if(t.newVal){A.overlay._uiSetAlign(u.node,u.points);}},_renderListElements:function(){var A=this;var v=A.get("maxResultsDisplayed");var t=A.resultList;var u=[];while(v--){u[v]='<li class="'+m+" "+G+'" data-listItemIndex="'+v+'"></li>';}t.html(u.join(""));},_renderOverlay:function(){var A=this;var v=A._overlayAlign;v.node=A.inputNode;var u=new M.OverlayBase({align:v,bodyContent:"<ul></ul>",visible:false,width:A.inputNode.get("offsetWidth")});var t=u.get(W);u.get(o).addClass(B);t.addClass(Q);u.render(document.body);u.addTarget(A);A.overlay=u;A.resultList=t.one("ul");A.resultList.addClass(i);A._renderListElements();},_selectItem:function(t){var A=this;A._itemSelected=true;A._updateValue(t);A._pastSelections=A.inputNode.get("value");A._clearInterval();A.fire("itemSelect",t,t._resultData);A._toggleContainer(false);},_textMatchesOption:function(){var A=this;var t=null;var x=A._displayedItems;var y=A.resultList.get("childNodes");for(var v=0;v<x.length;v++){var w=y.item(v);var u=(""+w._resultMatch).toLowerCase();if(u==A._currentQuery.toLowerCase()){t=w;break;}}return t;},_toggleContainer:function(t){var A=this;var u=A.overlay;if(A.get("alwaysShowContainer")&&u.get("visible")){return;}if(!t){A._toggleHighlight(A._elCurListItem,"from");A._displayedItems=0;A._currentQuery=null;}if(t){u.show();A.fire("containerExpand");}else{u.hide();A.fire("containerCollapse");}},_toggleHighlight:function(t,u){var A=this;if(t){if(A._elCurListItem){A._elCurListItem.removeClass(C);A._elCurListItem=null;}if(u=="to"){t.addClass(C);A._elCurListItem=t;}}},_updateValue:function(x){var t=this;if(!t.get("suppressInputUpdate")){var w=t.inputNode;var A=x._resultMatch;var v=t.get("delimChar");v=(v&&v[0])||v;var y="";if(v){y=t._pastSelections;y+=A+v;if(v!=" "){y+=" ";}}else{y=A;}w.set("value",y);if(w.get("type")=="textarea"){w.set("scrollTop",w.get("scrollHeight"));}var u=y.length;w.selectText(u,u);t._elCurListItem=x;}},_displayedItems:0,_elCurListItem:null,_itemSelected:false,_overContainer:false};M.AutoComplete=M.Base.build(a,M.Component,[M.DataSourceControl,M.InputTextControl,H]);},"@VERSION@",{requires:["aui-base","aui-datasource-control-base","aui-input-text-control","aui-overlay-base"],skinnable:true});