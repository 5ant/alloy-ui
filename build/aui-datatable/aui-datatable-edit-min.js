AUI.add("aui-datatable-edit",function(X){var P=X.Lang,aK=X.Array,c=P.isArray,at=P.isBoolean,an=P.isFunction,x=P.isObject,ax=P.isString,am=P.String,ak=X.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aD=function(A){return(A instanceof X.BaseCellEditor);},W=X.WidgetStdMod,p=X.getClassName,al="baseCellEditor",j="boundingBox",F="calendar",T="cancel",ap="cell",ab="celleditor",s="checkboxCellEditor",h="checked",ai="click",r="columnset",m="contentBox",af="data",E="datatable",B="dateCellEditor",V="disk",ao="dropDownCellEditor",N="editable",d="editor",u="editEvent",w="element",ae="elementName",aq="field",Z="hideOnSave",ah="id",aJ="initToolbar",Y="initValidator",b="inputFormatter",aI="key",aa="label",J="lazySyncUI",L="mousedown",aG="mousemove",O="multiple",g="name",au="option",az="options",l="optionsCellEditor",aH="outputFormatter",S="radioCellEditor",R="records",f="recordset",aF="rendered",aj="save",av="selected",ad="selectedAttrName",M="showToolbar",ay="submit",G="textAreaCellEditor",o="textCellEditor",D="toolbar",q="unescapeValue",K="validator",aC="value",Q="visible",aA="wrapper",aM=",",H="",e="#",aE="\n",k=/<br\s*\/?>/gi,t=/[\r\n]/g,I=p(ab,w),aw=p(ab,aa),z=p(ab,au),n=p(ab,aA),v=p(E,N),ar="<br/>";var aB=function(){};aB.NAME="dataTableCellEditorSupport";aB.ATTRS={editEvent:{setter:"_setEditEvent",validator:ax,value:ai},lazySyncUI:{value:true}};X.mix(aB.prototype,{activeColumnIndex:-1,activeRecordIndex:-1,initializer:function(){var A=this;A.after({columnsetChange:A._afterColumnsetChangeEditor,recordsetChange:A._afterRecordsetChangeEditor,render:A._afterRenderEditor});A.on(A.get(u),A._onCellEdit);},lazySyncUI:function(){var A=this;A.syncEditableColumnsUI();},getActiveColumn:function(){var A=this;return A.get(r).getColumn(A.activeColumnIndex);},getActiveRecord:function(){var A=this;return A.get(f).getRecord(A.activeRecordIndex);},getCellEditor:function(aN,aP){var A=this;var aO=aP.get(d);var aQ=aN.get(af).editor;if(aO===false){return null;}return aD(aO)?aO:aQ;},getRecordColumnValue:function(A,aN){return A.getValue(aN.get(aq));},syncEditableColumnsUI:function(){var A=this;var aO=A.get(r);var aN=A.get(f);X.each(aO.idHash,function(aQ){var aP=aQ.get(d);if(aD(aP)){X.all("[headers="+aQ.get(ah)+"]").addClass(v);}});X.each(aN.get(R),function(aP){var aQ=aP.get(af).editor;if(aD(aQ)){X.all(e+aP.get("id")+">td").each(function(aT,aR){var aS=aO.getColumn(aR);if(aS.get(d)!==false){aT.addClass(v);}});}});},_afterRenderEditor:function(aN){var A=this;if(A.get(J)){A.get(j).once(aG,X.bind(A.lazySyncUI,A));}else{A.lazySyncUI();}if(!A.events){A.plug(X.Plugin.DataTableEvents);}},_afterColumnsetChangeEditor:function(aN){var A=this;A.syncEditableColumnsUI();},_afterRecordsetChangeEditor:function(aN){var A=this;A.syncEditableColumnsUI();},_editCell:function(aQ){var A=this;var aS=A.get(r);var aR=A.get(f);var aP=aQ.column;var aN=aQ.record;A.activeColumnIndex=aS.getColumnIndex(aP);A.activeRecordIndex=aR.getRecordIndex(aN);var aO=A.getCellEditor(aN,aP);if(aD(aO)){if(!aO.get(aF)){aO.on({visibleChange:X.bind(A._onEditorVisibleChange,A),save:X.bind(A._onEditorSave,A)});aO.render();}aO.set(aC,A.getRecordColumnValue(aN,aP));aO.show().move(aQ.cell.getXY());}},_onCellEdit:function(aN){var A=this;A._editCell(aN);},_onEditorVisibleChange:function(aP){var A=this;var aO=A.selection;if(aO){var aN=A.getCellNode(A.getActiveRecord(),A.getActiveColumn());aO.select(aN);}},_onEditorSave:function(aO){var A=this;var aN=aO.currentTarget;var aP=A.get(f);aN.set(aC,aO.newVal);aP.updateRecordDataByKey(A.getActiveRecord(),A.getActiveColumn().get(aI),aO.newVal);A.set(f,aP);},_setEditEvent:function(A){return ap+ak(A);}});X.DataTable.CellEditorSupport=aB;X.DataTable.Base=X.Base.create("dataTable",X.DataTable.Base,[X.DataTable.CellEditorSupport]);var i=X.Component.create({NAME:al,ATTRS:{elementName:{value:aC,validator:ax},footerContent:{value:H},hideOnSave:{value:true,validator:at},inputFormatter:{value:function(A){if(ax(A)){A=A.replace(t,ar);}return A;}},outputFormatter:{value:function(aN){var A=this;if(ax(aN)){if(A.get(q)){aN=am.unescapeEntities(aN);}aN=aN.replace(k,aE);}return aN;}},showToolbar:{value:true,validator:at},strings:{value:{save:"Save",cancel:"Cancel"}},tabIndex:{value:1},toolbar:{setter:"_setToolbar",validator:x,value:null},unescapeValue:{value:true,validator:at},validator:{setter:"_setValidator",validator:x,value:null},value:{value:H},visible:{value:false}},EXTENDS:X.Overlay,UI_ATTRS:[M,aC],prototype:{CONTENT_TEMPLATE:"<form></form>",ELEMENT_TEMPLATE:null,elements:null,validator:null,_hDocMouseDownEv:null,initializer:function(aN){var A=this;A._initEvents();},destructor:function(){var aN=this;var A=aN._hDocMouseDownEv;var aP=aN.toolbar;var aO=aN.validator;if(A){A.detach();}if(aP){aP.destroy();}if(aO){aO.destroy();}},bindUI:function(){var A=this;A.get(j).on(aI,X.bind(A._onEscKey,A),"down:27");},formatValue:function(aN,aO){var A=this;if(an(aN)){aO=aN.call(A,aO);}return aO;},getValue:function(){var A=this;return A.formatValue(A.get(b),A.getElementsValue());},_initEvents:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn},initValidator:{defaultFn:A._defInitValidatorFn,fireOnce:true},initToolbar:{defaultFn:A._defInitToolbarFn,fireOnce:true},save:{defaultFn:A._defSaveFn}});A.after({render:A._afterRender,visibleChange:X.debounce(A._debounceVisibleChange,350,A)});A.on({"form-validator:submit":X.bind(A._onSubmit,A)});},_afterRender:function(){var A=this;A._handleInitValidatorEvent();A._handleInitToolbarEvent();},_defCancelFn:function(aN){var A=this;A.hide();},_defInitValidatorFn:function(aN){var A=this;A.validator=new X.FormValidator(A.get(K));},_defInitToolbarFn:function(aN){var A=this;A.toolbar=new X.Toolbar(A.get(D)).render(A.footerNode);},_defSaveFn:function(aN){var A=this;if(A.get(Z)){A.hide();}},_debounceVisibleChange:function(aO){var aN=this;var A=aN._hDocMouseDownEv;if(aO.newVal){if(!A){aN._hDocMouseDownEv=X.getDoc().on(L,X.bind(aN._onDocMouseDownExt,aN));}}else{if(A){A.detach();aN._hDocMouseDownEv=null;
}}},_handleCancelEvent:function(){var A=this;A.fire(T);},_handleInitValidatorEvent:function(){var A=this;if(A.get(aF)){this.fire(Y);}},_handleInitToolbarEvent:function(){var A=this;if(A.get(aF)&&A.get(M)){this.fire(aJ);}},_handleSaveEvent:function(){var A=this;if(!A.validator.hasErrors()){A.fire(aj,{newVal:A.getValue(),prevVal:A.get(aC)});}},_onDocMouseDownExt:function(aO){var A=this;var aN=A.get(j);A.set(Q,aN.contains(aO.target));},_onEscKey:function(aN){var A=this;A.hide();},_onSubmit:function(aO){var A=this;var aN=aO.validator;A._handleSaveEvent();if(aN){aN.formEvent.halt();}},_setToolbar:function(aO){var aN=this;var A=aN.getStrings();return X.merge({activeState:false,children:[{label:A[aj],icon:V,type:ay},{handler:X.bind(aN._handleCancelEvent,aN),label:A[T]}]},aO);},_setValidator:function(aN){var A=this;return X.merge({boundingBox:A.get(m),bubbleTargets:A},aN);},_uiSetShowToolbar:function(aO){var A=this;var aN=A.footerNode;if(aO){aN.show();}else{aN.hide();}A._handleInitToolbarEvent();},getElementsValue:function(){var A=this;var aN=A.elements;if(aN){return aN.get(aC);}return H;},renderUI:function(){var A=this;if(A.ELEMENT_TEMPLATE){A.elements=X.Node.create(A.ELEMENT_TEMPLATE);A._syncElementsName();A.setStdModContent(W.BODY,A.elements);}},_syncElementsName:function(){var A=this;A.elements.setAttribute(g,A.get(ae));},_uiSetValue:function(aO){var A=this;var aN=A.elements;if(aN){aN.val(A.formatValue(A.get(aH),aO));X.later(100,aN,aN.selectText);}}}});X.BaseCellEditor=i;var aL=X.Component.create({NAME:l,ATTRS:{inputFormatter:{value:null},options:{setter:"_setOptions",value:{},validator:x},outputFormatter:{value:null},selectedAttrName:{value:av,validator:ax}},EXTENDS:X.BaseCellEditor,UI_ATTRS:[az],prototype:{options:null,_createOptions:function(aO){var aS=this;var A=aS.elements;var aQ=[];var aN=[];var aP=aS.OPTION_TEMPLATE;var aT=aS.OPTION_WRAPPER;X.each(aO,function(aX,aW){var aV={id:X.guid(),label:aX,name:aW,value:aW};if(aP){aQ.push(X.substitute(aP,aV));}if(aT){aN.push(X.substitute(aT,aV));}});var aU=X.NodeList.create(aQ.join(H));var aR=X.NodeList.create(aN.join(H));if(aR.size()){aR.each(function(aW,aV){aW.prepend(aU.item(aV));});A.setContent(aR);}else{A.setContent(aU);}aS.options=aU;},_getSelectedOptions:function(){var A=this;var aN=[];A.options.each(function(aO){if(aO.get(A.get(ad))){aN.push(aO);}});return X.all(aN);},_setOptions:function(aN){var A={};if(c(aN)){aK.each(aN,function(aO){A[aO]=aO;});}else{if(x(aN)){A=aN;}}return A;},_uiSetOptions:function(aN){var A=this;A._createOptions(aN);A._syncElementsName();},_uiSetValue:function(aO){var A=this;var aN=A.options;if(aN&&aN.size()){aN.set(A.get(ad),false);aK.each(aK(aO),function(aP){aN.filter('[value="'+aP+'"]').set(A.get(ad),true);});}return aO;}}});X.BaseOptionsCellEditor=aL;var ac=X.Component.create({NAME:o,EXTENDS:X.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input class="'+I+'" type="text" />'}});X.TextCellEditor=ac;var ag=X.Component.create({NAME:G,EXTENDS:X.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<textarea class="'+I+'"></textarea>'}});X.TextAreaCellEditor=ag;var C=X.Component.create({NAME:ao,ATTRS:{multiple:{value:false,validator:at}},EXTENDS:X.BaseOptionsCellEditor,UI_ATTRS:[O],prototype:{ELEMENT_TEMPLATE:'<select class="'+I+'"></select>',OPTION_TEMPLATE:'<option value="{value}">{label}</option>',getElementsValue:function(){var A=this;if(A.get(O)){return A._getSelectedOptions().get(aC);}return A.elements.get(aC);},_uiSetMultiple:function(aO){var A=this;var aN=A.elements;if(aO){aN.setAttribute(O,O);}else{aN.removeAttribute(O);}}}});X.DropDownCellEditor=C;var U=X.Component.create({NAME:s,ATTRS:{selectedAttrName:{value:h}},EXTENDS:X.BaseOptionsCellEditor,prototype:{ELEMENT_TEMPLATE:'<div class="'+I+'"></div>',OPTION_TEMPLATE:'<input class="'+z+'" id="{id}" name="{name}" type="checkbox" value="{value}"/>',OPTION_WRAPPER:'<label class="'+n+'" for="{id}"><span class="'+aw+'">{label}</span></label>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aC);}}});X.CheckboxCellEditor=U;var y=X.Component.create({NAME:S,EXTENDS:X.CheckboxCellEditor,prototype:{OPTION_TEMPLATE:'<input class="yui3-aui-field-input-choice" id="{id}" name="{name}" type="radio" value="{value}"/>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aC)[0];},_syncElementsName:function(){var A=this;var aN=A.options;if(aN){aN.setAttribute(g,A.get(ae));}}}});X.RadioCellEditor=y;var a=X.Component.create({NAME:B,EXTENDS:X.BaseCellEditor,ATTRS:{bodyContent:{value:H},calendar:{setter:"_setCalendar",validator:x,value:null}},prototype:{ELEMENT_TEMPLATE:'<input class="'+I+'" type="hidden" />',initializer:function(){var A=this;A.on("calendar:select",X.bind(A._onDateSelect,A));},getElementsValue:function(){var A=this;return A.calendar.getFormattedSelectedDates().join(aM);},_afterRender:function(){var A=this;X.DateCellEditor.superclass._afterRender.apply(A,arguments);A.calendar=new X.Calendar(A.get(F)).render(A.bodyNode);},_onDateSelect:function(aN){var A=this;A.elements.val(aN.date.formatted.join(aM));},_setCalendar:function(aN){var A=this;return X.merge({bubbleTargets:A},aN);},_uiSetValue:function(aO){var A=this;var aN=A.calendar;if(aN){if(aO&&ax(aO)){aO=aO.split(aM);}A.calendar.set("dates",aO);}}}});X.DateCellEditor=a;},"@VERSION@",{requires:["aui-calendar","aui-datatable-events","aui-toolbar","aui-form-validator","overlay"],skinnable:true});