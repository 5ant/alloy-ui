AUI.add("aui-datatable-edit",function(W){var O=W.Lang,aI=W.Array,c=O.isArray,ar=O.isBoolean,am=O.isFunction,x=O.isObject,aw=O.isString,al=O.String,aj=W.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aC=function(A){return(A instanceof W.BaseCellEditor);},V=W.WidgetStdMod,p=W.getClassName,ak="baseCellEditor",j="boundingBox",F="calendar",S="cancel",ao="cell",aa="celleditor",s="checkboxCellEditor",h="checked",ah="click",r="columnset",m="contentBox",ae="data",E="datatable",B="dateCellEditor",U="disk",an="dropDownCellEditor",M="editable",d="editor",u="editEvent",w="element",ad="elementName",ap="field",Y="hideOnSave",ag="id",aH="initToolbar",X="initValidator",b="inputFormatter",aG="key",Z="label",K="mousedown",N="multiple",g="name",at="option",ay="options",l="optionsCellEditor",aF="outputFormatter",R="radioCellEditor",Q="records",f="recordset",aD="rendered",ai="save",au="selected",ac="selectedAttrName",L="showToolbar",ax="submit",G="textAreaCellEditor",o="textCellEditor",D="toolbar",q="unescapeValue",J="validator",aB="value",P="visible",az="wrapper",aK=",",H="",e="#",aE="\n",k=/<br\s*\/?>/gi,t=/[\r\n]/g,I=p(aa,w),av=p(aa,Z),z=p(aa,at),n=p(aa,az),v=p(E,M),aq="<br/>";var aA=function(){};aA.NAME="dataTableCellEditorSupport";aA.ATTRS={editEvent:{setter:"_setEditEvent",validator:aw,value:ah}};W.mix(aA.prototype,{activeColumnIndex:-1,activeRecordIndex:-1,initializer:function(){var A=this;A.after({render:A._afterRenderEditor});A.on(A.get(u),A._onCellEdit);A.after(A._afterUiSetRecordset,A,"_uiSetRecordset");},getActiveColumn:function(){var A=this;return A.get(r).getColumn(A.activeColumnIndex);},getActiveRecord:function(){var A=this;return A.get(f).getRecord(A.activeRecordIndex);},getCellEditor:function(aL,aN){var A=this;var aM=aN.get(d);var aO=aL.get(ae).editor;if(aM===false){return null;}return aO||aM;},getRecordColumnValue:function(A,aL){return A.getValue(aL.get(ap));},syncEditableColumnsUI:function(){var A=this;var aM=A.get(r);var aL=A.get(f);W.each(aM.idHash,function(aO){var aN=aO.get(d);if(aC(aN)){W.all("[headers="+aO.get(ag)+"]").addClass(v);}});W.each(aL.get(Q),function(aN){var aO=aN.get(ae).editor;if(aC(aO)){W.all(e+aN.get("id")+">td").each(function(aR,aP){var aQ=aM.getColumn(aP);if(aQ.get(d)!==false){aR.addClass(v);}});}});},_afterUiSetRecordset:function(aL){var A=this;A.syncEditableColumnsUI();},_afterRenderEditor:function(aL){var A=this;if(!A.events){A.plug(W.Plugin.DataTableEvents);}},_editCell:function(aP){var A=this;var aR=A.get(r);var aQ=A.get(f);var aO=aP.column;var aL=aP.record;A.activeColumnIndex=aR.getColumnIndex(aO);A.activeRecordIndex=aQ.getRecordIndex(aL);var aM=aP.alignNode||aP.cell;var aN=A.getCellEditor(aL,aO);if(aC(aN)){if(!aN.get(aD)){aN.on({visibleChange:W.bind(A._onEditorVisibleChange,A),save:W.bind(A._onEditorSave,A)});aN.render();}aN.set(aB,A.getRecordColumnValue(aL,aO));aN.show().move(aM.getXY());}},_onCellEdit:function(aL){var A=this;A._editCell(aL);},_onEditorVisibleChange:function(aP){var aL=this;var aN=aL.selection;if(aN){var aM=aL.getActiveRecord();var aO=aL.getActiveColumn();var A=aL.getCellNode(aM,aO);var aQ=aL.getRowNode(aM);aN.select(A,aQ);}},_onEditorSave:function(aM){var A=this;var aL=aM.currentTarget;var aN=A.get(f);aL.set(aB,aM.newVal);aN.updateRecordDataByKey(A.getActiveRecord(),A.getActiveColumn().get(aG),aM.newVal);A.set(f,aN);},_setEditEvent:function(A){return ao+aj(A);}});W.DataTable.CellEditorSupport=aA;W.DataTable.Base=W.Base.create("dataTable",W.DataTable.Base,[W.DataTable.CellEditorSupport]);var i=W.Component.create({NAME:ak,ATTRS:{elementName:{value:aB,validator:aw},footerContent:{value:H},hideOnSave:{value:true,validator:ar},inputFormatter:{value:function(A){if(aw(A)){A=A.replace(t,aq);}return A;}},outputFormatter:{value:function(aL){var A=this;if(aw(aL)){if(A.get(q)){aL=al.unescapeEntities(aL);}aL=aL.replace(k,aE);}return aL;}},showToolbar:{value:true,validator:ar},strings:{value:{save:"Save",cancel:"Cancel"}},tabIndex:{value:1},toolbar:{setter:"_setToolbar",validator:x,value:null},unescapeValue:{value:true,validator:ar},validator:{setter:"_setValidator",validator:x,value:null},value:{value:H},visible:{value:false}},EXTENDS:W.Overlay,UI_ATTRS:[L,aB],prototype:{CONTENT_TEMPLATE:"<form></form>",ELEMENT_TEMPLATE:null,elements:null,validator:null,_hDocMouseDownEv:null,initializer:function(aL){var A=this;A._initEvents();},destructor:function(){var aL=this;var A=aL._hDocMouseDownEv;var aN=aL.toolbar;var aM=aL.validator;if(A){A.detach();}if(aN){aN.destroy();}if(aM){aM.destroy();}},bindUI:function(){var A=this;A.get(j).on(aG,W.bind(A._onEscKey,A),"down:27");},formatValue:function(aL,aM){var A=this;if(am(aL)){aM=aL.call(A,aM);}return aM;},getValue:function(){var A=this;return A.formatValue(A.get(b),A.getElementsValue());},_initEvents:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn},initValidator:{defaultFn:A._defInitValidatorFn,fireOnce:true},initToolbar:{defaultFn:A._defInitToolbarFn,fireOnce:true},save:{defaultFn:A._defSaveFn}});A.after({render:A._afterRender,visibleChange:W.debounce(A._debounceVisibleChange,350,A)});A.on({"form-validator:submit":W.bind(A._onSubmit,A)});},_afterRender:function(){var A=this;A._handleInitValidatorEvent();A._handleInitToolbarEvent();},_defCancelFn:function(aL){var A=this;A.hide();},_defInitValidatorFn:function(aL){var A=this;A.validator=new W.FormValidator(A.get(J));},_defInitToolbarFn:function(aL){var A=this;A.toolbar=new W.Toolbar(A.get(D)).render(A.footerNode);},_defSaveFn:function(aL){var A=this;if(A.get(Y)){A.hide();}},_debounceVisibleChange:function(aM){var aL=this;var A=aL._hDocMouseDownEv;if(aM.newVal){if(!A){aL._hDocMouseDownEv=W.getDoc().on(K,W.bind(aL._onDocMouseDownExt,aL));}}else{if(A){A.detach();aL._hDocMouseDownEv=null;}}},_handleCancelEvent:function(){var A=this;A.fire(S);},_handleInitValidatorEvent:function(){var A=this;if(A.get(aD)){this.fire(X);}},_handleInitToolbarEvent:function(){var A=this;if(A.get(aD)&&A.get(L)){this.fire(aH);}},_handleSaveEvent:function(){var A=this;
if(!A.validator.hasErrors()){A.fire(ai,{newVal:A.getValue(),prevVal:A.get(aB)});}},_onDocMouseDownExt:function(aM){var A=this;var aL=A.get(j);A.set(P,aL.contains(aM.target));},_onEscKey:function(aL){var A=this;A.hide();},_onSubmit:function(aM){var A=this;var aL=aM.validator;A._handleSaveEvent();if(aL){aL.formEvent.halt();}},_setToolbar:function(aM){var aL=this;var A=aL.getStrings();return W.merge({activeState:false,children:[{label:A[ai],icon:U,type:ax},{handler:W.bind(aL._handleCancelEvent,aL),label:A[S]}]},aM);},_setValidator:function(aL){var A=this;return W.merge({boundingBox:A.get(m),bubbleTargets:A},aL);},_uiSetShowToolbar:function(aM){var A=this;var aL=A.footerNode;if(aM){aL.show();}else{aL.hide();}A._handleInitToolbarEvent();},getElementsValue:function(){var A=this;var aL=A.elements;if(aL){return aL.get(aB);}return H;},renderUI:function(){var A=this;if(A.ELEMENT_TEMPLATE){A.elements=W.Node.create(A.ELEMENT_TEMPLATE);A._syncElementsName();A.setStdModContent(V.BODY,A.elements);}},_syncElementsName:function(){var A=this;A.elements.setAttribute(g,A.get(ad));},_uiSetValue:function(aM){var A=this;var aL=A.elements;if(aL){aL.val(A.formatValue(A.get(aF),aM));W.later(100,aL,aL.selectText);}}}});W.BaseCellEditor=i;var aJ=W.Component.create({NAME:l,ATTRS:{inputFormatter:{value:null},options:{setter:"_setOptions",value:{},validator:x},outputFormatter:{value:null},selectedAttrName:{value:au,validator:aw}},EXTENDS:W.BaseCellEditor,UI_ATTRS:[ay],prototype:{options:null,_createOptions:function(aM){var aQ=this;var A=aQ.elements;var aO=[];var aL=[];var aN=aQ.OPTION_TEMPLATE;var aR=aQ.OPTION_WRAPPER;W.each(aM,function(aV,aU){var aT={id:W.guid(),label:aV,name:aU,value:aU};if(aN){aO.push(W.substitute(aN,aT));}if(aR){aL.push(W.substitute(aR,aT));}});var aS=W.NodeList.create(aO.join(H));var aP=W.NodeList.create(aL.join(H));if(aP.size()){aP.each(function(aU,aT){aU.prepend(aS.item(aT));});A.setContent(aP);}else{A.setContent(aS);}aQ.options=aS;},_getSelectedOptions:function(){var A=this;var aL=[];A.options.each(function(aM){if(aM.get(A.get(ac))){aL.push(aM);}});return W.all(aL);},_setOptions:function(aL){var A={};if(c(aL)){aI.each(aL,function(aM){A[aM]=aM;});}else{if(x(aL)){A=aL;}}return A;},_uiSetOptions:function(aL){var A=this;A._createOptions(aL);A._syncElementsName();},_uiSetValue:function(aM){var A=this;var aL=A.options;if(aL&&aL.size()){aL.set(A.get(ac),false);aI.each(aI(aM),function(aN){aL.filter('[value="'+aN+'"]').set(A.get(ac),true);});}return aM;}}});W.BaseOptionsCellEditor=aJ;var ab=W.Component.create({NAME:o,EXTENDS:W.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input class="'+I+'" type="text" />'}});W.TextCellEditor=ab;var af=W.Component.create({NAME:G,EXTENDS:W.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<textarea class="'+I+'"></textarea>'}});W.TextAreaCellEditor=af;var C=W.Component.create({NAME:an,ATTRS:{multiple:{value:false,validator:ar}},EXTENDS:W.BaseOptionsCellEditor,UI_ATTRS:[N],prototype:{ELEMENT_TEMPLATE:'<select class="'+I+'"></select>',OPTION_TEMPLATE:'<option value="{value}">{label}</option>',getElementsValue:function(){var A=this;if(A.get(N)){return A._getSelectedOptions().get(aB);}return A.elements.get(aB);},_uiSetMultiple:function(aM){var A=this;var aL=A.elements;if(aM){aL.setAttribute(N,N);}else{aL.removeAttribute(N);}}}});W.DropDownCellEditor=C;var T=W.Component.create({NAME:s,ATTRS:{selectedAttrName:{value:h}},EXTENDS:W.BaseOptionsCellEditor,prototype:{ELEMENT_TEMPLATE:'<div class="'+I+'"></div>',OPTION_TEMPLATE:'<input class="'+z+'" id="{id}" name="{name}" type="checkbox" value="{value}"/>',OPTION_WRAPPER:'<label class="'+n+'" for="{id}"><span class="'+av+'">{label}</span></label>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aB);}}});W.CheckboxCellEditor=T;var y=W.Component.create({NAME:R,EXTENDS:W.CheckboxCellEditor,prototype:{OPTION_TEMPLATE:'<input class="yui3-aui-field-input-choice" id="{id}" name="{name}" type="radio" value="{value}"/>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aB)[0];},_syncElementsName:function(){var A=this;var aL=A.options;if(aL){aL.setAttribute(g,A.get(ad));}}}});W.RadioCellEditor=y;var a=W.Component.create({NAME:B,EXTENDS:W.BaseCellEditor,ATTRS:{bodyContent:{value:H},calendar:{setter:"_setCalendar",validator:x,value:null}},prototype:{ELEMENT_TEMPLATE:'<input class="'+I+'" type="hidden" />',initializer:function(){var A=this;A.on("calendar:select",W.bind(A._onDateSelect,A));},getElementsValue:function(){var A=this;return A.calendar.getFormattedSelectedDates().join(aK);},_afterRender:function(){var A=this;W.DateCellEditor.superclass._afterRender.apply(A,arguments);A.calendar=new W.Calendar(A.get(F)).render(A.bodyNode);},_onDateSelect:function(aL){var A=this;A.elements.val(aL.date.formatted.join(aK));},_setCalendar:function(aL){var A=this;return W.merge({bubbleTargets:A},aL);},_uiSetValue:function(aM){var A=this;var aL=A.calendar;if(aL){if(aM&&aw(aM)){aM=aM.split(aK);}A.calendar.set("dates",aM);}}}});W.DateCellEditor=a;},"@VERSION@",{requires:["aui-calendar","aui-datatable-events","aui-toolbar","aui-form-validator","overlay"],skinnable:true});