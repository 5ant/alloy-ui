AUI.add("aui-datatable-edit",function(ak){var Z=ak.Lang,a1=ak.Array,d=Z.isArray,aI=Z.isBoolean,aD=Z.isFunction,G=Z.isObject,aN=Z.isString,aC=Z.String,aA=ak.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aT=function(A){return(A instanceof ak.BaseCellEditor);},ai=ak.WidgetStdMod,y=ak.getClassName,ab="add",aB="baseCellEditor",q="boundingBox",O="calendar",af="cancel",aF="cell",ao="celleditor",B="checkboxCellEditor",m="checked",ax="click",z="columnset",u="contentBox",au="data",N="datatable",J="dateCellEditor",S="delete",p="deleteSelectedOptions",ah="disk",aE="dropDownCellEditor",K="edit",W="editable",e="editor",D="editEvent",F="element",at="elementName",aG="field",t="hide",am="hideOnSave",aw="id",l="initEdit",a0="initToolbar",al="initValidator",Y="input",c="inputFormatter",aZ="key",an="label",aj="link",U="mousedown",X="multiple",k="name",aK="option",aP="options",s="optionsCellEditor",aX="outputFormatter",j="pencil",ae="radioCellEditor",ad="records",i="recordset",aV="rendered",ac="return",az="save",aL="selected",ar="selectedAttrName",V="showToolbar",aO="submit",P="textAreaCellEditor",w="textCellEditor",M="toolbar",x="unescapeValue",T="validator",aS="value",aa="visible",aQ="wrapper",a3=",",h=".",Q="",g="#",aU="\n",aY=" ",r=/<br\s*\/?>/gi,C=/[\r\n]/g,b=y(ao,K),f=y(ao,K,ab,aK),aJ=y(ao,K,S,aK),aW=y(ao,K,t,aK),ap=y(ao,K,Y,k),ay=y(ao,K,Y,aS),n=y(ao,K,aj),R=y(ao,F),aM=y(ao,an),I=y(ao,aK),v=y(ao,aQ),E=y(N,W),aH="<br/>";var aR=function(){};aR.NAME="dataTableCellEditorSupport";aR.ATTRS={editEvent:{setter:"_setEditEvent",validator:aN,value:ax}};ak.mix(aR.prototype,{activeColumnIndex:-1,activeRecordIndex:-1,initializer:function(){var A=this;A.after({render:A._afterRenderEditor});A.on(A.get(D),A._onCellEdit);A.after(A._afterUiSetRecordset,A,"_uiSetRecordset");},getActiveColumn:function(){var A=this;return A.get(z).getColumn(A.activeColumnIndex);},getActiveRecord:function(){var A=this;return A.get(i).getRecord(A.activeRecordIndex);},getCellEditor:function(a4,a6){var A=this;var a5=a6.get(e);var a7=a4.get(au).editor;if(a5===false){return null;}return a7||a5;},getRecordColumnValue:function(A,a4){return A.getValue(a4.get(aG));},syncEditableColumnsUI:function(){var A=this;var a5=A.get(z);var a4=A.get(i);ak.each(a5.idHash,function(a7){var a6=a7.get(e);if(aT(a6)){ak.all("[headers="+a7.get(aw)+"]").addClass(E);}});ak.each(a4.get(ad),function(a6){var a7=a6.get(au).editor;if(aT(a7)){ak.all(g+a6.get("id")+">td").each(function(ba,a8){var a9=a5.getColumn(a8);if(a9.get(e)!==false){ba.addClass(E);}});}});},_afterUiSetRecordset:function(a4){var A=this;A.syncEditableColumnsUI();},_afterRenderEditor:function(a4){var A=this;if(!A.events){A.plug(ak.Plugin.DataTableEvents);}},_editCell:function(a8){var A=this;var ba=A.get(z);var a9=A.get(i);var a7=a8.column;var a4=a8.record;A.activeColumnIndex=ba.getColumnIndex(a7);A.activeRecordIndex=a9.getRecordIndex(a4);var a5=a8.alignNode||a8.cell;var a6=A.getCellEditor(a4,a7);if(aT(a6)){if(!a6.get(aV)){a6.on({visibleChange:ak.bind(A._onEditorVisibleChange,A),save:ak.bind(A._onEditorSave,A)});a6.render();}a6.set(aS,A.getRecordColumnValue(a4,a7));a6.show().move(a5.getXY());}},_onCellEdit:function(a4){var A=this;A._editCell(a4);},_onEditorVisibleChange:function(a8){var a4=this;var a6=a4.selection;if(a6){var a5=a4.getActiveRecord();var a7=a4.getActiveColumn();var A=a4.getCellNode(a5,a7);var a9=a4.getRowNode(a5);a6.select(A,a9);}},_onEditorSave:function(a5){var A=this;var a4=a5.currentTarget;var a6=A.get(i);a4.set(aS,a5.newVal);a6.updateRecordDataByKey(A.getActiveRecord(),A.getActiveColumn().get(aZ),a5.newVal);A.set(i,a6);},_setEditEvent:function(A){return aF+aA(A);}});ak.DataTable.CellEditorSupport=aR;ak.DataTable.Base=ak.Base.create("dataTable",ak.DataTable.Base,[ak.DataTable.CellEditorSupport]);var o=ak.Component.create({NAME:aB,ATTRS:{editable:{value:false,validator:aI},elementName:{value:aS,validator:aN},footerContent:{value:Q},hideOnSave:{value:true,validator:aI},inputFormatter:{value:function(A){if(aN(A)){A=A.replace(C,aH);}return A;}},outputFormatter:{value:function(a4){var A=this;if(aN(a4)){if(A.get(x)){a4=aC.unescapeEntities(a4);}a4=a4.replace(r,aU);}return a4;}},showToolbar:{value:true,validator:aI},strings:{value:{edit:"Edit",save:"Save",cancel:"Cancel"}},tabIndex:{value:1},toolbar:{setter:"_setToolbar",validator:G,value:null},unescapeValue:{value:true,validator:aI},validator:{setter:"_setValidator",validator:G,value:null},value:{value:Q},visible:{value:false}},EXTENDS:ak.Overlay,UI_ATTRS:[W,V,aS],prototype:{CONTENT_TEMPLATE:"<form></form>",ELEMENT_TEMPLATE:null,elements:null,validator:null,_hDocMouseDownEv:null,initializer:function(a4){var A=this;A._initEvents();},destructor:function(){var a4=this;var A=a4._hDocMouseDownEv;var a6=a4.toolbar;var a5=a4.validator;if(A){A.detach();}if(a6){a6.destroy();}if(a5){a5.destroy();}},bindUI:function(){var A=this;A.get(q).on(aZ,ak.bind(A._onEscKey,A),"down:27");},formatValue:function(a4,a5){var A=this;if(aD(a4)){a5=a4.call(A,a5);}return a5;},getValue:function(){var A=this;return A.formatValue(A.get(c),A.getElementsValue());},_initEvents:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn},initEdit:{defaultFn:A._defInitEditFn,fireOnce:true},initValidator:{defaultFn:A._defInitValidatorFn,fireOnce:true},initToolbar:{defaultFn:A._defInitToolbarFn,fireOnce:true},save:{defaultFn:A._defSaveFn}});A.after({render:A._afterRender,visibleChange:ak.debounce(A._debounceVisibleChange,350,A)});A.on({"form-validator:submit":ak.bind(A._onSubmit,A)});},_afterRender:function(){var A=this;A._handleInitValidatorEvent();A._handleInitToolbarEvent();},_defCancelFn:function(a4){var A=this;A.hide();},_defInitValidatorFn:function(a4){var A=this;A.validator=new ak.FormValidator(A.get(T));},_defInitToolbarFn:function(a5){var A=this;var a4=A.get(W);A.toolbar=new ak.Toolbar(A.get(M)).render(A.footerNode);if(a4){A._uiSetEditable(a4);}},_defSaveFn:function(a4){var A=this;if(A.get(am)){A.hide();}},_debounceVisibleChange:function(a5){var a4=this;
var A=a4._hDocMouseDownEv;if(a5.newVal){if(!A){a4._hDocMouseDownEv=ak.getDoc().on(U,ak.bind(a4._onDocMouseDownExt,a4));}}else{if(A){A.detach();a4._hDocMouseDownEv=null;}}},_handleCancelEvent:function(){var A=this;A.fire(af);},_handleEditEvent:function(){var A=this;A.fire(K);},_handleInitEditEvent:function(){var A=this;if(A.get(aV)){this.fire(l);}},_handleInitValidatorEvent:function(){var A=this;if(A.get(aV)){this.fire(al);}},_handleInitToolbarEvent:function(){var A=this;if(A.get(aV)&&A.get(V)){this.fire(a0);}},_handleSaveEvent:function(){var A=this;if(!A.validator.hasErrors()){A.fire(az,{newVal:A.getValue(),prevVal:A.get(aS)});}},_onDocMouseDownExt:function(a5){var A=this;var a4=A.get(q);A.set(aa,a4.contains(a5.target));},_onEscKey:function(a4){var A=this;A.hide();},_onSubmit:function(a5){var A=this;var a4=a5.validator;A._handleSaveEvent();if(a4){a4.formEvent.halt();}},_setToolbar:function(a5){var a4=this;var A=a4.getStrings();return ak.merge({activeState:false,children:[{label:A[az],icon:ah,type:aO},{handler:ak.bind(a4._handleCancelEvent,a4),label:A[af]}]},a5);},_setValidator:function(a4){var A=this;return ak.merge({boundingBox:A.get(u),bubbleTargets:A},a4);},_uiSetShowToolbar:function(a5){var A=this;var a4=A.footerNode;if(a5){a4.show();}else{a4.hide();}A._handleInitToolbarEvent();},getElementsValue:function(){var A=this;var a4=A.elements;if(a4){return a4.get(aS);}return Q;},renderUI:function(){var A=this;if(A.ELEMENT_TEMPLATE){A.elements=ak.Node.create(A.ELEMENT_TEMPLATE);A._syncElementsName();A.setStdModContent(ai.BODY,A.elements);}},_defInitEditFn:function(A){},_syncElementsName:function(){var A=this;A.elements.setAttribute(k,A.get(at));},_uiSetEditable:function(a5){var A=this;var a4=A.toolbar;if(A.get(aV)&&a4){if(a5){a4.add({handler:ak.bind(A._handleEditEvent,A),icon:j,label:A.getString(K)},1);}else{a4.remove(1);}}},_uiSetValue:function(a5){var A=this;var a4=A.elements;if(a4){a4.val(A.formatValue(A.get(aX),a5));ak.later(30,a4,a4.selectText);}}}});ak.BaseCellEditor=o;var a2=ak.Component.create({NAME:s,ATTRS:{inputFormatter:{value:null},options:{setter:"_setOptions",value:{},validator:G},outputFormatter:{value:null},selectedAttrName:{value:aL,validator:aN},strings:{value:{add:"Add",cancel:"Cancel",deleteSelectedOptions:"Delete selected option(s)?",edit:"Edit options",save:"Save",stopEditing:"Stop editing"}}},EXTENDS:ak.BaseCellEditor,UI_ATTRS:[aP],prototype:{EDIT_TEMPLATE:'<div class="'+b+'">'+'<a class="'+[n,aJ].join(aY)+'" href="javascript:void(0);">{deleteSelectedOptions}</a>'+'<input class="'+ap+'" size="7" placeholder="Name" title="Name" type="text" /> '+'<input class="'+ay+'" size="7" placeholder="Value" title="Value" type="text" /> '+'<a class="'+[n,f].join(aY)+'" href="javascript:void(0);">{add}</a> '+'<a class="'+[n,aW].join(aY)+'" href="javascript:void(0);">{stopEditing}</a>'+"</div>",editContainer:null,editInputName:null,editInputValue:null,options:null,initializer:function(){var A=this;A.on(K,A._onEditEvent);A.after(a0,A._afterInitToolbar);},addCurrentOption:function(){var A=this;var a4=A.get(aP);var a5=A.getCurrentOptionValue();if(a5){a4[a5.name]=a5.value;A.set(aP,a4);A._uiSetValue(A.get(aS));A.clearCurrentOption();}else{A.editInputValue.selectText();}},clearCurrentOption:function(){var A=this;if(A.editContainer){A.editInputValue.val(Q);A.editInputName.val(Q).selectText();}},deleteSelectedOptions:function(){var A=this;var a4=A.get(aP);A._getSelectedOptions().each(function(a5){var a6=a5.val();if(a4.hasOwnProperty(a6)){delete a4[a6];}});A.set(aP,a4);A._uiSetValue(A.get(aS));A.clearCurrentOption();},getCurrentOptionValue:function(){var A=this;if(A.editContainer){var a4=A.editInputName.val();var a5=A.editInputValue.val();if(a4&&a5){return{name:a4,value:a5};}}return null;},toggleEdit:function(){var A=this;A.editContainer.toggle();},_createOptions:function(a5){var a9=this;var A=a9.elements;var a7=[];var a4=[];var a6=a9.OPTION_TEMPLATE;var ba=a9.OPTION_WRAPPER;ak.each(a5,function(be,bd){var bc={id:ak.guid(),label:be,name:bd,value:bd};if(a6){a7.push(ak.substitute(a6,bc));}if(ba){a4.push(ak.substitute(ba,bc));}});var bb=ak.NodeList.create(a7.join(Q));var a8=ak.NodeList.create(a4.join(Q));if(a8.size()){a8.each(function(bd,bc){bd.prepend(bb.item(bc));});A.setContent(a8);}else{A.setContent(bb);}a9.options=bb;},_defInitEditFn:function(a4){var A=this;var a5=ak.Node.create(Z.sub(A.EDIT_TEMPLATE,A.getStrings()));A.setStdModContent(ai.BODY,a5.hide(),ai.AFTER);a5.delegate("click",ak.bind(A._onEditLinkClickEvent,A),h+n);a5.delegate("keydown",ak.bind(A._onEditKeyEvent,A),Y);A.editContainer=a5;A.editInputName=a5.one(h+ap);A.editInputValue=a5.one(h+ay);},_getSelectedOptions:function(){var A=this;var a4=[];A.options.each(function(a5){if(a5.get(A.get(ar))){a4.push(a5);}});return ak.all(a4);},_onEditEvent:function(a4){var A=this;A._handleInitEditEvent();A.toggleEdit();A.clearCurrentOption();},_onEditLinkClickEvent:function(a5){var A=this;var a6=a5.currentTarget;if(a6.test(h+f)){A.addCurrentOption();}else{if(a6.test(h+aW)){A.toggleEdit();}else{if(a6.test(h+aJ)){var a4=A.getString(p);if(confirm(a4)){A.deleteSelectedOptions();}}}}a5.halt();},_onEditKeyEvent:function(a4){var A=this;if(a4.isKey(ac)){A.addCurrentOption();a4.halt();}},_setOptions:function(a4){var A={};if(d(a4)){a1.each(a4,function(a5){A[a5]=a5;});}else{if(G(a4)){A=a4;}}return A;},_uiSetOptions:function(a4){var A=this;A._createOptions(a4);A._syncElementsName();},_uiSetValue:function(a5){var A=this;var a4=A.options;if(a4&&a4.size()){a4.set(A.get(ar),false);a1.each(a1(a5),function(a6){a4.filter('[value="'+a6+'"]').set(A.get(ar),true);});}return a5;}}});ak.BaseOptionsCellEditor=a2;var aq=ak.Component.create({NAME:w,EXTENDS:ak.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input class="'+R+'" type="text" />'}});ak.TextCellEditor=aq;var av=ak.Component.create({NAME:P,EXTENDS:ak.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<textarea class="'+R+'"></textarea>'}});ak.TextAreaCellEditor=av;var L=ak.Component.create({NAME:aE,ATTRS:{multiple:{value:false,validator:aI}},EXTENDS:ak.BaseOptionsCellEditor,UI_ATTRS:[X],prototype:{ELEMENT_TEMPLATE:'<select class="'+R+'"></select>',OPTION_TEMPLATE:'<option value="{value}">{label}</option>',getElementsValue:function(){var A=this;
if(A.get(X)){return A._getSelectedOptions().get(aS);}return A.elements.get(aS);},_uiSetMultiple:function(a5){var A=this;var a4=A.elements;if(a5){a4.setAttribute(X,X);}else{a4.removeAttribute(X);}}}});ak.DropDownCellEditor=L;var ag=ak.Component.create({NAME:B,ATTRS:{selectedAttrName:{value:m}},EXTENDS:ak.BaseOptionsCellEditor,prototype:{ELEMENT_TEMPLATE:'<div class="'+R+'"></div>',OPTION_TEMPLATE:'<input class="'+I+'" id="{id}" name="{name}" type="checkbox" value="{value}"/>',OPTION_WRAPPER:'<label class="'+v+'" for="{id}"><span class="'+aM+'">{label}</span></label>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aS);}}});ak.CheckboxCellEditor=ag;var H=ak.Component.create({NAME:ae,EXTENDS:ak.CheckboxCellEditor,prototype:{OPTION_TEMPLATE:'<input class="yui3-aui-field-input-choice" id="{id}" name="{name}" type="radio" value="{value}"/>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aS)[0];},_syncElementsName:function(){var A=this;var a4=A.options;if(a4){a4.setAttribute(k,A.get(at));}}}});ak.RadioCellEditor=H;var a=ak.Component.create({NAME:J,EXTENDS:ak.BaseCellEditor,ATTRS:{bodyContent:{value:Q},calendar:{setter:"_setCalendar",validator:G,value:null}},prototype:{ELEMENT_TEMPLATE:'<input class="'+R+'" type="hidden" />',initializer:function(){var A=this;A.on("calendar:select",ak.bind(A._onDateSelect,A));},getElementsValue:function(){var A=this;return A.calendar.getFormattedSelectedDates().join(a3);},_afterRender:function(){var A=this;ak.DateCellEditor.superclass._afterRender.apply(A,arguments);A.calendar=new ak.Calendar(A.get(O)).render(A.bodyNode);},_onDateSelect:function(a4){var A=this;A.elements.val(a4.date.formatted.join(a3));},_setCalendar:function(a4){var A=this;return ak.merge({bubbleTargets:A},a4);},_uiSetValue:function(a5){var A=this;var a4=A.calendar;if(a4){if(a5&&aN(a5)){a5=a5.split(a3);}A.calendar.set("dates",a5);}}}});ak.DateCellEditor=a;},"@VERSION@",{requires:["aui-calendar","aui-datatable-events","aui-toolbar","aui-form-validator","overlay"],skinnable:true});