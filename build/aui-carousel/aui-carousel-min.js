AUI.add("aui-carousel",function(n){var e=n.Lang,j="carousel",t=n.ClassNameManager.getClassName,k=t(j,"item"),d=t(j,"item","active"),s=t(j,"item","transition"),b=t(j,"menu","active"),p=t(j,"menu","index"),h=t(j,"menu","item"),c=t(j,"menu","next"),g=t(j,"menu","play"),o=t(j,"menu","pause"),a=t(j,"menu","prev"),l=['<li><a class="',h,p,'">'].join(" "),i=['<li><a class="',h,c,'">'].join(" "),m=['<li><a class="',h,g,'">'].join(" "),f=['<li><a class="',h,a,'">'].join(" "),r=n.Widget.UI_SRC;MAP_EVENT_INFO={src:r};var q=n.Component.create({NAME:j,ATTRS:{activeIndex:{value:0,setter:"_setActiveIndex"},animationTime:{value:0.5},intervalTime:{value:0.75},itemSelector:{value:">*"},playing:{value:true}},prototype:{animation:null,nodeSelection:null,nodeMenu:null,initializer:function(){var u=this;u.animation=new n.Anim({duration:u.get("animationTime"),to:{opacity:1}});},renderUI:function(){var u=this;u._updateNodeSelection();u._renderMenu();},bindUI:function(){var u=this;u.after({activeIndexChange:u._afterActiveIndexChange,animationTimeChange:u._afterAnimationTimeChange,itemSelectorChange:u._afterItemSelectorChange,intervalTimeChange:u._afterIntervalTimeChange,playingChange:u._afterPlayingChange});u._bindMenu();if(u.get("playing")===true){u._afterPlayingChange({prevVal:false,newVal:true});}},syncUI:function(){var u=this;u._uiSetActiveIndex(u.get("activeIndex"));},item:function(v){var u=this;u.set("activeIndex",v);},next:function(){instance._updateIndexNext();},pause:function(){var u=this;u.set("playing",false);},play:function(){var u=this;u.set("playing",true);},prev:function(){var u=this;u._updateIndexPrev();},_afterActiveIndexChange:function(v){var u=this;u._uiSetActiveIndex(v.newVal,{prevVal:v.prevVal,animate:v.animate,src:v.src});},_afterAnimationTimeChange:function(v){var u=this;u.animation.set("duration",v.newVal);},_afterItemSelectorChange:function(v){var u=this;u._updateNodeSelection();},_afterIntervalTimeChange:function(v){var u=this;u._clearIntervalRotationTask();u._createIntervalRotationTask();},_afterPlayingChange:function(v){var u=this;var w=u.nodeMenu.get("children").item(0).get("children").item(0);if(v.newVal){u._createIntervalRotationTask();w.removeClass(g).addClass(o);}else{u._clearIntervalRotationTask();w.removeClass(o).addClass(g);}},_bindMenu:function(){var u=this;var w=u.nodeMenu;var v=w.get("children");v.each(function(y,x,z){if(x>1&&x!==z.size()-1){y.on("click",u._onMenuItemClick,u);}});v.first().on("click",u._onMenuPlayClick,u);v.item(1).on("click",u._updateIndexPrev,u);v.last().on("click",u._updateIndexNext,u);},_clearIntervalRotationTask:function(){var u=this;clearInterval(u._intervalRotationTask);},_createIndexRandom:function(){var u=this;return Math.ceil(Math.random()*u.nodeSelection.size())-1;},_createIntervalRotationTask:function(){var u=this;u._clearIntervalRotationTask();u._intervalRotationTask=setInterval(function(){u._updateIndexNext({animate:true});},u.get("intervalTime")*1000);},_onAnimationEnd:function(x,y,w,v,z){var u=this;if(w){w.removeClass(s);}y.setStyle("opacity","1");},_onAnimationStart:function(x,y,w,v,z){var u=this;y.addClass(d);v.addClass(b);if(w){w.replaceClass(d,s);}if(z){z.removeClass(b);}},_onMenuItemClick:function(w){var u=this;w.preventDefault();var v=u.nodeMenu.all("li").indexOf(w.currentTarget)-2;u.set("activeIndex",v,MAP_EVENT_INFO);},_onMenuPlayClick:function(v){var u=this;this.set("playing",!this.get("playing"));},_renderMenu:function(){var v=this;var w=n.Node.create("<menu>");var u=n.Node.create(m);w.appendChild(u);u=n.Node.create(f);w.appendChild(u);v.nodeSelection.each(function(y,x,z){u=n.Node.create([l,""].join(x));w.appendChild(u);});u=n.Node.create(i);w.appendChild(u);v.get("contentBox").appendChild(w);v.nodeMenu=w;},_setActiveIndex:function(v){var u=this;if(v=="rand"){v=u._createIndexRandom();}else{v=Math.max(Math.min(v,u.nodeSelection.size()),-1);}return v;},_uiSetActiveIndex:function(w,B){var E=this;var D=2;var z=null;var y=null;var F=null;var u=null;var C=E.nodeSelection.item(w);var v=E.nodeMenu.get("children").item(w+D).get("children").item(0);E.animation.set("node",C);if(B&&!e.isUndefined(B.prevVal)){var x=B.prevVal;var A=x+D;y=E.nodeMenu.get("children").item(A).get("children").item(0);z=E.nodeSelection.item(x);z.replaceClass(d,s);E.animation.stop();}C.setStyle("opacity","0");F=E.animation.on("start",function(G){E._onAnimationStart(G,C,z,v,y);F.detach();});u=E.animation.on("end",function(G){E._onAnimationEnd(G,C,z,v,y);u.detach();});if(B){if(B.animate){E.animation.run();}else{E.animation.fire("start");E.animation.fire("end");}if(B.src==r){E._createIntervalRotationTask();}}},_updateIndexNext:function(w){var u=this;var v=u.get("activeIndex");var y=u.nodeSelection.size();var x=v+1;if(x>(y-1)){x=0;}w.src=r;u.set("activeIndex",x,w);},_updateIndexPrev:function(w){var u=this;var v=u.get("activeIndex");var x=v-1;if(x<0){x=u.nodeSelection.size()-1;}w.src=r;u.set("activeIndex",x,w);},_updateNodeSelection:function(){var u=this;var v=u.get("itemSelector");var w=u.get("contentBox").all(v);w.addClass(k);u.nodeSelection=w;},_intervalRotationTask:null}});n.Carousel=q;},"@VERSION@",{requires:["aui-base","anim"],skinnable:true});