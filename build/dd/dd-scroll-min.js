/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 3.2.0
build: nightly
*/
YUI.add("dd-scroll",function(C){var G=function(){G.superclass.constructor.apply(this,arguments);},B,D,K="host",A="buffer",J="parentScroll",F="windowScroll",I="scrollTop",E="scrollLeft",H="offsetWidth",L="offsetHeight";G.ATTRS={parentScroll:{value:false,setter:function(M){if(M){return M;}return false;}},buffer:{value:30,validator:C.Lang.isNumber},scrollDelay:{value:235,validator:C.Lang.isNumber},host:{value:null},windowScroll:{value:false,validator:C.Lang.isBoolean},vertical:{value:true,validator:C.Lang.isBoolean},horizontal:{value:true,validator:C.Lang.isBoolean}};C.extend(G,C.Base,{_scrolling:null,_vpRegionCache:null,_dimCache:null,_scrollTimer:null,_getVPRegion:function(){var M={},N=this.get(J),R=this.get(A),Q=this.get(F),U=((Q)?[]:N.getXY()),S=((Q)?"winWidth":H),P=((Q)?"winHeight":L),T=((Q)?N.get(I):U[1]),O=((Q)?N.get(E):U[0]);M={top:T+R,right:(N.get(S)+O)-R,bottom:(N.get(P)+T)-R,left:O+R};this._vpRegionCache=M;return M;},initializer:function(){var M=this.get(K);M.after("drag:start",C.bind(this.start,this));M.after("drag:end",C.bind(this.end,this));M.on("drag:align",C.bind(this.align,this));C.one("win").on("scroll",C.bind(function(){this._vpRegionCache=null;},this));},_checkWinScroll:function(Y){var W=this._getVPRegion(),M=this.get(K),N=this.get(F),S=M.lastXY,V=false,e=this.get(A),R=this.get(J),g=R.get(I),T=R.get(E),U=this._dimCache.w,a=this._dimCache.h,P=S[1]+a,X=S[1],d=S[0]+U,Q=S[0],f=X,O=Q,Z=g,c=T;if(this.get("horizontal")){if(Q<=W.left){V=true;O=S[0]-((N)?e:0);c=T-e;}if(d>=W.right){V=true;O=S[0]+((N)?e:0);c=T+e;}}if(this.get("vertical")){if(P>=W.bottom){V=true;f=S[1]+((N)?e:0);Z=g+e;}if(X<=W.top){V=true;f=S[1]-((N)?e:0);Z=g-e;}}if(Z<0){Z=0;f=S[1];}if(c<0){c=0;O=S[0];}if(f<0){f=S[1];}if(O<0){O=S[0];}if(Y){M.actXY=[O,f];M._moveNode({node:R,top:Z,left:c});if(!Z&&!c){this._cancelScroll();}}else{if(V){this._initScroll();}else{this._cancelScroll();}}},_initScroll:function(){this._cancelScroll();this._scrollTimer=C.Lang.later(this.get("scrollDelay"),this,this._checkWinScroll,[true],true);},_cancelScroll:function(){this._scrolling=false;if(this._scrollTimer){this._scrollTimer.cancel();delete this._scrollTimer;}},align:function(M){if(this._scrolling){this._cancelScroll();M.preventDefault();}if(!this._scrolling){this._checkWinScroll();}},_setDimCache:function(){var M=this.get(K).get("dragNode");this._dimCache={h:M.get(L),w:M.get(H)};},start:function(){this._setDimCache();},end:function(M){this._dimCache=null;this._cancelScroll();},toString:function(){return G.NAME+" #"+this.get("node").get("id");}});C.namespace("Plugin");B=function(){B.superclass.constructor.apply(this,arguments);};B.ATTRS=C.merge(G.ATTRS,{windowScroll:{value:true,setter:function(M){if(M){this.set(J,C.one("win"));}return M;}}});C.extend(B,G,{initializer:function(){this.set("windowScroll",this.get("windowScroll"));}});B.NAME=B.NS="winscroll";C.Plugin.DDWinScroll=B;D=function(){D.superclass.constructor.apply(this,arguments);};D.ATTRS=C.merge(G.ATTRS,{node:{value:false,setter:function(M){var N=C.one(M);if(!N){if(M!==false){C.error("DDNodeScroll: Invalid Node Given: "+M);}}else{N=N.item(0);this.set(J,N);}return N;}}});C.extend(D,G,{initializer:function(){this.set("node",this.get("node"));}});D.NAME=D.NS="nodescroll";C.Plugin.DDNodeScroll=D;C.DD.Scroll=G;},"3.2.0",{requires:["dd-drag"],skinnable:false,optional:["dd-proxy"]});