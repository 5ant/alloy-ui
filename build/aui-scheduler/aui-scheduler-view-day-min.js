AUI.add("aui-scheduler-view-day",function(bu){var bD=bu.Lang,ax=bD.isBoolean,r=bD.isFunction,aj=bD.isNumber,bK=bD.isObject,bn=bD.isString,X=bu.DataType.DateMath,br=bu.WidgetStdMod,e="a",aR=",",bg=".",a9="",a5="%",J=" ",o="data-colnumber",bf="scheduler-view",ai="scheduler-view-day",f=bu.cached(function(){var bQ=bu.config.doc,bO=bQ.createElement("div"),A=bQ.getElementsByTagName("body")[0],bP=0.1;if(A){bO.style.cssText="position:absolute;visibility:hidden;overflow:scroll;width:20px;";bO.appendChild(bQ.createElement("p")).style.height="1px";A.insertBefore(bO,A.firstChild);bP=bO.offsetWidth-bO.clientWidth;A.removeChild(bO);}return bP;},null,0.1),C=function(A,bO){return function(bQ){var bP=bQ.all(A);return(bP.size()>=bO)?bP:null;};},be=function(bO,A){return Math.round(bO/A)*A;},bc=function(A){return parseFloat(A)||0;},aH="activeColumn",bb="activeView",D="allDay",at="boundingBox",R="col",ac="colDaysNode",bw="colHeaderDaysNode",y="colblank",q="coldata",al="colday",a="colgrid",L="colspan",h="coltime",aT="columnData",aw="columnDayHeader",am="columnShims",aK="columnTime",aq="container",M="creationStartDate",a0="date",ba="viewDate",bB="day",I="days",t="delegateConfig",a8="disabled",aS="division",bG="dotted",v="draggingEvent",bl="duration",ae="endDate",bF="eventClass",a7="eventPlaceholder",bM="eventRecorder",l="eventWidth",bq="filterFn",ak="first",aJ="grid",aZ="gridContainer",aD="grip",bL="hd",bt="header",aF="headerDateFormatter",bJ="headerTableNode",aA="headerView",aQ="headerViewConfig",ao="headerViewLabelNode",bi="height",aG="horizontal",ar="host",ah="hourHeight",n="icon",U="isoTime",N="label",au="left",ad="locale",g="marginRight",O="marker",aE="markercell",ay="markercellsNode",z="markers",a6="markersNode",bN="node",bs="offsetHeight",bv="pad",G="parentNode",aX="proxy",S="px",P="region",bh="resizer",bo="resizerNode",bd="resizing",az="right",k="scheduler",af="scheduler-event",H="shim",bx="startDate",K="startXY",bp="strings",av="table",a1="tableNode",aU="time",T="timesNode",V="today",aV="top",aY="view",ab="visible",a4="width",a3="data",u=bu.getClassName,c=u(n),w=u(n,aD,bG,aG),aB=u(bf,av,a3),an=u(af),aN=u(af,a8),bk=u(af,aX),E=u(k,V),W=u(k,V,bL),s=u(bf,q),b=u(bf,a),by=u(bf,aJ),bz=u(bf,aJ,aq),aC=u(bf,bB,bt,R),m=u(bf,bB,bt,bB),bm=u(bf,bB,bt,bB,ak),aO=u(bf,bB,bt,bB,bv,az),bC=u(bf,bB,bt,av),aI=u(bf,bB,bt,aY,N),aP=u(bf,O,aS),bA=u(bf,aE),B=u(bf,z),bj=u(bf,bB,bh),ap=u(bf,bB,bh,n),a2=u(bf,bB,av),bH=u(bf,bB,av,R),ag=u(bf,bB,av,R,H),F=u(bf,bB,av,y),x=u(bf,bB,av,al),bE=u(bf,bB,av,h),aW=u(bf,bB,av,aU),j='<div class="'+bj+'">'+'<div class="'+[c,w,ap].join(J)+'"></div>'+"</div>",Q='<div class="'+bA+'">'+'<div class="'+aP+'"></div>'+"</div>",i='<span class="'+aI+'">{label}</span>',Z='<table cellspacing="0" cellpadding="0" class="'+a2+'">'+"<tbody>"+'<tr class="'+b+'" height="1">'+'<td height="0" class="'+[bH,F].join(J)+'"></td>'+'<td class="'+bz+'" colspan="1">'+'<div class="'+by+'">'+'<div class="'+B+'"></div>'+"</div>"+"</td>"+"</tr>"+'<tr class="'+s+'">'+'<td class="'+[bH,bE].join(J)+'"></td>'+"</tr>"+"</tbody>"+"</table>",aL='<td class="'+[bH,x].join(J)+'" data-colnumber="{colNumber}">'+'<div class="'+ag+'"></div>'+"</td>",d='<div class="'+aW+'">{hour}</div>',aa='<table cellspacing="0" cellpadding="0" class="'+bC+'">'+"<tbody>"+'<tr class="'+aC+'"></tr>'+"</tbody>"+"</table>",aM='<th class="'+m+'" data-colnumber="{colNumber}"><a href="#">&nbsp;</a></th>',Y='<td class="'+[m,bm].join(J)+'"></td>',p='<th class="'+[m,aO].join(J)+'">&nbsp;</th>';var bI=bu.Component.create({NAME:ai,ATTRS:{bodyContent:{value:a9},days:{value:1,validator:aj},delegateConfig:{value:{},setter:function(bO){var A=this;return bu.merge({dragConfig:{useShim:false},bubbleTargets:A,container:A.get(at),nodes:bg+an,invalid:"input, select, button, a, textarea, "+bg+aN},bO||{});},validator:bK},eventWidth:{value:95,validator:aj},filterFn:{value:function(A){return(A.getHoursDuration()<=24&&!A.get(D));}},headerDateFormatter:{value:function(bO){var A=this;var bP=A.get(k);return bu.DataType.Date.format(bO,{format:"%d %A",locale:bP.get(ad)});},validator:bn},headerView:{value:true,validator:ax},headerViewConfig:{setter:function(bO){var A=this;return bu.merge({displayDaysInterval:1,displayRows:6,filterFn:function(bP){return((bP.getHoursDuration()>24)||bP.get(D));},height:"auto",visible:true},bO||{});},value:{}},hourHeight:{value:52,validator:aj},name:{value:bB},navigationDateFormatter:{value:function(bO){var A=this;var bP=A.get(k);return bu.DataType.Date.format(bO,{format:"%A, %B %d, %Y",locale:bP.get(ad)});},validator:r},strings:{value:{allDay:"All day"}},headerTableNode:{valueFn:function(){return bu.Node.create(aa);}},headerViewLabelNode:{valueFn:function(){var bO=this;var A=bO.get(bp);return bu.Node.create(bD.sub(i,{label:A[D]}));}},resizerNode:{valueFn:function(){return bu.Node.create(j);}},tableNode:{valueFn:function(){return bu.Node.create(Z);}},colDaysNode:{valueFn:"_valueColDaysNode"},colHeaderDaysNode:{valueFn:"_valueColHeaderDaysNode"},markercellsNode:{valueFn:"_valueMarkercellsNode"},timesNode:{valueFn:"_valueTimesNode"}},HTML_PARSER:{colDaysNode:C(bg+x,1),colHeaderDaysNode:C(bg+m,2),headerTableNode:bg+bC,headerViewLabelNode:bg+aI,markercellsNode:C(bg+bA,24),resizerNode:bg+bj,tableNode:bg+a2,timesNode:C(bg+aW,24)},EXTENDS:bu.SchedulerView,prototype:{initializer:function(){var A=this;A[ac]=A.get(ac);A[bw]=A.get(bw);A[bJ]=A.get(bJ);A[ay]=A.get(ay);A[bo]=A.get(bo);A[a1]=A.get(a1);A[T]=A.get(T);A[aH]=null;A[aT]=A[a1].one(bg+s);A[aw]=A.headerTableNode.one(bg+aC);A[am]=A[ac].all(bg+ag);A[aK]=A[a1].one(bg+bE);A[aZ]=A[a1].one(bg+bz);A[a6]=A[a1].one(bg+B);if(A.get(aA)){A[aA]=new bu.SchedulerTableView(A.get(aQ));}},renderUI:function(){var A=this;A[aK].setContent(A[T]);A[a6].setContent(A[ay]);A[ac].appendTo(A[aT]);A[bw].appendTo(A[aw]);if(A[aA]){A[aA].set(k,A.get(k));A[aA].render();}},bindUI:function(){var A=this;A[bJ].delegate("click",bu.bind(A._onClickDaysHeader,A),bg+m);A[aT].delegate("mousedown",bu.bind(A._onMouseDownTableCol,A),bg+bH);A[aT].delegate("mouseenter",bu.bind(A._onMouseEnterEvent,A),bg+an);
A[aT].delegate("mouseleave",bu.bind(A._onMouseLeaveEvent,A),bg+an);A[aT].delegate("mousemove",bu.bind(A._onMouseMoveTableCol,A),bg+x);A[aT].delegate("mouseup",bu.bind(A._onMouseUpTableCol,A),bg+bH);A.on("drag:end",A._onEventDragEnd);A.on("drag:start",A._onEventDragStart);A.on("drag:tickAlignY",A._dragTickAlignY);A.on("schedulerChange",A._onSchedulerChange);A.after("drag:align",A._afterDragAlign);},syncUI:function(){var A=this;bI.superclass.syncUI.apply(this,arguments);A[aZ].attr(L,A.get(I));A._setupDragDrop();},syncStdContent:function(){var bO=this;bO.setStdModContent(br.BODY,bO[a1].getDOM());var A=bu.NodeList.create(bO[bJ]);if(bO[aA]){A.push(bO[aA].get(at));A.push(bO.get(ao));}bO.setStdModContent(br.HEADER,A);},calculateEventHeight:function(bP){var bO=this;var A=bO.get(ah);return Math.max(bP*(A/60),A/2);},calculateTop:function(bO){var A=this;return((bO.getHours()*60)+bO.getMinutes()+(bO.getSeconds()/60))*(A.get(ah)/60);},getNextDate:function(){var A=this;var bO=A.get(k).get(a0);return X.add(bO,X.DAY,1);},getPrevDate:function(){var A=this;var bO=A.get(k).get(a0);return X.subtract(bO,X.DAY,1);},getColumnByDate:function(bO){var A=this;return A[ac].item(A.getDateDaysOffset(bO));},getColumnShimByDate:function(bO){var A=this;return A[am].item(A.getDateDaysOffset(bO));},getDateByColumn:function(bO){var A=this;var bP=X.safeClearTime(A.get(k).get(ba));return X.add(bP,X.DAY,bO);},getDateDaysOffset:function(bO){var A=this;var bP=X.safeClearTime(A.get(k).get(ba));return X.getDayOffset(X.safeClearTime(bO),bP);},getYCoordTime:function(bR){var bO=this;var A=bO.get(ah);var bS=bc((bR/A).toFixed(2));var bQ=Math.floor((bS*100)%100*0.6);var bP=Math.floor(bS);return[bP,bQ,0];},plotEvent:function(bP){var A=this;var bQ=bP.get(bN);if(bQ.size()<2){bP.addPaddingNode();}var bS=bP.get(bN).item(0);var bO=bP.get(bN).item(1);var bR=A.getColumnShimByDate(bP.get(ae));var bT=A.getColumnShimByDate(bP.get(bx));if(bT){bT.append(bS);if(bP.get(ab)){bS.show();}}else{bS.hide();}if(bR){if(bR.compareTo(bT)||bP.isDayBoundaryEvent()){bO.hide();}else{bR.append(bO);if(bP.get(ab)){bO.show();}}}else{bO.hide();}bP.syncUI();A.syncEventTopUI(bP);A.syncEventHeightUI(bP);},plotEvents:function(){var A=this;var bO=A.get(k);var bP=A.get(bq);A[am].each(function(bT,bS){var bQ=bO.getEventsByDay(A.getDateByColumn(bS),true);var bR=[];bT.empty();bu.Array.each(bQ,function(bU){if(bP.apply(A,[bU])){A.plotEvent(bU);bR.push(bU);}});A.syncEventsIntersectionUI(bR);});if(A.get(aA)){A.syncHeaderViewUI();}},syncColumnsUI:function(){var A=this;A[ac].each(function(bQ,bP){var bO=A.getDateByColumn(bP);bQ.toggleClass(E,X.isToday(bO));});},syncDaysHeaderUI:function(){var bO=this;var bQ=bO.get(k).get(ba);var bP=bO.get(aF);var A=bO.get(ad);bO[bw].all(e).each(function(bT,bS){var bR=X.add(bQ,X.DAY,bS);bT.toggleClass(W,X.isToday(bR));bT.html(bP.call(bO,bR));});},syncEventsIntersectionUI:function(bO){var A=this;var bP=A.get(l);A.get(k).flushEvents();bu.Array.each(bO,function(bR){var bT=A.findEventIntersections(bR,bO);var bS=bT.length;var bQ=(bP/bS);bu.Array.each(bT,function(bV,bW){var bU=bV.get(bN).item(0);var bY=bQ*bW;var bX=bQ*1.7;if(bW===(bS-1)){bX=bP-bY;}bU.setStyle(a4,bX+a5);bU.setStyle(au,bY+a5);var bZ=bU.get(G);if(bZ){bZ.insert(bU,bW);}bV._filtered=true;});});},syncEventHeightUI:function(bQ){var bO=this;var bU=bQ.get(ae);var A=bQ.get(bx);var bR=X.clone(A);bR.setHours(24,0,0);var bS=X.getMinutesOffset(bO.limitDate(bU,bR),A);bQ.get(bN).item(0).set(bs,bO.calculateEventHeight(bS));var bP=bQ.get(bN).item(1);if(bP.inDoc()){var bT=X.getMinutesOffset(bU,X.toMidnight(bQ.getClearEndDate()));bP.set(bs,bO.calculateEventHeight(bT));}},syncEventTopUI:function(bO){var A=this;bO.get(bN).item(0).setStyle(aV,A.calculateTop(bO.get(bx))+S);bO.get(bN).item(1).setStyle(aV,0);},syncHeaderViewUI:function(){var bO=this;if(bO.get(aA)){var bQ=bO[aA];bQ.plotEvents();var bR=bQ.get(at);bR.setStyle(g,f());var bP=bR.one(bg+aB);var A=Math.max(bP.get(bs),40);bQ.set(bi,A);bO._fillHeight();}},calculateYDelta:function(bP,bO){var A=this;return(bO[1]-bP[1])/(A.get(ah)/2)*30;},findEventIntersections:function(bO,bP){var A=this;var bQ=[];bu.Array.each(bP,function(bR){if(!bO._filtered&&bR.get(ab)&&bO.intersectHours(bR)){bQ.push(bR);}});return bQ;},getXYDelta:function(bO){var A=this;var bP=bO.currentTarget.getXY(),bQ=[bO.pageX,bO.pageY];return bu.Array.map(bP,function(bS,bR){return(bQ[bR]-bS);});},getTickY:function(){var A=this;return be(Math.ceil(A.get(ah)/2),10);},roundToNearestHour:function(bO,bP){var A=this;bO.setHours(bP[0],be(bP[1],A.getTickY()),bP[2]);},_afterDragAlign:function(bP){var bO=this;var A=bP.target;if(!bO[K]){bO[K]=A.actXY;}A.actXY[0]=null;},_dragTickAlignX:function(bP){var bO=this;var bS=bO[v];if(bS&&!bO[bd]){var bQ=bO[a7];var bR=bc(bP.attr(o))-bO.startColNumber;bO.draggingEventStartDate=X.add(bS.get(bx),X.DAY,bR);var A=X.clone(bO.draggingEventStartDate);X.copyHours(A,bQ.get(bx));bQ.move(A,{silent:true});bO.plotEvent(bQ);}},_dragTickAlignY:function(A){var bT=this;var bO=bT.get(k);var bV=bO.get(bM);var bQ=bT[v];if(bQ){var bU=A.target.get(ar);var bR=bT[a7];var bS=bT.calculateYDelta(bT[K],bU.actXY);if(bT[bd]){var bP=X.add(bT.draggingEventEndDate,X.MINUTES,bS);if(X.getMinutesOffset(bP,bT.draggingEventStartDate)<30){return;}bR.set(ae,bP,{silent:true});}else{bR.move(X.add(bT.draggingEventStartDate,X.MINUTES,bS),{silent:true});}bT.plotEvent(bR);}},_setupDragDrop:function(){var bO=this,bR=bO[a7];if(!bR){var bP=bO.get(k);bR=new (bO.get(bF))({scheduler:bP});bR.removeTarget(bP);bR.get(bN).addClass(bk);bR.set(ab,false,{silent:true});bO[a7]=bR;}if(!bO.delegate){bO.delegate=new bu.DD.Delegate(bO.get(t));}var A=bO.delegate.dd;A.unplug(bu.Plugin.DDConstrained);A.unplug(bu.Plugin.DDNodeScroll);var bQ=bO.bodyNode.get(P);bQ.bottom=Infinity;bQ.top=-Infinity;A.plug(bu.Plugin.DDConstrained,{bubbleTargets:bO,constrain:bQ,stickY:true,tickY:bO.get(ah)/2});A.plug(bu.Plugin.DDNodeScroll,{node:bO.bodyNode,scrollDelay:150});},_uiSetDate:function(bO){var A=this;A.syncColumnsUI();A.syncDaysHeaderUI();},_onClickDaysHeader:function(bQ){var A=this;
var bP=A.get(k);if(bQ.target.test(e)){var bR=bP.getViewByName(bB);if(bR){var bO=bc(bQ.currentTarget.attr(o));bP.set(ba,A.getDateByColumn(bO));bP.set(bb,bR);}}bQ.preventDefault();},_onEventDragEnd:function(bO){var A=this;var bQ=A[v];if(bQ){var bP=A[a7];bP.set(ab,false,{silent:true});bQ.set(ab,true,{silent:true});bQ.copyDates(bP);A.get(k).syncEventsUI();}A[K]=null;A[v]=null;},_onEventDragStart:function(bP){var A=this;var bR=A[v]=A.delegate.dd.get(bN).getData(af);if(bR){var bQ=A[a7];bQ.copyPropagateAttrValues(bR,null,{silent:true});A.plotEvent(bQ);bR.set(ab,false,{silent:true});A.draggingEventStartDate=X.clone(bR.get(bx));A.draggingEventEndDate=X.clone(bR.get(ae));var bO=A.getColumnByDate(bR.get(bx));A.startColNumber=bO?bc(bO.attr(o)):0;}},_onMouseDownTableCol:function(bO){var bT=this;var bS=bO.target;var bQ=bT.get(k);var bU=bQ.get(bM);if(bU&&!bQ.get(a8)){bU.hideOverlay();if(bS.test(bg+ag)){bT[K]=[bO.pageX,bO.pageY];var bV=bc(bO.currentTarget.attr(o));var bP=bT.getDateByColumn(bV);var A=bT.getXYDelta(bO);bT.roundToNearestHour(bP,bT.getYCoordTime(A[1]));var bR=X.add(bP,X.MINUTES,bU.get(bl));bU.move(bP,{silent:true});bU.setAttrs({allDay:false,endDate:bR},{silent:true});bT[M]=bP;bO.halt();}else{if(bS.test([bg+bj,bg+ap].join(aR))){bT[bd]=true;}}}bT.get(at).unselectable();},_onMouseEnterEvent:function(bP){var A=this;var bQ=bP.currentTarget;var bO=bQ.getData(af);if(bO&&!bO.get(a8)){A[bo].appendTo(bQ);}},_onMouseLeaveEvent:function(bO){var A=this;if(!A[bd]){A._removeResizer();}},_onMouseMoveTableCol:function(bR){var bO=this;var bQ=bR.currentTarget;var bP=bO.get(k).get(bM);if(bO[aH]!==bQ){bO[aH]=bQ;bO._dragTickAlignX(bO[aH]);}var bS=bO[M];if(bS){var bU=be(bO.calculateYDelta(bO[K],[bR.pageX,bR.pageY]),bO.getTickY());var bT=(bU>=bO._delta);if(bO._delta!==bU){if(bU>0){var A=bT?Math.max(bU,bP.get(bl)):bU;bP.set(ae,X.add(bS,X.MINUTES,A),{silent:true});}else{bP.set(bx,X.add(bS,X.MINUTES,bU),{silent:true});}bO.plotEvent(bP);bO._delta=bU;}}},_onMouseUpTableCol:function(bQ){var A=this;var bP=A.get(k);var bO=bP.get(bM);if(bO&&!bP.get(a8)){if(A[M]){A.plotEvent(bO);bO.showOverlay([bQ.pageX,bQ.pageY]);}}A[M]=null;A[bd]=false;A[K]=null;A._removeResizer();A.get(at).selectable();},_onSchedulerChange:function(bO){var A=this;if(A[aA]){A[aA].set(k,bO.newVal);}},_removeResizer:function(){var A=this;A[bo].remove();},_valueColDaysNode:function(){var A=this;var bQ=A.get(I);var bO=[],bP=0;while(bQ--){bO.push(bu.Lang.sub(aL,{colNumber:bP++}));}return bu.NodeList.create(bO.join(a9));},_valueColHeaderDaysNode:function(){var A=this;var bQ=A.get(I);var bO=[],bP=0;bO.push(Y);while(bQ--){bO.push(bu.Lang.sub(aM,{colNumber:bP++}));}bO.push(p);return bu.NodeList.create(bO.join(a9));},_valueMarkercellsNode:function(){var A=this;var bO=[],bP;for(bP=0;bP<=23;bP++){bO.push(Q);}return bu.NodeList.create(bO.join(a9));},_valueTimesNode:function(){var A=this;var bQ=A.get(U);var bP=[],bO;for(bO=0;bO<=23;bO++){bP.push(bD.sub(d,{hour:bQ?X.toIsoTimeString(bO):X.toUsTimeString(bO,false,true)}));}return bu.NodeList.create(bP.join(a9));}}});bu.SchedulerDayView=bI;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-view-table","dd-drag","dd-delegate","dd-drop","dd-constrain"]});