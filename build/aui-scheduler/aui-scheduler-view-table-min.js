AUI.add("aui-scheduler-view-table",function(ao){var aa=ao.Lang,aI=aa.isFunction,aS=aa.isString,p=ao.DataType.DateMath,aj=ao.WidgetStdMod,a0=p.WEEK_LENGTH,aP="-",ai=".",w="",x=" ",am="scheduler-view",aw="scheduler-view-table",a8=function(A,a9){return function(bb){var ba=bb.all(A);return(ba.size()>=a9)?ba:null;};},ax="body",f="close",ap="col",I="colHeaderDaysNode",v="colgrid",aE="colspan",J="columnDayHeader",K="columnTableGrid",a="container",an="content",aA="data",aJ="day",i="displayDaysInterval",V="displayRows",ad="div",aB="down",at="endDate",a6="event",aT="events",P="eventsOverlay",aN="filterFn",C="first",M="firstDayOfWeek",j="grid",D="header",d="headerDateFormatter",B="headerTableNode",af="icon",c="left",aX="locale",aM="more",s="next",u="node",n="overlay",l="right",r="row",Q="rowsContainerNode",U="scheduler",ag="scheduler-event",aW="showMore",aU="startDate",N="strings",m="table",aC="tableGridNode",t="tableRowContainer",o="tableRows",aR="tbody",ay="title",a4="tl",k="today",aV="tr",W="viewDate",ac="visible",L=ao.getClassName,q=L(af),a5=L(af,"arrowstop-1-l"),g=L(af,"arrowstop-1-r"),ar=L(am,m,v),a7=L(am,m,v,C),aK=L(am,m,v,k),al=L(am,m,a),T=L(am,m,aT,n,u),b=L(am,m,aT,n,u,ax),aH=L(am,m,aT,n,u,f),ae=L(am,m,D,ap),az=L(am,m,D,aJ),X=L(am,m,D,m),ak=L(am,m,aM),aZ=L(am,m,r),aO=L(am,m,r,a),H=L(am,m,aA),F=L(am,m,aA,ap),Z=L(am,m,aA,ap,ay),a3=L(am,m,aA,ap,ay,aB),ab=L(am,m,aA,ap,ay,C),O=L(am,m,aA,ap,ay,s),R=L(am,m,aA,ap,ay,k),y=L(am,m,aA,a6),aQ=L(am,m,aA,a6,c),a1=L(am,m,aA,a6,l),S=L(am,m,aA,C),ah=L(am,m,j),G=L(am,m,j,C),aY='<div class="'+al+'">'+'<div class="'+aO+'"></div>'+"</div>",aq='<div class="'+T+'">'+'<div class="'+b+'"></div>'+'<a href="javascript:;" class="'+aH+'">{label}</a>'+"</div>",aL='<td class="'+ar+'">&nbsp;</td>',a2='<th class="'+az+'"><div>&nbsp;</div></th>',h='<table cellspacing="0" cellpadding="0" class="'+X+'">'+"<tbody>"+'<tr class="'+ae+'"></tr>'+"</tbody>"+"</table>",aG='<a href="javascript:;" class="'+ak+'">{label} {count}</a>',aD='<div class="'+aZ+'" style="top: {top}%; height: {height}%;"></div>',Y='<table cellspacing="0" cellpadding="0" class="'+H+'">'+"<tbody></tbody>"+"</table>",aF='<table cellspacing="0" cellpadding="0" class="'+ah+'">'+"<tbody>"+"<tr></tr>"+"</tbody>"+"</table>",z='<span class="'+[q,a5].join(x)+'"></span>',av='<span class="'+[q,g].join(x)+'"></span>',E='<td class="'+F+'"><div></div></td>',au="<tr></tr>";var e=ao.Component.create({NAME:aw,ATTRS:{bodyContent:{value:w},displayDaysInterval:{value:42},displayRows:{value:4},fixedHeight:{value:true},name:{value:m},headerDateFormatter:{value:function(a9){var A=this;var ba=A.get(U);return ao.DataType.Date.format(a9,{format:"%A",locale:ba.get(aX)});},validator:aS},navigationDateFormatter:{value:function(a9){var A=this;var ba=A.get(U);return ao.DataType.Date.format(a9,{format:"%b %Y",locale:ba.get(aX)});},validator:aI},scrollable:{value:false},strings:{value:{close:"Close",showMore:"Show more"}},headerTableNode:{valueFn:function(){return ao.Node.create(h);}},colHeaderDaysNode:{valueFn:"_valueColHeaderDaysNode"},rowsContainerNode:{valueFn:function(){return ao.Node.create(aY);}},tableGridNode:{valueFn:"_valueTableGridNode"}},HTML_PARSER:{colHeaderDaysNode:a8(ai+az,7),headerTableNode:ai+X,rowsContainerNode:ai+al,tableGridNode:a8(ai+ah,7)},EXTENDS:ao.SchedulerView,prototype:{evtDateStack:null,evtRenderedStack:null,rowDataTableStack:null,initializer:function(){var A=this;A.evtDateStack={};A.evtRenderedStack={};A.rowDataTableStack={};A[I]=A.get(I);A[B]=A.get(B);A[Q]=A.get(Q);A[aC]=A.get(aC);A[J]=A.headerTableNode.one(ai+ae);A[K]=ao.NodeList.create();A[t]=A[Q].one(ai+aO);A[o]=ao.NodeList.create();},bindUI:function(){var A=this;A[Q].delegate("click",ao.bind(A._onClickMore,A),ai+ak);},renderUI:function(){var A=this,a9=A._getDisplayRowsCount(),ba;for(ba=0;ba<a9;ba++){A[o].push(A.buildGridRowNode(ba));}A._renderEventsOverlay();A[I].appendTo(A[J]);A[o].appendTo(A[t]);},buildEventsRow:function(a9,be,bd){var A=this;var ba=A.get(V);var bc=0;var bb=ao.Node.create(au);A.loopDates(a9,be,function(bn,bj){if(bc>bj){return;}var bo=A.getIntersectEvents(bn);var bl=A._getRenderableEvent(bo,a9,be,bn);var bh=ao.Node.create(E);var bg=bh.one(ad);if((ba<bo.length)&&(bd===(ba-1))){var bm=A.get(N);var bi=ao.Node.create(aa.sub(aG,{count:(bo.length-(ba-1)),label:bm[aW]}));bi.setData(aT,bo);bg.append(bi);}else{if(bl){var bf=A._getEvtSplitInfo(bl,bn,a9,be);bh.attr(aE,bf.colspan);bc+=(bf.colspan-1);A._syncEventNodeContainerUI(bl,bg,bf);A._syncEventNodeUI(bl,bg,bn);var bk=String(bn.getTime());A.evtRenderedStack[bk].push(bl);}}bc++;bb.append(bh);});return bb;},buildEventsTable:function(A,bc){var bi=this,bg=bi.get(V),bf=p.clearTime(bi._findCurrentIntervalStart()),be=String(bf.getTime()).concat(A.getTime()).concat(bc.getTime()),bh=bi.rowDataTableStack[be],bd;if(!bh){bh=ao.Node.create(Y);var bb=bh.one(aR);var ba=bi.buildEventsTitleRow(bh,A,bc);bb.append(ba);for(bd=0;bd<bg;bd++){var a9=bi.buildEventsRow(A,bc,bd);bb.append(a9);}bi.rowDataTableStack[be]=bh;}return bh;},buildEventsTitleRow:function(ba,a9,bc){var A=this;var bb=ao.Node.create(au);A.loopDates(a9,bc,function(be,bd){var bf=ao.Node.create(E);bf.addClass(Z).toggleClass(ab,(bd===0)).toggleClass(R,p.isToday(be)).toggleClass(O,p.isToday(p.subtract(be,p.DAY,1))).toggleClass(a3,p.isToday(p.subtract(be,p.WEEK,1)));bb.append(bf.setContent(be.getDate()));});return bb;},buildGridRowNode:function(bd){var ba=this;var bb=ba._getDisplayRowsCount();var a9=100/bb;var A=ba._getTableGridNode(bd);var bc=ao.Node.create(aa.sub(aD,{height:a9,top:a9*bd}));bc.append(A.toggleClass(G,(bd===0)));return bc;},flushViewCache:function(){var A=this;A.evtDateStack={};A.evtRenderedStack={};A.rowDataTableStack={};},getIntersectEvents:function(a9){var A=this;var bc=A.get(U);var bb=String(a9.getTime());if(!A.evtDateStack[bb]){var ba=bc.getIntersectEvents(a9);A.evtDateStack[bb]=ba.filter(A.get(aN));}return A.evtDateStack[bb];},getNextDate:function(){var A=this;var ba=A.get(U);var bb=ba.get(W);var a9=A.get(i);return p.add(bb,p.DAY,a9);},getPrevDate:function(){var A=this;
var ba=A.get(U);var bb=ba.get(W);var a9=A.get(i);return p.subtract(bb,p.DAY,a9);},hideEventsOverlay:function(){var A=this;A[P].set(ac,false);},loopDates:function(A,bb,be,bf,bd){var bg=this;var a9=p.clone(A);var ba=bb.getTime();var bc;for(bc=0;a9.getTime()<=ba;bc++){be.apply(bg,[a9,bc]);a9=p.add(a9,(bf||p.DAY),(bd||1));}},plotEvents:function(){var a9=this;var bc=a9._findCurrentIntervalStart();var A=p.safeClearTime(bc);a9.flushViewCache();a9.hideEventsOverlay();a9.bodyNode.all(ai+H).remove();var ba=a9.get(i);var bb=Math.min(ba,a0);a9[o].each(function(bg,be){var bd=p.add(A,p.DAY,bb*be);var bh=p.add(bd,p.DAY,bb-1);var bf=a9.buildEventsTable(bd,bh);if(be===0){bf.addClass(S);}bg.append(bf);});},syncDaysHeaderUI:function(){var a9=this;var bc=a9.get(U);var bd=bc.get(W);var bb=a9.get(d);var A=a9.get(aX);var ba=a9._findFirstDayOfWeek(bd);a9.colHeaderDaysNode.all(ad).each(function(bg,bf){var be=p.add(ba,p.DAY,bf);bg.html(bb.call(a9,be));});},syncGridUI:function(){var bi=this;var bc=bi.getToday();var a9=bi.get(U);bi[K].removeClass(aK);var bb=bi._findCurrentIntervalStart();var be=bi._findCurrentIntervalEnd();if(p.between(bc,bb,be)){var A=a9.get(M);var bg=bi._findFirstDayOfWeek(bc);var bd=p.getWeekNumber(bc,A)-p.getWeekNumber(bb,A);var bh=(bc.getDate()-bg.getDate());var ba=bi._getCellIndex([bh,bd]);var bf=bi[K].item(ba);if(bf){bf.addClass(aK);}}},syncStdContent:function(){var A=this;A.setStdModContent(aj.BODY,A[Q].getDOM());A.setStdModContent(aj.HEADER,A[B].getDOM());},_findCurrentIntervalEnd:function(){var A=this;var ba=A.get(U);var bb=ba.get(W);var a9=A.get(i);return p.add(bb,p.DAY,a9);},_findCurrentIntervalStart:function(){var A=this;var a9=A.get(U);return a9.get(W);},_findFirstDayOfWeek:function(ba){var A=this;var bb=A.get(U);var a9=bb.get(M);return p.getFirstDayOfWeek(ba,a9);},_getCellIndex:function(a9){var A=this;return a9[1]*a0+a9[0];},_getDisplayRowsCount:function(){var A=this;var a9=A.get(i);return Math.ceil(a9/a0);},_getDisplayRowDaysCount:function(){var A=this;var a9=A.get(i);return Math.min(a9,a0);},_getEvtLabel:function(ba){var a9=this;var bb=ba.get(at);var A=ba.get(aU);return[A.getHours(),aP,bb.getHours(),x,ba.get(an)].join(w);},_getEvtSplitInfo:function(bd,bg,A,bb){var be=this;var a9=bd.getClearStartDate();var bc=bd.getClearEndDate();var bf=p.getDayOffset(bb,bg);var ba={colspan:Math.min(p.getDayOffset(bc,bg),bf)+1,left:p.before(a9,A),right:p.after(bc,bb)};return ba;},_getRenderableEvent:function(bh,A,bb,bi){var bg=this,be=String(bi.getTime()),ba;if(!bg.evtRenderedStack[be]){bg.evtRenderedStack[be]=[];}for(ba=0;ba<bh.length;ba++){var bf=bh[ba];var a9=bf.get(aU);var bd=p.after(bi,a9)&&!p.isDayOverlap(bi,A);var bc=!p.isDayOverlap(a9,bi);var bj=ao.Array.indexOf(bg.evtRenderedStack[be],bf)>-1;if(!bj&&(bc||bd)){return bf;}}return null;},_getTableGridNode:function(be){var a9=this,bb=a9.get(i),A=a9[aC].item(be),bd=A.one(aV),ba;for(ba=0;ba<Math.min(bb,a0);ba++){var bc=ao.Node.create(aL);bd.append(bc);if(ba===0){bc.addClass(a7);}a9[K].push(bc);}return A;},_onClickMore:function(ba){var A=this;var bb=ba.target;var a9=bb.getData(aT);var bc=ao.NodeList.create();ao.Array.each(a9,function(be){var bd=be.get(u).item(0).clone();bd.setData(ag,be);bd.setStyles({height:"auto",left:0,position:"relative",top:0,width:"auto"});bc.push(bd);});A[P].bodyNode.one(ai+b).setContent(bc);A[P].setAttrs({visible:true,xy:bb.getXY()});},_renderEventsOverlay:function(){var a9=this;var A=a9.get(N);a9[P]=new ao.Overlay({align:{points:[a4,a4]},bodyContent:aa.sub(aq,{label:A[f]}),render:a9[Q],visible:false,width:250,zIndex:450});a9[P].bodyNode.delegate("click",ao.bind(a9.hideEventsOverlay,a9),ai+aH);},_syncEventNodeContainerUI:function(a9,bb,ba){var A=this;bb.addClass(y);if(ba.left){bb.addClass(aQ).prepend(z);}if(ba.right){bb.addClass(a1).append(av);}},_syncEventNodeUI:function(bh,a9,bj){var bi=this;var bc=bi.get(U);var A=bc.get(M);var bb=bh.get(u);var ba=bh.get(aU);var bg=p.clearTime(bi._findCurrentIntervalStart());var bd=p.getFirstDayOfWeek(new Date(Math.max(ba,bg)),A);var bf=Math.floor(p.getDayOffset(bj,bd)/a0);if(bb.size()<=bf){bh.addPaddingNode();}var be=bb.item(bf);be.setStyles({height:"auto",left:0,top:0,width:"auto"});be.appendTo(a9);bh.syncUI();},_uiSetDate:function(a9){var A=this;A.syncDaysHeaderUI();A.syncGridUI();},_valueColHeaderDaysNode:function(){var A=this;var a9=A.get(i);var ba=Math.min(a9,a0);return A._valueNodeList(ba,a2);},_valueTableGridNode:function(){var A=this;var a9=A.get(i);var ba=Math.min(a9,a0);return A._valueNodeList(ba,aF);},_valueNodeList:function(bb,ba){var A=this;var a9=[];while(bb--){a9.push(ba);}return ao.NodeList.create(a9.join(w));}}});ao.SchedulerTableView=e;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-base","overlay"]});