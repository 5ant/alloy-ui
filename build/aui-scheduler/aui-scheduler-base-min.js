AUI.add("aui-scheduler-base",function(AK){var w=AK.Lang,Ah=w.isString,g=w.isObject,C=w.isArray,G=w.isDate,p=w.isNumber,o=function(A){return(A instanceof AK.Scheduler);},Y=function(A){return(A instanceof AK.SchedulerView);},AH=function(A){return(A instanceof AK.SchedulerEvent);},a=function(A){return(AK.SchedulerCalendar&&(A instanceof AK.SchedulerCalendar));},L=AK.DataType.DateMath,AD=AK.WidgetStdMod,Af="-",AB=".",T="",U=" ",W="scheduler-base",AQ="data-view-name",m="activeView",S="boundingBox",Ag="clearfix",l="controls",AS="controlsNode",AV="current",AJ="currentDate",AF="currentDateNode",AR="date",AI="dateFormat",Ab="day",AP="endDate",Ai="events",i="firstDayOfWeek",An="hd",Ae="headerNode",Q="helper",z="icon",N="iconNextNode",Aa="iconPrevNode",Al="locale",I="month",P="name",x="nav",t="navNode",R="next",F="nextDate",Ad="prev",AT="prevDate",Am="rendered",s="scheduler",AW="srcNode",Ak="startDate",j="strings",AY="template",H="today",AL="todayNode",b="triggerNode",e="view",Ao="views",AE="viewsNode",v="week",X="year",AZ="navigationDateFormat",u="eventRecorder",f=AK.ClassNameManager.getClassName,AM=f(Q,Ag),M=f(z),AX=f(W,l),AA=f(W,AV,AR),K=f(W,An),AC=f(W,z,R),h=f(W,z,Ad),Aj=f(W,x),d=f(W,H),AG=f(W,e),V=f(W,Ao),J=f(W,e,T),Z=f(W,e,Ab),B=f(W,e,I),D=f(W,e,v),AO=f(W,e,X),k=f(s,e,T),AU='<div class="'+AX+'"></div>',c='<div class="'+AA+'"></div>',E='<div class="'+K+'"></div>',Ap='<a href="#" class="'+[M,AC].join(U)+'">Next</a>',AN='<a href="#" class="'+[M,h].join(U)+'">Prev</a>',O='<div class="'+Aj+'"></div>',y='<a href="#" class="'+d+'">{today}</a>',Ac='<a href="#" class="'+[AG,J].join(U)+'{name}" data-view-name="{name}">{label}</a>',q='<div class="'+V+'"></div>';var r=function(){};r.ATTRS={events:{value:[],setter:"_setEvents",validator:C}};AK.mix(r.prototype,{addEvent:function(Aq){var A=this;var Ar=A.get(Ai);if(AK.Array.indexOf(Ar,Aq)>-1){AK.Array.removeItem(Ar,Aq);}Ar.push(Aq);A.set(Ai,Ar);},addEvents:function(Aq){var A=this;AK.Array.each(A._normalizeEvents(Aq),AK.bind(A.addEvent,A));},removeEvent:function(Aq){var A=this;var Ar=A.get(Ai);AK.Array.removeItem(Ar,Aq);A.set(Ai,Ar);},removeEvents:function(Aq){var A=this;AK.Array.each(A._normalizeEvents(Aq),AK.bind(A.removeEvent,A));},_normalizeEvents:function(Ar){var A=this;var Aq=[];Ar=AK.Array(Ar);AK.Array.each(Ar,function(As,At){if(AH(As)){Aq.push(As);}else{if(a(As)){Aq=Aq.concat(A._normalizeEvents(As.get(Ai)));}else{As=new AK.SchedulerEvent(As);Aq.push(As);}}if(o(A)){As.set(s,A);}});return Aq;},_setEvents:function(Aq){var A=this;return A._normalizeEvents(Aq);}});AK.SchedulerEventSupport=r;var n=AK.Component.create({NAME:W,ATTRS:{activeView:{validator:Y},eventRecorder:{setter:"_setEventRecorder"},strings:{value:{day:"Day",month:"Month",today:"Today",week:"Week",year:"Year"}},navigationDateFormat:{getter:function(Ar){var A=this;var Aq=A.get(m);if(Aq){return Aq.get(AZ);}return Ar;},value:"%A - %d %b %Y",validator:Ah},views:{setter:"_setViews",value:[]},currentDate:{valueFn:function(){return new Date();},validator:G},firstDayOfWeek:{value:0,validator:p},controlsNode:{valueFn:function(){return AK.Node.create(AU);}},currentDateNode:{valueFn:function(){return AK.Node.create(c);}},headerNode:{valueFn:function(){return AK.Node.create(E);}},iconNextNode:{valueFn:function(){return AK.Node.create(Ap);}},iconPrevNode:{valueFn:function(){return AK.Node.create(AN);}},navNode:{valueFn:function(){return AK.Node.create(O);}},todayNode:{valueFn:function(){return AK.Node.create(this._processTemplate(y));}},viewsNode:{valueFn:function(){return AK.Node.create(q);}}},HTML_PARSER:{controlsNode:AB+AX,currentDateNode:AB+AA,headerNode:AB+K,iconNextNode:AB+AC,iconPrevNode:AB+h,navNode:AB+Aj,todayNode:AB+d,viewsNode:AB+V},UI_ATTRS:[AJ],AUGMENTS:[AK.SchedulerEventSupport,AK.WidgetStdMod],prototype:{viewStack:null,initializer:function(){var A=this;A.viewStack={};A.controlsNode=A.get(AS);A.currentDateNode=A.get(AF);A.iconNextNode=A.get(N);A.iconPrevNode=A.get(Aa);A.navNode=A.get(t);A.schedulerHeaderNode=A.get(Ae);A.todayNode=A.get(AL);A.viewsNode=A.get(AE);A.after({render:A._afterRender,activeViewChange:A._afterActiveViewChange});},bindUI:function(){var A=this;A._bindDelegate();},syncUI:function(){var A=this;A.syncStdContent();},flushEvents:function(){var A=this;AK.Array.each(A.get(Ai),function(Aq,Ar){Aq.eachRepeatedEvent(function(At,As){delete At._filtered;});delete Aq._filtered;});},getEventsByDay:function(Aq){var A=this;Aq=L.safeClearTime(Aq);return A._getEvents(Aq,function(Ar){return L.compare(Ar.getClearStartDate(),Aq);});},getIntersectEvents:function(Aq){var A=this;Aq=L.safeClearTime(Aq);return A._getEvents(Aq,function(As){var Ar=As.getClearStartDate();var At=As.getClearEndDate();return(L.compare(Aq,Ar)||L.compare(Aq,At)||L.between(Aq,Ar,At));});},sortEventsByDateAsc:function(Aq){var A=this;Aq.sort(function(Au,As){var At=Au.get(AP);var Ar=As.get(AP);var Aw=Au.get(Ak);var Av=As.get(Ak);if(L.after(Aw,Av)||L.compare(Aw,Av)&&L.before(At,Ar)){return 1;}else{return -1;}});},getViewByName:function(Aq){var A=this;return A.viewStack[Aq];},getStrings:function(){var A=this;return A.get(j);},getString:function(Aq){var A=this;return A.getStrings()[Aq];},renderView:function(Aq){var A=this;if(Aq){Aq.show();if(!Aq.get(Am)){var Ar=Aq.get(P);if(!A.bodyNode){A.setStdModContent(AD.BODY,T);}Aq.render(A.bodyNode);}}},plotViewEvents:function(Aq){var A=this;Aq.plotEvents(A.get(Ai));},syncEventsUI:function(){var A=this;A.plotViewEvents(A.get(m));},_afterActiveViewChange:function(As){var Aq=this;if(Aq.get(Am)){var Ar=As.newVal;var A=As.prevVal;if(A){A.hide();}Aq.renderView(Ar);}},_afterRender:function(Aq){var A=this;A.renderView(A.get(m));},_bindDelegate:function(){var A=this;A.viewsNode.delegate("click",A._onClickViewTrigger,AB+AG,A);A.controlsNode.delegate("click",A._onClickPrevIcon,AB+h,A);A.controlsNode.delegate("click",A._onClickNextIcon,AB+AC,A);A.controlsNode.delegate("click",A._onClickToday,AB+d,A);},_createViewTriggerNode:function(Aq){var A=this;if(!Aq.get(b)){var Ar=Aq.get(P);Aq.set(b,AK.Node.create(AK.substitute(Ac,{name:Ar,label:(A.getString(Ar)||Ar)})));
}return Aq.get(b);},_getEvents:function(Aq,As){var A=this;var Ar=A.get(Ai);var At=[];AK.Array.each(Ar,function(Au,Av){if(As.apply(A,[Au])){At.push(Au);}else{if(Au.isRepeatableDate(Aq)){var Aw=Au.repeatByDate(Aq);At.push(Aw);}}});A.sortEventsByDateAsc(At);return At;},_onClickToday:function(Aq){var A=this;A.set(AJ,A.get(m).getToday());Aq.preventDefault();},_onClickNextIcon:function(Aq){var A=this;A.set(AJ,A.get(m).get(F));Aq.preventDefault();},_onClickPrevIcon:function(Aq){var A=this;A.set(AJ,A.get(m).get(AT));Aq.preventDefault();},_onClickViewTrigger:function(Ar){var A=this;var As=Ar.currentTarget;var At=As.attr(AQ);var Aq=A.getViewByName(At);A.set(m,Aq);Ar.preventDefault();},_processTemplate:function(Aq){var A=this;return AK.substitute(Aq,A.getStrings());},_setEventRecorder:function(Aq){var A=this;if(Aq){Aq.set(s,A);}},_setViews:function(Ar){var A=this;var Aq=[];AK.Array.each(Ar,function(As){if(Y(As)&&!As.get(Am)){As.set(s,A);Aq.push(As);A.viewStack[As.get(P)]=As;}});if(!A.get(m)){A.set(m,Ar[0]);}return Aq;},syncStdContent:function(){var A=this;var Aq=A.get(Ao);A.navNode.append(A.iconPrevNode);A.navNode.append(A.iconNextNode);A.controlsNode.append(A.todayNode);A.controlsNode.append(A.navNode);A.controlsNode.append(A.currentDateNode);AK.Array.each(Aq,function(Ar){A.viewsNode.append(A._createViewTriggerNode(Ar));});A.schedulerHeaderNode.append(A.controlsNode);A.schedulerHeaderNode.append(A.viewsNode);A.schedulerHeaderNode.addClass(AM);A.setStdModContent(AD.HEADER,A.schedulerHeaderNode.getDOM());},_uiSetCurrentDate:function(Au){var Ar=this;var Aq=Ar.get(AZ);var A=Ar.get(Al);var At=AK.DataType.Date.format(Au,{format:Aq,locale:A});Ar.currentDateNode.html(At);if(Ar.get(Am)){var As=Ar.get(m);if(As){As._uiSetCurrentDate(Au);}Ar.syncEventsUI();}}}});AK.Scheduler=n;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-view","datasource"]});