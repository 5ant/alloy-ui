AUI.add("aui-scheduler-base",function(AJ){var v=AJ.Lang,Ag=v.isString,g=v.isObject,C=v.isArray,G=v.isDate,o=v.isNumber,Y=function(A){return(A instanceof AJ.SchedulerView);},AG=function(A){return(A instanceof AJ.SchedulerEvent);},a=function(A){return(AJ.SchedulerCalendar&&(A instanceof AJ.SchedulerCalendar));},L=AJ.DataType.DateMath,AC=AJ.WidgetStdMod,Ae="-",AA=".",T="",U=" ",W="scheduler-base",AP="data-view-name",m="activeView",S="boundingBox",Af="clearfix",l="controls",AR="controlsNode",AU="current",AI="currentDate",AE="currentDateNode",AQ="date",AH="dateFormat",Aa="day",AO="endDate",Ah="events",i="firstDayOfWeek",Am="hd",Ad="headerNode",Q="helper",y="icon",N="iconNextNode",AZ="iconPrevNode",Ak="locale",I="month",P="name",w="nav",s="navNode",R="next",F="nextDate",Ac="prev",AS="prevDate",Al="rendered",r="scheduler",AV="srcNode",Aj="startDate",j="strings",AX="template",H="today",AK="todayNode",b="triggerNode",e="view",An="views",AD="viewsNode",u="week",X="year",AY="navigationDateFormat",t="eventRecorder",f=AJ.ClassNameManager.getClassName,AL=f(Q,Af),M=f(y),AW=f(W,l),z=f(W,AU,AQ),K=f(W,Am),AB=f(W,y,R),h=f(W,y,Ac),Ai=f(W,w),d=f(W,H),AF=f(W,e),V=f(W,An),J=f(W,e,T),Z=f(W,e,Aa),B=f(W,e,I),D=f(W,e,u),AN=f(W,e,X),k=f(r,e,T),AT='<div class="'+AW+'"></div>',c='<div class="'+z+'"></div>',E='<div class="'+K+'"></div>',Ao='<a href="#" class="'+[M,AB].join(U)+'">Next</a>',AM='<a href="#" class="'+[M,h].join(U)+'">Prev</a>',O='<div class="'+Ai+'"></div>',x='<a href="#" class="'+d+'">{today}</a>',Ab='<a href="#" class="'+[AF,J].join(U)+'{name}" data-view-name="{name}">{label}</a>',p='<div class="'+V+'"></div>';var q=function(){};q.ATTRS={events:{value:[],setter:"_setEvents",validator:C}};AJ.mix(q.prototype,{addEvent:function(Ap){var A=this;var Aq=A.get(Ah);if(AJ.Array.indexOf(Aq,Ap)>-1){AJ.Array.removeItem(Aq,Ap);}Aq.push(Ap);A.set(Ah,Aq);},addEvents:function(Ap){var A=this;AJ.Array.each(A._normalizeEvents(Ap),AJ.bind(A.addEvent,A));},removeEvent:function(Ap){var A=this;var Aq=A.get(Ah);AJ.Array.removeItem(Aq,Ap);A.set(Ah,Aq);},removeEvents:function(Ap){var A=this;AJ.Array.each(A._normalizeEvents(Ap),AJ.bind(A.removeEvent,A));},_normalizeEvents:function(Aq){var A=this;var Ap=[];Aq=AJ.Array(Aq);AJ.Array.each(Aq,function(Ar,As){if(AG(Ar)){Ap.push(Ar);}else{if(a(Ar)){Ap=Ap.concat(A._normalizeEvents(Ar.get(Ah)));}else{Ap.push(new AJ.SchedulerEvent(Ar));}}});return Ap;},_setEvents:function(Ap){var A=this;return A._normalizeEvents(Ap);}});AJ.SchedulerEventSupport=q;var n=AJ.Component.create({NAME:W,ATTRS:{activeView:{validator:Y},eventRecorder:{setter:"_setEventRecorder"},strings:{value:{day:"Day",month:"Month",today:"Today",week:"Week",year:"Year"}},navigationDateFormat:{getter:function(Aq){var A=this;var Ap=A.get(m);if(Ap){return Ap.get(AY);}return Aq;},value:"%A - %d %b %Y",validator:Ag},views:{setter:"_setViews",value:[]},currentDate:{valueFn:function(){return new Date();},validator:G},firstDayOfWeek:{value:0,validator:o},controlsNode:{valueFn:function(){return AJ.Node.create(AT);}},currentDateNode:{valueFn:function(){return AJ.Node.create(c);}},headerNode:{valueFn:function(){return AJ.Node.create(E);}},iconNextNode:{valueFn:function(){return AJ.Node.create(Ao);}},iconPrevNode:{valueFn:function(){return AJ.Node.create(AM);}},navNode:{valueFn:function(){return AJ.Node.create(O);}},todayNode:{valueFn:function(){return AJ.Node.create(this._processTemplate(x));}},viewsNode:{valueFn:function(){return AJ.Node.create(p);}}},HTML_PARSER:{controlsNode:AA+AW,currentDateNode:AA+z,headerNode:AA+K,iconNextNode:AA+AB,iconPrevNode:AA+h,navNode:AA+Ai,todayNode:AA+d,viewsNode:AA+V},UI_ATTRS:[AI],AUGMENTS:[AJ.SchedulerEventSupport,AJ.WidgetStdMod],prototype:{viewStack:null,initializer:function(){var A=this;A.viewStack={};A.controlsNode=A.get(AR);A.currentDateNode=A.get(AE);A.iconNextNode=A.get(N);A.iconPrevNode=A.get(AZ);A.navNode=A.get(s);A.schedulerHeaderNode=A.get(Ad);A.todayNode=A.get(AK);A.viewsNode=A.get(AD);A.after({render:A._afterRender,activeViewChange:A._afterActiveViewChange});},bindUI:function(){var A=this;A._bindDelegate();},syncUI:function(){var A=this;A.syncStdContent();},flushEvents:function(){var A=this;AJ.Array.each(A.get(Ah),function(Ap,Aq){Ap.eachRepeatedEvent(function(As,Ar){delete As._filtered;});delete Ap._filtered;});},getEventsByDay:function(Ap){var A=this;Ap=L.safeClearTime(Ap);return A._getEvents(Ap,function(Aq){return L.compare(Aq.getClearStartDate(),Ap);});},getIntersectEvents:function(Ap){var A=this;Ap=L.safeClearTime(Ap);return A._getEvents(Ap,function(Ar){var Aq=Ar.getClearStartDate();var As=Ar.getClearEndDate();return(L.compare(Ap,Aq)||L.compare(Ap,As)||L.between(Ap,Aq,As));});},sortEventsByDateAsc:function(Ap){var A=this;Ap.sort(function(At,Ar){var As=At.get(AO);var Aq=Ar.get(AO);var Av=At.get(Aj);var Au=Ar.get(Aj);if(L.after(Av,Au)||L.compare(Av,Au)&&L.before(As,Aq)){return 1;}else{return -1;}});},getViewByName:function(Ap){var A=this;return A.viewStack[Ap];},getStrings:function(){var A=this;return A.get(j);},getString:function(Ap){var A=this;return A.getStrings()[Ap];},renderView:function(Ap){var A=this;if(Ap){Ap.show();if(!Ap.get(Al)){var Aq=Ap.get(P);if(!A.bodyNode){A.setStdModContent(AC.BODY,T);}Ap.render(A.bodyNode);}}},plotViewEvents:function(Ap){var A=this;Ap.plotEvents(A.get(Ah));},syncEventsUI:function(){var A=this;A.plotViewEvents(A.get(m));},_afterActiveViewChange:function(Ar){var Ap=this;if(Ap.get(Al)){var Aq=Ar.newVal;var A=Ar.prevVal;if(A){A.hide();}Ap.renderView(Aq);}},_afterRender:function(Ap){var A=this;A.renderView(A.get(m));},_bindDelegate:function(){var A=this;A.viewsNode.delegate("click",A._onClickViewTrigger,AA+AF,A);A.controlsNode.delegate("click",A._onClickPrevIcon,AA+h,A);A.controlsNode.delegate("click",A._onClickNextIcon,AA+AB,A);A.controlsNode.delegate("click",A._onClickToday,AA+d,A);},_createViewTriggerNode:function(Ap){var A=this;if(!Ap.get(b)){var Aq=Ap.get(P);Ap.set(b,AJ.Node.create(AJ.substitute(Ab,{name:Aq,label:(A.getString(Aq)||Aq)})));}return Ap.get(b);},_getEvents:function(Ap,Ar){var A=this;
var Aq=A.get(Ah);var As=[];AJ.Array.each(Aq,function(At,Au){if(Ar.apply(A,[At])){As.push(At);}else{if(At.isRepeatableDate(Ap)){var Av=At.repeatByDate(Ap);As.push(Av);}}});A.sortEventsByDateAsc(As);return As;},_onClickToday:function(Ap){var A=this;A.set(AI,A.get(m).getToday());Ap.preventDefault();},_onClickNextIcon:function(Ap){var A=this;A.set(AI,A.get(m).get(F));Ap.preventDefault();},_onClickPrevIcon:function(Ap){var A=this;A.set(AI,A.get(m).get(AS));Ap.preventDefault();},_onClickViewTrigger:function(Aq){var A=this;var Ar=Aq.currentTarget;var As=Ar.attr(AP);var Ap=A.getViewByName(As);A.set(m,Ap);Aq.preventDefault();},_processTemplate:function(Ap){var A=this;return AJ.substitute(Ap,A.getStrings());},_setEventRecorder:function(Ap){var A=this;if(Ap){Ap.set(r,A);}},_setViews:function(Aq){var A=this;var Ap=[];AJ.Array.each(Aq,function(Ar){if(Y(Ar)&&!Ar.get(Al)){Ar.set(r,A);Ap.push(Ar);A.viewStack[Ar.get(P)]=Ar;}});if(!A.get(m)){A.set(m,Aq[0]);}return Ap;},syncStdContent:function(){var A=this;var Ap=A.get(An);A.navNode.append(A.iconPrevNode);A.navNode.append(A.iconNextNode);A.controlsNode.append(A.todayNode);A.controlsNode.append(A.navNode);A.controlsNode.append(A.currentDateNode);AJ.Array.each(Ap,function(Aq){A.viewsNode.append(A._createViewTriggerNode(Aq));});A.schedulerHeaderNode.append(A.controlsNode);A.schedulerHeaderNode.append(A.viewsNode);A.schedulerHeaderNode.addClass(AL);A.setStdModContent(AC.HEADER,A.schedulerHeaderNode.getDOM());},_uiSetCurrentDate:function(At){var Aq=this;var Ap=Aq.get(AY);var A=Aq.get(Ak);var As=AJ.DataType.Date.format(At,{format:Ap,locale:A});Aq.currentDateNode.html(As);if(Aq.get(Al)){var Ar=Aq.get(m);if(Ar){Ar._uiSetCurrentDate(At);}Aq.syncEventsUI();}}}});AJ.Scheduler=n;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-view","datasource"]});