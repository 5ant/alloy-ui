AUI.add("aui-scheduler-event-recorder",function(x){var aq=x.Lang,F=aq.isArray,R=aq.isObject,p=aq.isString,B=aq.isUndefined,ag=x.IO.prototype._serialize,o=x.DataType.DateMath,I="-",D=".",d=" ",Q="scheduler-event",ao="scheduler-event-recorder",e="activeView",M="arrow",Z="body",u="bodyContent",K="bottom",ah="boundingBox",O="cancel",W="click",t="constrain",S="content",r="date",Y="dateFormat",s="delete",an="endDate",h="event",k="footerContent",c="form",L="header",af="isoTime",ap="node",T="offsetHeight",X="offsetWidth",C="overlay",ak="overlayOffset",am="recorder",ae="rendered",al="right",V="save",G="scheduler",ad="schedulerChange",q="shadow",aj="startDate",a="strings",f="submit",j="template",P="title",ac="toolbar",ab="visibleChange",n=x.getClassName,E=n(Q),aa=n(Q,P),w=n(Q,am),v=n(G,h,am,C),b=n(G,h,am,C,M),l=n(G,h,am,C,M,K),J=n(G,h,am,C,M,al),U=n(G,h,am,C,M,q),N=n(G,h,am,C,Z),H=n(G,h,am,C,S),m=n(G,h,am,C,r),ai=n(G,h,am,C,c),z=n(G,h,am,C,L),y=new x.Template('<div class="',U," ",b,'"></div>','<div class="',b,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',z,'">','<input class="',H,'" name="content" value="{content}" />',"</div>",'<div class="',N,'">','<label class="',m,'">{date}</label>',"</div>"),i='<form class="'+ai+'" id="schedulerEventRecorderForm"></form>';var g=x.Component.create({NAME:ao,ATTRS:{allDay:{value:false},content:{},duration:{value:60},dateFormat:{validator:p,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return x.SchedulerEvent;}},strings:{value:{},setter:function(A){return x.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's",cancel:"Cancel",description:"Description",edit:"Edit",save:"Save",when:"When"},A||{});},validator:R},overlay:{validator:R,value:{constrain:null,visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:F},template:{value:y},toolbar:{setter:function(at){var ar=this;var A=ar.get(a);return x.merge({children:[{handler:x.bind(ar._handleSaveEvent,ar),label:A[V]},{handler:x.bind(ar._handleCancelEvent,ar),label:A[O]},{handler:x.bind(ar._handleDeleteEvent,ar),label:A[s]}]},at||{});},validator:R,value:{}}},EXTENDS:x.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(ap).addClass(w);A.publish("cancel",{defaultFn:A._defCancelEventFn});A.publish("delete",{defaultFn:A._defDeleteEventFn});A.publish("edit",{defaultFn:A._defEditEventFn});A.publish("save",{defaultFn:A._defSaveEventFn});A.after(ad,A._afterSchedulerChange);A[C]=new x.Overlay(A.get(C));A[ac]=new x.Toolbar(A.get(ac));},getOverlayContentNode:function(){var A=this;var ar=A[C].get(ah);return ar.one(D+H);},getUpdatedSchedulerEvent:function(at){var A=this,au=A.get(h),ar={silent:!au},av=A.serializeForm();if(!au){au=A.clone();}au.set(G,A.get(G),{silent:true});au.setAttrs(x.merge(av,at),ar);return au;},_afterSchedulerChange:function(au){var A=this;var at=au.newVal;var ar=at.get(ah);A[C].set(t,ar);ar.delegate(W,x.bind(A._onClickSchedulerEvent,A),D+E);},_defCancelEventFn:function(ar){var A=this;A.get(ap).remove();A.hideOverlay();},_defDeleteEventFn:function(at){var A=this;var ar=A.get(G);ar.removeEvents(A.get(h));A.hideOverlay();ar.syncEventsUI();},_defEditEventFn:function(at){var A=this;var ar=A.get(G);A.hideOverlay();ar.syncEventsUI();},_defSaveEventFn:function(at){var A=this;var ar=A.get(G);ar.addEvents(at.newSchedulerEvent);A.hideOverlay();ar.syncEventsUI();},_handleCancelEvent:function(ar){var A=this;A.fire("cancel");ar.preventDefault();},_handleDeleteEvent:function(ar){var A=this;A.fire("delete",{schedulerEvent:A.get(h)});ar.preventDefault();},_handleSaveEvent:function(at){var A=this,ar=A.get(h)?"edit":"save";A.fire(ar,{newSchedulerEvent:A.getUpdatedSchedulerEvent()});at.preventDefault();},_onClickSchedulerEvent:function(at){var A=this;var ar=at.currentTarget.getData(Q);if(ar){A.set(h,ar,{silent:true});A.showOverlay([at.pageX,at.pageY]);A.get(ap).remove();}},_onOverlayVisibleChange:function(ar){var A=this;if(ar.newVal){A.populateForm();if(!A.get(h)){var at=A.getOverlayContentNode();if(at){setTimeout(function(){at.selectText();},0);}}}else{A.set(h,null,{silent:true});A.get(ap).remove();}},_onSubmitForm:function(ar){var A=this;A._handleSaveEvent(ar);},_renderOverlay:function(){var ar=this;var A=ar.get(a);ar[C].render();ar[ac].render();var at=ar[C].get(ah);at.addClass(v);ar[C].set(k,ar[ac].get(ah));ar[C].on(ab,x.bind(ar._onOverlayVisibleChange,ar));ar.formNode=x.Node.create(i);ar[C].set(u,ar.formNode);ar.formNode.on(f,x.bind(ar._onSubmitForm,ar));},getFormattedDate:function(){var at=this;var ar=at.get(Y);var av=(at.get(h)||at);var ax=av.get(an);var aw=av.get(G);var A=av.get(aj);var au=(aw.get(e).get(af)?o.toIsoTimeString:o.toUsTimeString);return[av._formatDate(A,ar),au(A),I,au(ax)].join(d);},getTemplateData:function(){var ar=this,A=ar.get(a),at=ar.get(h)||ar,au=at.get(S);if(B(au)){au=A["description-hint"];}return{content:au,date:ar.getFormattedDate(),endDate:at.get(an).getTime(),startDate:at.get(aj).getTime()};},hideOverlay:function(){var A=this;A[C].hide();},populateForm:function(){var A=this;A.formNode.setContent(A.get(j).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return x.QueryString.parse(ag(A.formNode.getDOM()));},showOverlay:function(aC,at){var aB=this,az=aB[C].get(t),au=aB.get(ak),ax=aC.concat([]);if(!aB[C].get(ae)){aB._renderOverlay();}aB[C].show();if(!aC){var ay=(aB.get(h)||aB).get(ap);var ar=ay.one(D+aa);at=[au[0]+ar.get(X),au[1]+ar.get(T)/2];aC=ar.getXY();}at=at||au;aC[0]+=at[0];aC[1]+=at[1];var A=aB[C].get(ah),aw=A.get(X),av=A.one(D+z),aA=A.all(D+b);if((aC[0]+aw)>=az.get(X)){aA.addClass(J);aC[0]-=aw+aA.item(0).get(X);}aB[C].set("xy",aC);if(ax[1]>=(av.get(T)+av.getY())){aA.addClass(l);}else{aA.removeClass(l);}}}});x.SchedulerEventRecorder=g;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-base","aui-template","aui-toolbar","io-form","querystring","overlay"]});