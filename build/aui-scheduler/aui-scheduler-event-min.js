AUI.add("aui-scheduler-event",function(az){var af=az.Lang,a2=af.isString,g=af.isDate,aS=af.isFunction,D=af.isObject,aW=af.isBoolean,V=af.isNumber,aK=az.ColorUtil,j=az.DataType.DateMath,aP=az.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),ar=":",bg="-",h=".",W="",bi="&ndash;",bf=" ",C="_",N="activeView",t="all",G="allDay",P="borderColor",aA="borderColorRGB",ax="borderStyle",a8="borderWidth",F="Change",aN="color",aI="colorBrightnessFactor",aX="colorSaturationFactor",av="content",aV="day",r="disabled",aB="endDate",aE="eventClass",ak="hidden",E="hsbColor",aj="icon",T="icons",ab="inherit",aJ="isoTime",a7="locale",aL="never",m="node",i="overlay",be="recorder",a1="repeated",aU="repeater",Y="scheduler",al="scheduler-event",an="scheduler-event-recorder",a="short",a4="startDate",aQ="template",aH="title",f="titleDateFormat",ah="visible",e="%H:%M",H="%l",bb="%M",ag=function(A){var L=[H];if(A.getMinutes()>0){L.push(ar);L.push(bb);}if(A.getHours()>=12){L.push("p");}return L.join(W);},B=az.getClassName,k=B(aj),p=B(al),z=B(al,t,aV),aC=B(al,av),x=B(al,ak),aZ=B(al,r),ai=B(al,be),aq=B(al,a1),ad=B(al,aU),ae=B(al,a),y=B(al,aH),a6=B(al,T),q=B(al,aj,r),c=B(al,aj,a1),ba=B(al,aj,aU);var R=az.Component.create({NAME:al,ATTRS:{allDay:{setter:az.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:a2},borderWidth:{value:"1px",validator:a2},colorBrightnessFactor:{value:0.75,validator:V},colorSaturationFactor:{value:1.5,validator:V},content:{value:"(no title)",validator:a2},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:a2},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this,L=A.get(Y),bl=L&&L.get(N).get(aJ),bm={endDate:bi+bf+e,startDate:e};if(!bl){bm.endDate=bi+bf+ag(A.get(aB));bm.startDate=ag(A.get(a4));}if(A.getMinutesDuration()<=30){delete bm.endDate;}else{if(A.get(G)){bm={};}}return bm;}},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(a4));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return az.SchedulerEvent;}},disabled:{value:false,validator:aW},node:{valueFn:function(){return az.NodeList.create(az.Node.create(this.EVENT_NODE_TEMPLATE).setData(al,this));}},repeated:{value:false,validator:aW},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:aW}},EXTENDS:az.Base,PROPAGATE_ATTRS:[a4,aB,av,aN,aI,aX,ax,a8,f,ah,r],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+p+'">'+'<div class="'+y+'"></div>'+'<div class="'+aC+'"></div>'+'<div class="'+a6+'">'+'<span class="'+[k,c].join(bf)+'"></span>'+'<span class="'+[k,ba].join(bf)+'"></span>'+'<span class="'+[k,q].join(bf)+'"></span>'+"</div>"+"</div>",initializer:function(){var A=this;var L=A.get(m);A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.get(m).remove(true);},addPaddingNode:function(){var A=this;A.get(m).push(az.Node.create(A.EVENT_NODE_TEMPLATE).setData(al,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aB,j.clone(L.get(aB)));A.set(a4,j.clone(L.get(a4)));},copyPropagateAttrValues:function(L,bl){var A=this;A.copyDates(L);az.Array.each(A.get(aE).PROPAGATE_ATTRS,function(bm){if(!((bl||{}).hasOwnProperty(bm))){var bn=L.get(bm);if(!D(bn)){A.set(bm,bn);}}});},getBorderColor:function(){var A=this;return A[aA].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aB),A.get(a4));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aB),A.get(a4));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aB),A.get(a4));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aB),A.get(a4));},sameEndDate:function(L){var A=this;return j.compare(A.get(aB),L.get(aB));},sameStartDate:function(L){var A=this;return j.compare(A.get(a4),L.get(a4));},isAfter:function(bm){var bl=this;var L=bl.get(a4);var A=bm.get(a4);return j.after(L,A);},isBefore:function(bm){var bl=this;var L=bl.get(a4);var A=bm.get(a4);return j.before(L,A);},intersects:function(bm){var bl=this;var bn=bl.get(aB);var L=bl.get(a4);var A=bm.get(a4);return(bl.sameStartDate(bm)||j.between(A,L,bn));},intersectHours:function(bl){var L=this;var bn=L.get(aB);var A=L.get(a4);var bm=j.clone(A);j.copyHours(bm,bl.get(a4));return(j.compare(A,bm)||j.between(bm,A,bn));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(a4),A.get(aB));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(a4),A.get(aB));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aB));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(a4));},move:function(L){var A=this;var bl=A.getMinutesDuration();A.set(a4,L);A.set(aB,j.add(j.clone(L),j.MINUTES,bl));},setContent:function(L){var A=this;A.get(m).each(function(bm){var bl=bm.one(h+aC);bl.setContent(L);});},setTitle:function(L){var A=this;A.get(m).each(function(bl){var bm=bl.one(h+y);bm.setContent(L);});},syncNodeUI:function(){var A=this;A._syncUIAttrs();A.syncNodeColorUI();A.syncNodeTitleUI();A.syncNodeContentUI();},syncNodeColorUI:function(){var A=this;var bl=A.get(m);var bm=A.getBorderColor();if(bl){var L={borderWidth:A.get(a8),borderColor:bm,backgroundColor:A.get(aN),borderStyle:A.get(ax),color:ab};bl.setStyles(L);}},syncNodeContentUI:function(){var A=this;A.setContent(A.get(av));},syncNodeTitleUI:function(){var L=this,bm=L.get(f),A=L.get(a4),bl=L.get(aB),bn=[];if(bm.startDate){bn.push(L._formatDate(A,bm.startDate));}if(bm.endDate){bn.push(L._formatDate(bl,bm.endDate));}L.setTitle(bn.join(bf));},split:function(){var A=this,bl=j.clone(A.get(a4)),bm=j.clone(A.get(aB));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(bl);L.setHours(24,0,0,0);return[[bl,j.toMidnight(j.clone(bl))],[L,j.clone(bm)]];}return[[bl,bm]];},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);
},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatedChange:function(L){var A=this;A._uiSetRepeated(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,repeatedChange:A._afterRepeatedChange,visibleChange:A._afterVisibleChange});A._syncUIAttrs();},_setColor:function(L){var A=this;A[E]=aK.rgb2hsb(aK.getRGB(L));A[P]=az.clone(A[E]);A[P].b*=A.get(aI);A[P].s*=A.get(aX);A[aA]=aK.hsb2rgb(A[P]);return L;},_setDate:function(L){var A=this;if(V(L)){L=new Date(L);}return L;},_setScheduler:function(bl){var A=this;var L=A.get(Y);if(L){A.removeTarget(L);}A.addTarget(bl);return bl;},_syncUIAttrs:function(){var A=this;A._uiSetAllDay(A.get(G));A._uiSetDisabled(A.get(r));A._uiSetEndDate(A.get(aB));A._uiSetVisible(A.get(ah));A._uiSetRepeated(A.get(a1));},_formatDate:function(bl,bm){var L=this;var A=L.get(a7);return az.DataType.Date.format(bl,{format:bm,locale:A});},_getTitleDateFormat:function(L){var A=this;if(a2(L)){L={endDate:L,startDate:L};}else{if(aS(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(m).toggleClass(z,!!L);},_uiSetDisabled:function(L){var A=this;A.get(m).toggleClass(aZ,!!L);},_uiSetEndDate:function(L){var A=this;A.get(m).toggleClass(ae,A.getMinutesDuration()<=30);},_uiSetRepeated:function(L){var A=this;A.get(m).toggleClass(aq,!!L);},_uiSetVisible:function(L){var A=this;A.get(m).toggleClass(x,!L);}}});az.SchedulerEvent=R;var am=az.Lang,b=am.isArray,d="arrow",aG="body",ap="bodyContent",n="boundingBox",ao="cancel",aM="click",aF="date",aw="dateFormat",ac="delete",aT="description",bd="event",w="footerContent",au="form",v="header",M="offsetHeight",a0="offsetWidth",O="overlayOffset",a1="repeated",a9="rendered",aO="save",l="schedulerChange",at="shadow",K="strings",bc="tl",U="toolbar",a3="submit",a5="value",aD="visibleChange",X="cancel",J="delete",u="edit",ay="save",o=az.IO.prototype._serialize,bh=B(Y,bd,be,i),s=B(Y,bd,be,i,d),aY=B(Y,bd,be,i,d,at),aa=B(Y,bd,be,i,aG),aR=B(Y,bd,be,i,av),Z=B(Y,bd,be,i,aF),Q=B(Y,bd,be,i,au),bk=B(Y,bd,be,i,v),I=new az.Template('<div class="',aY," ",s,'"></div>','<div class="',s,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bk,'">','<input class="',aR,'" name="content" value="{content}" />',"</div>",'<div class="',aa,'">','<label class="',Z,'">{date}</label>',"</div>"),bj='<form class="'+Q+'" id="schedulerEventRecorderForm"></form>';var S=az.Component.create({NAME:an,ATTRS:{allDay:{value:false},content:{value:W},duration:{value:60},dateFormat:{validator:a2,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return az.SchedulerEvent;}},strings:{value:{},setter:function(A){return az.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's",cancel:"Cancel",description:"Description",edit:"Edit",save:"Save",when:"When"},A||{});},validator:D},overlay:{validator:D,value:{align:{points:[bc,bc]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:b},template:{value:I},toolbar:{setter:function(bl){var L=this;var A=L.get(K);return az.merge({children:[{handler:az.bind(L._handleSaveEvent,L),label:A[aO]},{handler:az.bind(L._handleCancelEvent,L),label:A[ao]},{handler:az.bind(L._handleDeleteEvent,L),label:A[ac]}]},bl||{});},validator:D,value:{}}},EXTENDS:az.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(m).addClass(ai);A.publish(X,{defaultFn:A._defCancelEventFn});A.publish(J,{defaultFn:A._defDeleteEventFn});A.publish(u,{defaultFn:A._defEditEventFn});A.publish(ay,{defaultFn:A._defSaveEventFn});A.after(l,A._afterSchedulerChange);A[i]=new az.Overlay(A.get(i));A[U]=new az.Toolbar(A.get(U));},_afterSchedulerChange:function(bm){var A=this;var bl=bm.newVal;var L=bl.get(n);L.delegate(aM,az.bind(A._onClickSchedulerEvent,A),h+p);},_defCancelEventFn:function(L){var A=this;A.get(m).remove();A.hideOverlay();},_defDeleteEventFn:function(bl){var A=this;var L=A.get(Y);L.removeEvent(A.get(bd));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(bl){var A=this;var L=A.get(Y);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(bl){var A=this;var L=A.get(Y);L.addEvent(bl.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(X);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(J,{schedulerEvent:A.get(bd)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bd)?u:ay,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(bl){var A=this;var L=bl.currentTarget.getData(al);if(L){A.set(bd,L);A.showOverlay([bl.pageX,bl.pageY]);A.get(m).remove();}},_onOverlayVisibleChange:function(bm){var L=this;if(bm.newVal){L.populateForm();if(!L.get(bd)){var bl=L[i].get(n);var A=bl.one(h+aR);setTimeout(function(){A.selectText();},0);}}else{L.set(bd,null);L.get(m).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(K);L[i].render();L[U].render();var bl=L[i].get(n);bl.addClass(bh);L[i].set(w,L[U].get(n));L[i].on(aD,az.bind(L._onOverlayVisibleChange,L));L.formNode=az.Node.create(bj);L[i].set(ap,L.formNode);L.formNode.on(a3,az.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var bl=A.get(bd);if(!bl){bl=new (A.get(aE))({allDay:A.get(G),endDate:A.get(aB),scheduler:A.get(Y),startDate:A.get(a4)});bl.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();bl.set(av,L[av]);bl.set(a1,L[a1]);return bl;},getFormattedDate:function(){var bl=this;var L=bl.get(aw);var bn=(bl.get(bd)||bl);var bp=bn.get(aB);var bo=bn.get(Y);var A=bn.get(a4);var bm=(bo.get(N).get(aJ)?j.toIsoTimeString:j.toUsTimeString);return[bn._formatDate(A,L),bm(A),bg,bm(bp)].join(bf);},getTemplateData:function(){var L=this;var A=L.get(K);var bl=(L.get(bd)||L);return{content:bl.get(av)||A["description-hint"],date:L.getFormattedDate(),endDate:bl.get(aB).getTime(),repeated:bl.get(a1),startDate:bl.get(a4).getTime()};
},hideOverlay:function(){var A=this;A[i].hide();},populateForm:function(){var A=this;A.formNode.setContent(A.get(aQ).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return az.QueryString.parse(o(A.formNode.getDOM()));},showOverlay:function(bm,bo){var A=this;var bl=A.get(O);if(!A[i].get(a9)){A._renderOverlay();}A[i].show();if(!bm){var L=(A.get(bd)||A).get(m);var bn=L.one(h+y);bo=[bl[0]+bn.get(a0),bl[1]+bn.get(M)/2];bm=bn.getXY();}bo=bo||bl;bm[0]+=bo[0];bm[1]+=bo[1];A[i].set("xy",bm);}}});az.SchedulerEventRecorder=S;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});