AUI.add("aui-scheduler-event",function(AV){var AG=AV.Lang,A6=AG.isString,I=AG.isDate,Aw=AG.isFunction,l=AG.isObject,Ay=AG.isBoolean,v=AG.isNumber,An=AV.ColorUtil,O=AV.DataType.DateMath,At=AV.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),A3="-",AL=".",U="",V=" ",R="_",Aa="_propagateSet",q="activeView",BF="borderWidth",Aj="colorBrightnessFactor",A1="colorSaturationFactor",m="Change",As="color",AR="content",AB="contentNode",Ap="duration",Ad="endDate",A7="events",Ar="id",Al="isoTime",BE="locale",S="node",L="overlay",AX="parentEvent",BH="recorder",Ab="repeat",A5="repeated",p="repeatedEvents",AA="scheduler",AJ="scheduler-event",AK="scheduler-event-recorder",A9="startDate",Av="template",Ai="title",H="titleDateFormat",j="titleNode",AT="borderStyle",G="%H:%M",Au="%I:%M",h=AV.ClassNameManager.getClassName,W=h(AJ),AH=h(AJ,BH),Ae=h(AJ,AR),AN=h(AJ,A5),e=h(AJ,Ai),AY='<div class="'+W+'">'+'<div class="'+e+'"></div>'+'<div class="'+Ae+'"></div>'+"</div>";var r=AV.Component.create({NAME:AJ,ATTRS:{borderStyle:{value:"solid",validator:A6},borderWidth:{value:"1px",validator:A6},colorBrightnessFactor:{value:0.75,validator:v},colorSaturationFactor:{value:1.5,validator:v},content:{value:"(no title)",validator:A6},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:A6},titleDateFormat:{getter:"_getTitleDateFormat",validator:A6},endDate:{valueFn:function(){var A=O.clone(this.get(A9));A.setHours(A.getHours()+1);return A;},validator:I},columnNode:{setter:AV.one},node:{valueFn:function(){return AV.Node.create(AY).setData(AJ,this);},setter:AV.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:I}},EXTENDS:AV.Base,PROPAGATE_ATTRS:[A9,Ad,AR,As,Aj,A1,AT,BF,H],prototype:{eventStack:null,initializer:function(){var A=this;var BC=A.get(S);A.eventStack={};A.nodeStack={};AV.Array.each(AV.SchedulerEvent.PROPAGATE_ATTRS,function(BD){A.after(BD+m,A._propagateAttrChange);});A.contentNode=BC.one(AL+Ae);A.titleNode=BC.one(AL+e);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(BC,BD){BC.destroy();});A.eventStack={};A.get(S).remove(true);},copyDates:function(BC){var A=this;A.set(Ad,O.clone(BC.get(Ad)));A.set(A9,O.clone(BC.get(A9)));},copyPropagateAttrValues:function(BC,BD){var A=this;A.copyDates(BC);AV.Array.each(AV.SchedulerEvent.PROPAGATE_ATTRS,function(BK){if(!(BK in (BD||{}))){var BL=BC.get(BK);if(!l(BL)){A.set(BK,BL);}}});},getBorderColor:function(){var A=this;return A.borderColorRGB.hex;},getDaysDuration:function(){var A=this;return O.getDayOffset(A.get(Ad),A.get(A9));},getHoursDuration:function(){var A=this;return O.getHoursOffset(A.get(Ad),A.get(A9));},getMinutesDuration:function(){var A=this;return O.getMinutesOffset(A.get(Ad),A.get(A9));},getSecondsDuration:function(){var A=this;return O.getSecondsOffset(A.get(Ad),A.get(A9));},sameEndDate:function(BC){var A=this;return O.compare(A.get(Ad),BC.get(Ad));},sameStartDate:function(BC){var A=this;return O.compare(A.get(A9),BC.get(A9));},isAfter:function(BK){var BD=this;var BC=BD.get(A9);var A=BK.get(A9);return O.after(BC,A);},isBefore:function(BK){var BD=this;var BC=BD.get(A9);var A=BK.get(A9);return O.before(BC,A);},repeatByDate:function(BD){var A=this;var BK=A.uidByDate(BD);if(!A.eventStack[BK]){var BC=O.clone(BD);var BL=O.clone(BD);O.copyHours(BC,A.get(A9));O.copyHours(BL,A.get(Ad));var BM=new AV.SchedulerEvent({endDate:BL,parentEvent:A,scheduler:A.get(AA),startDate:BC});BM.copyPropagateAttrValues(A);A.eventStack[BK]=BM;}return A.eventStack[BK];},intersects:function(BK){var BD=this;var BL=BD.get(Ad);var BC=BD.get(A9);var A=BK.get(A9);return(BD.sameStartDate(BK)||O.between(A,BC,BL));},intersectHours:function(BD){var BC=this;var BL=BC.get(Ad);var A=BC.get(A9);var BK=O.clone(A);O.copyHours(BK,BD.get(A9));return(O.compare(A,BK)||O.between(BK,A,BL));},isDayOverlapEvent:function(){var A=this;return O.isDayOverlap(A.get(A9),A.get(Ad));},isRepeatableDate:function(BC){var A=this;var BD=A.get(Ab);return(BD&&BD.validate(A,BC));},getClearEndDate:function(){var A=this;return O.safeClearTime(A.get(Ad));},getClearStartDate:function(){var A=this;return O.safeClearTime(A.get(A9));},uidByDate:function(BC){var A=this;BC=I(BC)?O.safeClearTime(BC):A.getClearStartDate();return[AJ,BC.getTime()].join(R);},setContent:function(BD,BC){var A=this;A._setContent(AB,BD,BC);},setTitle:function(BD,BC){var A=this;A._setContent(j,BD,BC);},syncNodeUI:function(BC){var A=this;A.get(S).toggleClass(AN,!!(A.get(AX)));A.syncNodeColorUI(BC);A.syncNodeTitleUI(BC);A.syncNodeContentUI(BC);},syncNodeColorUI:function(BC){var A=this;var BD=A.get(S);var BK=A.getBorderColor();if(BD){BD.setStyles({borderWidth:A.get(BF),borderColor:BK,backgroundColor:A.get(As),borderStyle:A.get(AT)});}if(A.titleNode){A.titleNode.setStyles({backgroundColor:BK});}if(BC){A.eachRepeatedEvent(function(BL,BM){BL.syncNodeColorUI();});}},syncNodeContentUI:function(BC){var A=this;A.setContent(A.get(AR),BC);},syncNodeTitleUI:function(BC){var A=this;var BD=A._formatDate(A.get(A9));var BK=A._formatDate(A.get(Ad));A.setTitle([BD,BK].join(V+A3+V),BC);},eachRepeatedEvent:function(BC){var A=this;AV.each(A.eventStack,BC,A);},unlink:function(){var A=this;if(A.get(AX)){A.set(AX,null);}else{A.eachRepeatedEvent(function(BC,BD){BC.unlink();});}A.eventStack={};A.syncNodeUI();},_propagateAttrChange:function(BK){var A=this;var BD=BK.attrName;var BC=BK.newVal;A.eachRepeatedEvent(function(BL,BM){var BN=BL[Aa+At(BD)];if(BN){BN.apply(A,[BL,BD,BC]);}else{BL.set(BD,BK.newVal);}BL.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,BC,BK){var BD=O.clone(A.get(Ad));O.copyHours(BD,BK);A.set(Ad,BD);},_propagateSetStartDate:function(BC,BD,BK){var A=O.clone(BC.get(A9));O.copyHours(A,BK);BC.set(A9,A);},_setColor:function(BC){var A=this;A.hsbColor=An.rgb2hsb(An.getRGB(BC));A.borderColor=AV.clone(A.hsbColor);A.borderColor.b*=A.get(Aj);A.borderColor.s*=A.get(A1);A.borderColorRGB=An.hsb2rgb(A.borderColor);
return BC;},_setContent:function(BD,BL,BC){var A=this;var BK=A[BD];if(BK){BK.setContent(BL);}if(BC){A.eachRepeatedEvent(function(BM,BN){BM[BD].setContent(BL);});}},_setRepeat:function(BC){var A=this;if(A6(BC)){BC=AV.SchedulerEventRepeat[BC];}return BC;},_setScheduler:function(BD){var A=this;var BC=A.get(AA);if(BC){A.removeTarget(BC);}A.addTarget(BD);return BD;},_formatDate:function(BD,BK){var BC=this;var A=BC.get(BE);BK=BK||BC.get(H);return AV.DataType.Date.format(BD,{format:BK,locale:A});},_getTitleDateFormat:function(BD){var A=this;if(!A6(BD)){var BC=A.get(AA);BD=(BC&&BC.get(q).get(Al))?G:Au;}return BD;}}});AV.SchedulerEvent=r;AV.SchedulerEventRepeat={dayly:{description:"Every day",validate:function(A,BC){return true;},value:"dayly"},monthly:{description:"Every month",validate:function(BC,BD){var BK=BC.get(Ad);var A=BC.get(A9);return(A.getDate()===BD.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,BC){return O.isMonWedOrFri(BC);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,BC){return O.isTueOrThu(BC);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,BC){return O.isWeekDay(BC);},value:"weekDays"},weekly:{description:"Every week",validate:function(BC,BD){var BK=BC.get(Ad);var A=BC.get(A9);return(A.getDay()===BC.getDay());},value:"weekly"}};var q="activeView",BB="bc",BA="bd",AM="bodyContent",T="boundingBox",AW="button",F="column",AR="content",AS="dateFormat",AP="dblclick",Aq="desc",AO="disk",BI="event",Ax="field",AZ="fieldset",AQ="form",AC="hint",AF="input",Al="isoTime",Ac="label",X="layout",Ah="menu",f="overlayContextPanel",P="pencil",Ab="repeat",Q="row",AA="scheduler",u="select",o="strings",B="tc",i="text",t="when",K="trigger",AD="auiSchedulerEventRecorderWhen",A2="auiSchedulerEventRecorderDesc",Ao="auiSchedulerEventRecorderSelect",d="auiSchedulerEventRecorderButtonRow",z="scheduler-event-recorder:cancel",b="scheduler-event-recorder:edit",AU="scheduler-event-recorder:save",A3="-",g="#",BJ=h(AJ,BH,L),A0=h(AJ,BH,AQ),Y=h(AQ),M=h(X,AR),A4=h(X,AZ),AI=h(X,AZ,BA),y=h(X,AZ,AR),c=h(X,"w100"),N=h(F),Af=h(F,AR),C=h(Ax),Z=h(Ax,Ah),Ag=h(Ax,u),A8=h(Ax,AR),E=h(Ax,Ac),Am=h(Ax,i),J=h(AW,Q),Az=h(Ax,AF),AE=h(Ax,AF,u),a=h(Ax,AF,i),Ak=h(AJ,BH,Ac,t),D=h(AJ,BH,Aq),n=h(AJ,BH,Ax,AC),x=h(AJ,BH,Ab),w=h(AJ,BH,AW,Q),k="<option></option>",BG='<form id="auiSchedulerEventRecorderForm" class="'+[A0,M,Y].join(V)+'">'+'<div class="'+[A4,c,N].join(V)+'">'+'<div class="'+[y,Af].join(V)+'aui-fieldset-content aui-column-content">'+'<div class="'+AI+'">'+'<span class="'+[C,Am].join(V)+'">'+'<span class="'+A8+'">'+'<label class="'+E+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+Ak+'"></span>'+"</span>"+"</span>"+'<span class="'+[C,Am].join(V)+'">'+'<span class="'+A8+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[Az,a,D].join(V)+'" size="30" type="text" />'+'<div class="'+n+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[C,Z,Ag].join(V)+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[Az,AE,x].join(V)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[C,J,w].join(V)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";var s=AV.Component.create({NAME:AK,ATTRS:{content:{value:U},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:A6},event:{},strings:{value:{},setter:function(A){return AV.merge({save:"Save",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",when:"When","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat"},A||{});},validator:l},overlayContextPanel:{value:{},setter:function(BC){var A=this;var BD=AV.Node.create(AV.substitute(BG,A.get(o)));return AV.merge({align:{points:[BB,B]},anim:false,bodyContent:BD,hideOn:AP,trigger:A.get(S),visible:false,zIndex:9999},BC||{});}}},EXTENDS:AV.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.after("schedulerChange",A._afterSchedulerChange);A.on("startDateChange",A._onStartDateChange);A.get(S).addClass(AH);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(BC){var A=this;var BK=A.overlayDescNode.val();var BD=A.get(BI);if(!BD){BD=new AV.SchedulerEvent({endDate:A.get(Ad),scheduler:A.get(AA),startDate:A.get(A9)});BD.copyPropagateAttrValues(A,{content:true});}BD.set(Ab,A.overlaySelectNode.val());if(BK){BD.set(AR,BK);}return BD;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},loadFormValues:function(){var A=this;var BK=U;var BD=U;var BC=A.get(BI);if(BC){var BL=BC.get(Ab);if(BL){BK=BL.value;}BD=BC.get(AR);}A.overlaySelectNode.val(BK);A.overlayWhenNode.setContent(A._getWhenFormattedDt());setTimeout(function(){A.overlayDescNode.val(BD).selectText();},0);},_afterSchedulerChange:function(BK){var A=this;var BD=BK.newVal;var BC=BD.get(T);BC.delegate("click",AV.bind(A._onClickSchedulerEvent,A),AL+W);},_createEvents:function(){var A=this;var BC=function(BD,BK){A.publish(BD,{defaultFn:BK,queuable:false,emitFacade:true,bubbles:true,prefix:AK});};BC(AU,this._defSaveEventFn);BC(b,this._defEditEventFn);BC(z,this._defCancelEventFn);},_initOverlay:function(){var BC=this;var A=BC.get(o);BC.overlay=new AV.OverlayContextPanel(BC.get(f));var BK=BC.overlay;var BD=BK.get(T);var BL=BK.get(AM);BC.overlayButtonRowNode=BL.one(g+d);BC.overlayDescNode=BL.one(g+A2);BC.overlaySelectNode=BL.one(g+Ao);BC.overlayWhenNode=BL.one(g+AD);BC.overlaySaveBtn=new AV.ButtonItem({label:A.save,icon:AO,render:BC.overlayButtonRowNode,handler:{fn:BC._handleSaveEvent,context:BC}});BC.overlayEditBtn=new AV.ButtonItem({label:A.edit,icon:P,render:BC.overlayButtonRowNode,handler:{fn:BC._handleEditEvent,context:BC}});
BC.overlayCancelBtn=new AV.ButtonItem({label:A.cancel,render:BC.overlayButtonRowNode,handler:{fn:BC._handleCancelEvent,context:BC}});AV.each(AV.SchedulerEventRepeat,function(BN,BM){BC.overlaySelectNode.append(AV.Node.create(k).val(BN.value||BM).setContent(BN.description));});BK.on("hide",AV.bind(BC._onOverlayHide,BC));BK.on("show",AV.bind(BC._onOverlayShow,BC));BL.on("submit",AV.bind(BC._onSubmitForm,BC));BD.addClass(BJ);},_defCancelEventFn:function(BC){var A=this;A.hideOverlay();},_defEditEventFn:function(BC){var A=this;A.hideOverlay();},_defSaveEventFn:function(BD){var A=this;var BC=A.get(AA);BC.addEvent(BD.newSchedulerEvent);A.hideOverlay();BC.syncEventsUI();},_getWhenFormattedDt:function(){var BD=this;var BC=BD.get(AS);var BL=(BD.get(BI)||BD);var BN=BL.get(Ad);var BM=BL.get(AA);var A=BL.get(A9);var BK=(BM.get(q).get(Al)?O.toIsoTimeString:O.toUsTimeString);return[BL._formatDate(A,BC),BK(A),A3,BK(BN)].join(V);},_handleEditEvent:function(BC){var A=this;A.fire(b,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleSaveEvent:function(BC){var A=this;A.fire(AU,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleCancelEvent:function(BC){var A=this;A.fire(z);BC.preventDefault();},_onClickSchedulerEvent:function(BD){var A=this;var BC=BD.currentTarget.getData(AJ);if(BC){if(!A.overlay){A._initOverlay();}A.set(BI,BC);A.overlay.set(K,BC.get(S));A.get(S).remove();A.showOverlay();}},_onOverlayHide:function(BD){var A=this;var BC=A.get(S);if(A.overlay){A.set(BI,null);A.overlay.set(K,BC);}BC.remove();},_onOverlayShow:function(BD){var BC=this;var BK=BC.overlayEditBtn;var A=BC.overlaySaveBtn;if(BC.get(BI)){BK.show();A.hide();}else{BK.hide();A.show();}BC.loadFormValues();},_onStartDateChange:function(BC){var A=this;var BD=A.get(Ap);A.set(Ad,O.add(BC.newVal,O.MINUTES,BD));},_onSubmitForm:function(BC){var A=this;if(A.get(BI)){A._handleEditEvent(BC);}else{A._handleSaveEvent(BC);}}}});AV.SchedulerEventRecorder=s;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-overlay-context-panel","substitute"]});