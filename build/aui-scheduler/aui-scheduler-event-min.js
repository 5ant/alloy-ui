AUI.add("aui-scheduler-event",function(aM){var aq=aM.Lang,bk=aq.isString,f=aq.isDate,bb=aq.isFunction,K=aq.isObject,be=aq.isBoolean,af=aq.isNumber,a0=aM.ColorUtil,j=aM.DataType.DateMath,a7=aM.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bg="-",v="&ndash;",aB=".",r="",s=" ",n="_",aP="_propagateSet",S="activeView",V="borderColor",aR="borderColorRGB",aK="borderStyle",br="borderWidth",N="Change",a5="color",aY="colorBrightnessFactor",bf="colorSaturationFactor",aI="content",aj="contentNode",y="disabled",a2="duration",aS="endDate",au="eventStack",bl="events",ax="hidden",M="hsbColor",aw="icon",ac="icons",a3="id",aZ="isoTime",bq="locale",a1="never",p="node",h="overlay",aO="parentEvent",bw="recorder",aQ="repeat",bj="repeated",R="repeatedEvents",bd="repeater",ai="scheduler",ay="scheduler-event",aA="scheduler-event-recorder",bn="startDate",a9="template",aX="title",e="titleDateFormat",J="titleNode",ar="visible",k="paddingNode",m="paddingContentNode",aN="paddingTitleNode",d="%H:%M",a8="%I:%M",H=aM.getClassName,l=H(aw),u=H(ay),aT=H(ay,aI),E=H(ay,ax),bi=H(ay,y),at=H(ay,bw),aE=H(ay,bj),ap=H(ay,bd),G=H(ay,aX),bp=H(ay,ac),x=H(ay,aw,y),b=H(ay,aw,bj),bt=H(ay,aw,bd);var Z=aM.Component.create({NAME:ay,ATTRS:{borderStyle:{value:"solid",validator:bk},borderWidth:{value:"1px",validator:bk},colorBrightnessFactor:{value:0.75,validator:af},colorSaturationFactor:{value:1.5,validator:af},content:{value:"(no title)",validator:bk},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bk},titleDateFormat:{getter:"_getTitleDateFormat",validator:bk},endDate:{valueFn:function(){var A=j.clone(this.get(bn));A.setHours(A.getHours()+1);return A;},validator:f},disabled:{value:false,validator:be},node:{valueFn:function(){return aM.Node.create(this.EVENT_NODE_TEMPLATE).setData(ay,this);},setter:aM.one},paddingNode:{readOnly:true,valueFn:function(){return aM.Node.create(this.EVENT_NODE_TEMPLATE).setData(ay,this);}},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:f},visible:{value:true,validator:be}},EXTENDS:aM.Base,PROPAGATE_ATTRS:[bn,aS,aI,a5,aY,bf,aK,br,e,ar,y],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+u+'">'+'<div class="'+G+'"></div>'+'<div class="'+aT+'"></div>'+'<div class="'+bp+'">'+'<span class="'+[l,b].join(s)+'"></span>'+'<span class="'+[l,bt].join(s)+'"></span>'+'<span class="'+[l,x].join(s)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var X=A.get(p);var L=A.get(k);A[au]={};aM.Array.each(aM.SchedulerEvent.PROPAGATE_ATTRS,function(Y){A.after(Y+N,A._propagateAttrChange);});A._bindUIAttrs();A[aj]=X.one(aB+aT);A[J]=X.one(aB+G);A[m]=L.one(aB+aT);A[aN]=L.one(aB+G);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[au]={};A.get(k).remove(true);A.get(p).remove(true);},copyDates:function(L){var A=this;A.set(aS,j.clone(L.get(aS)));A.set(bn,j.clone(L.get(bn)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aM.Array.each(aM.SchedulerEvent.PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bB=L.get(Y);if(!K(bB)){A.set(Y,bB);}}});},getBorderColor:function(){var A=this;return A[aR].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aS),A.get(bn));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aS),A.get(bn));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aS),A.get(bn));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aS),A.get(bn));},sameEndDate:function(L){var A=this;return j.compare(A.get(aS),L.get(aS));},sameStartDate:function(L){var A=this;return j.compare(A.get(bn),L.get(bn));},isAfter:function(Y){var X=this;var L=X.get(bn);var A=Y.get(bn);return j.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(bn);var A=Y.get(bn);return j.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[au][Y]){var A=j.clone(X);var bC=j.clone(X);j.copyHours(A,L.get(bn));j.copyHours(bC,L.get(aS));var bB=new aM.SchedulerEvent({endDate:bC,parentEvent:L,scheduler:L.get(ai),startDate:A});bB.copyPropagateAttrValues(L);L[au][Y]=bB;}return L[au][Y];},intersects:function(Y){var X=this;var bB=X.get(aS);var L=X.get(bn);var A=Y.get(bn);return(X.sameStartDate(Y)||j.between(A,L,bB));},intersectHours:function(X){var L=this;var bB=L.get(aS);var A=L.get(bn);var Y=j.clone(A);j.copyHours(Y,X.get(bn));return(j.compare(A,Y)||j.between(Y,A,bB));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(bn),A.get(aS));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(bn),A.get(aS));},isRepeatableDate:function(L){var A=this;var X=A.get(aQ);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aS));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(bn));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(bn,L);A.set(aS,j.add(j.clone(L),j.MINUTES,X));},uidByDate:function(L){var A=this;L=f(L)?j.safeClearTime(L):A.getClearStartDate();return[ay,L.getTime()].join(n);},setContent:function(X,L){var A=this;A._setContent(aj,X,L);A._setContent(m,X,L);},setTitle:function(X,L){var A=this;A._setContent(J,X,L);A._setContent(aN,X,L);},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var bB=A.get(p);var X=A.get(k);var bC=A.getBorderColor();if(bB&&X){var Y={borderWidth:A.get(br),borderColor:bC,backgroundColor:A.get(a5),borderStyle:A.get(aK)};bB.setStyles(Y);X.setStyles(Y);}if(L){A.eachRepeatedEvent(function(bD,bE){bD.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aI),L);},syncNodeTitleUI:function(L){var A=this;var Y=A._formatDate(A.get(bn));var X=A._formatDate(A.get(aS));A.setTitle([Y,X].join(s+v+s),L);},split:function(){var A=this,X=j.clone(A.get(bn)),Y=j.clone(A.get(aS));
if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(X);L.setHours(24,0,0,0);return[[X,j.toMidnight(j.clone(X))],[L,j.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aM.each(A[au],L,A);},unlink:function(){var A=this;if(A.get(aO)){A.set(aO,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[au]={};A.syncNodeUI();},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({disabledChange:A._afterDisabledChange,visibleChange:A._afterVisibleChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bB,bC){var bD=bB[aP+a7(X)];if(bD){bD.apply(A,[bB,X,L]);}else{bB.set(X,Y.newVal);}bB.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=j.clone(A.get(aS));j.copyHours(X,Y);A.set(aS,X);},_propagateSetStartDate:function(L,X,Y){var A=j.clone(L.get(bn));j.copyHours(A,Y);L.set(bn,A);},_setColor:function(L){var A=this;A[M]=a0.rgb2hsb(a0.getRGB(L));A[V]=aM.clone(A[M]);A[V].b*=A.get(aY);A[V].s*=A.get(bf);A[aR]=a0.hsb2rgb(A[V]);return L;},_setContent:function(X,bB,L){var A=this;var Y=A[X];if(Y){Y.setContent(bB);}if(L){A.eachRepeatedEvent(function(bC,bD){bC[X].setContent(bB);});}},_setRepeat:function(L){var A=this;if(bk(L)){L=aM.SchedulerEventRepeat[L];}return K(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ai);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(y));A._uiSetVisible(A.get(ar));A._uiSetParentEvent(A.get(aO));A._uiSetRepeat(A.get(aQ));},_formatDate:function(X,Y){var L=this;var A=L.get(bq);Y=Y||L.get(e);return aM.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(X){var A=this;if(!bk(X)){var L=A.get(ai);X=(L&&L.get(S).get(aZ))?d:a8;}return X;},_uiSetDisabled:function(L){var A=this;A.get(p).toggleClass(bi,!!L);A.get(k).toggleClass(bi,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(p).toggleClass(aE,!!L);A.get(k).toggleClass(aE,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aM.SchedulerEventRepeat[a1];A.get(p).toggleClass(ap,L);A.get(k).toggleClass(ap,L);},_uiSetVisible:function(L){var A=this;A.get(p).toggleClass(E,!L);A.get(k).toggleClass(E,!L);}}});aM.SchedulerEvent=Z;aM.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aS);var A=L.get(bn);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aS);var A=L.get(bn);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aS);var A=L.get(bn);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var az=aM.Lang,a=az.isArray,K=az.isObject,S="activeView",c="arrow",aW="body",aD="bodyContent",q="boundingBox",aC="cancel",a4="click",aI="content",aV="date",aJ="dateFormat",am="delete",bc="description",T="edit",bv="event",D="footerContent",aH="form",C="header",w="hide",aZ="isoTime",p="node",h="overlay",U="overlayOffset",bw="recorder",bs="rendered",aQ="repeat",a6="save",ai="scheduler",o="schedulerChange",ay="scheduler-event",aA="scheduler-event-recorder",aG="shadow",aF="show",I="startDateChange",Q="strings",a9="template",aX="title",bu="tl",ae="toolbar",bm="submit",bo="value",aU="visibleChange",ab="when",ao="x",an="y",ah="cancel",P="delete",B="edit",aL="save",bx="-",g=".",ag="",i="#",t=aM.IO.prototype._serialize,H=aM.getClassName,u=H(ai,bv),at=H(ai,bv,bw),by=H(ai,bv,bw,h),z=H(ai,bv,bw,h,c),bh=H(ai,bv,bw,h,c,aG),al=H(ai,bv,bw,h,aW),ba=H(ai,bv,bw,h,aI),ak=H(ai,bv,bw,h,aV),F=H(ai,bv,bw,h,am),W=H(ai,bv,bw,h,aH),bA=H(ai,bv,bw,h,C),av=H(ai,bv,bw,h,aQ),G=H(ai,bv,aX),O=new aM.Template('<div class="',bh," ",z,'"></div>','<div class="',z,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bA,'">','<input class="',ba,'" name="content" value="{content}" />',"</div>",'<div class="',al,'">','<label class="',ak,'">{date}</label>','<select class="',av,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),ad='<a class="'+F+'" href="javascript:;">{delete}</a>',bz='<form class="'+W+'" id="schedulerEventRecorderForm"></form>';var aa=aM.Component.create({NAME:aA,ATTRS:{content:{value:ag},duration:{value:60},dateFormat:{validator:bk,value:"%a, %B %d,"},event:{},strings:{value:{},setter:function(A){return aM.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:K},overlay:{validator:K,value:{align:{points:[bu,bu]},visible:false,width:260,zIndex:500}},overlayOffset:{value:[95,-31],validator:a},template:{value:O},toolbar:{setter:function(X){var L=this;var A=L.get(Q);return aM.merge({children:[{handler:aM.bind(L._handleSaveEvent,L),label:A[a6]},{handler:aM.bind(L._handleCancelEvent,L),label:A[aC]}]},X||{});
},validator:K,value:{}}},EXTENDS:aM.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(p).addClass(at);A.publish(ah,{defaultFn:A._defCancelEventFn});A.publish(P,{defaultFn:A._defDeleteEventFn});A.publish(B,{defaultFn:A._defEditEventFn});A.publish(aL,{defaultFn:A._defSaveEventFn});A.after(o,A._afterSchedulerChange);A.on(I,A._onStartDateChange);A[h]=new aM.Overlay(A.get(h));A[ae]=new aM.Toolbar(A.get(ae));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(q);L.delegate(a4,aM.bind(A._onClickSchedulerEvent,A),g+u);},_defCancelEventFn:function(L){var A=this;A.get(p).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ai);L.removeEvent(A.get(bv));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ai);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ai);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ah);L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bv)?B:aL,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickDelete:function(){var A=this;A.fire(P);},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(ay);if(L){A.set(bv,L);A.showOverlay();A.get(p).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bv)){var X=L[h].get(q);var A=X.one(g+ba);setTimeout(function(){A.selectText();},0);L.deleteNode.hide();}else{L.deleteNode.show();}}else{L.set(bv,null);L.get(p).remove();}},_onStartDateChange:function(L){var A=this;var X=A.get(a2);A.set(aS,j.add(L.newVal,j.MINUTES,X));},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(Q);L[h].render();L[ae].render();var X=L[h].get(q);X.addClass(by);L[h].set(D,L[ae].get(q));L[h].on(aU,aM.bind(L._onOverlayVisibleChange,L));L.deleteNode=aM.Node.create(az.sub(ad,{"delete":A[am]}));L.formNode=aM.Node.create(bz);X.append(L.deleteNode);L.deleteNode.on(a4,aM.bind(L._onClickDelete,L));L.formNode.on(bm,aM.bind(L._onSubmitForm,L));L[h].set(aD,L.formNode);},getEventCopy:function(){var A=this;var X=A.get(bv);if(!X){X=new aM.SchedulerEvent({endDate:A.get(aS),scheduler:A.get(ai),startDate:A.get(bn)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aI,L[aI]);X.set(aQ,L[aQ]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aJ);var bB=(X.get(bv)||X);var bD=bB.get(aS);var bC=bB.get(ai);var A=bB.get(bn);var Y=(bC.get(S).get(aZ)?j.toIsoTimeString:j.toUsTimeString);return[bB._formatDate(A,L),Y(A),bg,Y(bD)].join(s);},hideOverlay:function(){var A=this;A[h].hide();},populateForm:function(){var L=this;var A=L.get(Q);if(!L.eventRepeatArray){L.eventRepeatArray=[];aM.each(aM.SchedulerEventRepeat,function(Y){L.eventRepeatArray.push({description:Y[bc],value:Y[bo]});});}var X=(L.get(bv)||L);L.formNode.setContent(L.get(a9).parse({content:X.get(aI)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aS),eventRepeat:L.eventRepeatArray,repeat:X.get(aQ),startDate:X.get(bn)}));},serializeForm:function(){var A=this;return aM.QueryString.parse(t(A.formNode.getDOM()));},showOverlay:function(X,Y){var A=this;if(!A[h].get(bs)){A._renderOverlay();}A[h].show();if(!X){var L=(A.get(bv)||A).get(p);X=L.one(g+G);}A[h].set("align.node",X);Y=Y||A.get(U);A[h].move(A[h].get(ao)+Y[0],A[h].get(an)+Y[1]);}}});aM.SchedulerEventRecorder=aa;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});