AUI.add("aui-scheduler-event",function(aH){var am=aH.Lang,bc=am.isString,h=am.isDate,a2=am.isFunction,I=am.isObject,a6=am.isBoolean,ab=am.isNumber,ag=am.isUndefined,aT=aH.ColorUtil,l=aH.DataType.DateMath,aZ=aH.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aA=":",br="-",i=".",ac="",bt="&ndash;",bq=" ",H="_",T="activeView",w="all",M="allDay",V="borderColor",aI="borderColorRGB",aF="borderStyle",bj="borderWidth",K="Change",aW="color",aQ="colorBrightnessFactor",a7="colorSaturationFactor",aD="content",a5="day",t="disabled",aJ="endDate",aM="eventClass",at="hidden",J="hsbColor",ar="icon",Z="icons",aj="inherit",aR="isoTime",bi="locale",bf="meeting",aU="never",p="node",k="overlay",bp="recorder",ae="reminder",bb="repeated",a4="repeater",af="scheduler",au="scheduler-event",aw="scheduler-event-recorder",a="short",be="startDate",a0="template",aP="title",g="titleDateFormat",ap="visible",f="%H:%M",N="%l",bm="%M",an=function(A){var L=[N];if(A.getMinutes()>0){L.push(aA);L.push(bm);}if(A.getHours()>=12){L.push("p");}return L.join(ac);},G=aH.getClassName,m=G(ar),s=G(au),F=G(au,w,a5),aK=G(au,aD),a9=G(au,t),B=G(au,at),u=G(au,ar,t),D=G(au,ar,bf),aq=G(au,ar,ae),d=G(au,ar,bb),bh=G(au,Z),b=G(au,bf),ao=G(au,bp),o=G(au,ae),az=G(au,bb),al=G(au,a),C=G(au,aP);var X=aH.Component.create({NAME:au,ATTRS:{allDay:{setter:aH.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:bc},borderWidth:{value:"1px",validator:bc},colorBrightnessFactor:{value:0.75,validator:ab},colorSaturationFactor:{value:1.5,validator:ab},content:{validator:bc},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bc},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this,L=A.get(af),bw=L&&L.get(T).get(aR),bx={endDate:bt+bq+f,startDate:f};if(!bw){bx.endDate=bt+bq+an(A.get(aJ));bx.startDate=an(A.get(be));}if(A.getMinutesDuration()<=30){delete bx.endDate;}else{if(A.get(M)){bx={};}}return bx;}},endDate:{setter:"_setDate",valueFn:function(){var A=l.clone(this.get(be));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aH.SchedulerEvent;}},disabled:{value:false,validator:a6},meeting:{value:false,validator:a6},node:{valueFn:function(){return aH.NodeList.create(aH.Node.create(this.EVENT_NODE_TEMPLATE).setData(au,this));}},reminder:{value:false,validator:a6},repeated:{value:false,validator:a6},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:a6}},EXTENDS:aH.Model,PROPAGATE_ATTRS:[M,be,aJ,aD,aW,aQ,a7,aF,bj,g,ap,t],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+s+'">'+'<div class="'+C+'"></div>'+'<div class="'+aK+'"></div>'+'<div class="'+bh+'">'+'<span class="'+[m,u].join(bq)+'"></span>'+'<span class="'+[m,D].join(bq)+'"></span>'+'<span class="'+[m,aq].join(bq)+'"></span>'+'<span class="'+[m,d].join(bq)+'"></span>'+"</div>"+"</div>",initializer:function(){var A=this;var L=A.get(p);A.bindUI();A.syncUI();},bindUI:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,colorChange:A._afterColorChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,meetingChange:A._afterMeetingChange,reminderChange:A._afterReminderChange,repeatedChange:A._afterRepeatedChange,visibleChange:A._afterVisibleChange});},syncUI:function(){var A=this;A._uiSetAllDay(A.get(M));A._uiSetColor(A.get(aW));A._uiSetDisabled(A.get(t));A._uiSetEndDate(A.get(aJ));A._uiSetMeeting(A.get(bf));A._uiSetReminder(A.get(ae));A._uiSetRepeated(A.get(bb));A._uiSetVisible(A.get(ap));A.syncNodeTitleUI();A.syncNodeContentUI();},destroy:function(){var A=this;A.get(p).remove(true);},addPaddingNode:function(){var A=this;A.get(p).push(aH.Node.create(A.EVENT_NODE_TEMPLATE).setData(au,A));A.syncUI();},clone:function(){var L=this,A=new (L.get(aM))();A.copyPropagateAttrValues(L,null,{silent:true});return A;},copyDates:function(L,bw){var A=this;A.setAttrs({endDate:l.clone(L.get(aJ)),startDate:l.clone(L.get(be))},bw);},copyPropagateAttrValues:function(bw,by,bx){var A=this,L={};A.copyDates(bw,bx);aH.Array.each(A.get(aM).PROPAGATE_ATTRS,function(bz){if(!((by||{}).hasOwnProperty(bz))){var bA=bw.get(bz);if(!I(bA)){L[bz]=bA;}}});A.setAttrs(L,bx);},getBorderColor:function(){var A=this;return A[aI].hex;},getDaysDuration:function(){var A=this;return l.getDayOffset(A.get(aJ),A.get(be));},getHoursDuration:function(){var A=this;return l.getHoursOffset(A.get(aJ),A.get(be));},getMinutesDuration:function(){var A=this;return l.getMinutesOffset(A.get(aJ),A.get(be));},getSecondsDuration:function(){var A=this;return l.getSecondsOffset(A.get(aJ),A.get(be));},sameEndDate:function(L){var A=this;return l.compare(A.get(aJ),L.get(aJ));},sameStartDate:function(L){var A=this;return l.compare(A.get(be),L.get(be));},isAfter:function(bx){var bw=this;var L=bw.get(be);var A=bx.get(be);return l.after(L,A);},isBefore:function(bx){var bw=this;var L=bw.get(be);var A=bx.get(be);return l.before(L,A);},intersects:function(bx){var bw=this;var by=bw.get(aJ);var L=bw.get(be);var A=bx.get(be);return(bw.sameStartDate(bx)||l.between(A,L,by));},intersectHours:function(bw){var L=this;var by=L.get(aJ);var A=L.get(be);var bx=l.clone(A);l.copyHours(bx,bw.get(be));return(l.compare(A,bx)||l.between(bx,A,by));},isDayBoundaryEvent:function(){var A=this;return l.isDayBoundary(A.get(be),A.get(aJ));},isDayOverlapEvent:function(){var A=this;return l.isDayOverlap(A.get(be),A.get(aJ));},getClearEndDate:function(){var A=this;return l.safeClearTime(A.get(aJ));},getClearStartDate:function(){var A=this;return l.safeClearTime(A.get(be));},move:function(bw,L){var A=this;var bx=A.getMinutesDuration();A.setAttrs({endDate:l.add(l.clone(bw),l.MINUTES,bx),startDate:bw},L);},setContent:function(L){var A=this;A.get(p).each(function(bx){var bw=bx.one(i+aK);bw.setContent(L);});},setTitle:function(L){var A=this;A.get(p).each(function(bw){var bx=bw.one(i+C);bx.setContent(L);});},syncNodeContentUI:function(){var A=this;A.setContent(A.get(aD));},syncNodeTitleUI:function(){var L=this,bx=L.get(g),A=L.get(be),bw=L.get(aJ),by=[];
if(bx.startDate){by.push(L._formatDate(A,bx.startDate));}if(bx.endDate){by.push(L._formatDate(bw,bx.endDate));}L.setTitle(by.join(bq));},split:function(){var A=this,bw=l.clone(A.get(be)),bx=l.clone(A.get(aJ));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=l.clone(bw);L.setHours(24,0,0,0);return[[bw,l.toMidnight(l.clone(bw))],[L,l.clone(bx)]];}return[[bw,bx]];},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterColorChange:function(L){var A=this;A._uiSetColor(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterMeetingChange:function(L){var A=this;A._uiSetMeeting(L.newVal);},_afterReminderChange:function(L){var A=this;A._uiSetReminder(L.newVal);},_afterRepeatedChange:function(L){var A=this;A._uiSetRepeated(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_setColor:function(L){var A=this;A[J]=aT.rgb2hsb(aT.getRGB(L));A[V]=aH.clone(A[J]);A[V].b*=A.get(aQ);A[V].s*=A.get(a7);A[aI]=aT.hsb2rgb(A[V]);return L;},_setDate:function(L){var A=this;if(ab(L)){L=new Date(L);}return L;},_setScheduler:function(bw){var A=this;var L=A.get(af);if(L){A.removeTarget(L);}A.addTarget(bw);return bw;},_formatDate:function(bw,bx){var L=this;var A=L.get(bi);return aH.DataType.Date.format(bw,{format:bx,locale:A});},_getTitleDateFormat:function(L){var A=this;if(bc(L)){L={endDate:L,startDate:L};}else{if(a2(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(p).toggleClass(F,!!L);},_uiSetColor:function(bx){var A=this;var bw=A.get(p);var by=A.getBorderColor();if(bw){var L={borderWidth:A.get(bj),borderColor:by,backgroundColor:bx,borderStyle:A.get(aF),color:aj};bw.setStyles(L);}},_uiSetDisabled:function(L){var A=this;A.get(p).toggleClass(a9,!!L);},_uiSetEndDate:function(L){var A=this;A.get(p).toggleClass(al,A.getMinutesDuration()<=30);},_uiSetMeeting:function(L){var A=this;A.get(p).toggleClass(b,!!L);},_uiSetReminder:function(L){var A=this;A.get(p).toggleClass(o,!!L);},_uiSetRepeated:function(L){var A=this;A.get(p).toggleClass(az,!!L);},_uiSetVisible:function(L){var A=this;A.get(p).toggleClass(B,!L);}}});aH.SchedulerEvent=X;var av=aH.Lang,c=av.isArray,e="arrow",aO="body",ay="bodyContent",aY="bottom",q="boundingBox",ax="cancel",aV="click",E="constrain",aN="date",aE="dateFormat",ak="delete",a3="description",bo="event",z="footerContent",aC="form",y="header",R="offsetHeight",ba="offsetWidth",U="overlayOffset",bl="rendered",j="right",aX="save",n="schedulerChange",aB="shadow",Q="strings",bn="tl",aa="toolbar",bd="submit",bg="value",aL="visibleChange",S="width",ad="cancel",P="delete",x="edit",aG="save",r=aH.IO.prototype._serialize,bs=G(af,bo,bp,k),v=G(af,bo,bp,k,e),bk=G(af,bo,bp,k,e,aY),aS=G(af,bo,bp,k,e,j),a8=G(af,bo,bp,k,e,aB),ai=G(af,bo,bp,k,aO),a1=G(af,bo,bp,k,aD),ah=G(af,bo,bp,k,aN),W=G(af,bo,bp,k,aC),bv=G(af,bo,bp,k,y),O=new aH.Template('<div class="',a8," ",v,'"></div>','<div class="',v,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bv,'">','<input class="',a1,'" name="content" value="{content}" />',"</div>",'<div class="',ai,'">','<label class="',ah,'">{date}</label>',"</div>"),bu='<form class="'+W+'" id="schedulerEventRecorderForm"></form>';var Y=aH.Component.create({NAME:aw,ATTRS:{allDay:{value:false},content:{},duration:{value:60},dateFormat:{validator:bc,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aH.SchedulerEvent;}},strings:{value:{},setter:function(A){return aH.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's",cancel:"Cancel",description:"Description",edit:"Edit",save:"Save",when:"When"},A||{});},validator:I},overlay:{validator:I,value:{constrain:null,visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:c},template:{value:O},toolbar:{setter:function(bw){var L=this;var A=L.get(Q);return aH.merge({children:[{handler:aH.bind(L._handleSaveEvent,L),label:A[aX]},{handler:aH.bind(L._handleCancelEvent,L),label:A[ax]},{handler:aH.bind(L._handleDeleteEvent,L),label:A[ak]}]},bw||{});},validator:I,value:{}}},EXTENDS:aH.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(p).addClass(ao);A.publish(ad,{defaultFn:A._defCancelEventFn});A.publish(P,{defaultFn:A._defDeleteEventFn});A.publish(x,{defaultFn:A._defEditEventFn});A.publish(aG,{defaultFn:A._defSaveEventFn});A.after(n,A._afterSchedulerChange);A[k]=new aH.Overlay(A.get(k));A[aa]=new aH.Toolbar(A.get(aa));},getOverlayContentNode:function(){var A=this;var L=A[k].get(q);return L.one(i+a1);},getUpdatedSchedulerEvent:function(bw){var A=this,bx=A.get(bo),L={silent:!bx},by=A.serializeForm();if(!bx){bx=A.clone();}bx.set(af,A.get(af),{silent:true});bx.setAttrs(aH.merge(by,bw),L);return bx;},_afterSchedulerChange:function(bx){var A=this;var bw=bx.newVal;var L=bw.get(q);A[k].set(E,L);L.delegate(aV,aH.bind(A._onClickSchedulerEvent,A),i+s);},_defCancelEventFn:function(L){var A=this;A.get(p).remove();A.hideOverlay();},_defDeleteEventFn:function(bw){var A=this;var L=A.get(af);L.removeEvent(A.get(bo));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(bw){var A=this;var L=A.get(af);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(bw){var A=this;var L=A.get(af);L.addEvent(bw.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ad);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(P,{schedulerEvent:A.get(bo)});L.preventDefault();},_handleSaveEvent:function(bw){var A=this,L=A.get(bo)?x:aG;A.fire(L,{newSchedulerEvent:A.getUpdatedSchedulerEvent()});bw.preventDefault();},_onClickSchedulerEvent:function(bw){var A=this;var L=bw.currentTarget.getData(au);if(L){A.set(bo,L,{silent:true});A.showOverlay([bw.pageX,bw.pageY]);A.get(p).remove();}},_onOverlayVisibleChange:function(L){var A=this;if(L.newVal){A.populateForm();if(!A.get(bo)){var bw=A.getOverlayContentNode();
if(bw){setTimeout(function(){bw.selectText();},0);}}}else{A.set(bo,null,{silent:true});A.get(p).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(Q);L[k].render();L[aa].render();var bw=L[k].get(q);bw.addClass(bs);L[k].set(z,L[aa].get(q));L[k].on(aL,aH.bind(L._onOverlayVisibleChange,L));L.formNode=aH.Node.create(bu);L[k].set(ay,L.formNode);L.formNode.on(bd,aH.bind(L._onSubmitForm,L));},getFormattedDate:function(){var bw=this;var L=bw.get(aE);var by=(bw.get(bo)||bw);var bA=by.get(aJ);var bz=by.get(af);var A=by.get(be);var bx=(bz.get(T).get(aR)?l.toIsoTimeString:l.toUsTimeString);return[by._formatDate(A,L),bx(A),br,bx(bA)].join(bq);},getTemplateData:function(){var L=this,A=L.get(Q),bw=L.get(bo)||L,bx=bw.get(aD);if(ag(bx)){bx=A["description-hint"];}return{content:bx,date:L.getFormattedDate(),endDate:bw.get(aJ).getTime(),startDate:bw.get(be).getTime()};},hideOverlay:function(){var A=this;A[k].hide();},populateForm:function(){var A=this;A.formNode.setContent(A.get(a0).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aH.QueryString.parse(r(A.formNode.getDOM()));},showOverlay:function(bF,bw){var bE=this,bC=bE[k].get(E),bx=bE.get(U),bA=bF.concat([]);if(!bE[k].get(bl)){bE._renderOverlay();}bE[k].show();if(!bF){var bB=(bE.get(bo)||bE).get(p);var L=bB.one(i+C);bw=[bx[0]+L.get(ba),bx[1]+L.get(R)/2];bF=L.getXY();}bw=bw||bx;bF[0]+=bw[0];bF[1]+=bw[1];var A=bE[k].get(q),bz=A.get(ba),by=A.one(i+bv),bD=A.all(i+v);if((bF[0]+bz)>=bC.get(ba)){bD.addClass(aS);bF[0]-=bz+bD.item(0).get(ba);}bE[k].set("xy",bF);if(bA[1]>=(by.get(R)+by.getY())){bD.addClass(bk);}else{bD.removeClass(bk);}}}});aH.SchedulerEventRecorder=Y;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","model","querystring","overlay"]});