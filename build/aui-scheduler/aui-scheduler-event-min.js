AUI.add("aui-scheduler-event",function(aI){var al=aI.Lang,bh=al.isString,f=al.isDate,a7=al.isFunction,G=al.isObject,ba=al.isBoolean,ab=al.isNumber,aW=aI.ColorUtil,j=aI.DataType.DateMath,a3=aI.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bc="-",t="&ndash;",aw=".",p="",q=" ",l="_",aK="_propagateSet",P="activeView",S="borderColor",aM="borderColorRGB",aG="borderStyle",bo="borderWidth",I="Change",a1="color",aU="colorBrightnessFactor",bb="colorSaturationFactor",aE="content",w="disabled",aY="duration",aN="endDate",aQ="eventClass",ao="eventStack",bi="events",ar="hidden",H="hsbColor",aq="icon",Z="icons",aZ="id",aV="isoTime",bn="locale",aX="never",n="node",h="overlay",aJ="parentEvent",bt="recorder",aL="repeat",bg="repeated",O="repeatedEvents",a9="repeater",ae="scheduler",at="scheduler-event",av="scheduler-event-recorder",bk="startDate",a5="template",aT="title",e="titleDateFormat",am="visible",d="%H:%M",a4="%I:%M",E=aI.getClassName,k=E(aq),s=E(at),aO=E(at,aE),C=E(at,ar),be=E(at,w),an=E(at,bt),az=E(at,bg),ak=E(at,a9),D=E(at,aT),bm=E(at,Z),v=E(at,aq,w),b=E(at,aq,bg),bq=E(at,aq,a9);var U=aI.Component.create({NAME:at,ATTRS:{borderStyle:{value:"solid",validator:bh},borderWidth:{value:"1px",validator:bh},colorBrightnessFactor:{value:0.75,validator:ab},colorSaturationFactor:{value:1.5,validator:ab},content:{value:"(no title)",validator:bh},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bh},titleDateFormat:{getter:"_getTitleDateFormat",validator:bh},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(bk));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aI.SchedulerEvent;}},disabled:{value:false,validator:ba},node:{valueFn:function(){return aI.NodeList.create(aI.Node.create(this.EVENT_NODE_TEMPLATE).setData(at,this));}},parentEvent:{},repeat:{value:p,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:ba}},EXTENDS:aI.Base,PROPAGATE_ATTRS:[bk,aN,aE,a1,aU,bb,aG,bo,e,am,w],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+s+'">'+'<div class="'+D+'"></div>'+'<div class="'+aO+'"></div>'+'<div class="'+bm+'">'+'<span class="'+[k,b].join(q)+'"></span>'+'<span class="'+[k,bq].join(q)+'"></span>'+'<span class="'+[k,v].join(q)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(n);A[ao]={};aI.Array.each(A.get(aQ).PROPAGATE_ATTRS,function(X){A.after(X+I,A._propagateAttrChange);});A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[ao]={};A.get(n).remove(true);},addPaddingNode:function(){var A=this;A.get(n).push(aI.Node.create(A.EVENT_NODE_TEMPLATE).setData(at,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aN,j.clone(L.get(aN)));A.set(bk,j.clone(L.get(bk)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aI.Array.each(A.get(aQ).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var by=L.get(Y);if(!G(by)){A.set(Y,by);}}});},getBorderColor:function(){var A=this;return A[aM].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aN),A.get(bk));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aN),A.get(bk));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aN),A.get(bk));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aN),A.get(bk));},sameEndDate:function(L){var A=this;return j.compare(A.get(aN),L.get(aN));},sameStartDate:function(L){var A=this;return j.compare(A.get(bk),L.get(bk));},isAfter:function(Y){var X=this;var L=X.get(bk);var A=Y.get(bk);return j.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(bk);var A=Y.get(bk);return j.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[ao][Y]){var A=j.clone(X);var bz=j.clone(X);j.copyHours(A,L.get(bk));j.copyHours(bz,L.get(aN));var by=new L.get(aQ)({endDate:bz,parentEvent:L,scheduler:L.get(ae),startDate:A});by.copyPropagateAttrValues(L);L[ao][Y]=by;}return L[ao][Y];},intersects:function(Y){var X=this;var by=X.get(aN);var L=X.get(bk);var A=Y.get(bk);return(X.sameStartDate(Y)||j.between(A,L,by));},intersectHours:function(X){var L=this;var by=L.get(aN);var A=L.get(bk);var Y=j.clone(A);j.copyHours(Y,X.get(bk));return(j.compare(A,Y)||j.between(Y,A,by));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(bk),A.get(aN));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(bk),A.get(aN));},isRepeatableDate:function(L){var A=this;var X=A.get(aL);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aN));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(bk));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(bk,L);A.set(aN,j.add(j.clone(L),j.MINUTES,X));},uidByDate:function(L){var A=this;L=f(L)?j.safeClearTime(L):A.getClearStartDate();return[at,L.getTime()].join(l);},setContent:function(X,L){var A=this;A.get(n).each(function(by){var Y=by.one(g+aO);Y.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,by){Y.setContent(X);});}},setTitle:function(X,L){var A=this;A.get(n).each(function(Y){var by=Y.one(g+D);by.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,by){Y.setTitle(X);});}},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var Y=A.get(n);var by=A.getBorderColor();if(Y){var X={borderWidth:A.get(bo),borderColor:by,backgroundColor:A.get(a1),borderStyle:A.get(aG)};Y.setStyles(X);}if(L){A.eachRepeatedEvent(function(bz,bA){bz.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aE),L);},syncNodeTitleUI:function(L){var A=this;var Y=A._formatDate(A.get(bk));var X=A._formatDate(A.get(aN));A.setTitle([Y,X].join(q+t+q),L);},split:function(){var A=this,X=j.clone(A.get(bk)),Y=j.clone(A.get(aN));
if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(X);L.setHours(24,0,0,0);return[[X,j.toMidnight(j.clone(X))],[L,j.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aI.each(A[ao],L,A);},unlink:function(){var A=this;if(A.get(aJ)){A.set(aJ,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[ao]={};A.syncNodeUI();},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({disabledChange:A._afterDisabledChange,visibleChange:A._afterVisibleChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(by,bz){var bA=by[aK+a3(X)];if(bA){bA.apply(A,[by,X,L]);}else{by.set(X,Y.newVal);}by.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=j.clone(A.get(aN));j.copyHours(X,Y);A.set(aN,X);},_propagateSetStartDate:function(L,X,Y){var A=j.clone(L.get(bk));j.copyHours(A,Y);L.set(bk,A);},_setColor:function(L){var A=this;A[H]=aW.rgb2hsb(aW.getRGB(L));A[S]=aI.clone(A[H]);A[S].b*=A.get(aU);A[S].s*=A.get(bb);A[aM]=aW.hsb2rgb(A[S]);return L;},_setDate:function(L){var A=this;if(ab(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bh(L)){L=aI.SchedulerEventRepeat[L];}return G(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ae);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(w));A._uiSetVisible(A.get(am));A._uiSetParentEvent(A.get(aJ));A._uiSetRepeat(A.get(aL));},_formatDate:function(X,Y){var L=this;var A=L.get(bn);Y=Y||L.get(e);return aI.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(X){var A=this;if(!bh(X)){var L=A.get(ae);X=(L&&L.get(P).get(aV))?d:a4;}return X;},_uiSetDisabled:function(L){var A=this;A.get(n).toggleClass(be,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(n).toggleClass(az,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aI.SchedulerEventRepeat[aX];A.get(n).toggleClass(ak,L);},_uiSetVisible:function(L){var A=this;A.get(n).toggleClass(C,!L);}}});aI.SchedulerEvent=U;aI.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aN);var A=L.get(bk);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aN);var A=L.get(bk);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aN);var A=L.get(bk);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var au=aI.Lang,a=au.isArray,G=au.isObject,P="activeView",c="arrow",aS="body",ay="bodyContent",o="boundingBox",ax="cancel",a0="click",aE="content",aR="date",aF="dateFormat",ah="delete",a8="description",Q="edit",bs="event",aQ="eventClass",B="footerContent",aC="form",z="header",u="hide",aV="isoTime",aD="link",n="node",N="offsetHeight",bf="offsetWidth",h="overlay",R="overlayOffset",bt="recorder",bp="rendered",aL="repeat",a2="save",ae="scheduler",m="schedulerChange",at="scheduler-event",av="scheduler-event-recorder",aB="shadow",aA="show",F="startDateChange",M="strings",a5="template",aT="title",br="tl",aa="toolbar",bj="submit",bl="value",aP="visibleChange",W="when",aj="x",ai="y",ad="cancel",K="delete",y="edit",aH="save",bu="-",g=".",ac="",i="#",r=aI.IO.prototype._serialize,E=aI.getClassName,s=E(ae,bs),an=E(ae,bs,bt),bv=E(ae,bs,bt,h),x=E(ae,bs,bt,h,c),bd=E(ae,bs,bt,h,c,aB),ag=E(ae,bs,bt,h,aS),a6=E(ae,bs,bt,h,aE),af=E(ae,bs,bt,h,aR),T=E(ae,bs,bt,h,aC),bx=E(ae,bs,bt,h,z),ap=E(ae,bs,bt,h,aL),D=E(ae,bs,aT),J=new aI.Template('<div class="',bd," ",x,'"></div>','<div class="',x,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bx,'">','<input class="',a6,'" name="content" value="{content}" />',"</div>",'<div class="',ag,'">','<label class="',af,'">{date}</label>','<select class="',ap,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),bw='<form class="'+T+'" id="schedulerEventRecorderForm"></form>';var V=aI.Component.create({NAME:av,ATTRS:{content:{value:ac},duration:{value:60},dateFormat:{validator:bh,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aI.SchedulerEvent;}},strings:{value:{},setter:function(A){return aI.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:G},overlay:{validator:G,value:{align:{points:[br,br]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:a},template:{value:J},toolbar:{setter:function(X){var L=this;var A=L.get(M);return aI.merge({children:[{handler:aI.bind(L._handleSaveEvent,L),label:A[a2]},{handler:aI.bind(L._handleCancelEvent,L),label:A[ax]},{handler:aI.bind(L._handleDeleteEvent,L),label:A[ah]}]},X||{});},validator:G,value:{}}},EXTENDS:aI.SchedulerEvent,prototype:{initializer:function(){var A=this;
A.get(n).addClass(an);A.publish(ad,{defaultFn:A._defCancelEventFn});A.publish(K,{defaultFn:A._defDeleteEventFn});A.publish(y,{defaultFn:A._defEditEventFn});A.publish(aH,{defaultFn:A._defSaveEventFn});A.after(m,A._afterSchedulerChange);A[h]=new aI.Overlay(A.get(h));A[aa]=new aI.Toolbar(A.get(aa));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(o);L.delegate(a0,aI.bind(A._onClickSchedulerEvent,A),g+s);},_defCancelEventFn:function(L){var A=this;A.get(n).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ae);L.removeEvent(A.get(bs));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ae);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ae);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ad);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(K,{schedulerEvent:A.get(bs)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bs)?y:aH,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(at);if(L){A.set(bs,L);A.showOverlay([X.pageX,X.pageY]);A.get(n).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bs)){var X=L[h].get(o);var A=X.one(g+a6);setTimeout(function(){A.selectText();},0);}}else{L.set(bs,null);L.get(n).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(M);L[h].render();L[aa].render();var X=L[h].get(o);X.addClass(bv);L[h].set(B,L[aa].get(o));L[h].on(aP,aI.bind(L._onOverlayVisibleChange,L));L.formNode=aI.Node.create(bw);L[h].set(ay,L.formNode);L.formNode.on(bj,aI.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bs);if(!X){X=new (A.get(aQ))({endDate:A.get(aN),scheduler:A.get(ae),startDate:A.get(bk)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aE,L[aE]);X.set(aL,L[aL]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aF);var by=(X.get(bs)||X);var bA=by.get(aN);var bz=by.get(ae);var A=by.get(bk);var Y=(bz.get(P).get(aV)?j.toIsoTimeString:j.toUsTimeString);return[by._formatDate(A,L),Y(A),bc,Y(bA)].join(q);},getTemplateData:function(){var L=this;var A=L.get(M);var X=(L.get(bs)||L);return{content:X.get(aE)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aN).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aL),startDate:X.get(bk).getTime()};},hideOverlay:function(){var A=this;A[h].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aI.each(aI.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[a8],value:L[bl]});});}A.formNode.setContent(A.get(a5).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aI.QueryString.parse(r(A.formNode.getDOM()));},showOverlay:function(Y,bz){var A=this;var X=A.get(R);if(!A[h].get(bp)){A._renderOverlay();}A[h].show();if(!Y){var L=(A.get(bs)||A).get(n);var by=L.one(g+D);bz=[X[0]+by.get(bf),X[1]+by.get(N)/2];Y=by.getXY();}bz=bz||X;Y[0]+=bz[0];Y[1]+=bz[1];A[h].set("xy",Y);}}});aI.SchedulerEventRecorder=V;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});