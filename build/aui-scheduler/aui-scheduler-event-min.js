AUI.add("aui-scheduler-event",function(AU){var AF=AU.Lang,A5=AF.isString,I=AF.isDate,Av=AF.isFunction,k=AF.isObject,Ax=AF.isBoolean,u=AF.isNumber,Am=AU.ColorUtil,O=AU.DataType.DateMath,As=AU.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),A2="-",AK=".",U="",V=" ",R="_",AZ="_propagateSet",p="activeView",BE="borderWidth",Ai="colorBrightnessFactor",A0="colorSaturationFactor",l="Change",Ar="color",AQ="content",AA="contentNode",Ao="duration",Ac="endDate",A6="events",Aq="id",Ak="isoTime",BB="locale",S="node",L="overlay",AW="parentEvent",BG="recorder",Aa="repeat",A4="repeated",o="repeatedEvents",z="scheduler",AI="scheduler-event",AJ="scheduler-event-recorder",A8="startDate",Au="template",Ah="title",H="titleDateFormat",i="titleNode",AS="borderStyle",G="%H:%M",At="%I:%M",g=AU.ClassNameManager.getClassName,W=g(AI),AG=g(AI,BG),Ad=g(AI,AQ),AM=g(AI,A4),d=g(AI,Ah),AX='<div class="'+W+'">'+'<div class="'+d+'"></div>'+'<div class="'+Ad+'"></div>'+"</div>";var q=AU.Component.create({NAME:AI,ATTRS:{borderStyle:{value:"solid",validator:A5},borderWidth:{value:"1px",validator:A5},colorBrightnessFactor:{value:0.75,validator:u},colorSaturationFactor:{value:1.5,validator:u},content:{value:"(no title)",validator:A5},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:A5},titleDateFormat:{getter:"_getTitleDateFormat",validator:A5},endDate:{valueFn:function(){var A=O.clone(this.get(A8));A.setHours(A.getHours()+1);return A;},validator:I},columnNode:{setter:AU.one},node:{valueFn:function(){return AU.Node.create(AX).setData(AI,this);},setter:AU.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:I}},EXTENDS:AU.Base,PROPAGATE_ATTRS:[A8,Ac,AQ,Ar,Ai,A0,AS,BE,H],prototype:{eventStack:null,initializer:function(){var A=this;var BC=A.get(S);A.eventStack={};A.nodeStack={};AU.Array.each(AU.SchedulerEvent.PROPAGATE_ATTRS,function(BD){A.after(BD+l,A._propagateAttrChange);});A.contentNode=BC.one(AK+Ad);A.titleNode=BC.one(AK+d);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(BC,BD){BC.destroy();});A.eventStack={};A.get(S).remove(true);},copyDates:function(BC){var A=this;A.set(Ac,O.clone(BC.get(Ac)));A.set(A8,O.clone(BC.get(A8)));},copyPropagateAttrValues:function(BC,BD){var A=this;A.copyDates(BC);AU.Array.each(AU.SchedulerEvent.PROPAGATE_ATTRS,function(BJ){if(!(BJ in (BD||{}))){var BK=BC.get(BJ);if(!k(BK)){A.set(BJ,BK);}}});},getBorderColor:function(){var A=this;return A.borderColorRGB.hex;},getDaysDuration:function(){var A=this;return O.getDayOffset(A.get(Ac),A.get(A8));},getHoursDuration:function(){var A=this;return O.getHoursOffset(A.get(Ac),A.get(A8));},getMinutesDuration:function(){var A=this;return O.getMinutesOffset(A.get(Ac),A.get(A8));},getSecondsDuration:function(){var A=this;return O.getSecondsOffset(A.get(Ac),A.get(A8));},sameEndDate:function(BC){var A=this;return O.compare(A.get(Ac),BC.get(Ac));},sameStartDate:function(BC){var A=this;return O.compare(A.get(A8),BC.get(A8));},isAfter:function(BJ){var BD=this;var BC=BD.get(A8);var A=BJ.get(A8);return O.after(BC,A);},isBefore:function(BJ){var BD=this;var BC=BD.get(A8);var A=BJ.get(A8);return O.before(BC,A);},repeatByDate:function(BD){var A=this;var BJ=A.uidByDate(BD);if(!A.eventStack[BJ]){var BC=O.clone(BD);var BK=O.clone(BD);O.copyHours(BC,A.get(A8));O.copyHours(BK,A.get(Ac));var BL=new AU.SchedulerEvent({endDate:BK,parentEvent:A,scheduler:A.get(z),startDate:BC});BL.copyPropagateAttrValues(A);A.eventStack[BJ]=BL;}return A.eventStack[BJ];},intersects:function(BJ){var BD=this;var BK=BD.get(Ac);var BC=BD.get(A8);var A=BJ.get(A8);return(BD.sameStartDate(BJ)||O.between(A,BC,BK));},intersectHours:function(BD){var BC=this;var BK=BC.get(Ac);var A=BC.get(A8);var BJ=O.clone(A);O.copyHours(BJ,BD.get(A8));return(O.compare(A,BJ)||O.between(BJ,A,BK));},isDayOverlapEvent:function(){var A=this;return O.isDayOverlap(A.get(A8),A.get(Ac));},isRepeatableDate:function(BC){var A=this;var BD=A.get(Aa);return(BD&&BD.validate(A,BC));},getClearEndDate:function(){var A=this;return O.safeClearTime(A.get(Ac));},getClearStartDate:function(){var A=this;return O.safeClearTime(A.get(A8));},uidByDate:function(BC){var A=this;BC=I(BC)?O.safeClearTime(BC):A.getClearStartDate();return[AI,BC.getTime()].join(R);},setContent:function(BD,BC){var A=this;A._setContent(AA,BD,BC);},setTitle:function(BD,BC){var A=this;A._setContent(i,BD,BC);},syncNodeUI:function(BC){var A=this;A.get(S).toggleClass(AM,!!(A.get(AW)));A.syncNodeColorUI(BC);A.syncNodeTitleUI(BC);A.syncNodeContentUI(BC);},syncNodeColorUI:function(BC){var A=this;var BD=A.get(S);var BJ=A.getBorderColor();if(BD){BD.setStyles({borderWidth:A.get(BE),borderColor:BJ,backgroundColor:A.get(Ar),borderStyle:A.get(AS)});}if(A.titleNode){A.titleNode.setStyles({backgroundColor:BJ});}if(BC){A.eachRepeatedEvent(function(BK,BL){BK.syncNodeColorUI();});}},syncNodeContentUI:function(BC){var A=this;A.setContent(A.get(AQ),BC);},syncNodeTitleUI:function(BC){var A=this;var BD=A._formatDate(A.get(A8));var BJ=A._formatDate(A.get(Ac));A.setTitle([BD,BJ].join(V+A2+V),BC);},eachRepeatedEvent:function(BC){var A=this;AU.each(A.eventStack,BC,A);},unlink:function(){var A=this;if(A.get(AW)){A.set(AW,null);}else{A.eachRepeatedEvent(function(BC,BD){BC.unlink();});}A.eventStack={};A.syncNodeUI();},_propagateAttrChange:function(BJ){var A=this;var BD=BJ.attrName;var BC=BJ.newVal;A.eachRepeatedEvent(function(BK,BL){var BM=BK[AZ+As(BD)];if(BM){BM.apply(A,[BK,BD,BC]);}else{BK.set(BD,BJ.newVal);}BK.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,BC,BJ){var BD=O.clone(A.get(Ac));O.copyHours(BD,BJ);A.set(Ac,BD);},_propagateSetStartDate:function(BC,BD,BJ){var A=O.clone(BC.get(A8));O.copyHours(A,BJ);BC.set(A8,A);},_setColor:function(BC){var A=this;A.hsbColor=Am.rgb2hsb(Am.getRGB(BC));A.borderColor=AU.clone(A.hsbColor);A.borderColor.b*=A.get(Ai);A.borderColor.s*=A.get(A0);A.borderColorRGB=Am.hsb2rgb(A.borderColor);
return BC;},_setContent:function(BD,BK,BC){var A=this;var BJ=A[BD];if(BJ){BJ.setContent(BK);}if(BC){A.eachRepeatedEvent(function(BL,BM){BL[BD].setContent(BK);});}},_setRepeat:function(BC){var A=this;if(A5(BC)){BC=AU.SchedulerEventRepeat[BC];}return BC;},_setScheduler:function(BD){var A=this;var BC=A.get(z);if(BC){A.removeTarget(BC);}A.addTarget(BD);return BD;},_formatDate:function(BD,BJ){var BC=this;var A=BC.get(BB);BJ=BJ||BC.get(H);return AU.DataType.Date.format(BD,{format:BJ,locale:A});},_getTitleDateFormat:function(BD){var A=this;if(!A5(BD)){var BC=A.get(z);BD=(BC&&BC.get(p).get(Ak))?G:At;}return BD;}}});AU.SchedulerEvent=q;AU.SchedulerEventRepeat={dayly:{description:"Every day",validate:function(A,BC){return true;},value:"dayly"},monthly:{description:"Every month",validate:function(BC,BD){var BJ=BC.get(Ac);var A=BC.get(A8);return(A.getDate()===BD.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,BC){return O.isMonWedOrFri(BC);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,BC){return O.isTueOrThu(BC);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,BC){return O.isWeekDay(BC);},value:"weekDays"},weekly:{description:"Every week",validate:function(BC,BD){var BJ=BC.get(Ac);var A=BC.get(A8);return(A.getDay()===BC.getDay());},value:"weekly"}};var p="activeView",BA="bc",A9="bd",AL="bodyContent",T="boundingBox",AV="button",F="column",AQ="content",AR="dateFormat",AO="dblclick",Ap="desc",AN="disk",BH="event",Aw="field",AY="fieldset",AP="form",AB="hint",AE="input",Ak="isoTime",Ab="label",X="layout",Ag="menu",e="overlayContextPanel",P="pencil",Aa="repeat",Q="row",z="scheduler",t="select",n="strings",B="tc",h="text",s="when",K="trigger",AC="auiSchedulerEventRecorderWhen",A1="auiSchedulerEventRecorderDesc",An="auiSchedulerEventRecorderSelect",c="auiSchedulerEventRecorderButtonRow",AT="scheduler-event-recorder:save",y="scheduler-event-recorder:cancel",A2="-",f="#",BI=g(AI,BG,L),Az=g(AI,BG,AP),Y=g(AP),M=g(X,AQ),A3=g(X,AY),AH=g(X,AY,A9),x=g(X,AY,AQ),b=g(X,"w100"),N=g(F),Ae=g(F,AQ),C=g(Aw),Z=g(Aw,Ag),Af=g(Aw,t),A7=g(Aw,AQ),E=g(Aw,Ab),Al=g(Aw,h),J=g(AV,Q),Ay=g(Aw,AE),AD=g(Aw,AE,t),a=g(Aw,AE,h),Aj=g(AI,BG,Ab,s),D=g(AI,BG,Ap),m=g(AI,BG,Aw,AB),w=g(AI,BG,Aa),v=g(AI,BG,AV,Q),j="<option></option>",BF='<form id="auiSchedulerEventRecorderForm" class="'+[Az,M,Y].join(V)+'">'+'<div class="'+[A3,b,N].join(V)+'">'+'<div class="'+[x,Ae].join(V)+'aui-fieldset-content aui-column-content">'+'<div class="'+AH+'">'+'<span class="'+[C,Al].join(V)+'">'+'<span class="'+A7+'">'+'<label class="'+E+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+Aj+'"></span>'+"</span>"+"</span>"+'<span class="'+[C,Al].join(V)+'">'+'<span class="'+A7+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[Ay,a,D].join(V)+'" size="30" type="text" />'+'<div class="'+m+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[C,Z,Af].join(V)+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[Ay,AD,w].join(V)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[C,J,v].join(V)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";var r=AU.Component.create({NAME:AJ,ATTRS:{content:{value:U},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:A5},event:{},strings:{value:{},setter:function(A){return AU.merge({save:"Save",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",when:"When","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat"},A||{});},validator:k},overlayContextPanel:{value:{},setter:function(BC){var A=this;var BD=AU.Node.create(AU.substitute(BF,A.get(n)));return AU.merge({align:{points:[BA,B]},anim:false,bodyContent:BD,hideOn:AO,trigger:A.get(S),visible:false,zIndex:9999},BC||{});}}},EXTENDS:AU.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.after("schedulerChange",A._afterSchedulerChange);A.on("startDateChange",A._onStartDateChange);A.get(S).addClass(AG);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(BC){var A=this;var BJ=A.overlayDescNode.val();var BD=A.get(BH);if(!BD){BD=new AU.SchedulerEvent({endDate:A.get(Ac),scheduler:A.get(z),startDate:A.get(A8)});BD.copyPropagateAttrValues(A,{content:true});}BD.set(Aa,A.overlaySelectNode.val());if(BJ){BD.set(AQ,BJ);}return BD;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},loadFormValues:function(){var A=this;var BJ=U;var BD=U;var BC=A.get(BH);if(BC){var BK=BC.get(Aa);if(BK){BJ=BK.value;}BD=BC.get(AQ);}A.overlaySelectNode.val(BJ);A.overlayWhenNode.setContent(A._getWhenFormattedDt());setTimeout(function(){A.overlayDescNode.val(BD).selectText();},0);},_afterSchedulerChange:function(BJ){var A=this;var BD=BJ.newVal;var BC=BD.get(T);BC.delegate("click",AU.bind(A._onClickSchedulerEvent,A),AK+W);},_createEvents:function(){var A=this;var BC=function(BD,BJ){A.publish(BD,{defaultFn:BJ,queuable:false,emitFacade:true,bubbles:true,prefix:AJ});};BC(AT,this._defSaveEventFn);BC(y,this._defCancelEventFn);},_initOverlay:function(){var BC=this;var A=BC.get(n);BC.overlay=new AU.OverlayContextPanel(BC.get(e));var BJ=BC.overlay;var BD=BJ.get(T);var BK=BJ.get(AL);BC.overlayButtonRowNode=BK.one(f+c);BC.overlayDescNode=BK.one(f+A1);BC.overlaySelectNode=BK.one(f+An);BC.overlayWhenNode=BK.one(f+AC);BC.overlaySaveBtn=new AU.ButtonItem({label:A.save,icon:AN,render:BC.overlayButtonRowNode,handler:{fn:BC._handleSaveEvent,context:BC}});BC.overlayEditBtn=new AU.ButtonItem({label:A.edit,icon:P,render:BC.overlayButtonRowNode,handler:{fn:BC._handleEditEvent,context:BC}});BC.overlayCancelBtn=new AU.ButtonItem({label:A.cancel,render:BC.overlayButtonRowNode,handler:{fn:BC._handleCancelEvent,context:BC}});
AU.each(AU.SchedulerEventRepeat,function(BM,BL){BC.overlaySelectNode.append(AU.Node.create(j).val(BM.value||BL).setContent(BM.description));});BJ.on("hide",AU.bind(BC._onOverlayHide,BC));BJ.on("show",AU.bind(BC._onOverlayShow,BC));BK.on("submit",AU.bind(BC._handleSaveEvent,BC));BD.addClass(BI);},_defCancelEventFn:function(BC){var A=this;A.hideOverlay();},_defSaveEventFn:function(BD){var A=this;var BC=A.get(z);BC.addEvent(BD.newSchedulerEvent);A.hideOverlay();BC.syncEventsUI();},_getWhenFormattedDt:function(){var BD=this;var BC=BD.get(AR);var BK=(BD.get(BH)||BD);var BM=BK.get(Ac);var BL=BK.get(z);var A=BK.get(A8);var BJ=(BL.get(p).get(Ak)?O.toIsoTimeString:O.toUsTimeString);return[BK._formatDate(A,BC),BJ(A),A2,BJ(BM)].join(V);},_handleEditEvent:function(BC){var A=this;A._handleSaveEvent(BC);},_handleSaveEvent:function(BC){var A=this;A.fire(AT,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleCancelEvent:function(BC){var A=this;A.fire(y);BC.preventDefault();},_onClickSchedulerEvent:function(BD){var A=this;var BC=BD.currentTarget.getData(AI);if(BC){if(!A.overlay){A._initOverlay();}A.set(BH,BC);A.overlay.set(K,BC.get(S));A.showOverlay();}},_onOverlayHide:function(BD){var A=this;var BC=A.get(S);if(A.overlay){A.set(BH,null);A.overlay.set(K,BC);}BC.remove();},_onOverlayShow:function(BC){var A=this;var BD=A.overlayEditBtn;if(A.get(BH)){BD.show();}else{BD.hide();}A.loadFormValues();},_onStartDateChange:function(BC){var A=this;var BD=A.get(Ao);A.set(Ac,O.add(BC.newVal,O.MINUTES,BD));}}});AU.SchedulerEventRecorder=r;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-overlay-context-panel","substitute"]});