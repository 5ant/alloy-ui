AUI.add("aui-scheduler-event",function(AR){var AD=AR.Lang,Az=AD.isString,I=AD.isDate,Aq=AD.isFunction,i=AD.isObject,As=AD.isBoolean,N=AR.DataType.DateMath,An=AR.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),Aw="-",AI=".",S="",T=" ",P="_",AW="_propagateSet",n="activeView",o="borderColor",j="Change",Am="color",AO="content",AZ="endDate",Al="id",Ag="isoTime",A5="locale",Q="node",AT="parentEvent",AX="repeat",Ay="repeated",m="repeatedEvents",x="scheduler",AG="scheduler-event",AH="scheduler-event-recorder",A2="startDate",Ap="template",Ad="title",H="titleDateFormat",g="titleNode",y="contentNode",A0="events",A7="recorder",Aj="duration",K="overlay",G="%H:%M",Ao="%I:%M",e=AR.ClassNameManager.getClassName,U=e(AG),AE=e(AG,A7),Aa=e(AG,AO),AK=e(AG,Ay),b=e(AG,Ad),AU='<div class="'+U+'">'+'<div class="'+b+'"></div>'+'<div class="'+Aa+'"></div>'+"</div>";var p=AR.Component.create({NAME:AG,ATTRS:{borderColor:{value:"#A32929",validator:Az},content:{value:"(no title)",validator:Az},color:{value:"#D96666",validator:Az},titleDateFormat:{getter:"_getTitleDateFormat",validator:Az},endDate:{valueFn:function(){var A=N.clone(this.get(A2));A.setHours(A.getHours()+1);return A;},validator:I},columnNode:{setter:AR.one},node:{valueFn:function(){return AR.Node.create(AU).setData(AG,this);},setter:AR.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:I}},EXTENDS:AR.Base,PROPAGATE_ATTRS:[A2,AZ,AO,o,Am,H],prototype:{eventStack:null,initializer:function(){var A=this;var A9=A.get(Q);A.eventStack={};A.nodeStack={};AR.Array.each(AR.SchedulerEvent.PROPAGATE_ATTRS,function(BA){A.after(BA+j,A._propagateAttrChange);});A.contentNode=A9.one(AI+Aa);A.titleNode=A9.one(AI+b);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(A9,BA){A9.destroy();});A.eventStack={};A.get(Q).remove(true);},copyDates:function(A9){var A=this;A.set(AZ,N.clone(A9.get(AZ)));A.set(A2,N.clone(A9.get(A2)));},getDaysDuration:function(){var A=this;return N.getDayOffset(A.get(AZ),A.get(A2));},getHoursDuration:function(){var A=this;return N.getHoursOffset(A.get(AZ),A.get(A2));},getMinutesDuration:function(){var A=this;return N.getMinutesOffset(A.get(AZ),A.get(A2));},getSecondsDuration:function(){var A=this;return N.getSecondsOffset(A.get(AZ),A.get(A2));},sameEndDate:function(A9){var A=this;return N.compare(A.get(AZ),A9.get(AZ));},sameStartDate:function(A9){var A=this;return N.compare(A.get(A2),A9.get(A2));},isAfter:function(BB){var BA=this;var A9=BA.get(A2);var A=BB.get(A2);return N.after(A9,A);},isBefore:function(BB){var BA=this;var A9=BA.get(A2);var A=BB.get(A2);return N.before(A9,A);},repeatByDate:function(BA){var A=this;var BB=A.uidByDate(BA);if(!A.eventStack[BB]){var A9=N.clone(BA);var BC=N.clone(BA);N.copyHours(A9,A.get(A2));N.copyHours(BC,A.get(AZ));A.eventStack[BB]=new AR.SchedulerEvent({parentEvent:A,borderColor:A.get(o),content:A.get(AO),color:A.get(Am),endDate:BC,scheduler:A.get(x),startDate:A9,titleDateFormat:A.get(H)});}return A.eventStack[BB];},intersects:function(BB){var BA=this;var BC=BA.get(AZ);var A9=BA.get(A2);var A=BB.get(A2);return(BA.sameStartDate(BB)||N.between(A,A9,BC));},intersectHours:function(BA){var A9=this;var BC=A9.get(AZ);var A=A9.get(A2);var BB=N.clone(A);N.copyHours(BB,BA.get(A2));return(N.compare(A,BB)||N.between(BB,A,BC));},isDayOverlapEvent:function(){var A=this;return N.isDayOverlap(A.get(A2),A.get(AZ));},isRepeatableDate:function(A9){var A=this;var BA=A.get(AX);return(BA&&BA.validate(A,A9));},getClearEndDate:function(){var A=this;return N.safeClearTime(A.get(AZ));},getClearStartDate:function(){var A=this;return N.safeClearTime(A.get(A2));},uidByDate:function(A9){var A=this;A9=I(A9)?N.safeClearTime(A9):A.getClearStartDate();return[AG,A9.getTime()].join(P);},setContent:function(BA,A9){var A=this;A._setContent(y,BA,A9);},setTitle:function(BA,A9){var A=this;A._setContent(g,BA,A9);},syncNodeUI:function(A9){var A=this;A.get(Q).toggleClass(AK,!!(A.get(AT)));A.syncNodeTitleUI(A9);A.syncNodeContentUI(A9);},syncNodeContentUI:function(A9){var A=this;A.setContent(A.get(AO),A9);},syncNodeTitleUI:function(A9){var A=this;var BA=A._formatDate(A.get(A2));var BB=A._formatDate(A.get(AZ));A.setTitle([BA,BB].join(T+Aw+T),A9);},eachRepeatedEvent:function(A9){var A=this;AR.each(A.eventStack,A9,A);},unlink:function(){var A=this;if(A.get(AT)){A.set(AT,null);}else{A.eachRepeatedEvent(function(A9,BA){A9.unlink();});}A.eventStack={};A.syncNodeUI();},_propagateAttrChange:function(BB){var A=this;var BA=BB.attrName;var A9=BB.newVal;A.eachRepeatedEvent(function(BC,BD){var BE=BC[AW+An(BA)];if(BE){BE.apply(A,[BC,BA,A9]);}else{BC.set(BA,BB.newVal);}BC.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,A9,BB){var BA=N.clone(A.get(AZ));N.copyHours(BA,BB);A.set(AZ,BA);},_propagateSetStartDate:function(A9,BA,BB){var A=N.clone(A9.get(A2));N.copyHours(A,BB);A9.set(A2,A);},_setContent:function(BA,BC,A9){var A=this;var BB=A[BA];if(BB){BB.setContent(BC);}if(A9){A.eachRepeatedEvent(function(BD,BE){BD[BA].setContent(BC);});}},_setRepeat:function(A9){var A=this;if(Az(A9)){A9=AR.SchedulerEventRepeat[A9];}return A9;},_setScheduler:function(BA){var A=this;var A9=A.get(x);if(A9){A.removeTarget(A9);}A.addTarget(BA);return BA;},_formatDate:function(BA,BB){var A9=this;var A=A9.get(A5);BB=BB||A9.get(H);return AR.DataType.Date.format(BA,{format:BB,locale:A});},_getTitleDateFormat:function(BA){var A=this;if(!Az(BA)){var A9=A.get(x);BA=(A9&&A9.get(n).get(Ag))?G:Ao;}return BA;}}});AR.SchedulerEvent=p;var A4="bc",A3="bd",AJ="bodyContent",R="boundingBox",AS="button",F="column",AO="content",AM="dblclick",Ak="desc",AL="disk",Ar="field",AV="fieldset",AN="form",z="hint",AC="input",AY="label",V="layout",Ae="menu",c="overlayContextPanel",AX="repeat",O="row",s="select",l="strings",B="tc",f="text",r="when",AP="dateFormat",x="scheduler",Ag="isoTime",AA="auiSchedulerEventRecorderWhen",Av="auiSchedulerEventRecorderDesc",Ai="auiSchedulerEventRecorderSelect",a="auiSchedulerEventRecorderButtonRow",AQ="scheduler-event-recorder:save",w="scheduler-event-recorder:cancel",Aw="-",d="#",A8=e(AG,A7,K),Au=e(AG,A7,AN),W=e(AN),L=e(V,AO),Ax=e(V,AV),AF=e(V,AV,A3),v=e(V,AV,AO),Z=e(V,"w100"),M=e(F),Ab=e(F,AO),C=e(Ar),X=e(Ar,Ae),Ac=e(Ar,s),A1=e(Ar,AO),E=e(Ar,AY),Ah=e(Ar,f),J=e(AS,O),At=e(Ar,AC),AB=e(Ar,AC,s),Y=e(Ar,AC,f),Af=e(AG,A7,AY,r),D=e(AG,A7,Ak),k=e(AG,A7,Ar,z),u=e(AG,A7,AX),t=e(AG,A7,AS,O),h="<option></option>",A6='<form id="auiSchedulerEventRecorderForm" class="'+[Au,L,W].join(T)+'">'+'<div class="'+[Ax,Z,M].join(T)+'">'+'<div class="'+[v,Ab].join(T)+'aui-fieldset-content aui-column-content">'+'<div class="'+AF+'">'+'<span class="'+[C,Ah].join(T)+'">'+'<span class="'+A1+'">'+'<label class="'+E+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+Af+'"></span>'+"</span>"+"</span>"+'<span class="'+[C,Ah].join(T)+'">'+'<span class="'+A1+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[At,Y,D].join(T)+'" size="30" type="text" />'+'<div class="'+k+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[C,X,Ac].join(T)+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[At,AB,u].join(T)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[C,J,t].join(T)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";
var q=AR.Component.create({NAME:AH,ATTRS:{content:{value:S},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:Az},strings:{value:{},setter:function(A){return AR.merge({save:"Save",cancel:"Cancel",description:"Description",repeat:"Repeat",when:"When","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat"},A||{});},validator:i},overlayContextPanel:{value:{},setter:function(A9){var A=this;var BA=AR.Node.create(AR.substitute(A6,A.get(l)));return AR.merge({align:{points:[A4,B]},anim:false,bodyContent:BA,hideOn:AM,trigger:A.get(Q),visible:false,zIndex:9999},A9||{});}}},EXTENDS:AR.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.on("startDateChange",A._onStartDateChange);A.get(Q).addClass(AE);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(A9){var A=this;var BB=A.overlayDescNode.val();var BA=new AR.SchedulerEvent({borderColor:A.get(o),color:A.get(Am),endDate:A.get(AZ),scheduler:A.get(x),startDate:A.get(A2),repeat:A.overlaySelectNode.val(),titleDateFormat:A.get(H)});if(BB){BA.set(AO,BB);}return BA;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},_createEvents:function(){var A=this;var A9=function(BA,BB){A.publish(BA,{defaultFn:BB,queuable:false,emitFacade:true,bubbles:true,prefix:AH});};A9(AQ,this._defSaveEventFn);A9(w,this._defCancelEventFn);},_initOverlay:function(){var A9=this;var A=A9.get(l);A9.overlay=new AR.OverlayContextPanel(A9.get(c));var BB=A9.overlay;var BA=BB.get(R);var BC=BB.get(AJ);A9.overlayButtonRowNode=BC.one(d+a);A9.overlayDescNode=BC.one(d+Av);A9.overlaySelectNode=BC.one(d+Ai);A9.overlayWhenNode=BC.one(d+AA);A9.overlaySaveBtn=new AR.ButtonItem({label:A.save,icon:AL,render:A9.overlayButtonRowNode,handler:{fn:A9._handleSaveEvent,context:A9}});A9.overlayCancelBtn=new AR.ButtonItem({label:A.cancel,render:A9.overlayButtonRowNode,handler:{fn:A9._handleCancelEvent,context:A9}});AR.each(AR.SchedulerEventRepeat,function(BE,BD){A9.overlaySelectNode.append(AR.Node.create(h).val(BD).setContent(BE.description));});BB.on("hide",AR.bind(A9._onOverlayHide,A9));BB.on("show",AR.bind(A9._onOverlayShow,A9));BC.on("submit",AR.bind(A9._handleSaveEvent,A9));BA.addClass(A8);},_defCancelEventFn:function(A9){var A=this;A.hideOverlay();},_defSaveEventFn:function(BA){var A=this;var A9=A.get(x);A9.addEvent(A.getEventCopy());A.hideOverlay();A9.syncEventsUI();},_getWhenFormattedDt:function(){var BA=this;var A9=BA.get(AP);var BD=BA.get(AZ);var BC=BA.get(x);var A=BA.get(A2);var BB=(BC.get(Ag)?N.toIsoTimeString:N.toUsTimeString);return[BA._formatDate(A,A9),BB(A),Aw,BB(BD)].join(T);},_handleSaveEvent:function(A9){var A=this;A.fire(AQ);A9.preventDefault();},_handleCancelEvent:function(A9){var A=this;A.fire(w);A9.preventDefault();},_onOverlayHide:function(A9){var A=this;A.get(Q).remove();},_onOverlayShow:function(A9){var A=this;A.overlayWhenNode.setContent(A._getWhenFormattedDt());setTimeout(function(){A.overlayDescNode.val(S).selectText();},0);},_onStartDateChange:function(A9){var A=this;var BA=A.get(Aj);A.set(AZ,N.add(A9.newVal,N.MINUTES,BA));}}});AR.SchedulerEventRecorder=q;AR.SchedulerEventRepeat={dayly:{description:"Every day",validate:function(A,A9){return true;}},monthly:{description:"Every month",validate:function(A9,BA){var BB=A9.get(AZ);var A=A9.get(A2);return(A.getDate()===A9.getDate());}},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,A9){return N.isMonWedOrFri(A9);}},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,A9){return N.isTueOrThu(A9);}},weekDays:{description:"Every week days",validate:function(A,A9){return N.isWeekDay(A9);}},weekly:{description:"Every week",validate:function(A9,BA){var BB=A9.get(AZ);var A=A9.get(A2);return(A.getDay()===A9.getDay());}}};},"@VERSION@",{requires:["aui-base","aui-color","aui-datatype","aui-overlay-context-panel","substitute"],skinnable:true});