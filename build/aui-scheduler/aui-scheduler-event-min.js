AUI.add("aui-scheduler-event",function(aB){var af=aB.Lang,a7=af.isString,g=af.isDate,aX=af.isFunction,D=af.isObject,a1=af.isBoolean,V=af.isNumber,aP=aB.ColorUtil,j=aB.DataType.DateMath,aU=aB.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),au=":",bl="-",h=".",W="",bn="&ndash;",bk=" ",C="_",aD="_propagateSet",N="activeView",t="all",G="allDay",P="borderColor",aF="borderColorRGB",az="borderStyle",bd="borderWidth",F="Change",aS="color",aN="colorBrightnessFactor",a2="colorSaturationFactor",ax="content",a0="day",r="disabled",aG="endDate",aJ="eventClass",aj="eventStack",am="hidden",E="hsbColor",al="icon",T="icons",ab="inherit",aO="isoTime",bc="locale",aQ="never",m="node",i="overlay",aC="parentEvent",bj="recorder",aE="repeat",a6="repeated",aZ="repeater",Y="scheduler",an="scheduler-event",ap="scheduler-event-recorder",a="short",a9="startDate",aV="template",aM="title",f="titleDateFormat",ai="visible",e="%H:%M",H="%l",bg="%M",ag=function(A){var L=[H];if(A.getMinutes()>0){L.push(au);L.push(bg);}if(A.getHours()>=12){L.push("p");}return L.join(W);},B=aB.getClassName,k=B(al),p=B(an),z=B(an,t,a0),aH=B(an,ax),x=B(an,am),a4=B(an,r),ah=B(an,bj),at=B(an,a6),ae=B(an,aZ),ad=B(an,a),y=B(an,aM),bb=B(an,T),q=B(an,al,r),c=B(an,al,a6),bf=B(an,al,aZ);var R=aB.Component.create({NAME:an,ATTRS:{allDay:{setter:aB.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:a7},borderWidth:{value:"1px",validator:a7},colorBrightnessFactor:{value:0.75,validator:V},colorSaturationFactor:{value:1.5,validator:V},content:{value:"(no title)",validator:a7},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:a7},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this,L=A.get(Y),bq=L&&L.get(N).get(aO),br={endDate:bn+bk+e,startDate:e};if(!bq){br.endDate=bn+bk+ag(A.get(aG));br.startDate=ag(A.get(a9));}if(A.getMinutesDuration()<=30){delete br.endDate;}else{if(A.get(G)){br={};}}return br;}},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(a9));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aB.SchedulerEvent;}},disabled:{value:false,validator:a1},node:{valueFn:function(){return aB.NodeList.create(aB.Node.create(this.EVENT_NODE_TEMPLATE).setData(an,this));}},parentEvent:{},repeat:{value:W,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:a1}},EXTENDS:aB.Base,PROPAGATE_ATTRS:[a9,aG,ax,aS,aN,a2,az,bd,f,ai,r],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+p+'">'+'<div class="'+y+'"></div>'+'<div class="'+aH+'"></div>'+'<div class="'+bb+'">'+'<span class="'+[k,c].join(bk)+'"></span>'+'<span class="'+[k,bf].join(bk)+'"></span>'+'<span class="'+[k,q].join(bk)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(m);A[aj]={};aB.Array.each(A.get(aJ).PROPAGATE_ATTRS,function(bq){A.after(bq+F,A._propagateAttrChange);});A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,bq){L.destroy();});A[aj]={};A.get(m).remove(true);},addPaddingNode:function(){var A=this;A.get(m).push(aB.Node.create(A.EVENT_NODE_TEMPLATE).setData(an,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aG,j.clone(L.get(aG)));A.set(a9,j.clone(L.get(a9)));},copyPropagateAttrValues:function(L,bq){var A=this;A.copyDates(L);aB.Array.each(A.get(aJ).PROPAGATE_ATTRS,function(br){if(!((bq||{}).hasOwnProperty(br))){var bs=L.get(br);if(!D(bs)){A.set(br,bs);}}});},getBorderColor:function(){var A=this;return A[aF].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aG),A.get(a9));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aG),A.get(a9));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aG),A.get(a9));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aG),A.get(a9));},sameEndDate:function(L){var A=this;return j.compare(A.get(aG),L.get(aG));},sameStartDate:function(L){var A=this;return j.compare(A.get(a9),L.get(a9));},isAfter:function(br){var bq=this;var L=bq.get(a9);var A=br.get(a9);return j.after(L,A);},isBefore:function(br){var bq=this;var L=bq.get(a9);var A=br.get(a9);return j.before(L,A);},repeatByDate:function(bq){var L=this;var br=L.uidByDate(bq);if(!L[aj][br]){var A=j.clone(bq);var bt=j.clone(bq);j.copyHours(A,L.get(a9));j.copyHours(bt,L.get(aG));var bs=new L.get(aJ)({endDate:bt,parentEvent:L,scheduler:L.get(Y),startDate:A});bs.copyPropagateAttrValues(L);L[aj][br]=bs;}return L[aj][br];},intersects:function(br){var bq=this;var bs=bq.get(aG);var L=bq.get(a9);var A=br.get(a9);return(bq.sameStartDate(br)||j.between(A,L,bs));},intersectHours:function(bq){var L=this;var bs=L.get(aG);var A=L.get(a9);var br=j.clone(A);j.copyHours(br,bq.get(a9));return(j.compare(A,br)||j.between(br,A,bs));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(a9),A.get(aG));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(a9),A.get(aG));},isRepeatableDate:function(L){var A=this;var bq=A.get(aE);return(bq&&bq.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aG));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(a9));},move:function(L){var A=this;var bq=A.getMinutesDuration();A.set(a9,L);A.set(aG,j.add(j.clone(L),j.MINUTES,bq));},uidByDate:function(L){var A=this;L=g(L)?j.safeClearTime(L):A.getClearStartDate();return[an,L.getTime()].join(C);},setContent:function(bq,L){var A=this;A.get(m).each(function(bs){var br=bs.one(h+aH);br.setContent(bq);});if(L){A.eachRepeatedEvent(function(br,bs){br.setContent(bq);});}},setTitle:function(bq,L){var A=this;A.get(m).each(function(br){var bs=br.one(h+y);bs.setContent(bq);});if(L){A.eachRepeatedEvent(function(br,bs){br.setTitle(bq);});}},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;
var br=A.get(m);var bs=A.getBorderColor();if(br){var bq={borderWidth:A.get(bd),borderColor:bs,backgroundColor:A.get(aS),borderStyle:A.get(az),color:ab};br.setStyles(bq);}if(L){A.eachRepeatedEvent(function(bt,bu){bt.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(ax),L);},syncNodeTitleUI:function(bq){var L=this,bs=L.get(f),A=L.get(a9),br=L.get(aG),bt=[];if(bs.startDate){bt.push(L._formatDate(A,bs.startDate));}if(bs.endDate){bt.push(L._formatDate(br,bs.endDate));}L.setTitle(bt.join(bk),bq);},split:function(){var A=this,bq=j.clone(A.get(a9)),br=j.clone(A.get(aG));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(bq);L.setHours(24,0,0,0);return[[bq,j.toMidnight(j.clone(bq))],[L,j.clone(br)]];}return[[bq,br]];},eachRepeatedEvent:function(L){var A=this;aB.each(A[aj],L,A);},unlink:function(){var A=this;if(A.get(aC)){A.set(aC,null);}else{A.eachRepeatedEvent(function(L,bq){L.unlink();});}A[aj]={};A.syncNodeUI();},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange,visibleChange:A._afterVisibleChange});A._syncUIAttrs();},_propagateAttrChange:function(br){var A=this;var bq=br.attrName;var L=br.newVal;A.eachRepeatedEvent(function(bs,bt){var bu=bs[aD+aU(bq)];if(bu){bu.apply(A,[bs,bq,L]);}else{bs.set(bq,br.newVal);}bs.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,br){var bq=j.clone(A.get(aG));j.copyHours(bq,br);A.set(aG,bq);},_propagateSetStartDate:function(L,bq,br){var A=j.clone(L.get(a9));j.copyHours(A,br);L.set(a9,A);},_setColor:function(L){var A=this;A[E]=aP.rgb2hsb(aP.getRGB(L));A[P]=aB.clone(A[E]);A[P].b*=A.get(aN);A[P].s*=A.get(a2);A[aF]=aP.hsb2rgb(A[P]);return L;},_setDate:function(L){var A=this;if(V(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(a7(L)){L=aB.SchedulerEventRepeat[L];}return D(L)?L:null;},_setScheduler:function(bq){var A=this;var L=A.get(Y);if(L){A.removeTarget(L);}A.addTarget(bq);return bq;},_syncUIAttrs:function(){var A=this;A._uiSetAllDay(A.get(G));A._uiSetDisabled(A.get(r));A._uiSetEndDate(A.get(aG));A._uiSetVisible(A.get(ai));A._uiSetParentEvent(A.get(aC));A._uiSetRepeat(A.get(aE));},_formatDate:function(bq,br){var L=this;var A=L.get(bc);return aB.DataType.Date.format(bq,{format:br,locale:A});},_getTitleDateFormat:function(L){var A=this;if(a7(L)){L={endDate:L,startDate:L};}else{if(aX(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(m).toggleClass(z,!!L);},_uiSetDisabled:function(L){var A=this;A.get(m).toggleClass(a4,!!L);},_uiSetEndDate:function(L){var A=this;A.get(m).toggleClass(ad,A.getMinutesDuration()<=30);},_uiSetParentEvent:function(L){var A=this;A.get(m).toggleClass(at,!!L);},_uiSetRepeat:function(bq){var A=this;var L=!!bq&&bq!==aB.SchedulerEventRepeat[aQ];A.get(m).toggleClass(ae,L);},_uiSetVisible:function(L){var A=this;A.get(m).toggleClass(x,!L);}}});aB.SchedulerEvent=R;aB.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,bq){var br=L.get(aG);var A=L.get(a9);return(A.getDate()===bq.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,bq){var br=L.get(aG);var A=L.get(a9);return(A.getDay()===bq.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,bq){var br=L.get(aG);var A=L.get(a9);return((A.getMonth()===bq.getMonth())&&(A.getDay()===bq.getDay()));},value:"yearly"}};var ao=aB.Lang,b=ao.isArray,d="arrow",aL="body",ar="bodyContent",n="boundingBox",aq="cancel",aR="click",aK="date",ay="dateFormat",ac="delete",aY="description",bi="event",w="footerContent",aw="form",v="header",M="offsetHeight",a5="offsetWidth",O="overlayOffset",be="rendered",aT="save",l="schedulerChange",av="shadow",K="strings",bh="tl",U="toolbar",a8="submit",ba="value",aI="visibleChange",X="cancel",J="delete",u="edit",aA="save",o=aB.IO.prototype._serialize,bm=B(Y,bi,bj,i),s=B(Y,bi,bj,i,d),a3=B(Y,bi,bj,i,d,av),aa=B(Y,bi,bj,i,aL),aW=B(Y,bi,bj,i,ax),Z=B(Y,bi,bj,i,aK),Q=B(Y,bi,bj,i,aw),bp=B(Y,bi,bj,i,v),ak=B(Y,bi,bj,i,aE),I=new aB.Template('<div class="',a3," ",s,'"></div>','<div class="',s,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bp,'">','<input class="',aW,'" name="content" value="{content}" />',"</div>",'<div class="',aa,'">','<label class="',Z,'">{date}</label>','<select class="',ak,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),bo='<form class="'+Q+'" id="schedulerEventRecorderForm"></form>';var S=aB.Component.create({NAME:ap,ATTRS:{allDay:{value:false},content:{value:W},duration:{value:60},dateFormat:{validator:a7,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aB.SchedulerEvent;}},strings:{value:{},setter:function(A){return aB.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});
},validator:D},overlay:{validator:D,value:{align:{points:[bh,bh]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:b},template:{value:I},toolbar:{setter:function(bq){var L=this;var A=L.get(K);return aB.merge({children:[{handler:aB.bind(L._handleSaveEvent,L),label:A[aT]},{handler:aB.bind(L._handleCancelEvent,L),label:A[aq]},{handler:aB.bind(L._handleDeleteEvent,L),label:A[ac]}]},bq||{});},validator:D,value:{}}},EXTENDS:aB.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(m).addClass(ah);A.publish(X,{defaultFn:A._defCancelEventFn});A.publish(J,{defaultFn:A._defDeleteEventFn});A.publish(u,{defaultFn:A._defEditEventFn});A.publish(aA,{defaultFn:A._defSaveEventFn});A.after(l,A._afterSchedulerChange);A[i]=new aB.Overlay(A.get(i));A[U]=new aB.Toolbar(A.get(U));},_afterSchedulerChange:function(br){var A=this;var bq=br.newVal;var L=bq.get(n);L.delegate(aR,aB.bind(A._onClickSchedulerEvent,A),h+p);},_defCancelEventFn:function(L){var A=this;A.get(m).remove();A.hideOverlay();},_defDeleteEventFn:function(bq){var A=this;var L=A.get(Y);L.removeEvent(A.get(bi));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(bq){var A=this;var L=A.get(Y);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(bq){var A=this;var L=A.get(Y);L.addEvent(bq.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(X);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(J,{schedulerEvent:A.get(bi)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bi)?u:aA,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(bq){var A=this;var L=bq.currentTarget.getData(an);if(L){A.set(bi,L);A.showOverlay([bq.pageX,bq.pageY]);A.get(m).remove();}},_onOverlayVisibleChange:function(br){var L=this;if(br.newVal){L.populateForm();if(!L.get(bi)){var bq=L[i].get(n);var A=bq.one(h+aW);setTimeout(function(){A.selectText();},0);}}else{L.set(bi,null);L.get(m).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(K);L[i].render();L[U].render();var bq=L[i].get(n);bq.addClass(bm);L[i].set(w,L[U].get(n));L[i].on(aI,aB.bind(L._onOverlayVisibleChange,L));L.formNode=aB.Node.create(bo);L[i].set(ar,L.formNode);L.formNode.on(a8,aB.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var bq=A.get(bi);if(!bq){bq=new (A.get(aJ))({allDay:A.get(G),endDate:A.get(aG),scheduler:A.get(Y),startDate:A.get(a9)});bq.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();bq.set(ax,L[ax]);bq.set(aE,L[aE]);return bq;},getFormattedDate:function(){var bq=this;var L=bq.get(ay);var bs=(bq.get(bi)||bq);var bu=bs.get(aG);var bt=bs.get(Y);var A=bs.get(a9);var br=(bt.get(N).get(aO)?j.toIsoTimeString:j.toUsTimeString);return[bs._formatDate(A,L),br(A),bl,br(bu)].join(bk);},getTemplateData:function(){var L=this;var A=L.get(K);var bq=(L.get(bi)||L);return{content:bq.get(ax)||A["description-hint"],date:L.getFormattedDate(),endDate:bq.get(aG).getTime(),eventRepeat:L.eventRepeatArray,repeat:bq.get(aE),startDate:bq.get(a9).getTime()};},hideOverlay:function(){var A=this;A[i].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aB.each(aB.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[aY],value:L[ba]});});}A.formNode.setContent(A.get(aV).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aB.QueryString.parse(o(A.formNode.getDOM()));},showOverlay:function(br,bt){var A=this;var bq=A.get(O);if(!A[i].get(be)){A._renderOverlay();}A[i].show();if(!br){var L=(A.get(bi)||A).get(m);var bs=L.one(h+y);bt=[bq[0]+bs.get(a5),bq[1]+bs.get(M)/2];br=bs.getXY();}bt=bt||bq;br[0]+=bt[0];br[1]+=bt[1];A[i].set("xy",br);}}});aB.SchedulerEventRecorder=S;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});