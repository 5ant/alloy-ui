AUI.add("aui-scheduler-event",function(AY){var AH=AY.Lang,A9=AH.isString,I=AH.isDate,Az=AH.isFunction,m=AH.isObject,A1=AH.isBoolean,w=AH.isNumber,Aq=AY.ColorUtil,O=AY.DataType.DateMath,Aw=AY.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),A6="-",AO=".",U="",V=" ",R="_",Ad="_propagateSet",r="activeView",AW="borderStyle",BI="borderWidth",n="Change",Av="color",Am="colorBrightnessFactor",A4="colorSaturationFactor",AU="content",AC="contentNode",As="duration",Ag="endDate",BA="events",AK="hidden",Au="id",Ao="isoTime",BH="locale",S="node",L="overlay",Aa="parentEvent",BK="recorder",Ae="repeat",A8="repeated",q="repeatedEvents",AB="scheduler",AM="scheduler-event",AN="scheduler-event-recorder",BE="startDate",Ay="template",Al="title",H="titleDateFormat",k="titleNode",AI="visible",G="%H:%M",Ax="%I:%M",i=AY.ClassNameManager.getClassName,W=i(AM),Ah=i(AM,AU),d=i(AM,AK),AJ=i(AM,BK),AQ=i(AM,A8),f=i(AM,Al),Ab='<div class="'+W+'">'+'<div class="'+f+'"></div>'+'<div class="'+Ah+'"></div>'+"</div>";var s=AY.Component.create({NAME:AM,ATTRS:{borderStyle:{value:"solid",validator:A9},borderWidth:{value:"1px",validator:A9},colorBrightnessFactor:{value:0.75,validator:w},colorSaturationFactor:{value:1.5,validator:w},content:{value:"(no title)",validator:A9},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:A9},titleDateFormat:{getter:"_getTitleDateFormat",validator:A9},endDate:{valueFn:function(){var A=O.clone(this.get(BE));A.setHours(A.getHours()+1);return A;},validator:I},columnNode:{setter:AY.one},node:{valueFn:function(){return AY.Node.create(Ab).setData(AM,this);},setter:AY.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:I},visible:{value:true,validator:A1}},EXTENDS:AY.Base,PROPAGATE_ATTRS:[BE,Ag,AU,Av,Am,A4,AW,BI,H,AI],prototype:{eventStack:null,initializer:function(){var A=this;var BC=A.get(S);A.eventStack={};A.nodeStack={};AY.Array.each(AY.SchedulerEvent.PROPAGATE_ATTRS,function(BD){A.after(BD+n,A._propagateAttrChange);});A.on("visibleChange",A._onVisibleChange);A._uiSetVisible(A.get(AI));A.contentNode=BC.one(AO+Ah);A.titleNode=BC.one(AO+f);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(BC,BD){BC.destroy();});A.eventStack={};A.get(S).remove(true);},copyDates:function(BC){var A=this;A.set(Ag,O.clone(BC.get(Ag)));A.set(BE,O.clone(BC.get(BE)));},copyPropagateAttrValues:function(BC,BD){var A=this;A.copyDates(BC);AY.Array.each(AY.SchedulerEvent.PROPAGATE_ATTRS,function(BN){if(!(BN in (BD||{}))){var BO=BC.get(BN);if(!m(BO)){A.set(BN,BO);}}});},getBorderColor:function(){var A=this;return A.borderColorRGB.hex;},getDaysDuration:function(){var A=this;return O.getDayOffset(A.get(Ag),A.get(BE));},getHoursDuration:function(){var A=this;return O.getHoursOffset(A.get(Ag),A.get(BE));},getMinutesDuration:function(){var A=this;return O.getMinutesOffset(A.get(Ag),A.get(BE));},getSecondsDuration:function(){var A=this;return O.getSecondsOffset(A.get(Ag),A.get(BE));},sameEndDate:function(BC){var A=this;return O.compare(A.get(Ag),BC.get(Ag));},sameStartDate:function(BC){var A=this;return O.compare(A.get(BE),BC.get(BE));},isAfter:function(BN){var BD=this;var BC=BD.get(BE);var A=BN.get(BE);return O.after(BC,A);},isBefore:function(BN){var BD=this;var BC=BD.get(BE);var A=BN.get(BE);return O.before(BC,A);},repeatByDate:function(BD){var A=this;var BN=A.uidByDate(BD);if(!A.eventStack[BN]){var BC=O.clone(BD);var BO=O.clone(BD);O.copyHours(BC,A.get(BE));O.copyHours(BO,A.get(Ag));var BP=new AY.SchedulerEvent({endDate:BO,parentEvent:A,scheduler:A.get(AB),startDate:BC});BP.copyPropagateAttrValues(A);A.eventStack[BN]=BP;}return A.eventStack[BN];},intersects:function(BN){var BD=this;var BO=BD.get(Ag);var BC=BD.get(BE);var A=BN.get(BE);return(BD.sameStartDate(BN)||O.between(A,BC,BO));},intersectHours:function(BD){var BC=this;var BO=BC.get(Ag);var A=BC.get(BE);var BN=O.clone(A);O.copyHours(BN,BD.get(BE));return(O.compare(A,BN)||O.between(BN,A,BO));},isDayOverlapEvent:function(){var A=this;return O.isDayOverlap(A.get(BE),A.get(Ag));},isRepeatableDate:function(BC){var A=this;var BD=A.get(Ae);return(BD&&BD.validate(A,BC));},getClearEndDate:function(){var A=this;return O.safeClearTime(A.get(Ag));},getClearStartDate:function(){var A=this;return O.safeClearTime(A.get(BE));},uidByDate:function(BC){var A=this;BC=I(BC)?O.safeClearTime(BC):A.getClearStartDate();return[AM,BC.getTime()].join(R);},setContent:function(BD,BC){var A=this;A._setContent(AC,BD,BC);},setTitle:function(BD,BC){var A=this;A._setContent(k,BD,BC);},syncNodeUI:function(BC){var A=this;A.get(S).toggleClass(AQ,!!(A.get(Aa)));A.syncNodeColorUI(BC);A.syncNodeTitleUI(BC);A.syncNodeContentUI(BC);},syncNodeColorUI:function(BC){var A=this;var BD=A.get(S);var BN=A.getBorderColor();if(BD){BD.setStyles({borderWidth:A.get(BI),borderColor:BN,backgroundColor:A.get(Av),borderStyle:A.get(AW)});}if(A.titleNode){A.titleNode.setStyles({backgroundColor:BN});}if(BC){A.eachRepeatedEvent(function(BO,BP){BO.syncNodeColorUI();});}},syncNodeContentUI:function(BC){var A=this;A.setContent(A.get(AU),BC);},syncNodeTitleUI:function(BC){var A=this;var BD=A._formatDate(A.get(BE));var BN=A._formatDate(A.get(Ag));A.setTitle([BD,BN].join(V+A6+V),BC);},eachRepeatedEvent:function(BC){var A=this;AY.each(A.eventStack,BC,A);},unlink:function(){var A=this;if(A.get(Aa)){A.set(Aa,null);}else{A.eachRepeatedEvent(function(BC,BD){BC.unlink();});}A.eventStack={};A.syncNodeUI();},_onVisibleChange:function(BC){var A=this;A._uiSetVisible(BC.newVal);},_propagateAttrChange:function(BN){var A=this;var BD=BN.attrName;var BC=BN.newVal;A.eachRepeatedEvent(function(BO,BP){var BQ=BO[Ad+Aw(BD)];if(BQ){BQ.apply(A,[BO,BD,BC]);}else{BO.set(BD,BN.newVal);}BO.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,BC,BN){var BD=O.clone(A.get(Ag));O.copyHours(BD,BN);A.set(Ag,BD);},_propagateSetStartDate:function(BC,BD,BN){var A=O.clone(BC.get(BE));O.copyHours(A,BN);
BC.set(BE,A);},_setColor:function(BC){var A=this;A.hsbColor=Aq.rgb2hsb(Aq.getRGB(BC));A.borderColor=AY.clone(A.hsbColor);A.borderColor.b*=A.get(Am);A.borderColor.s*=A.get(A4);A.borderColorRGB=Aq.hsb2rgb(A.borderColor);return BC;},_setContent:function(BD,BO,BC){var A=this;var BN=A[BD];if(BN){BN.setContent(BO);}if(BC){A.eachRepeatedEvent(function(BP,BQ){BP[BD].setContent(BO);});}},_setRepeat:function(BC){var A=this;if(A9(BC)){BC=AY.SchedulerEventRepeat[BC];}return BC;},_setScheduler:function(BD){var A=this;var BC=A.get(AB);if(BC){A.removeTarget(BC);}A.addTarget(BD);return BD;},_formatDate:function(BD,BN){var BC=this;var A=BC.get(BH);BN=BN||BC.get(H);return AY.DataType.Date.format(BD,{format:BN,locale:A});},_getTitleDateFormat:function(BD){var A=this;if(!A9(BD)){var BC=A.get(AB);BD=(BC&&BC.get(r).get(Ao))?G:Ax;}return BD;},_uiSetVisible:function(BC){var A=this;A.get(S).toggleClass(d,!BC);}}});AY.SchedulerEvent=s;AY.SchedulerEventRepeat={dayly:{description:"Every day",validate:function(A,BC){return true;},value:"dayly"},monthly:{description:"Every month",validate:function(BC,BD){var BN=BC.get(Ag);var A=BC.get(BE);return(A.getDate()===BD.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,BC){return O.isMonWedOrFri(BC);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,BC){return O.isTueOrThu(BC);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,BC){return O.isWeekDay(BC);},value:"weekDays"},weekly:{description:"Every week",validate:function(BC,BD){var BN=BC.get(Ag);var A=BC.get(BE);return(A.getDay()===BC.getDay());},value:"weekly"}};var r="activeView",BG="bc",BF="bd",AP="bodyContent",T="boundingBox",AZ="button",F="column",AU="content",AV="dateFormat",AS="dblclick",At="desc",AR="disk",BL="event",A0="field",Ac="fieldset",AT="form",AD="hint",AG="input",Ao="isoTime",Af="label",X="layout",Ak="menu",g="overlayContextPanel",P="pencil",Ae="repeat",Q="row",AB="scheduler",v="select",p="strings",B="tc",j="text",u="when",K="trigger",AE="auiSchedulerEventRecorderWhen",A5="auiSchedulerEventRecorderDesc",Ar="auiSchedulerEventRecorderSelect",e="auiSchedulerEventRecorderButtonRow",AA="cancel",b="edit",AX="save",A6="-",h="#",BM=i(AM,BK,L),A3=i(AM,BK,AT),Y=i(AT),M=i(X,AU),A7=i(X,Ac),AL=i(X,Ac,BF),z=i(X,Ac,AU),c=i(X,"w100"),N=i(F),Ai=i(F,AU),C=i(A0),Z=i(A0,Ak),Aj=i(A0,v),BB=i(A0,AU),E=i(A0,Af),Ap=i(A0,j),J=i(AZ,Q),A2=i(A0,AG),AF=i(A0,AG,v),a=i(A0,AG,j),An=i(AM,BK,Af,u),D=i(AM,BK,At),o=i(AM,BK,A0,AD),y=i(AM,BK,Ae),x=i(AM,BK,AZ,Q),l="<option></option>",BJ='<form id="auiSchedulerEventRecorderForm" class="'+[A3,M,Y].join(V)+'">'+'<div class="'+[A7,c,N].join(V)+'">'+'<div class="'+[z,Ai].join(V)+'aui-fieldset-content aui-column-content">'+'<div class="'+AL+'">'+'<span class="'+[C,Ap].join(V)+'">'+'<span class="'+BB+'">'+'<label class="'+E+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+An+'"></span>'+"</span>"+"</span>"+'<span class="'+[C,Ap].join(V)+'">'+'<span class="'+BB+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[A2,a,D].join(V)+'" size="30" type="text" />'+'<div class="'+o+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[C,Z,Aj].join(V)+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[A2,AF,y].join(V)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[C,J,x].join(V)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";var t=AY.Component.create({NAME:AN,ATTRS:{content:{value:U},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:A9},event:{},strings:{value:{},setter:function(A){return AY.merge({save:"Save",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",when:"When","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat"},A||{});},validator:m},overlayContextPanel:{value:{},setter:function(BC){var A=this;var BD=AY.Node.create(AY.substitute(BJ,A.get(p)));return AY.merge({align:{points:[BG,B]},anim:false,bodyContent:BD,hideOn:AS,trigger:A.get(S),visible:false,zIndex:9999},BC||{});}}},EXTENDS:AY.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.after("schedulerChange",A._afterSchedulerChange);A.on("startDateChange",A._onStartDateChange);A.get(S).addClass(AJ);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(BC){var A=this;var BN=A.overlayDescNode.val();var BD=A.get(BL);if(!BD){BD=new AY.SchedulerEvent({endDate:A.get(Ag),scheduler:A.get(AB),startDate:A.get(BE)});BD.copyPropagateAttrValues(A,{content:true});}BD.set(Ae,A.overlaySelectNode.val());if(BN){BD.set(AU,BN);}return BD;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},loadFormValues:function(){var A=this;var BN=U;var BD=U;var BC=A.get(BL);if(BC){var BO=BC.get(Ae);if(BO){BN=BO.value;}BD=BC.get(AU);}A.overlaySelectNode.val(BN);A.overlayWhenNode.setContent(A._getWhenFormattedDt());setTimeout(function(){A.overlayDescNode.val(BD).selectText();},0);},_afterSchedulerChange:function(BN){var A=this;var BD=BN.newVal;var BC=BD.get(T);BC.delegate("click",AY.bind(A._onClickSchedulerEvent,A),AO+W);},_createEvents:function(){var A=this;var BC=function(BD,BN){A.publish(BD,{defaultFn:BN,queuable:false,emitFacade:true,bubbles:true});};BC(AX,this._defSaveEventFn);BC(b,this._defEditEventFn);BC(AA,this._defCancelEventFn);},_initOverlay:function(){var BC=this;var A=BC.get(p);BC.overlay=new AY.OverlayContextPanel(BC.get(g));var BN=BC.overlay;var BD=BN.get(T);var BO=BN.get(AP);BC.overlayButtonRowNode=BO.one(h+e);BC.overlayDescNode=BO.one(h+A5);BC.overlaySelectNode=BO.one(h+Ar);BC.overlayWhenNode=BO.one(h+AE);BC.overlaySaveBtn=new AY.ButtonItem({label:A.save,icon:AR,render:BC.overlayButtonRowNode,handler:{fn:BC._handleSaveEvent,context:BC}});
BC.overlayEditBtn=new AY.ButtonItem({label:A.edit,icon:P,render:BC.overlayButtonRowNode,handler:{fn:BC._handleEditEvent,context:BC}});BC.overlayCancelBtn=new AY.ButtonItem({label:A.cancel,render:BC.overlayButtonRowNode,handler:{fn:BC._handleCancelEvent,context:BC}});AY.each(AY.SchedulerEventRepeat,function(BQ,BP){BC.overlaySelectNode.append(AY.Node.create(l).val(BQ.value||BP).setContent(BQ.description));});BN.on("hide",AY.bind(BC._onOverlayHide,BC));BN.on("show",AY.bind(BC._onOverlayShow,BC));BO.on("submit",AY.bind(BC._onSubmitForm,BC));BD.addClass(BM);},_defCancelEventFn:function(BC){var A=this;A.hideOverlay();},_defEditEventFn:function(BC){var A=this;A.hideOverlay();},_defSaveEventFn:function(BD){var A=this;var BC=A.get(AB);BC.addEvent(BD.newSchedulerEvent);A.hideOverlay();BC.syncEventsUI();},_getWhenFormattedDt:function(){var BD=this;var BC=BD.get(AV);var BO=(BD.get(BL)||BD);var BQ=BO.get(Ag);var BP=BO.get(AB);var A=BO.get(BE);var BN=(BP.get(r).get(Ao)?O.toIsoTimeString:O.toUsTimeString);return[BO._formatDate(A,BC),BN(A),A6,BN(BQ)].join(V);},_handleEditEvent:function(BC){var A=this;A.fire(b,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleSaveEvent:function(BC){var A=this;A.fire(AX,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleCancelEvent:function(BC){var A=this;A.fire(AA);BC.preventDefault();},_onClickSchedulerEvent:function(BD){var A=this;var BC=BD.currentTarget.getData(AM);if(BC){if(!A.overlay){A._initOverlay();}A.set(BL,BC);A.overlay.set(K,BC.get(S));A.get(S).remove();A.showOverlay();}},_onOverlayHide:function(BD){var A=this;var BC=A.get(S);if(A.overlay){A.set(BL,null);A.overlay.set(K,BC);}BC.remove();},_onOverlayShow:function(BD){var BC=this;var BN=BC.overlayEditBtn;var A=BC.overlaySaveBtn;if(BC.get(BL)){BN.show();A.hide();}else{BN.hide();A.show();}BC.loadFormValues();},_onStartDateChange:function(BC){var A=this;var BD=A.get(As);A.set(Ag,O.add(BC.newVal,O.MINUTES,BD));},_onSubmitForm:function(BC){var A=this;if(A.get(BL)){A._handleEditEvent(BC);}else{A._handleSaveEvent(BC);}}}});AY.SchedulerEventRecorder=t;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-overlay-context-panel","substitute"]});