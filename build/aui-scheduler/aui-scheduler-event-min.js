AUI.add("aui-scheduler-event",function(aN){var aq=aN.Lang,bm=aq.isString,f=aq.isDate,bd=aq.isFunction,J=aq.isObject,bg=aq.isBoolean,af=aq.isNumber,a2=aN.ColorUtil,j=aN.DataType.DateMath,a9=aN.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bi="-",v="&ndash;",aB=".",r="",s=" ",n="_",aQ="_propagateSet",R="activeView",U="borderColor",aS="borderColorRGB",aL="borderStyle",bt="borderWidth",M="Change",a7="color",a0="colorBrightnessFactor",bh="colorSaturationFactor",aJ="content",aj="contentNode",y="disabled",a4="duration",aT="endDate",aW="eventClass",au="eventStack",bn="events",ax="hidden",K="hsbColor",aw="icon",ac="icons",a5="id",a1="isoTime",bs="locale",a3="never",p="node",h="overlay",aP="parentEvent",by="recorder",aR="repeat",bl="repeated",Q="repeatedEvents",bf="repeater",ai="scheduler",ay="scheduler-event",aA="scheduler-event-recorder",bp="startDate",bb="template",aZ="title",e="titleDateFormat",I="titleNode",at="visible",k="paddingNode",m="paddingContentNode",aO="paddingTitleNode",d="%H:%M",ba="%I:%M",G=aN.getClassName,l=G(aw),u=G(ay),aU=G(ay,aJ),E=G(ay,ax),bk=G(ay,y),ar=G(ay,by),aE=G(ay,bl),ap=G(ay,bf),F=G(ay,aZ),br=G(ay,ac),x=G(ay,aw,y),b=G(ay,aw,bl),bv=G(ay,aw,bf);var W=aN.Component.create({NAME:ay,ATTRS:{borderStyle:{value:"solid",validator:bm},borderWidth:{value:"1px",validator:bm},colorBrightnessFactor:{value:0.75,validator:af},colorSaturationFactor:{value:1.5,validator:af},content:{value:"(no title)",validator:bm},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bm},titleDateFormat:{getter:"_getTitleDateFormat",validator:bm},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(bp));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aN.SchedulerEvent;}},disabled:{value:false,validator:bg},node:{valueFn:function(){return aN.Node.create(this.EVENT_NODE_TEMPLATE).setData(ay,this);},setter:aN.one},paddingNode:{readOnly:true,valueFn:function(){return aN.Node.create(this.EVENT_NODE_TEMPLATE).setData(ay,this);}},parentEvent:{},repeat:{value:r,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:bg}},EXTENDS:aN.Base,PROPAGATE_ATTRS:[bp,aT,aJ,a7,a0,bh,aL,bt,e,at,y],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+u+'">'+'<div class="'+F+'"></div>'+'<div class="'+aU+'"></div>'+'<div class="'+br+'">'+'<span class="'+[l,b].join(s)+'"></span>'+'<span class="'+[l,bv].join(s)+'"></span>'+'<span class="'+[l,x].join(s)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var X=A.get(p);var L=A.get(k);A[au]={};aN.Array.each(A.get(aW).PROPAGATE_ATTRS,function(Y){A.after(Y+M,A._propagateAttrChange);});A._bindUIAttrs();A[aj]=X.one(aB+aU);A[I]=X.one(aB+F);A[m]=L.one(aB+aU);A[aO]=L.one(aB+F);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[au]={};A.get(k).remove(true);A.get(p).remove(true);},copyDates:function(L){var A=this;A.set(aT,j.clone(L.get(aT)));A.set(bp,j.clone(L.get(bp)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aN.Array.each(A.get(aW).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bD=L.get(Y);if(!J(bD)){A.set(Y,bD);}}});},getBorderColor:function(){var A=this;return A[aS].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aT),A.get(bp));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aT),A.get(bp));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aT),A.get(bp));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aT),A.get(bp));},sameEndDate:function(L){var A=this;return j.compare(A.get(aT),L.get(aT));},sameStartDate:function(L){var A=this;return j.compare(A.get(bp),L.get(bp));},isAfter:function(Y){var X=this;var L=X.get(bp);var A=Y.get(bp);return j.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(bp);var A=Y.get(bp);return j.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[au][Y]){var A=j.clone(X);var bE=j.clone(X);j.copyHours(A,L.get(bp));j.copyHours(bE,L.get(aT));var bD=new L.get(aW)({endDate:bE,parentEvent:L,scheduler:L.get(ai),startDate:A});bD.copyPropagateAttrValues(L);L[au][Y]=bD;}return L[au][Y];},intersects:function(Y){var X=this;var bD=X.get(aT);var L=X.get(bp);var A=Y.get(bp);return(X.sameStartDate(Y)||j.between(A,L,bD));},intersectHours:function(X){var L=this;var bD=L.get(aT);var A=L.get(bp);var Y=j.clone(A);j.copyHours(Y,X.get(bp));return(j.compare(A,Y)||j.between(Y,A,bD));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(bp),A.get(aT));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(bp),A.get(aT));},isRepeatableDate:function(L){var A=this;var X=A.get(aR);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aT));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(bp));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(bp,L);A.set(aT,j.add(j.clone(L),j.MINUTES,X));},uidByDate:function(L){var A=this;L=f(L)?j.safeClearTime(L):A.getClearStartDate();return[ay,L.getTime()].join(n);},setContent:function(X,L){var A=this;A._setContent(aj,X,L);A._setContent(m,X,L);},setTitle:function(X,L){var A=this;A._setContent(I,X,L);A._setContent(aO,X,L);},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var bD=A.get(p);var X=A.get(k);var bE=A.getBorderColor();if(bD&&X){var Y={borderWidth:A.get(bt),borderColor:bE,backgroundColor:A.get(a7),borderStyle:A.get(aL)};bD.setStyles(Y);X.setStyles(Y);}if(L){A.eachRepeatedEvent(function(bF,bG){bF.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aJ),L);},syncNodeTitleUI:function(L){var A=this;var Y=A._formatDate(A.get(bp));var X=A._formatDate(A.get(aT));A.setTitle([Y,X].join(s+v+s),L);
},split:function(){var A=this,X=j.clone(A.get(bp)),Y=j.clone(A.get(aT));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(X);L.setHours(24,0,0,0);return[[X,j.toMidnight(j.clone(X))],[L,j.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aN.each(A[au],L,A);},unlink:function(){var A=this;if(A.get(aP)){A.set(aP,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[au]={};A.syncNodeUI();},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({disabledChange:A._afterDisabledChange,visibleChange:A._afterVisibleChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bD,bE){var bF=bD[aQ+a9(X)];if(bF){bF.apply(A,[bD,X,L]);}else{bD.set(X,Y.newVal);}bD.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=j.clone(A.get(aT));j.copyHours(X,Y);A.set(aT,X);},_propagateSetStartDate:function(L,X,Y){var A=j.clone(L.get(bp));j.copyHours(A,Y);L.set(bp,A);},_setColor:function(L){var A=this;A[K]=a2.rgb2hsb(a2.getRGB(L));A[U]=aN.clone(A[K]);A[U].b*=A.get(a0);A[U].s*=A.get(bh);A[aS]=a2.hsb2rgb(A[U]);return L;},_setContent:function(X,bD,L){var A=this;var Y=A[X];if(Y){Y.setContent(bD);}if(L){A.eachRepeatedEvent(function(bE,bF){bE[X].setContent(bD);});}},_setDate:function(L){var A=this;if(af(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bm(L)){L=aN.SchedulerEventRepeat[L];}return J(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ai);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(y));A._uiSetVisible(A.get(at));A._uiSetParentEvent(A.get(aP));A._uiSetRepeat(A.get(aR));},_formatDate:function(X,Y){var L=this;var A=L.get(bs);Y=Y||L.get(e);return aN.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(X){var A=this;if(!bm(X)){var L=A.get(ai);X=(L&&L.get(R).get(a1))?d:ba;}return X;},_uiSetDisabled:function(L){var A=this;A.get(p).toggleClass(bk,!!L);A.get(k).toggleClass(bk,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(p).toggleClass(aE,!!L);A.get(k).toggleClass(aE,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aN.SchedulerEventRepeat[a3];A.get(p).toggleClass(ap,L);A.get(k).toggleClass(ap,L);},_uiSetVisible:function(L){var A=this;A.get(p).toggleClass(E,!L);A.get(k).toggleClass(E,!L);}}});aN.SchedulerEvent=W;aN.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aT);var A=L.get(bp);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aT);var A=L.get(bp);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aT);var A=L.get(bp);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var az=aN.Lang,a=az.isArray,J=az.isObject,R="activeView",c="arrow",aY="body",aD="bodyContent",q="boundingBox",aC="cancel",a6="click",aJ="content",aX="date",aK="dateFormat",am="delete",be="description",S="edit",bx="event",aW="eventClass",D="footerContent",aH="form",C="header",w="hide",a1="isoTime",aI="link",p="node",h="overlay",T="overlayOffset",by="recorder",bu="rendered",aR="repeat",a8="save",ai="scheduler",o="schedulerChange",ay="scheduler-event",aA="scheduler-event-recorder",aG="shadow",aF="show",H="startDateChange",P="strings",bb="template",aZ="title",bw="tl",ae="toolbar",bo="submit",bq="value",aV="visibleChange",ab="when",ao="x",an="y",ah="cancel",O="delete",B="edit",aM="save",bz="-",g=".",ag="",i="#",t=aN.IO.prototype._serialize,G=aN.getClassName,u=G(ai,bx),ar=G(ai,bx,by),bA=G(ai,bx,by,h),z=G(ai,bx,by,h,c),bj=G(ai,bx,by,h,c,aG),al=G(ai,bx,by,h,aY),bc=G(ai,bx,by,h,aJ),ak=G(ai,bx,by,h,aX),V=G(ai,bx,by,h,aH),bC=G(ai,bx,by,h,C),Z=G(ai,bx,by,h,aI),av=G(ai,bx,by,h,aR),F=G(ai,bx,aZ),N=new aN.Template('<div class="',bj," ",z,'"></div>','<div class="',z,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bC,'">','<input class="',bc,'" name="content" value="{content}" />',"</div>",'<div class="',al,'">','<label class="',ak,'">{date}</label>','<select class="',av,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),ad='<a class="'+Z+'" href="javascript:;">{delete}</a>',bB='<form class="'+V+'" id="schedulerEventRecorderForm"></form>';var aa=aN.Component.create({NAME:aA,ATTRS:{content:{value:ag},duration:{value:60},dateFormat:{validator:bm,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aN.SchedulerEvent;}},strings:{value:{},setter:function(A){return aN.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:J},overlay:{validator:J,value:{align:{points:[bw,bw]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[95,-31],validator:a},template:{value:N},toolbar:{setter:function(X){var L=this;
var A=L.get(P);return aN.merge({children:[{handler:aN.bind(L._handleSaveEvent,L),label:A[a8]},{handler:aN.bind(L._handleCancelEvent,L),label:A[aC]}]},X||{});},validator:J,value:{}}},EXTENDS:aN.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(p).addClass(ar);A.publish(ah,{defaultFn:A._defCancelEventFn});A.publish(O,{defaultFn:A._defDeleteEventFn});A.publish(B,{defaultFn:A._defEditEventFn});A.publish(aM,{defaultFn:A._defSaveEventFn});A.after(o,A._afterSchedulerChange);A[h]=new aN.Overlay(A.get(h));A[ae]=new aN.Toolbar(A.get(ae));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(q);L.delegate(a6,aN.bind(A._onClickSchedulerEvent,A),g+u);},_defCancelEventFn:function(L){var A=this;A.get(p).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ai);L.removeEvent(A.get(bx));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ai);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ai);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ah);L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bx)?B:aM,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickDelete:function(){var A=this;A.fire(O,{schedulerEvent:A.get(bx)});},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(ay);if(L){A.set(bx,L);A.showOverlay(X.currentTarget);A.get(p).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bx)){var X=L[h].get(q);var A=X.one(g+bc);setTimeout(function(){A.selectText();},0);L.deleteNode.hide();}else{L.deleteNode.show();}}else{L.set(bx,null);L.get(p).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(P);L[h].render();L[ae].render();var X=L[h].get(q);X.addClass(bA);L[h].set(D,L[ae].get(q));L[h].on(aV,aN.bind(L._onOverlayVisibleChange,L));L.deleteNode=aN.Node.create(az.sub(ad,{"delete":A[am]}));L[h].footerNode.append(L.deleteNode);L.formNode=aN.Node.create(bB);L[h].set(aD,L.formNode);L.deleteNode.on(a6,aN.bind(L._onClickDelete,L));L.formNode.on(bo,aN.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bx);if(!X){X=new (A.get(aW))({endDate:A.get(aT),scheduler:A.get(ai),startDate:A.get(bp)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aJ,L[aJ]);X.set(aR,L[aR]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aK);var bD=(X.get(bx)||X);var bF=bD.get(aT);var bE=bD.get(ai);var A=bD.get(bp);var Y=(bE.get(R).get(a1)?j.toIsoTimeString:j.toUsTimeString);return[bD._formatDate(A,L),Y(A),bi,Y(bF)].join(s);},getTemplateData:function(){var L=this;var A=L.get(P);var X=(L.get(bx)||L);return{content:X.get(aJ)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aT).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aR),startDate:X.get(bp).getTime()};},hideOverlay:function(){var A=this;A[h].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aN.each(aN.SchedulerEventRepeat,function(X){A.eventRepeatArray.push({description:X[be],value:X[bq]});});}var L=(A.get(bx)||A);A.formNode.setContent(A.get(bb).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aN.QueryString.parse(t(A.formNode.getDOM()));},showOverlay:function(X,Y){var A=this;if(!A[h].get(bu)){A._renderOverlay();}A[h].show();if(!X){var L=(A.get(bx)||A).get(p);X=L.one(g+F);}A[h].set("align.node",X);Y=Y||A.get(T);A[h].move(A[h].get(ao)+Y[0],A[h].get(an)+Y[1]);}}});aN.SchedulerEventRecorder=aa;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});