AUI.add("aui-scheduler-event",function(bl){var bu=bl.Lang,bd=bu.isString,L=bu.isDate,o=bu.isFunction,bG=bu.isObject,ap=bu.isBoolean,aa=bu.isNumber,bp=bl.ColorUtil,Q=bl.DataType.DateMath,ag=bl.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),a4="-",a5="&ndash;",a7=".",aZ="",G=" ",r="_",ay="_propagateSet",a1="activeView",bs="borderColor",bC="borderColorRGB",p="borderStyle",aN="borderWidth",am="Change",bx="color",D="colorBrightnessFactor",aJ="colorSaturationFactor",ah="content",aR="contentNode",aY="disabled",bc="duration",Y="endDate",at="eventStack",bh="events",R="hidden",P="hsbColor",n="icon",w="icons",bv="id",K="isoTime",W="locale",bH="node",aw="overlay",bA="parentEvent",au="recorder",X="repeat",bi="repeated",bB="repeatedEvents",a9="repeater",k="scheduler",Z="scheduler-event",U="scheduler-event-recorder",bo="startDate",af="template",e="title",ae="titleDateFormat",aS="titleNode",V="visible",ab="paddingNode",bq="paddingContentNode",u="paddingTitleNode",bE="%H:%M",S="%I:%M",t=bl.getClassName,d=t(n),ad=t(Z),a0=t(Z,ah),aT=t(Z,R),aE=t(Z,aY),J=t(Z,au),aU=t(Z,bi),aL=t(Z,a9),x=t(Z,e),N=t(Z,w),al=t(Z,n,aY),aH=t(Z,n,bi),aC=t(Z,n,a9);var i=bl.Component.create({NAME:Z,ATTRS:{borderStyle:{value:"solid",validator:bd},borderWidth:{value:"1px",validator:bd},colorBrightnessFactor:{value:0.75,validator:aa},colorSaturationFactor:{value:1.5,validator:aa},content:{value:"(no title)",validator:bd},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bd},titleDateFormat:{getter:"_getTitleDateFormat",validator:bd},endDate:{valueFn:function(){var A=Q.clone(this.get(bo));A.setHours(A.getHours()+1);return A;},validator:L},disabled:{value:false,validator:ap},node:{valueFn:function(){return bl.Node.create(this.EVENT_NODE_TEMPLATE).setData(Z,this);},setter:bl.one},paddingNode:{readOnly:true,valueFn:function(){return bl.Node.create(this.EVENT_NODE_TEMPLATE).setData(Z,this);}},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:L},visible:{value:true,validator:ap}},EXTENDS:bl.Base,PROPAGATE_ATTRS:[bo,Y,ah,bx,D,aJ,p,aN,ae,V,aY],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+ad+'">'+'<div class="'+x+'"></div>'+'<div class="'+a0+'"></div>'+'<div class="'+N+'">'+'<span class="'+[d,aH].join(G)+'"></span>'+'<span class="'+[d,aC].join(G)+'"></span>'+'<span class="'+[d,al].join(G)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var bJ=A.get(bH);var bI=A.get(ab);A[at]={};bl.Array.each(bl.SchedulerEvent.PROPAGATE_ATTRS,function(bK){A.after(bK+am,A._propagateAttrChange);});A._bindUIAttrs();A[aR]=bJ.one(a7+a0);A[aS]=bJ.one(a7+x);A[bq]=bI.one(a7+a0);A[u]=bI.one(a7+x);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(bI,bJ){bI.destroy();});A[at]={};A.get(ab).remove(true);A.get(bH).remove(true);},copyDates:function(bI){var A=this;A.set(Y,Q.clone(bI.get(Y)));A.set(bo,Q.clone(bI.get(bo)));},copyPropagateAttrValues:function(bI,bJ){var A=this;A.copyDates(bI);bl.Array.each(bl.SchedulerEvent.PROPAGATE_ATTRS,function(bK){if(!((bJ||{}).hasOwnProperty(bK))){var bL=bI.get(bK);if(!bG(bL)){A.set(bK,bL);}}});},getBorderColor:function(){var A=this;return A[bC].hex;},getDaysDuration:function(){var A=this;return Q.getDayOffset(A.get(Y),A.get(bo));},getHoursDuration:function(){var A=this;return Q.getHoursOffset(A.get(Y),A.get(bo));},getMinutesDuration:function(){var A=this;return Q.getMinutesOffset(A.get(Y),A.get(bo));},getSecondsDuration:function(){var A=this;return Q.getSecondsOffset(A.get(Y),A.get(bo));},sameEndDate:function(bI){var A=this;return Q.compare(A.get(Y),bI.get(Y));},sameStartDate:function(bI){var A=this;return Q.compare(A.get(bo),bI.get(bo));},isAfter:function(bK){var bJ=this;var bI=bJ.get(bo);var A=bK.get(bo);return Q.after(bI,A);},isBefore:function(bK){var bJ=this;var bI=bJ.get(bo);var A=bK.get(bo);return Q.before(bI,A);},repeatByDate:function(bJ){var bI=this;var bK=bI.uidByDate(bJ);if(!bI[at][bK]){var A=Q.clone(bJ);var bM=Q.clone(bJ);Q.copyHours(A,bI.get(bo));Q.copyHours(bM,bI.get(Y));var bL=new bl.SchedulerEvent({endDate:bM,parentEvent:bI,scheduler:bI.get(k),startDate:A});bL.copyPropagateAttrValues(bI);bI[at][bK]=bL;}return bI[at][bK];},intersects:function(bK){var bJ=this;var bL=bJ.get(Y);var bI=bJ.get(bo);var A=bK.get(bo);return(bJ.sameStartDate(bK)||Q.between(A,bI,bL));},intersectHours:function(bJ){var bI=this;var bL=bI.get(Y);var A=bI.get(bo);var bK=Q.clone(A);Q.copyHours(bK,bJ.get(bo));return(Q.compare(A,bK)||Q.between(bK,A,bL));},isDayBoundaryEvent:function(){var A=this;return Q.isDayBoundary(A.get(bo),A.get(Y));},isDayOverlapEvent:function(){var A=this;return Q.isDayOverlap(A.get(bo),A.get(Y));},isRepeatableDate:function(bI){var A=this;var bJ=A.get(X);return(bJ&&bJ.validate(A,bI));},getClearEndDate:function(){var A=this;return Q.safeClearTime(A.get(Y));},getClearStartDate:function(){var A=this;return Q.safeClearTime(A.get(bo));},move:function(bI){var A=this;var bJ=A.getMinutesDuration();A.set(bo,bI);A.set(Y,Q.add(Q.clone(bI),Q.MINUTES,bJ));},uidByDate:function(bI){var A=this;bI=L(bI)?Q.safeClearTime(bI):A.getClearStartDate();return[Z,bI.getTime()].join(r);},setContent:function(bJ,bI){var A=this;A._setContent(aR,bJ,bI);A._setContent(bq,bJ,bI);},setTitle:function(bJ,bI){var A=this;A._setContent(aS,bJ,bI);A._setContent(u,bJ,bI);},syncNodeUI:function(bI){var A=this;A._syncUIAttrs();A.syncNodeColorUI(bI);A.syncNodeTitleUI(bI);A.syncNodeContentUI(bI);},syncNodeColorUI:function(bI){var A=this;var bL=A.get(bH);var bJ=A.get(ab);var bM=A.getBorderColor();if(bL&&bJ){var bK={borderWidth:A.get(aN),borderColor:bM,backgroundColor:A.get(bx),borderStyle:A.get(p)};bL.setStyles(bK);bJ.setStyles(bK);}if(bI){A.eachRepeatedEvent(function(bN,bO){bN.syncNodeColorUI();});}},syncNodeContentUI:function(bI){var A=this;A.setContent(A.get(ah),bI);},syncNodeTitleUI:function(bI){var A=this;var bK=A._formatDate(A.get(bo));var bJ=A._formatDate(A.get(Y));A.setTitle([bK,bJ].join(G+a5+G),bI);
},split:function(){var A=this,bJ=Q.clone(A.get(bo)),bK=Q.clone(A.get(Y));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var bI=Q.clone(bJ);bI.setHours(24,0,0,0);return[[bJ,Q.toMidnight(Q.clone(bJ))],[bI,Q.clone(bK)]];}return[[bJ,bK]];},eachRepeatedEvent:function(bI){var A=this;bl.each(A[at],bI,A);},unlink:function(){var A=this;if(A.get(bA)){A.set(bA,null);}else{A.eachRepeatedEvent(function(bI,bJ){bI.unlink();});}A[at]={};A.syncNodeUI();},_afterDisabledChange:function(bI){var A=this;A._uiSetDisabled(bI.newVal);},_afterVisibleChange:function(bI){var A=this;A._uiSetVisible(bI.newVal);},_afterRepeatChange:function(bI){var A=this;A._uiSetRepeat(bI.newVal);},_afterParentEventChange:function(bI){var A=this;A._uiSetParentEvent(bI.newVal);},_bindUIAttrs:function(){var A=this;A.after({disabledChange:A._afterDisabledChange,visibleChange:A._afterVisibleChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange});A._syncUIAttrs();},_propagateAttrChange:function(bK){var A=this;var bJ=bK.attrName;var bI=bK.newVal;A.eachRepeatedEvent(function(bL,bM){var bN=bL[ay+ag(bJ)];if(bN){bN.apply(A,[bL,bJ,bI]);}else{bL.set(bJ,bK.newVal);}bL.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,bI,bK){var bJ=Q.clone(A.get(Y));Q.copyHours(bJ,bK);A.set(Y,bJ);},_propagateSetStartDate:function(bI,bJ,bK){var A=Q.clone(bI.get(bo));Q.copyHours(A,bK);bI.set(bo,A);},_setColor:function(bI){var A=this;A[P]=bp.rgb2hsb(bp.getRGB(bI));A[bs]=bl.clone(A[P]);A[bs].b*=A.get(D);A[bs].s*=A.get(aJ);A[bC]=bp.hsb2rgb(A[bs]);return bI;},_setContent:function(bJ,bL,bI){var A=this;var bK=A[bJ];if(bK){bK.setContent(bL);}if(bI){A.eachRepeatedEvent(function(bM,bN){bM[bJ].setContent(bL);});}},_setRepeat:function(bI){var A=this;if(bd(bI)){bI=bl.SchedulerEventRepeat[bI];}return bG(bI)?bI:null;},_setScheduler:function(bJ){var A=this;var bI=A.get(k);if(bI){A.removeTarget(bI);}A.addTarget(bJ);return bJ;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(aY));A._uiSetVisible(A.get(V));A._uiSetParentEvent(A.get(bA));A._uiSetRepeat(A.get(X));},_formatDate:function(bJ,bK){var bI=this;var A=bI.get(W);bK=bK||bI.get(ae);return bl.DataType.Date.format(bJ,{format:bK,locale:A});},_getTitleDateFormat:function(bJ){var A=this;if(!bd(bJ)){var bI=A.get(k);bJ=(bI&&bI.get(a1).get(K))?bE:S;}return bJ;},_uiSetDisabled:function(bI){var A=this;A.get(bH).toggleClass(aE,!!bI);A.get(ab).toggleClass(aE,!!bI);},_uiSetParentEvent:function(bI){var A=this;A.get(bH).toggleClass(aU,!!bI);A.get(ab).toggleClass(aU,!!bI);},_uiSetRepeat:function(bI){var A=this;A.get(bH).toggleClass(aL,!!bI);A.get(ab).toggleClass(aL,!!bI);},_uiSetVisible:function(bI){var A=this;A.get(bH).toggleClass(aT,!bI);A.get(ab).toggleClass(aT,!bI);}}});bl.SchedulerEvent=i;bl.SchedulerEventRepeat={daily:{description:"Every day",validate:function(A,bI){return true;},value:"daily"},monthly:{description:"Every month",validate:function(bI,bJ){var bK=bI.get(Y);var A=bI.get(bo);return(A.getDate()===bJ.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,bI){return Q.isMonWedOrFri(bI);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,bI){return Q.isTueOrThu(bI);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,bI){return Q.isWeekDay(bI);},value:"weekDays"},weekly:{description:"Every week",validate:function(bI,bJ){var bK=bI.get(Y);var A=bI.get(bo);return(A.getDay()===bJ.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(bI,bJ){var bK=bI.get(Y);var A=bI.get(bo);return((A.getMonth()===bJ.getMonth())&&(A.getDay()===bJ.getDay()));},value:"yearly"}};var a1="activeView",ao="bc",an="bd",g="bodyContent",aj="boundingBox",by="button",bf="column",ah="content",aA="dateFormat",T="dblclick",aW="desc",aO="disk",av="event",aG="field",aq="fieldset",m="form",bt="hint",ar="input",K="isoTime",H="label",z="layout",a="menu",bm="overlayButtonRowNode",aQ="overlayContextPanel",a3="overlayDescNode",aX="overlaySelectNode",bD="overlayWhenNode",bk="pencil",X="repeat",aI="row",k="scheduler",aF="select",bg="strings",b="tc",a2="text",q="trigger",ac="when",bF="auiSchedulerEventRecorderButtonRow",a6="auiSchedulerEventRecorderDesc",bn="auiSchedulerEventRecorderSelect",ak="auiSchedulerEventRecorderWhen",B="cancel",F="edit",bb="save",a4="-",be="#",aD=t(by,aI),I=t(bf),y=t(bf,ah),f=t(aG),j=t(aG,ah),aM=t(aG,ar),a8=t(aG,ar,aF),C=t(aG,ar,a2),ai=t(aG,H),bz=t(aG,a),s=t(aG,aF),aK=t(aG,a2),aV=t(z,aq),bw=t(z,aq,an),h=t(z,aq,ah),c=t(m),E=t(z,ah),v=t(Z,au,aW),az=t(Z,au,m),aB=t(Z,au,H,ac),l=t(Z,au,aw),bj=t(z,"w100"),ax=t(Z,au,by,aI),ba=t(Z,au,aG,bt),O=t(Z,au,X),M="<option></option>",aP='<form id="auiSchedulerEventRecorderForm" class="'+[az,E,c].join(G)+'">'+'<div class="'+[aV,bj,I].join(G)+'">'+'<div class="'+[h,y].join(G)+'aui-fieldset-content aui-column-content">'+'<div class="'+bw+'">'+'<span class="'+[f,aK].join(G)+'">'+'<span class="'+j+'">'+'<label class="'+ai+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+aB+'"></span>'+"</span>"+"</span>"+'<span class="'+[f,aK].join(G)+'">'+'<span class="'+j+'">'+'<label class="'+ai+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[aM,C,v].join(G)+'" size="30" type="text" />'+'<div class="'+ba+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[f,bz,s].join(G)+'">'+'<label class="'+ai+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[aM,a8,O].join(G)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[f,aD,ax].join(G)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";var br=bl.Component.create({NAME:U,ATTRS:{content:{value:aZ},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:bd},event:{},strings:{value:{},setter:function(A){return bl.merge({"description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});
},validator:bG},overlayContextPanel:{value:{},setter:function(bI){var A=this;var bJ=bl.Node.create(bl.Lang.sub(aP,A.get(bg)));return bl.merge({align:{points:[ao,b]},anim:false,bodyContent:bJ,hideOn:T,trigger:A.get(bH),visible:false,zIndex:9999},bI||{});}}},EXTENDS:bl.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.after("schedulerChange",A._afterSchedulerChange);A.get(bH).addClass(J);A.get(ab).addClass(J);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(){var A=this;var bJ=A[a3].val();var bI=A.get(av);if(!bI){bI=new bl.SchedulerEvent({endDate:A.get(Y),scheduler:A.get(k),startDate:A.get(bo)});bI.copyPropagateAttrValues(A,{content:true});}bI.set(X,A[aX].val());if(bJ){bI.set(ah,bJ);}return bI;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},loadFormValues:function(){var A=this;var bK=aZ;var bJ=aZ;var bI=A.get(av);if(bI){var bL=bI.get(X);if(bL){bK=bL.value;}bJ=bI.get(ah);}A[aX].val(bK);A[bD].setContent(A._getWhenFormattedDt());setTimeout(function(){A[a3].val(bJ).selectText();},0);},_afterSchedulerChange:function(bK){var A=this;var bJ=bK.newVal;var bI=bJ.get(aj);bI.delegate("click",bl.bind(A._onClickSchedulerEvent,A),a7+ad);},_createEvents:function(){var A=this;var bI=function(bJ,bK){A.publish(bJ,{defaultFn:bK,queuable:false,emitFacade:true,bubbles:true});};bI(bb,this._defSaveEventFn);bI(F,this._defEditEventFn);bI(B,this._defCancelEventFn);},_initOverlay:function(){var bI=this;var A=bI.get(bg);bI.overlay=new bl.OverlayContextPanel(bI.get(aQ));var bK=bI.overlay;var bJ=bK.get(aj);var bL=bK.get(g);bI[bm]=bL.one(be+bF);bI[a3]=bL.one(be+a6);bI[aX]=bL.one(be+bn);bI[bD]=bL.one(be+ak);bI.overlaySaveBtn=new bl.ButtonItem({label:A.save,icon:aO,render:bI[bm],handler:{fn:bI._handleSaveEvent,context:bI}});bI.overlayEditBtn=new bl.ButtonItem({label:A.edit,icon:bk,render:bI[bm],handler:{fn:bI._handleEditEvent,context:bI}});bI.overlayCancelBtn=new bl.ButtonItem({label:A.cancel,render:bI[bm],handler:{fn:bI._handleCancelEvent,context:bI}});bl.each(bl.SchedulerEventRepeat,function(bN,bM){bI[aX].append(bl.Node.create(M).val(bN.value||bM).setContent(bN.description));});bK.on("hide",bl.bind(bI._onOverlayHide,bI));bK.on("show",bl.bind(bI._onOverlayShow,bI));bL.on("submit",bl.bind(bI._onSubmitForm,bI));bJ.addClass(l);},_defCancelEventFn:function(bI){var A=this;A.hideOverlay();},_defEditEventFn:function(bI){var A=this;A.hideOverlay();A.get(k).syncEventsUI();},_defSaveEventFn:function(bJ){var A=this;var bI=A.get(k);bI.addEvent(bJ.newSchedulerEvent);A.hideOverlay();bI.syncEventsUI();},_getWhenFormattedDt:function(){var bJ=this;var bI=bJ.get(aA);var bL=(bJ.get(av)||bJ);var bN=bL.get(Y);var bM=bL.get(k);var A=bL.get(bo);var bK=(bM.get(a1).get(K)?Q.toIsoTimeString:Q.toUsTimeString);return[bL._formatDate(A,bI),bK(A),a4,bK(bN)].join(G);},_handleEditEvent:function(bI){var A=this;A.fire(F,{newSchedulerEvent:A.getEventCopy()});bI.preventDefault();},_handleSaveEvent:function(bI){var A=this;A.fire(bb,{newSchedulerEvent:A.getEventCopy()});bI.preventDefault();},_handleCancelEvent:function(bI){var A=this;A.fire(B);bI.preventDefault();},_onClickSchedulerEvent:function(bJ){var A=this;var bI=bJ.currentTarget.getData(Z);if(bI){if(!A.overlay){A._initOverlay();}A.set(av,bI);A.overlay.set(q,bJ.currentTarget);A.get(bH).remove();A.showOverlay();}},_onOverlayHide:function(bJ){var A=this;var bI=A.get(bH);if(A.overlay){A.set(av,null);A.overlay.set(q,bI);}bI.remove();},_onOverlayShow:function(bJ){var bI=this;var bK=bI.overlayEditBtn;var A=bI.overlaySaveBtn;if(bI.get(av)){bK.show();A.hide();}else{bK.hide();A.show();}bI.loadFormValues();},_onSubmitForm:function(bI){var A=this;if(A.get(av)){A._handleEditEvent(bI);}else{A._handleSaveEvent(bI);}}}});bl.SchedulerEventRecorder=br;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-overlay-context-panel"]});