AUI.add("aui-scheduler-event",function(aO){var ar=aO.Lang,bo=ar.isString,g=ar.isDate,bd=ar.isFunction,J=ar.isObject,bh=ar.isBoolean,af=ar.isNumber,a2=aO.ColorUtil,k=aO.DataType.DateMath,a9=aO.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bj="-",u="&ndash;",aC=".",q="",r=" ",m="_",aQ="_propagateSet",T="activeView",z="all",W="borderColor",aS="borderColorRGB",aM="borderStyle",bv="borderWidth",M="Change",a7="color",a0="colorBrightnessFactor",bi="colorSaturationFactor",aK="content",bg="day",x="disabled",a4="duration",aT="endDate",aW="eventClass",av="eventStack",bp="events",ay="hidden",K="hsbColor",ax="icon",ad="icons",a5="id",al="inherit",a1="isoTime",bu="locale",a3="never",o="node",i="overlay",aP="parentEvent",bA="recorder",aR="repeat",bn="repeated",S="repeatedEvents",bf="repeater",ai="scheduler",az="scheduler-event",aB="scheduler-event-recorder",a="short",br="startDate",bb="template",aZ="title",f="titleDateFormat",au="visible",e="%H:%M",ba="%I:%M",H=aO.getClassName,l=H(ax),t=H(az),G=H(az,z,bg),aU=H(az,aK),E=H(az,ay),bl=H(az,x),at=H(az,bA),aF=H(az,bn),aq=H(az,bf),ap=H(az,a),F=H(az,aZ),bt=H(az,ad),w=H(az,ax,x),c=H(az,ax,bn),bx=H(az,ax,bf);var aa=aO.Component.create({NAME:az,ATTRS:{allDay:{setter:aO.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:bo},borderWidth:{value:"1px",validator:bo},colorBrightnessFactor:{value:0.75,validator:af},colorSaturationFactor:{value:1.5,validator:af},content:{value:"(no title)",validator:bo},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bo},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this;var Y=A.get(N);var L=A.get(ai);var X=L&&L.get(T).get(a1);var bG=X?e:ba;var bF={endDate:bj+r+bG,startDate:bG};if(A.getMinutesDuration()<=30){delete bF.endDate;}else{if(Y){bF={};}}return bF;}},endDate:{setter:"_setDate",valueFn:function(){var A=k.clone(this.get(br));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aO.SchedulerEvent;}},disabled:{value:false,validator:bh},node:{valueFn:function(){return aO.NodeList.create(aO.Node.create(this.EVENT_NODE_TEMPLATE).setData(az,this));}},parentEvent:{},repeat:{value:q,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:bh}},EXTENDS:aO.Base,PROPAGATE_ATTRS:[br,aT,aK,a7,a0,bi,aM,bv,f,au,x],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+t+'">'+'<div class="'+F+'"></div>'+'<div class="'+aU+'"></div>'+'<div class="'+bt+'">'+'<span class="'+[l,c].join(r)+'"></span>'+'<span class="'+[l,bx].join(r)+'"></span>'+'<span class="'+[l,w].join(r)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(o);A[av]={};aO.Array.each(A.get(aW).PROPAGATE_ATTRS,function(X){A.after(X+M,A._propagateAttrChange);});A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[av]={};A.get(o).remove(true);},addPaddingNode:function(){var A=this;A.get(o).push(aO.Node.create(A.EVENT_NODE_TEMPLATE).setData(az,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aT,k.clone(L.get(aT)));A.set(br,k.clone(L.get(br)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aO.Array.each(A.get(aW).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bF=L.get(Y);if(!J(bF)){A.set(Y,bF);}}});},getBorderColor:function(){var A=this;return A[aS].hex;},getDaysDuration:function(){var A=this;return k.getDayOffset(A.get(aT),A.get(br));},getHoursDuration:function(){var A=this;return k.getHoursOffset(A.get(aT),A.get(br));},getMinutesDuration:function(){var A=this;return k.getMinutesOffset(A.get(aT),A.get(br));},getSecondsDuration:function(){var A=this;return k.getSecondsOffset(A.get(aT),A.get(br));},sameEndDate:function(L){var A=this;return k.compare(A.get(aT),L.get(aT));},sameStartDate:function(L){var A=this;return k.compare(A.get(br),L.get(br));},isAfter:function(Y){var X=this;var L=X.get(br);var A=Y.get(br);return k.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(br);var A=Y.get(br);return k.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[av][Y]){var A=k.clone(X);var bG=k.clone(X);k.copyHours(A,L.get(br));k.copyHours(bG,L.get(aT));var bF=new L.get(aW)({endDate:bG,parentEvent:L,scheduler:L.get(ai),startDate:A});bF.copyPropagateAttrValues(L);L[av][Y]=bF;}return L[av][Y];},intersects:function(Y){var X=this;var bF=X.get(aT);var L=X.get(br);var A=Y.get(br);return(X.sameStartDate(Y)||k.between(A,L,bF));},intersectHours:function(X){var L=this;var bF=L.get(aT);var A=L.get(br);var Y=k.clone(A);k.copyHours(Y,X.get(br));return(k.compare(A,Y)||k.between(Y,A,bF));},isDayBoundaryEvent:function(){var A=this;return k.isDayBoundary(A.get(br),A.get(aT));},isDayOverlapEvent:function(){var A=this;return k.isDayOverlap(A.get(br),A.get(aT));},isRepeatableDate:function(L){var A=this;var X=A.get(aR);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return k.safeClearTime(A.get(aT));},getClearStartDate:function(){var A=this;return k.safeClearTime(A.get(br));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(br,L);A.set(aT,k.add(k.clone(L),k.MINUTES,X));},uidByDate:function(L){var A=this;L=g(L)?k.safeClearTime(L):A.getClearStartDate();return[az,L.getTime()].join(m);},setContent:function(X,L){var A=this;A.get(o).each(function(bF){var Y=bF.one(h+aU);Y.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bF){Y.setContent(X);});}},setTitle:function(X,L){var A=this;A.get(o).each(function(Y){var bF=Y.one(h+F);bF.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bF){Y.setTitle(X);});}},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var Y=A.get(o);var bF=A.getBorderColor();if(Y){var X={borderWidth:A.get(bv),borderColor:bF,backgroundColor:A.get(a7),borderStyle:A.get(aM),color:al};Y.setStyles(X);
}if(L){A.eachRepeatedEvent(function(bG,bH){bG.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aK),L);},syncNodeTitleUI:function(L){var A=this;var X=A.get(f);var Y=[];if(X.startDate){Y.push(A._formatDate(A.get(br),X.startDate));}if(X.endDate){Y.push(A._formatDate(A.get(aT),X.endDate));}A.setTitle(Y.join(r),L);},split:function(){var A=this,X=k.clone(A.get(br)),Y=k.clone(A.get(aT));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=k.clone(X);L.setHours(24,0,0,0);return[[X,k.toMidnight(k.clone(X))],[L,k.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aO.each(A[av],L,A);},unlink:function(){var A=this;if(A.get(aP)){A.set(aP,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[av]={};A.syncNodeUI();},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange,visibleChange:A._afterVisibleChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bF,bG){var bH=bF[aQ+a9(X)];if(bH){bH.apply(A,[bF,X,L]);}else{bF.set(X,Y.newVal);}bF.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=k.clone(A.get(aT));k.copyHours(X,Y);A.set(aT,X);},_propagateSetStartDate:function(L,X,Y){var A=k.clone(L.get(br));k.copyHours(A,Y);L.set(br,A);},_setColor:function(L){var A=this;A[K]=a2.rgb2hsb(a2.getRGB(L));A[W]=aO.clone(A[K]);A[W].b*=A.get(a0);A[W].s*=A.get(bi);A[aS]=a2.hsb2rgb(A[W]);return L;},_setDate:function(L){var A=this;if(af(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bo(L)){L=aO.SchedulerEventRepeat[L];}return J(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ai);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetAllDay(A.get(N));A._uiSetDisabled(A.get(x));A._uiSetEndDate(A.get(aT));A._uiSetVisible(A.get(au));A._uiSetParentEvent(A.get(aP));A._uiSetRepeat(A.get(aR));},_formatDate:function(X,Y){var L=this;var A=L.get(bu);return aO.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(L){var A=this;if(bo(L)){L={endDate:L,startDate:L};}else{if(bd(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(o).toggleClass(G,!!L);},_uiSetDisabled:function(L){var A=this;A.get(o).toggleClass(bl,!!L);},_uiSetEndDate:function(L){var A=this;A.get(o).toggleClass(ap,A.getMinutesDuration()<=30);},_uiSetParentEvent:function(L){var A=this;A.get(o).toggleClass(aF,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aO.SchedulerEventRepeat[a3];A.get(o).toggleClass(aq,L);},_uiSetVisible:function(L){var A=this;A.get(o).toggleClass(E,!L);}}});aO.SchedulerEvent=aa;aO.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aT);var A=L.get(br);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return k.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return k.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return k.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aT);var A=L.get(br);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aT);var A=L.get(br);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var aA=aO.Lang,b=aA.isArray,J=aA.isObject,T="activeView",N="allDay",d="arrow",aY="body",aE="bodyContent",p="boundingBox",aD="cancel",a6="click",aK="content",aX="date",aL="dateFormat",am="delete",be="description",U="edit",bz="event",aW="eventClass",D="footerContent",aI="form",C="header",v="hide",a1="isoTime",aJ="link",o="node",R="offsetHeight",bm="offsetWidth",i="overlay",V="overlayOffset",bA="recorder",bw="rendered",aR="repeat",a8="save",ai="scheduler",n="schedulerChange",az="scheduler-event",aB="scheduler-event-recorder",aH="shadow",aG="show",I="startDateChange",Q="strings",bb="template",aZ="title",by="tl",ae="toolbar",bq="submit",bs="value",aV="visibleChange",ac="when",ao="x",an="y",ah="cancel",P="delete",B="edit",aN="save",bB="-",h=".",ag="",j="#",s=aO.IO.prototype._serialize,H=aO.getClassName,t=H(ai,bz),at=H(ai,bz,bA),bC=H(ai,bz,bA,i),y=H(ai,bz,bA,i,d),bk=H(ai,bz,bA,i,d,aH),ak=H(ai,bz,bA,i,aY),bc=H(ai,bz,bA,i,aK),aj=H(ai,bz,bA,i,aX),Z=H(ai,bz,bA,i,aI),bE=H(ai,bz,bA,i,C),aw=H(ai,bz,bA,i,aR),F=H(ai,bz,aZ),O=new aO.Template('<div class="',bk," ",y,'"></div>','<div class="',y,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bE,'">','<input class="',bc,'" name="content" value="{content}" />',"</div>",'<div class="',ak,'">','<label class="',aj,'">{date}</label>','<select class="',aw,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),bD='<form class="'+Z+'" id="schedulerEventRecorderForm"></form>';var ab=aO.Component.create({NAME:aB,ATTRS:{allDay:{value:false},content:{value:ag},duration:{value:60},dateFormat:{validator:bo,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aO.SchedulerEvent;
}},strings:{value:{},setter:function(A){return aO.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:J},overlay:{validator:J,value:{align:{points:[by,by]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:b},template:{value:O},toolbar:{setter:function(X){var L=this;var A=L.get(Q);return aO.merge({children:[{handler:aO.bind(L._handleSaveEvent,L),label:A[a8]},{handler:aO.bind(L._handleCancelEvent,L),label:A[aD]},{handler:aO.bind(L._handleDeleteEvent,L),label:A[am]}]},X||{});},validator:J,value:{}}},EXTENDS:aO.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(o).addClass(at);A.publish(ah,{defaultFn:A._defCancelEventFn});A.publish(P,{defaultFn:A._defDeleteEventFn});A.publish(B,{defaultFn:A._defEditEventFn});A.publish(aN,{defaultFn:A._defSaveEventFn});A.after(n,A._afterSchedulerChange);A[i]=new aO.Overlay(A.get(i));A[ae]=new aO.Toolbar(A.get(ae));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(p);L.delegate(a6,aO.bind(A._onClickSchedulerEvent,A),h+t);},_defCancelEventFn:function(L){var A=this;A.get(o).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ai);L.removeEvent(A.get(bz));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ai);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ai);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ah);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(P,{schedulerEvent:A.get(bz)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bz)?B:aN,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(az);if(L){A.set(bz,L);A.showOverlay([X.pageX,X.pageY]);A.get(o).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bz)){var X=L[i].get(p);var A=X.one(h+bc);setTimeout(function(){A.selectText();},0);}}else{L.set(bz,null);L.get(o).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(Q);L[i].render();L[ae].render();var X=L[i].get(p);X.addClass(bC);L[i].set(D,L[ae].get(p));L[i].on(aV,aO.bind(L._onOverlayVisibleChange,L));L.formNode=aO.Node.create(bD);L[i].set(aE,L.formNode);L.formNode.on(bq,aO.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bz);if(!X){X=new (A.get(aW))({allDay:A.get(N),endDate:A.get(aT),scheduler:A.get(ai),startDate:A.get(br)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aK,L[aK]);X.set(aR,L[aR]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aL);var bF=(X.get(bz)||X);var bH=bF.get(aT);var bG=bF.get(ai);var A=bF.get(br);var Y=(bG.get(T).get(a1)?k.toIsoTimeString:k.toUsTimeString);return[bF._formatDate(A,L),Y(A),bj,Y(bH)].join(r);},getTemplateData:function(){var L=this;var A=L.get(Q);var X=(L.get(bz)||L);return{content:X.get(aK)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aT).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aR),startDate:X.get(br).getTime()};},hideOverlay:function(){var A=this;A[i].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aO.each(aO.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[be],value:L[bs]});});}A.formNode.setContent(A.get(bb).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aO.QueryString.parse(s(A.formNode.getDOM()));},showOverlay:function(Y,bG){var A=this;var X=A.get(V);if(!A[i].get(bw)){A._renderOverlay();}A[i].show();if(!Y){var L=(A.get(bz)||A).get(o);var bF=L.one(h+F);bG=[X[0]+bF.get(bm),X[1]+bF.get(R)/2];Y=bF.getXY();}bG=bG||X;Y[0]+=bG[0];Y[1]+=bG[1];A[i].set("xy",Y);}}});aO.SchedulerEventRecorder=ab;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});