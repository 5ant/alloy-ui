AUI.add("aui-scheduler-event",function(AS){var AD=AS.Lang,A3=AD.isString,I=AD.isDate,At=AD.isFunction,i=AD.isObject,Av=AD.isBoolean,s=AD.isNumber,Ak=AS.ColorUtil,N=AS.DataType.DateMath,Aq=AS.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),A0="-",AI=".",S="",T=" ",P="_",AX="_propagateSet",n="activeView",BA="borderWidth",Ag="colorBrightnessFactor",Ay="colorSaturationFactor",j="Change",Ap="color",AO="content",y="contentNode",Am="duration",Aa="endDate",A4="events",Ao="id",Ai="isoTime",A9="locale",Q="node",K="overlay",AU="parentEvent",BE="recorder",AY="repeat",A2="repeated",m="repeatedEvents",x="scheduler",AG="scheduler-event",AH="scheduler-event-recorder",A6="startDate",As="template",Af="title",H="titleDateFormat",g="titleNode",AQ="borderStyle",G="%H:%M",Ar="%I:%M",e=AS.ClassNameManager.getClassName,U=e(AG),AE=e(AG,BE),Ab=e(AG,AO),AK=e(AG,A2),b=e(AG,Af),AV='<div class="'+U+'">'+'<div class="'+b+'"></div>'+'<div class="'+Ab+'"></div>'+"</div>";var o=AS.Component.create({NAME:AG,ATTRS:{borderStyle:{value:"solid",validator:A3},borderWidth:{value:"1px",validator:A3},colorBrightnessFactor:{value:0.75,validator:s},colorSaturationFactor:{value:1.5,validator:s},content:{value:"(no title)",validator:A3},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:A3},titleDateFormat:{getter:"_getTitleDateFormat",validator:A3},endDate:{valueFn:function(){var A=N.clone(this.get(A6));A.setHours(A.getHours()+1);return A;},validator:I},columnNode:{setter:AS.one},node:{valueFn:function(){return AS.Node.create(AV).setData(AG,this);},setter:AS.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:I}},EXTENDS:AS.Base,PROPAGATE_ATTRS:[A6,Aa,AO,Ap,Ag,Ay,AQ,BA,H],prototype:{eventStack:null,initializer:function(){var A=this;var BC=A.get(Q);A.eventStack={};A.nodeStack={};AS.Array.each(AS.SchedulerEvent.PROPAGATE_ATTRS,function(BD){A.after(BD+j,A._propagateAttrChange);});A.contentNode=BC.one(AI+Ab);A.titleNode=BC.one(AI+b);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(BC,BD){BC.destroy();});A.eventStack={};A.get(Q).remove(true);},copyDates:function(BC){var A=this;A.set(Aa,N.clone(BC.get(Aa)));A.set(A6,N.clone(BC.get(A6)));},copyPropagateAttrValues:function(BC,BD){var A=this;A.copyDates(BC);AS.Array.each(AS.SchedulerEvent.PROPAGATE_ATTRS,function(BG){if(!(BG in (BD||{}))){var BH=BC.get(BG);if(!i(BH)){A.set(BG,BH);}}});},getBorderColor:function(){var A=this;return A.borderColorRGB.hex;},getDaysDuration:function(){var A=this;return N.getDayOffset(A.get(Aa),A.get(A6));},getHoursDuration:function(){var A=this;return N.getHoursOffset(A.get(Aa),A.get(A6));},getMinutesDuration:function(){var A=this;return N.getMinutesOffset(A.get(Aa),A.get(A6));},getSecondsDuration:function(){var A=this;return N.getSecondsOffset(A.get(Aa),A.get(A6));},sameEndDate:function(BC){var A=this;return N.compare(A.get(Aa),BC.get(Aa));},sameStartDate:function(BC){var A=this;return N.compare(A.get(A6),BC.get(A6));},isAfter:function(BG){var BD=this;var BC=BD.get(A6);var A=BG.get(A6);return N.after(BC,A);},isBefore:function(BG){var BD=this;var BC=BD.get(A6);var A=BG.get(A6);return N.before(BC,A);},repeatByDate:function(BD){var A=this;var BG=A.uidByDate(BD);if(!A.eventStack[BG]){var BC=N.clone(BD);var BH=N.clone(BD);N.copyHours(BC,A.get(A6));N.copyHours(BH,A.get(Aa));var BI=new AS.SchedulerEvent({endDate:BH,parentEvent:A,scheduler:A.get(x),startDate:BC});BI.copyPropagateAttrValues(A);A.eventStack[BG]=BI;}return A.eventStack[BG];},intersects:function(BG){var BD=this;var BH=BD.get(Aa);var BC=BD.get(A6);var A=BG.get(A6);return(BD.sameStartDate(BG)||N.between(A,BC,BH));},intersectHours:function(BD){var BC=this;var BH=BC.get(Aa);var A=BC.get(A6);var BG=N.clone(A);N.copyHours(BG,BD.get(A6));return(N.compare(A,BG)||N.between(BG,A,BH));},isDayOverlapEvent:function(){var A=this;return N.isDayOverlap(A.get(A6),A.get(Aa));},isRepeatableDate:function(BC){var A=this;var BD=A.get(AY);return(BD&&BD.validate(A,BC));},getClearEndDate:function(){var A=this;return N.safeClearTime(A.get(Aa));},getClearStartDate:function(){var A=this;return N.safeClearTime(A.get(A6));},uidByDate:function(BC){var A=this;BC=I(BC)?N.safeClearTime(BC):A.getClearStartDate();return[AG,BC.getTime()].join(P);},setContent:function(BD,BC){var A=this;A._setContent(y,BD,BC);},setTitle:function(BD,BC){var A=this;A._setContent(g,BD,BC);},syncNodeUI:function(BC){var A=this;A.get(Q).toggleClass(AK,!!(A.get(AU)));A.syncNodeColorUI(BC);A.syncNodeTitleUI(BC);A.syncNodeContentUI(BC);},syncNodeColorUI:function(BC){var A=this;var BD=A.get(Q);var BG=A.getBorderColor();if(BD){BD.setStyles({borderWidth:A.get(BA),borderColor:BG,backgroundColor:A.get(Ap),borderStyle:A.get(AQ)});}if(A.titleNode){A.titleNode.setStyles({backgroundColor:BG});}if(BC){A.eachRepeatedEvent(function(BH,BI){BH.syncNodeColorUI();});}},syncNodeContentUI:function(BC){var A=this;A.setContent(A.get(AO),BC);},syncNodeTitleUI:function(BC){var A=this;var BD=A._formatDate(A.get(A6));var BG=A._formatDate(A.get(Aa));A.setTitle([BD,BG].join(T+A0+T),BC);},eachRepeatedEvent:function(BC){var A=this;AS.each(A.eventStack,BC,A);},unlink:function(){var A=this;if(A.get(AU)){A.set(AU,null);}else{A.eachRepeatedEvent(function(BC,BD){BC.unlink();});}A.eventStack={};A.syncNodeUI();},_propagateAttrChange:function(BG){var A=this;var BD=BG.attrName;var BC=BG.newVal;A.eachRepeatedEvent(function(BH,BI){var BJ=BH[AX+Aq(BD)];if(BJ){BJ.apply(A,[BH,BD,BC]);}else{BH.set(BD,BG.newVal);}BH.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,BC,BG){var BD=N.clone(A.get(Aa));N.copyHours(BD,BG);A.set(Aa,BD);},_propagateSetStartDate:function(BC,BD,BG){var A=N.clone(BC.get(A6));N.copyHours(A,BG);BC.set(A6,A);},_setColor:function(BC){var A=this;A.hsbColor=Ak.rgb2hsb(Ak.getRGB(BC));A.borderColor=AS.clone(A.hsbColor);A.borderColor.b*=A.get(Ag);A.borderColor.s*=A.get(Ay);A.borderColorRGB=Ak.hsb2rgb(A.borderColor);
return BC;},_setContent:function(BD,BH,BC){var A=this;var BG=A[BD];if(BG){BG.setContent(BH);}if(BC){A.eachRepeatedEvent(function(BI,BJ){BI[BD].setContent(BH);});}},_setRepeat:function(BC){var A=this;if(A3(BC)){BC=AS.SchedulerEventRepeat[BC];}return BC;},_setScheduler:function(BD){var A=this;var BC=A.get(x);if(BC){A.removeTarget(BC);}A.addTarget(BD);return BD;},_formatDate:function(BD,BG){var BC=this;var A=BC.get(A9);BG=BG||BC.get(H);return AS.DataType.Date.format(BD,{format:BG,locale:A});},_getTitleDateFormat:function(BD){var A=this;if(!A3(BD)){var BC=A.get(x);BD=(BC&&BC.get(n).get(Ai))?G:Ar;}return BD;}}});AS.SchedulerEvent=o;AS.SchedulerEventRepeat={dayly:{description:"Every day",validate:function(A,BC){return true;}},monthly:{description:"Every month",validate:function(BC,BD){var BG=BC.get(Aa);var A=BC.get(A6);return(A.getDate()===BC.getDate());}},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,BC){return N.isMonWedOrFri(BC);}},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,BC){return N.isTueOrThu(BC);}},weekDays:{description:"Every week days",validate:function(A,BC){return N.isWeekDay(BC);}},weekly:{description:"Every week",validate:function(BC,BD){var BG=BC.get(Aa);var A=BC.get(A6);return(A.getDay()===BC.getDay());}}};var n="activeView",A8="bc",A7="bd",AJ="bodyContent",R="boundingBox",AT="button",F="column",AO="content",AM="dblclick",An="desc",AL="disk",Au="field",AW="fieldset",AN="form",z="hint",AC="input",AZ="label",V="layout",Ae="menu",c="overlayContextPanel",AY="repeat",O="row",r="select",l="strings",B="tc",f="text",q="when",AP="dateFormat",x="scheduler",Ai="isoTime",AA="auiSchedulerEventRecorderWhen",Az="auiSchedulerEventRecorderDesc",Al="auiSchedulerEventRecorderSelect",a="auiSchedulerEventRecorderButtonRow",AR="scheduler-event-recorder:save",w="scheduler-event-recorder:cancel",A0="-",d="#",BF=e(AG,BE,K),Ax=e(AG,BE,AN),W=e(AN),L=e(V,AO),A1=e(V,AW),AF=e(V,AW,A7),v=e(V,AW,AO),Z=e(V,"w100"),M=e(F),Ac=e(F,AO),C=e(Au),X=e(Au,Ae),Ad=e(Au,r),A5=e(Au,AO),E=e(Au,AZ),Aj=e(Au,f),J=e(AT,O),Aw=e(Au,AC),AB=e(Au,AC,r),Y=e(Au,AC,f),Ah=e(AG,BE,AZ,q),D=e(AG,BE,An),k=e(AG,BE,Au,z),u=e(AG,BE,AY),t=e(AG,BE,AT,O),h="<option></option>",BB='<form id="auiSchedulerEventRecorderForm" class="'+[Ax,L,W].join(T)+'">'+'<div class="'+[A1,Z,M].join(T)+'">'+'<div class="'+[v,Ac].join(T)+'aui-fieldset-content aui-column-content">'+'<div class="'+AF+'">'+'<span class="'+[C,Aj].join(T)+'">'+'<span class="'+A5+'">'+'<label class="'+E+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+Ah+'"></span>'+"</span>"+"</span>"+'<span class="'+[C,Aj].join(T)+'">'+'<span class="'+A5+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[Aw,Y,D].join(T)+'" size="30" type="text" />'+'<div class="'+k+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[C,X,Ad].join(T)+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[Aw,AB,u].join(T)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[C,J,t].join(T)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";var p=AS.Component.create({NAME:AH,ATTRS:{content:{value:S},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:A3},strings:{value:{},setter:function(A){return AS.merge({save:"Save",cancel:"Cancel",description:"Description",repeat:"Repeat",when:"When","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat"},A||{});},validator:i},overlayContextPanel:{value:{},setter:function(BC){var A=this;var BD=AS.Node.create(AS.substitute(BB,A.get(l)));return AS.merge({align:{points:[A8,B]},anim:false,bodyContent:BD,hideOn:AM,trigger:A.get(Q),visible:false,zIndex:9999},BC||{});}}},EXTENDS:AS.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.on("startDateChange",A._onStartDateChange);A.get(Q).addClass(AE);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(BC){var A=this;var BG=A.overlayDescNode.val();var BD=new AS.SchedulerEvent({endDate:A.get(Aa),scheduler:A.get(x),startDate:A.get(A6),repeat:A.overlaySelectNode.val()});BD.copyPropagateAttrValues(A,{content:true});if(BG){BD.set(AO,BG);}return BD;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},_createEvents:function(){var A=this;var BC=function(BD,BG){A.publish(BD,{defaultFn:BG,queuable:false,emitFacade:true,bubbles:true,prefix:AH});};BC(AR,this._defSaveEventFn);BC(w,this._defCancelEventFn);},_initOverlay:function(){var BC=this;var A=BC.get(l);BC.overlay=new AS.OverlayContextPanel(BC.get(c));var BG=BC.overlay;var BD=BG.get(R);var BH=BG.get(AJ);BC.overlayButtonRowNode=BH.one(d+a);BC.overlayDescNode=BH.one(d+Az);BC.overlaySelectNode=BH.one(d+Al);BC.overlayWhenNode=BH.one(d+AA);BC.overlaySaveBtn=new AS.ButtonItem({label:A.save,icon:AL,render:BC.overlayButtonRowNode,handler:{fn:BC._handleSaveEvent,context:BC}});BC.overlayCancelBtn=new AS.ButtonItem({label:A.cancel,render:BC.overlayButtonRowNode,handler:{fn:BC._handleCancelEvent,context:BC}});AS.each(AS.SchedulerEventRepeat,function(BJ,BI){BC.overlaySelectNode.append(AS.Node.create(h).val(BI).setContent(BJ.description));});BG.on("hide",AS.bind(BC._onOverlayHide,BC));BG.on("show",AS.bind(BC._onOverlayShow,BC));BH.on("submit",AS.bind(BC._handleSaveEvent,BC));BD.addClass(BF);},_defCancelEventFn:function(BC){var A=this;A.hideOverlay();},_defSaveEventFn:function(BD){var A=this;var BC=A.get(x);BC.addEvent(BD.newSchedulerEvent);A.hideOverlay();BC.syncEventsUI();},_getWhenFormattedDt:function(){var BD=this;var BC=BD.get(AP);var BI=BD.get(Aa);var BH=BD.get(x);var A=BD.get(A6);var BG=(BH.get(n).get(Ai)?N.toIsoTimeString:N.toUsTimeString);return[BD._formatDate(A,BC),BG(A),A0,BG(BI)].join(T);},_handleSaveEvent:function(BC){var A=this;
A.fire(AR,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleCancelEvent:function(BC){var A=this;A.fire(w);BC.preventDefault();},_onOverlayHide:function(BC){var A=this;A.get(Q).remove();},_onOverlayShow:function(BC){var A=this;A.overlayWhenNode.setContent(A._getWhenFormattedDt());setTimeout(function(){A.overlayDescNode.val(S).selectText();},0);},_onStartDateChange:function(BC){var A=this;var BD=A.get(Am);A.set(Aa,N.add(BC.newVal,N.MINUTES,BD));}}});AS.SchedulerEventRecorder=p;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-overlay-context-panel","substitute"]});