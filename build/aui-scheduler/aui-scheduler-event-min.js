AUI.add("aui-scheduler-event",function(AZ){var AI=AZ.Lang,BA=AI.isString,I=AI.isDate,A0=AI.isFunction,n=AI.isObject,A2=AI.isBoolean,x=AI.isNumber,Ar=AZ.ColorUtil,O=AZ.DataType.DateMath,Ax=AZ.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),A7="-",Z="&ndash;",AP=".",U="",V=" ",R="_",Ae="_propagateSet",s="activeView",AX="borderStyle",BJ="borderWidth",o="Change",Aw="color",An="colorBrightnessFactor",A5="colorSaturationFactor",AV="content",AD="contentNode",At="duration",Ah="endDate",BB="events",AL="hidden",Av="id",Ap="isoTime",BI="locale",S="node",L="overlay",Ab="parentEvent",BM="recorder",Af="repeat",A9="repeated",r="repeatedEvents",AC="scheduler",AN="scheduler-event",AO="scheduler-event-recorder",BF="startDate",Az="template",Am="title",H="titleDateFormat",l="titleNode",AJ="visible",G="%H:%M",Ay="%I:%M",j=AZ.ClassNameManager.getClassName,W=j(AN),Ai=j(AN,AV),e=j(AN,AL),AK=j(AN,BM),AR=j(AN,A9),g=j(AN,Am),Ac='<div class="'+W+'">'+'<div class="'+g+'"></div>'+'<div class="'+Ai+'"></div>'+"</div>";var t=AZ.Component.create({NAME:AN,ATTRS:{borderStyle:{value:"solid",validator:BA},borderWidth:{value:"1px",validator:BA},colorBrightnessFactor:{value:0.75,validator:x},colorSaturationFactor:{value:1.5,validator:x},content:{value:"(no title)",validator:BA},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:BA},titleDateFormat:{getter:"_getTitleDateFormat",validator:BA},endDate:{valueFn:function(){var A=O.clone(this.get(BF));A.setHours(A.getHours()+1);return A;},validator:I},columnNode:{setter:AZ.one},node:{valueFn:function(){return AZ.Node.create(Ac).setData(AN,this);},setter:AZ.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:I},visible:{value:true,validator:A2}},EXTENDS:AZ.Base,PROPAGATE_ATTRS:[BF,Ah,AV,Aw,An,A5,AX,BJ,H,AJ],prototype:{eventStack:null,initializer:function(){var A=this;var BC=A.get(S);A.eventStack={};A.nodeStack={};AZ.Array.each(AZ.SchedulerEvent.PROPAGATE_ATTRS,function(BD){A.after(BD+o,A._propagateAttrChange);});A.on("visibleChange",A._onVisibleChange);A._uiSetVisible(A.get(AJ));A.contentNode=BC.one(AP+Ai);A.titleNode=BC.one(AP+g);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(BC,BD){BC.destroy();});A.eventStack={};A.get(S).remove(true);},copyDates:function(BC){var A=this;A.set(Ah,O.clone(BC.get(Ah)));A.set(BF,O.clone(BC.get(BF)));},copyPropagateAttrValues:function(BC,BD){var A=this;A.copyDates(BC);AZ.Array.each(AZ.SchedulerEvent.PROPAGATE_ATTRS,function(BO){if(!(BO in (BD||{}))){var BP=BC.get(BO);if(!n(BP)){A.set(BO,BP);}}});},getBorderColor:function(){var A=this;return A.borderColorRGB.hex;},getDaysDuration:function(){var A=this;return O.getDayOffset(A.get(Ah),A.get(BF));},getHoursDuration:function(){var A=this;return O.getHoursOffset(A.get(Ah),A.get(BF));},getMinutesDuration:function(){var A=this;return O.getMinutesOffset(A.get(Ah),A.get(BF));},getSecondsDuration:function(){var A=this;return O.getSecondsOffset(A.get(Ah),A.get(BF));},sameEndDate:function(BC){var A=this;return O.compare(A.get(Ah),BC.get(Ah));},sameStartDate:function(BC){var A=this;return O.compare(A.get(BF),BC.get(BF));},isAfter:function(BO){var BD=this;var BC=BD.get(BF);var A=BO.get(BF);return O.after(BC,A);},isBefore:function(BO){var BD=this;var BC=BD.get(BF);var A=BO.get(BF);return O.before(BC,A);},repeatByDate:function(BD){var A=this;var BO=A.uidByDate(BD);if(!A.eventStack[BO]){var BC=O.clone(BD);var BP=O.clone(BD);O.copyHours(BC,A.get(BF));O.copyHours(BP,A.get(Ah));var BQ=new AZ.SchedulerEvent({endDate:BP,parentEvent:A,scheduler:A.get(AC),startDate:BC});BQ.copyPropagateAttrValues(A);A.eventStack[BO]=BQ;}return A.eventStack[BO];},intersects:function(BO){var BD=this;var BP=BD.get(Ah);var BC=BD.get(BF);var A=BO.get(BF);return(BD.sameStartDate(BO)||O.between(A,BC,BP));},intersectHours:function(BD){var BC=this;var BP=BC.get(Ah);var A=BC.get(BF);var BO=O.clone(A);O.copyHours(BO,BD.get(BF));return(O.compare(A,BO)||O.between(BO,A,BP));},isDayOverlapEvent:function(){var A=this;return O.isDayOverlap(A.get(BF),A.get(Ah));},isRepeatableDate:function(BC){var A=this;var BD=A.get(Af);return(BD&&BD.validate(A,BC));},getClearEndDate:function(){var A=this;return O.safeClearTime(A.get(Ah));},getClearStartDate:function(){var A=this;return O.safeClearTime(A.get(BF));},uidByDate:function(BC){var A=this;BC=I(BC)?O.safeClearTime(BC):A.getClearStartDate();return[AN,BC.getTime()].join(R);},setContent:function(BD,BC){var A=this;A._setContent(AD,BD,BC);},setTitle:function(BD,BC){var A=this;A._setContent(l,BD,BC);},syncNodeUI:function(BC){var A=this;A.get(S).toggleClass(AR,!!(A.get(Ab)));A.syncNodeColorUI(BC);A.syncNodeTitleUI(BC);A.syncNodeContentUI(BC);},syncNodeColorUI:function(BC){var A=this;var BD=A.get(S);var BO=A.getBorderColor();if(BD){BD.setStyles({borderWidth:A.get(BJ),borderColor:BO,backgroundColor:A.get(Aw),borderStyle:A.get(AX)});}if(A.titleNode){A.titleNode.setStyles({backgroundColor:BO});}if(BC){A.eachRepeatedEvent(function(BP,BQ){BP.syncNodeColorUI();});}},syncNodeContentUI:function(BC){var A=this;A.setContent(A.get(AV),BC);},syncNodeTitleUI:function(BC){var A=this;var BD=A._formatDate(A.get(BF));var BO=A._formatDate(A.get(Ah));A.setTitle([BD,BO].join(V+Z+V),BC);},eachRepeatedEvent:function(BC){var A=this;AZ.each(A.eventStack,BC,A);},unlink:function(){var A=this;if(A.get(Ab)){A.set(Ab,null);}else{A.eachRepeatedEvent(function(BC,BD){BC.unlink();});}A.eventStack={};A.syncNodeUI();},_onVisibleChange:function(BC){var A=this;A._uiSetVisible(BC.newVal);},_propagateAttrChange:function(BO){var A=this;var BD=BO.attrName;var BC=BO.newVal;A.eachRepeatedEvent(function(BP,BQ){var BR=BP[Ae+Ax(BD)];if(BR){BR.apply(A,[BP,BD,BC]);}else{BP.set(BD,BO.newVal);}BP.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,BC,BO){var BD=O.clone(A.get(Ah));O.copyHours(BD,BO);A.set(Ah,BD);},_propagateSetStartDate:function(BC,BD,BO){var A=O.clone(BC.get(BF));O.copyHours(A,BO);
BC.set(BF,A);},_setColor:function(BC){var A=this;A.hsbColor=Ar.rgb2hsb(Ar.getRGB(BC));A.borderColor=AZ.clone(A.hsbColor);A.borderColor.b*=A.get(An);A.borderColor.s*=A.get(A5);A.borderColorRGB=Ar.hsb2rgb(A.borderColor);return BC;},_setContent:function(BD,BP,BC){var A=this;var BO=A[BD];if(BO){BO.setContent(BP);}if(BC){A.eachRepeatedEvent(function(BQ,BR){BQ[BD].setContent(BP);});}},_setRepeat:function(BC){var A=this;if(BA(BC)){BC=AZ.SchedulerEventRepeat[BC];}return n(BC)?BC:null;},_setScheduler:function(BD){var A=this;var BC=A.get(AC);if(BC){A.removeTarget(BC);}A.addTarget(BD);return BD;},_formatDate:function(BD,BO){var BC=this;var A=BC.get(BI);BO=BO||BC.get(H);return AZ.DataType.Date.format(BD,{format:BO,locale:A});},_getTitleDateFormat:function(BD){var A=this;if(!BA(BD)){var BC=A.get(AC);BD=(BC&&BC.get(s).get(Ap))?G:Ay;}return BD;},_uiSetVisible:function(BC){var A=this;A.get(S).toggleClass(e,!BC);}}});AZ.SchedulerEvent=t;AZ.SchedulerEventRepeat={daily:{description:"Every day",validate:function(A,BC){return true;},value:"daily"},monthly:{description:"Every month",validate:function(BC,BD){var BO=BC.get(Ah);var A=BC.get(BF);return(A.getDate()===BD.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,BC){return O.isMonWedOrFri(BC);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,BC){return O.isTueOrThu(BC);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,BC){return O.isWeekDay(BC);},value:"weekDays"},weekly:{description:"Every week",validate:function(BC,BD){var BO=BC.get(Ah);var A=BC.get(BF);return(A.getDay()===BD.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(BC,BD){var BO=BC.get(Ah);var A=BC.get(BF);return((A.getMonth()===BD.getMonth())&&(A.getDay()===BD.getDay()));},value:"yearly"}};var s="activeView",BH="bc",BG="bd",AQ="bodyContent",T="boundingBox",Aa="button",F="column",AV="content",AW="dateFormat",AT="dblclick",Au="desc",AS="disk",BL="event",A1="field",Ad="fieldset",AU="form",AE="hint",AH="input",Ap="isoTime",Ag="label",X="layout",Al="menu",h="overlayContextPanel",P="pencil",Af="repeat",Q="row",AC="scheduler",w="select",q="strings",B="tc",k="text",v="when",K="trigger",AF="auiSchedulerEventRecorderWhen",A6="auiSchedulerEventRecorderDesc",As="auiSchedulerEventRecorderSelect",f="auiSchedulerEventRecorderButtonRow",AB="cancel",c="edit",AY="save",A7="-",i="#",BN=j(AN,BM,L),A4=j(AN,BM,AU),Y=j(AU),M=j(X,AV),A8=j(X,Ad),AM=j(X,Ad,BG),AA=j(X,Ad,AV),d=j(X,"w100"),N=j(F),Aj=j(F,AV),C=j(A1),a=j(A1,Al),Ak=j(A1,w),BE=j(A1,AV),E=j(A1,Ag),Aq=j(A1,k),J=j(Aa,Q),A3=j(A1,AH),AG=j(A1,AH,w),b=j(A1,AH,k),Ao=j(AN,BM,Ag,v),D=j(AN,BM,Au),p=j(AN,BM,A1,AE),z=j(AN,BM,Af),y=j(AN,BM,Aa,Q),m="<option></option>",BK='<form id="auiSchedulerEventRecorderForm" class="'+[A4,M,Y].join(V)+'">'+'<div class="'+[A8,d,N].join(V)+'">'+'<div class="'+[AA,Aj].join(V)+'aui-fieldset-content aui-column-content">'+'<div class="'+AM+'">'+'<span class="'+[C,Aq].join(V)+'">'+'<span class="'+BE+'">'+'<label class="'+E+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+Ao+'"></span>'+"</span>"+"</span>"+'<span class="'+[C,Aq].join(V)+'">'+'<span class="'+BE+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[A3,b,D].join(V)+'" size="30" type="text" />'+'<div class="'+p+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[C,a,Ak].join(V)+'">'+'<label class="'+E+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[A3,AG,z].join(V)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[C,J,y].join(V)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";var u=AZ.Component.create({NAME:AO,ATTRS:{content:{value:U},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:BA},event:{},strings:{value:{},setter:function(A){return AZ.merge({save:"Save",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",when:"When","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat"},A||{});},validator:n},overlayContextPanel:{value:{},setter:function(BC){var A=this;var BD=AZ.Node.create(AZ.substitute(BK,A.get(q)));return AZ.merge({align:{points:[BH,B]},anim:false,bodyContent:BD,hideOn:AT,trigger:A.get(S),visible:false,zIndex:9999},BC||{});}}},EXTENDS:AZ.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.after("schedulerChange",A._afterSchedulerChange);A.on("startDateChange",A._onStartDateChange);A.get(S).addClass(AK);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(BC){var A=this;var BO=A.overlayDescNode.val();var BD=A.get(BL);if(!BD){BD=new AZ.SchedulerEvent({endDate:A.get(Ah),scheduler:A.get(AC),startDate:A.get(BF)});BD.copyPropagateAttrValues(A,{content:true});}BD.set(Af,A.overlaySelectNode.val());if(BO){BD.set(AV,BO);}return BD;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},loadFormValues:function(){var A=this;var BO=U;var BD=U;var BC=A.get(BL);if(BC){var BP=BC.get(Af);if(BP){BO=BP.value;}BD=BC.get(AV);}A.overlaySelectNode.val(BO);A.overlayWhenNode.setContent(A._getWhenFormattedDt());setTimeout(function(){A.overlayDescNode.val(BD).selectText();},0);},_afterSchedulerChange:function(BO){var A=this;var BD=BO.newVal;var BC=BD.get(T);BC.delegate("click",AZ.bind(A._onClickSchedulerEvent,A),AP+W);},_createEvents:function(){var A=this;var BC=function(BD,BO){A.publish(BD,{defaultFn:BO,queuable:false,emitFacade:true,bubbles:true});};BC(AY,this._defSaveEventFn);BC(c,this._defEditEventFn);BC(AB,this._defCancelEventFn);},_initOverlay:function(){var BC=this;var A=BC.get(q);BC.overlay=new AZ.OverlayContextPanel(BC.get(h));var BO=BC.overlay;var BD=BO.get(T);var BP=BO.get(AQ);BC.overlayButtonRowNode=BP.one(i+f);
BC.overlayDescNode=BP.one(i+A6);BC.overlaySelectNode=BP.one(i+As);BC.overlayWhenNode=BP.one(i+AF);BC.overlaySaveBtn=new AZ.ButtonItem({label:A.save,icon:AS,render:BC.overlayButtonRowNode,handler:{fn:BC._handleSaveEvent,context:BC}});BC.overlayEditBtn=new AZ.ButtonItem({label:A.edit,icon:P,render:BC.overlayButtonRowNode,handler:{fn:BC._handleEditEvent,context:BC}});BC.overlayCancelBtn=new AZ.ButtonItem({label:A.cancel,render:BC.overlayButtonRowNode,handler:{fn:BC._handleCancelEvent,context:BC}});AZ.each(AZ.SchedulerEventRepeat,function(BR,BQ){BC.overlaySelectNode.append(AZ.Node.create(m).val(BR.value||BQ).setContent(BR.description));});BO.on("hide",AZ.bind(BC._onOverlayHide,BC));BO.on("show",AZ.bind(BC._onOverlayShow,BC));BP.on("submit",AZ.bind(BC._onSubmitForm,BC));BD.addClass(BN);},_defCancelEventFn:function(BC){var A=this;A.hideOverlay();},_defEditEventFn:function(BC){var A=this;A.hideOverlay();},_defSaveEventFn:function(BD){var A=this;var BC=A.get(AC);BC.addEvent(BD.newSchedulerEvent);A.hideOverlay();BC.syncEventsUI();},_getWhenFormattedDt:function(){var BD=this;var BC=BD.get(AW);var BP=(BD.get(BL)||BD);var BR=BP.get(Ah);var BQ=BP.get(AC);var A=BP.get(BF);var BO=(BQ.get(s).get(Ap)?O.toIsoTimeString:O.toUsTimeString);return[BP._formatDate(A,BC),BO(A),A7,BO(BR)].join(V);},_handleEditEvent:function(BC){var A=this;A.fire(c,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleSaveEvent:function(BC){var A=this;A.fire(AY,{newSchedulerEvent:A.getEventCopy()});BC.preventDefault();},_handleCancelEvent:function(BC){var A=this;A.fire(AB);BC.preventDefault();},_onClickSchedulerEvent:function(BD){var A=this;var BC=BD.currentTarget.getData(AN);if(BC){if(!A.overlay){A._initOverlay();}A.set(BL,BC);A.overlay.set(K,BC.get(S));A.get(S).remove();A.showOverlay();}},_onOverlayHide:function(BD){var A=this;var BC=A.get(S);if(A.overlay){A.set(BL,null);A.overlay.set(K,BC);}BC.remove();},_onOverlayShow:function(BD){var BC=this;var BO=BC.overlayEditBtn;var A=BC.overlaySaveBtn;if(BC.get(BL)){BO.show();A.hide();}else{BO.hide();A.show();}BC.loadFormValues();},_onStartDateChange:function(BC){var A=this;var BD=A.get(At);A.set(Ah,O.add(BC.newVal,O.MINUTES,BD));},_onSubmitForm:function(BC){var A=this;if(A.get(BL)){A._handleEditEvent(BC);}else{A._handleSaveEvent(BC);}}}});AZ.SchedulerEventRecorder=u;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-overlay-context-panel","substitute"]});