AUI.add("aui-scheduler-event",function(aQ){var at=aQ.Lang,bp=at.isString,g=at.isDate,be=at.isFunction,J=at.isObject,bi=at.isBoolean,ag=at.isNumber,a4=aQ.ColorUtil,k=aQ.DataType.DateMath,bb=aQ.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bk="-",u="&ndash;",aE=".",q="",r=" ",m="_",aS="_propagateSet",U="activeView",z="all",Z="borderColor",aU="borderColorRGB",aO="borderStyle",bw="borderWidth",M="Change",a9="color",a2="colorBrightnessFactor",bj="colorSaturationFactor",aM="content",bh="day",x="disabled",a6="duration",aV="endDate",aY="eventClass",ax="eventStack",bq="events",aA="hidden",K="hsbColor",az="icon",ae="icons",a7="id",am="inherit",a3="isoTime",bv="locale",a5="never",o="node",i="overlay",aR="parentEvent",bC="recorder",aT="repeat",bo="repeated",T="repeatedEvents",bg="repeater",aj="scheduler",aB="scheduler-event",aD="scheduler-event-recorder",a="short",bs="startDate",bc="template",a1="title",f="titleDateFormat",aw="visible",e="%H:%M",O="%l",bz=":%M",au=function(A){var L=[O];if(A.getMinutes()>0){L.push(bz);}if(A.getHours()>=12){L.push("p");}return L.join(q);},H=aQ.getClassName,l=H(az),t=H(aB),G=H(aB,z,bh),aW=H(aB,aM),E=H(aB,aA),bm=H(aB,x),av=H(aB,bC),aH=H(aB,bo),ar=H(aB,bg),aq=H(aB,a),F=H(aB,a1),bu=H(aB,ae),w=H(aB,az,x),c=H(aB,az,bo),by=H(aB,az,bg);var ab=aQ.Component.create({NAME:aB,ATTRS:{allDay:{setter:aQ.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:bp},borderWidth:{value:"1px",validator:bp},colorBrightnessFactor:{value:0.75,validator:ag},colorSaturationFactor:{value:1.5,validator:ag},content:{value:"(no title)",validator:bp},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bp},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this;var Y={endDate:u+r+e,startDate:e};var L=A.get(aj);var X=L&&L.get(U).get(a3);if(!X){Y.endDate=u+r+au(A.get(aV));Y.startDate=au(A.get(bs));}if(A.getMinutesDuration()<=30){delete Y.endDate;}else{if(A.get(N)){Y={};}}return Y;}},endDate:{setter:"_setDate",valueFn:function(){var A=k.clone(this.get(bs));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aQ.SchedulerEvent;}},disabled:{value:false,validator:bi},node:{valueFn:function(){return aQ.NodeList.create(aQ.Node.create(this.EVENT_NODE_TEMPLATE).setData(aB,this));}},parentEvent:{},repeat:{value:q,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:bi}},EXTENDS:aQ.Base,PROPAGATE_ATTRS:[bs,aV,aM,a9,a2,bj,aO,bw,f,aw,x],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+t+'">'+'<div class="'+F+'"></div>'+'<div class="'+aW+'"></div>'+'<div class="'+bu+'">'+'<span class="'+[l,c].join(r)+'"></span>'+'<span class="'+[l,by].join(r)+'"></span>'+'<span class="'+[l,w].join(r)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(o);A[ax]={};aQ.Array.each(A.get(aY).PROPAGATE_ATTRS,function(X){A.after(X+M,A._propagateAttrChange);});A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[ax]={};A.get(o).remove(true);},addPaddingNode:function(){var A=this;A.get(o).push(aQ.Node.create(A.EVENT_NODE_TEMPLATE).setData(aB,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aV,k.clone(L.get(aV)));A.set(bs,k.clone(L.get(bs)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aQ.Array.each(A.get(aY).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bH=L.get(Y);if(!J(bH)){A.set(Y,bH);}}});},getBorderColor:function(){var A=this;return A[aU].hex;},getDaysDuration:function(){var A=this;return k.getDayOffset(A.get(aV),A.get(bs));},getHoursDuration:function(){var A=this;return k.getHoursOffset(A.get(aV),A.get(bs));},getMinutesDuration:function(){var A=this;return k.getMinutesOffset(A.get(aV),A.get(bs));},getSecondsDuration:function(){var A=this;return k.getSecondsOffset(A.get(aV),A.get(bs));},sameEndDate:function(L){var A=this;return k.compare(A.get(aV),L.get(aV));},sameStartDate:function(L){var A=this;return k.compare(A.get(bs),L.get(bs));},isAfter:function(Y){var X=this;var L=X.get(bs);var A=Y.get(bs);return k.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(bs);var A=Y.get(bs);return k.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[ax][Y]){var A=k.clone(X);var bI=k.clone(X);k.copyHours(A,L.get(bs));k.copyHours(bI,L.get(aV));var bH=new L.get(aY)({endDate:bI,parentEvent:L,scheduler:L.get(aj),startDate:A});bH.copyPropagateAttrValues(L);L[ax][Y]=bH;}return L[ax][Y];},intersects:function(Y){var X=this;var bH=X.get(aV);var L=X.get(bs);var A=Y.get(bs);return(X.sameStartDate(Y)||k.between(A,L,bH));},intersectHours:function(X){var L=this;var bH=L.get(aV);var A=L.get(bs);var Y=k.clone(A);k.copyHours(Y,X.get(bs));return(k.compare(A,Y)||k.between(Y,A,bH));},isDayBoundaryEvent:function(){var A=this;return k.isDayBoundary(A.get(bs),A.get(aV));},isDayOverlapEvent:function(){var A=this;return k.isDayOverlap(A.get(bs),A.get(aV));},isRepeatableDate:function(L){var A=this;var X=A.get(aT);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return k.safeClearTime(A.get(aV));},getClearStartDate:function(){var A=this;return k.safeClearTime(A.get(bs));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(bs,L);A.set(aV,k.add(k.clone(L),k.MINUTES,X));},uidByDate:function(L){var A=this;L=g(L)?k.safeClearTime(L):A.getClearStartDate();return[aB,L.getTime()].join(m);},setContent:function(X,L){var A=this;A.get(o).each(function(bH){var Y=bH.one(h+aW);Y.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bH){Y.setContent(X);});}},setTitle:function(X,L){var A=this;A.get(o).each(function(Y){var bH=Y.one(h+F);bH.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bH){Y.setTitle(X);});}},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var Y=A.get(o);
var bH=A.getBorderColor();if(Y){var X={borderWidth:A.get(bw),borderColor:bH,backgroundColor:A.get(a9),borderStyle:A.get(aO),color:am};Y.setStyles(X);}if(L){A.eachRepeatedEvent(function(bI,bJ){bI.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aM),L);},syncNodeTitleUI:function(L){var A=this;var X=A.get(f);var Y=[];if(X.startDate){Y.push(A._formatDate(A.get(bs),X.startDate));}if(X.endDate){Y.push(A._formatDate(A.get(aV),X.endDate));}A.setTitle(Y.join(r),L);},split:function(){var A=this,X=k.clone(A.get(bs)),Y=k.clone(A.get(aV));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=k.clone(X);L.setHours(24,0,0,0);return[[X,k.toMidnight(k.clone(X))],[L,k.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aQ.each(A[ax],L,A);},unlink:function(){var A=this;if(A.get(aR)){A.set(aR,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[ax]={};A.syncNodeUI();},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange,visibleChange:A._afterVisibleChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bH,bI){var bJ=bH[aS+bb(X)];if(bJ){bJ.apply(A,[bH,X,L]);}else{bH.set(X,Y.newVal);}bH.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=k.clone(A.get(aV));k.copyHours(X,Y);A.set(aV,X);},_propagateSetStartDate:function(L,X,Y){var A=k.clone(L.get(bs));k.copyHours(A,Y);L.set(bs,A);},_setColor:function(L){var A=this;A[K]=a4.rgb2hsb(a4.getRGB(L));A[Z]=aQ.clone(A[K]);A[Z].b*=A.get(a2);A[Z].s*=A.get(bj);A[aU]=a4.hsb2rgb(A[Z]);return L;},_setDate:function(L){var A=this;if(ag(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bp(L)){L=aQ.SchedulerEventRepeat[L];}return J(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(aj);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetAllDay(A.get(N));A._uiSetDisabled(A.get(x));A._uiSetEndDate(A.get(aV));A._uiSetVisible(A.get(aw));A._uiSetParentEvent(A.get(aR));A._uiSetRepeat(A.get(aT));},_formatDate:function(X,Y){var L=this;var A=L.get(bv);return aQ.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(L){var A=this;if(bp(L)){L={endDate:L,startDate:L};}else{if(be(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(o).toggleClass(G,!!L);},_uiSetDisabled:function(L){var A=this;A.get(o).toggleClass(bm,!!L);},_uiSetEndDate:function(L){var A=this;A.get(o).toggleClass(aq,A.getMinutesDuration()<=30);},_uiSetParentEvent:function(L){var A=this;A.get(o).toggleClass(aH,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aQ.SchedulerEventRepeat[a5];A.get(o).toggleClass(ar,L);},_uiSetVisible:function(L){var A=this;A.get(o).toggleClass(E,!L);}}});aQ.SchedulerEvent=ab;aQ.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aV);var A=L.get(bs);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return k.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return k.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return k.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aV);var A=L.get(bs);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aV);var A=L.get(bs);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var aC=aQ.Lang,b=aC.isArray,J=aC.isObject,U="activeView",N="allDay",d="arrow",a0="body",aG="bodyContent",p="boundingBox",aF="cancel",a8="click",aM="content",aZ="date",aN="dateFormat",an="delete",bf="description",V="edit",bB="event",aY="eventClass",D="footerContent",aK="form",C="header",v="hide",a3="isoTime",aL="link",o="node",S="offsetHeight",bn="offsetWidth",i="overlay",W="overlayOffset",bC="recorder",bx="rendered",aT="repeat",ba="save",aj="scheduler",n="schedulerChange",aB="scheduler-event",aD="scheduler-event-recorder",aJ="shadow",aI="show",I="startDateChange",R="strings",bc="template",a1="title",bA="tl",af="toolbar",br="submit",bt="value",aX="visibleChange",ad="when",ap="x",ao="y",ai="cancel",Q="delete",B="edit",aP="save",bD="-",h=".",ah="",j="#",s=aQ.IO.prototype._serialize,H=aQ.getClassName,t=H(aj,bB),av=H(aj,bB,bC),bE=H(aj,bB,bC,i),y=H(aj,bB,bC,i,d),bl=H(aj,bB,bC,i,d,aJ),al=H(aj,bB,bC,i,a0),bd=H(aj,bB,bC,i,aM),ak=H(aj,bB,bC,i,aZ),aa=H(aj,bB,bC,i,aK),bG=H(aj,bB,bC,i,C),ay=H(aj,bB,bC,i,aT),F=H(aj,bB,a1),P=new aQ.Template('<div class="',bl," ",y,'"></div>','<div class="',y,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bG,'">','<input class="',bd,'" name="content" value="{content}" />',"</div>",'<div class="',al,'">','<label class="',ak,'">{date}</label>','<select class="',ay,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),bF='<form class="'+aa+'" id="schedulerEventRecorderForm"></form>';
var ac=aQ.Component.create({NAME:aD,ATTRS:{allDay:{value:false},content:{value:ah},duration:{value:60},dateFormat:{validator:bp,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aQ.SchedulerEvent;}},strings:{value:{},setter:function(A){return aQ.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:J},overlay:{validator:J,value:{align:{points:[bA,bA]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:b},template:{value:P},toolbar:{setter:function(X){var L=this;var A=L.get(R);return aQ.merge({children:[{handler:aQ.bind(L._handleSaveEvent,L),label:A[ba]},{handler:aQ.bind(L._handleCancelEvent,L),label:A[aF]},{handler:aQ.bind(L._handleDeleteEvent,L),label:A[an]}]},X||{});},validator:J,value:{}}},EXTENDS:aQ.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(o).addClass(av);A.publish(ai,{defaultFn:A._defCancelEventFn});A.publish(Q,{defaultFn:A._defDeleteEventFn});A.publish(B,{defaultFn:A._defEditEventFn});A.publish(aP,{defaultFn:A._defSaveEventFn});A.after(n,A._afterSchedulerChange);A[i]=new aQ.Overlay(A.get(i));A[af]=new aQ.Toolbar(A.get(af));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(p);L.delegate(a8,aQ.bind(A._onClickSchedulerEvent,A),h+t);},_defCancelEventFn:function(L){var A=this;A.get(o).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(aj);L.removeEvent(A.get(bB));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(aj);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(aj);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ai);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(Q,{schedulerEvent:A.get(bB)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bB)?B:aP,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(aB);if(L){A.set(bB,L);A.showOverlay([X.pageX,X.pageY]);A.get(o).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bB)){var X=L[i].get(p);var A=X.one(h+bd);setTimeout(function(){A.selectText();},0);}}else{L.set(bB,null);L.get(o).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(R);L[i].render();L[af].render();var X=L[i].get(p);X.addClass(bE);L[i].set(D,L[af].get(p));L[i].on(aX,aQ.bind(L._onOverlayVisibleChange,L));L.formNode=aQ.Node.create(bF);L[i].set(aG,L.formNode);L.formNode.on(br,aQ.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bB);if(!X){X=new (A.get(aY))({allDay:A.get(N),endDate:A.get(aV),scheduler:A.get(aj),startDate:A.get(bs)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aM,L[aM]);X.set(aT,L[aT]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aN);var bH=(X.get(bB)||X);var bJ=bH.get(aV);var bI=bH.get(aj);var A=bH.get(bs);var Y=(bI.get(U).get(a3)?k.toIsoTimeString:k.toUsTimeString);return[bH._formatDate(A,L),Y(A),bk,Y(bJ)].join(r);},getTemplateData:function(){var L=this;var A=L.get(R);var X=(L.get(bB)||L);return{content:X.get(aM)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aV).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aT),startDate:X.get(bs).getTime()};},hideOverlay:function(){var A=this;A[i].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aQ.each(aQ.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[bf],value:L[bt]});});}A.formNode.setContent(A.get(bc).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aQ.QueryString.parse(s(A.formNode.getDOM()));},showOverlay:function(Y,bI){var A=this;var X=A.get(W);if(!A[i].get(bx)){A._renderOverlay();}A[i].show();if(!Y){var L=(A.get(bB)||A).get(o);var bH=L.one(h+F);bI=[X[0]+bH.get(bn),X[1]+bH.get(S)/2];Y=bH.getXY();}bI=bI||X;Y[0]+=bI[0];Y[1]+=bI[1];A[i].set("xy",Y);}}});aQ.SchedulerEventRecorder=ac;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});