AUI.add("aui-editor-toolbar-plugin",function(s){var aj=s.Lang,D=aj.isArray,t=aj.isFunction,ae=s.ClassNameManager.getClassName,I="editortoolbar",ah="toolbar",w="alignment",E="align-left",W="align-inline",v="align-block",ai="align-right",K="color",P="content",p="font",ad="indent",l="input",R="insert",G="insertimage",X="insertlink",S="list",x="select",c="source",m="styles",Z="subscript",Y="text",N="circle-check",a="close",ab={backcolor:true,forecolor:true,format:true,insertimage:true,insertlink:true,source:true,styles:true},z=["b","big","font","em","i","small","s","strike","strong","sub","sup","u"],q=ae("button","holder"),r=ae("field",l),y=ae("field",l,"text"),h=ae("field","label"),H=ae("field","numeric"),n=ae(I,"align","node"),B=ae(I,G),k=ae(I,X),b=ae(I,x,"fontname"),ac=ae(I,x,"fontsize"),f=ae(I,"size","separator"),i=ae(I,c,"textarea"),e=ae("state","active"),j=ae(I),C=ae(I,P),Q='<div class="'+n+'"></div>',o="<a></a>",F="<img />",M='<a href="{0}"{2}>{1}</a>',g='<textarea class="'+i+'"></textarea>',ag='<div class="'+j+'"><div class="'+C+'"></div></div>',U='<div class="'+q+'"></div>',af='<select class="'+b+'">{0}</select>',u='<option selected="selected"></option>'+"<option>Arial</option>"+"<option>Arial Black</option>"+"<option>Comic Sans MS</option>"+"<option>Courier New</option>"+"<option>Lucida Console</option>"+"<option>Tahoma</option>"+"<option>Times New Roman</option>"+"<option>Trebuchet MS</option>"+"<option>Verdana</option>",V='<select class="'+ac+'">{0}</select>',O='<option selected="selected"></option>'+'<option value="1">10</option>'+'<option value="2">13</option>'+'<option value="3">16</option>'+'<option value="4">18</option>'+'<option value="5">24</option>'+'<option value="6">32</option>'+'<option value="7">48</option>',L='<span class="'+f+'">x</span>';var J=s.Component.create({NAME:I,NS:ah,EXTENDS:s.Plugin.Base,ATTRS:{append:{value:null},groups:{value:[{type:p},{type:Y},{type:K},{type:w},{type:ad},{type:S},{type:R},{type:c}]}},prototype:{initializer:function(){var aA=this;var aq=aA.get("host");var ao=aq.frame.get("container");var ay=aA.get("append");var aB=aA.get("groups");var am=s.Node.create(ag);var ap=am.one("."+C);ao.placeBefore(am);aA._boundingBox=am;aA._contentBox=ap;var ar=[];if(ay!=null&&D(ay)){var at=ay.length;for(var aw=0;aw<at;aw++){var az=ay[aw];if(az.index!=null){var ak=aA._isGroupIncluded("type",aB,az.type);if(ak!=-1){aB.splice(ak,1);}aB.splice(Math.min(az.index,aB.length),0,az);}else{aB.push(az);}}}for(aw=0;aw<aB.length;aw++){var al=aB[aw];var au=T[al.type]||al;var ax=[];if(D(al.include)){var A=al.include.length;for(var av=0;av<A;av++){ak=aA._isGroupIncluded("icon",au.children,al.include[av]);if(ak!=-1){ax.push(au.children[ak]);}}}else{ax=au.children;}var an=aA._addGroup(al,au,ax);if(an){ar.push(an);}}aA._toolbars=ar;ap.delegate("click",function(aF){var aD=this;var aE=s.Widget.getByNode(aF.currentTarget);if(aE){var aC=aE.get("icon").split("-");if(!ab[aC[0]]){aD.execCommand(aC[0],(aC[1]?aC[1]:""));aD.focus();}}},"button",aq);},addGroup:function(al){var A=this;var ak=T[al.type]||al;A._addGroup(al,ak);},addGroupType:function(ak,al){var A=this;if(!T[ak]){T[ak]=al;}},_addGroup:function(an,au,ay){var aB=this;var ak=(ay==null&&an.index!=null);ay=ay||au.children;if(D(ay)){var aq=aB.get("host");var ap=aB._contentBox;var al=[];var ao;var at={boundingBox:aB._boundingBox,contentBox:ap};for(var ax=0;ax<ay.length;ax++){var A=ay[ax];if(!A.select){var aD=YUI.AUI.defaults.EditorToolbar.STRINGS[A._titleKey];A.title=(aD!=null?aD:aa[A._titleKey]);al.push(A);}}if(al.length){ao=new s.Toolbar(s.merge(au.config,an.toolbar,{children:al})).render(ap);}var av=au.generate;if(av&&t(av.init)){av.init.call(aB,aq,at);}al=(al.length?al:ay);for(ax=0;ax<al.length;ax++){var aA=al[ax];var az=aA.icon;if(av&&t(av[az])){var aC=(an.config?an.config[az]:null);at.button=(aA.select||!ao?null:ao.item(ax));av[az].call(aB,aq,at,aC);}}if(ak){var ar=ap.get("childNodes");var aw=ar.size();var am=an.index;if(am<aw-1){ap.insert(ar.item(aw-1),ar.item(am));}}return ao;}return null;},_isGroupIncluded:function(ak,am,an){var A=this;for(var al=0;al<am.length;al++){if(am[al][ak]==an){return al;}}return -1;},_updateToolbar:function(A,ap){var aq=this;if(A.changedNode){var al=A.commands;var ar=aq.toolbars;var au=function(aw,av,ay){var ax=!!(al[aw.get("icon")]);aw.StateInteraction.set("active",ax);};if(ar){for(var an=0;an<ar.length;an++){ar[an].each(au);}}var ak=A.fontFamily;var ao=ap._fontNameOptions;var at=A.fontSize;var am=ap._fontSizeOptions;if(ao){ao.item(0).set("selected",true);ao.each(function(aw,av,ay){var ax=aw.get("value").toLowerCase();if(ax===ak.toLowerCase()){aw.set("selected",true);}});}if(am){at=at.replace("px","");am.item(0).set("selected",true);am.each(function(ax,aw,az){var ay=ax.get("value").toLowerCase();var av=ax.get("text");if(av===at){ax.set("selected",true);}});}}}}});function d(al){var A=this;var an=al.currentTarget;var ak=an.get("className");var am=ak.substring(ak.lastIndexOf("-")+1);var ao=an.get("value");A.execCommand(am,ao);A.focus();}J.generateOverlay=function(am,al,A){var ak=new s["OverlayContext"+(A?"Panel":"")](s.merge({align:{node:am,points:["tl","bl"]},hideOn:"click",showOn:"click",trigger:am},al)).render();return ak;};J.generateColorPicker=function(ap,am,al,aq){var ao=am.button;var ak=ao.get("boundingBox");var A=new s.ColorPicker(s.merge({align:{node:ak,points:["tl","bl"]},trigger:ak},al));if(al&&al.plugins){for(var an=0;an<al.plugins.length;an++){A.plug(al.plugins[an],al);}}A.render(s.getBody());A.on("colorChange",function(au){var ar=this;var at=A.get("rgb");ap.execCommand(aq,at.hex);ap.focus();});};J.openOverlayToAlignNode=function(al,ak,am,A){var ao=am.getXY();var an=A.getXY();ao=[ao[0]+an[0],ao[1]+an[1]];ak.setStyle("width",A.get("offsetWidth"));ak.setStyle("height",A.get("offsetHeight"));ak.setXY(ao);ak.show();al.set("align",{node:ak,points:["tl","bc"]});al.show();};var aa={ALIGN:"Align",ALIGN_BLOCK:"Block",ALIGN_LEFT:"Left",ALIGN_INLINE:"Inline",ALIGN_RIGHT:"Right",BACKCOLOR:"Background Color",BOLD:"Bold",BORDER:"Border",DESCRIPTION:"Description",EDIT_IMAGE:"Edit Image",EDIT_LINK:"Edit Link",FORECOLOR:"Foreground Color",IMAGE_URL:"Image URL",INDENT:"Indent",INSERT:"Insert",INSERT_IMAGE:"Insert Image",INSERT_LINK:"Insert Link",INSERT_ORDERED_LIST:"Insert Numbered List",INSERT_UNORDERED_LIST:"Insert Bulleted List",ITALIC:"Italic",JUSTIFY_LEFT:"Justify Left",JUSTIFY_CENTER:"Justify Center",JUSTIFY_RIGHT:"Justify Right",LINE_THROUGH:"Line Through",LINK_URL:"Link URL",OPEN_IN_NEW_WINDOW:"Open in new window",OUTDENT:"Outdent",PADDING:"Padding",REMOVE_FORMAT:"Format Source",SAVE:"Save",SIZE:"Size",SOURCE:"Source",SUBSCRIPT:"Subscript",SUPERSCRIPT:"Superscript",STYLES:"Styles",UNDERLINE:"Underline"};
if(!YUI.AUI.defaults.EditorToolbar){YUI.AUI.defaults.EditorToolbar={STRINGS:{}};}s.mix(YUI.AUI.defaults.EditorToolbar.STRINGS,aa);var T={};T[w]={children:[{icon:"justifyleft",_titleKey:"JUSTIFY_LEFT"},{icon:"justifycenter",_titleKey:"JUSTIFY_CENTER"},{icon:"justifyright",_titleKey:"JUSTIFY_RIGHT"}]};T[K]={children:[{icon:"forecolor",_titleKey:"FORECOLOR"},{icon:"backcolor",_titleKey:"BACKCOLOR"}],generate:{forecolor:function(am,al,ak){var A=this;J.generateColorPicker(am,al,ak,"forecolor");},backcolor:function(am,al,ak){var A=this;J.generateColorPicker(am,al,ak,"backcolor");}}};T[p]={children:[{icon:"fontname",select:true},{icon:"fontsize",select:true}],generate:{init:function(am,al){var A=this;var ak=al.contentBox;am.after("nodeChange",function(ao){var an=this;switch(ao.changedType){case"keyup":case"mousedown":an._updateToolbar(ao,al);break;}},A);},fontname:function(ao,an,am){var A=this;var ak=an.contentBox;var ap;var aq=[u];if(am&&am.optionHtml){aq[0]=am.optionHtml;}ap=s.Node.create(aj.sub(af,aq));ak.append(ap);ap.on("change",d,ao);var al=ak.all("."+b+" option");an._fontNameOptions=al;return ap;},fontsize:function(ao,an,am){var A=this;var ak=an.contentBox;var ap;var aq=[O];if(am&&am.optionHtml){aq[0]=am.optionHtml;}ap=s.Node.create(aj.sub(V,aq));ak.append(ap);ap.on("change",d,ao);var al=ak.all("."+ac+" option");an._fontSizeOptions=al;return ap;}}};T[ad]={children:[{icon:"indent",_titleKey:"INDENT"},{icon:"outdent",_titleKey:"OUTDENT"}]};T[R]={children:[{icon:"insertimage",_titleKey:"INSERT_IMAGE"},{icon:"insertlink",_titleKey:"INSERT_LINK"}],generate:{insertimage:function(an,aw,aF){var aD=this;var A=aw.button;var aq=A.get("boundingBox");var aC=J.generateOverlay(aq,aF,true);var az=aC.get("contentBox");var au=new s.Panel({collapsible:false,title:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT_IMAGE,icons:[{icon:a,handler:{fn:aC.hide,context:aC}}]}).render(az);az=au.bodyNode;if(aF&&aF.dataBrowser){aF.dataBrowser.render(az);}else{var ap;var aG;var aE=new s.Form({cssClass:B,labelAlign:"left"}).render(az);var at=[{labelText:"none",value:"none"}];for(var aA=1;aA<6;aA++){at.push({labelText:aA+"px",value:aA+"px solid"});}aE.add([{id:"imageURL",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.IMAGE_URL},{id:"size",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.SIZE,type:"hidden"},{id:"width",labelText:false,cssClass:H},{id:"height",labelText:false,cssClass:H},{id:"padding",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.PADDING},new s.Select({id:"border",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.BORDER,options:at}),{id:"align",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN,type:"hidden"},{id:"description",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.DESCRIPTION},{id:"linkURL",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.LINK_URL},{id:"openInNewWindow",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.OPEN_IN_NEW_WINDOW,type:"checkbox"}],true);aE.getField("width").get("boundingBox").placeAfter(L);var ao=aE.get("contentBox");var aB=s.Node.create(U);var av=aE.getField("openInNewWindow");var ay=new s.ButtonItem({icon:N,label:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT}).render(aB);ay.on("click",function(aI){var aS=this;var aJ;var aM;var aQ;if(ap){aM=ap;aQ=ap.get("parentNode");if(aQ.get("tagName").toLowerCase()=="a"){aJ=aQ;}}else{aM=s.Node.create(F);}var aL=aE.get("fieldValues");var aR=aL.description;var aN={src:aL.imageURL,title:aR,alt:aR};var aP={border:aL.border};var aT=parseInt(aL.height,10);var aK=parseInt(aL.width,10);if(!isNaN(aT)){aN.height=aT;}if(!isNaN(aK)){aN.width=aK;}var aO=parseInt(aL.padding,10);if(!isNaN(aO)){aP.padding=aO;}ax.some(function(aW,aV,aY){var aU=this;var aX=aW.StateInteraction.get("active");if(aX){aP.display="";switch(aV){case 0:aN.align="left";break;case 1:aN.align="";break;case 2:aN.align="center";aP.display="block";break;case 3:aN.align="right";break;}return true;}return false;});aM.setAttrs(aN);aM.setStyles(aP);var aH=aL.linkURL;if(aH){if(!aJ){aJ=s.Node.create(o);if(ap){aQ.insert(aJ,ap);}aJ.append(aM);}aJ.setAttribute("href",aH);aJ.setAttribute("target",(av.get("node").get("checked")?"_blank":""));aM=aJ;}else{if(ap&&aJ){aQ.insert(ap,aJ);aJ.remove(true);}}if(!ap&&aG&&aG.anchorNode){aG.anchorNode.append(aM);}aC.hide();});var ar=s.Node.create(F);var ak=aE.getField("height");var al=aE.getField("width");ar.on("load",function(aI){var aH=aI.currentTarget;if(!ak.get("value")||!al.get("value")){aE.set("values",{height:aH.get("height"),width:aH.get("width")});}});aE.getField("imageURL").get("node").on("blur",function(aH){ar.set("src",this.val());});ao.append(aB);var ax=new s.Toolbar({activeState:true,children:[{icon:E,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_LEFT},{icon:W,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_INLINE},{icon:v,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_BLOCK},{icon:ai,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_RIGHT}]});ax.after("buttonitem:click",function(aI){var aH=aI.target;ax.each(function(aK,aJ,aL){if(aK!=aH){aK.StateInteraction.set("active",false);}});});ax.render(aE.getField("align").get("contentBox"));aC.on("show",function(aH){if(!aG||!aG.anchorNode){var aI=an.getInstance();an.focus();aG=new aI.Selection();}});aC.after("hide",function(aH){aE.resetValues();ax.each(function(aJ,aI,aK){aJ.StateInteraction.set("active",false);});av.get("node").set("checked",false);au.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT_IMAGE);ay.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT);am.hide();aC.set("align",{node:aq,points:["tl","bl"]});ap=null;});var am=s.Node.create(Q);am.hide();s.getBody().append(am);an.on("toolbar:ready",function(){var aH=an.frame._iframe;var aI=an.getInstance();aH.on("mouseout",function(aJ){aG=new aI.Selection();});aI.one("body").delegate("click",function(aO){var aJ=this;if(ap!=aO.currentTarget){var aL=aO.currentTarget;var aN=aL.get("parentNode");var aK=aL.getStyle("borderWidth");var aP=aL.getStyle("padding");var aQ=(aN.get("tagName").toLowerCase()=="a");aE.set("values",{border:(aK?aK+" solid":""),description:aL.get("alt"),height:aL.get("height"),imageURL:aL.get("src"),linkURL:(aQ?aN.get("href"):""),width:aL.get("width"),padding:(aP?parseInt(aP):"")});
var aM=1;switch(aL.getAttribute("align")){case"left":aM=0;break;case"center":aM=2;break;case"right":aM=3;break;}ax.item(aM).StateInteraction.set("active",true);av.get("node").attr("checked",(aQ&&aN.getAttribute("target")=="_blank"));au.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.EDIT_IMAGE);ay.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.SAVE);ap=aL;J.openOverlayToAlignNode(aC,am,aH,aL);}},"img");});}},insertlink:function(al,au,aA){var az=this;var A=au.button;var an=A.get("boundingBox");var ay=J.generateOverlay(an,aA,true);var aw=ay.get("contentBox");var ar=new s.Panel({collapsible:false,title:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT_LINK,icons:[{icon:a,handler:{fn:ay.hide,context:ay}}]}).render(aw);aw=ar.bodyNode;var ao=al.frame._iframe;var am;var aB;var aq=new s.Form({cssClass:k,labelAlign:"left"}).render(aw);aq.add([{id:"description",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.DESCRIPTION},{id:"linkURL",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.LINK_URL},{id:"openInNewWindow",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.OPEN_IN_NEW_WINDOW,type:"checkbox"}],true);var ap=aq.get("contentBox");var ax=s.Node.create(U);var at=aq.getField("openInNewWindow");var av=new s.ButtonItem({icon:N,label:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT}).render(ax);av.on("click",function(aE){var aC=this;var aD=aq.get("fieldValues");if(am){am.setAttribute("href",aD.linkURL);am.set("innerHTML",aD.description);if(at.get("node").get("checked")){am.setAttribute("target","_blank");}else{am.setAttribute("target","");}}else{al.execCommand("inserthtml",aj.sub(M,[aD.linkURL,aD.description,(at.get("node").get("checked")?' target="_blank"':"")]));}ay.hide();});ap.append(ax);ay.after("hide",function(aC){aq.resetValues();at.get("node").set("checked",false);ar.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.CREATE_LINK);av.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT);ak.hide();ay.set("align",{node:an,points:["tl","bl"]});am=null;});var ak=s.Node.create(Q);ak.hide();s.getBody().append(ak);al.on("toolbar:ready",function(){var aC=al.getInstance();aC.one("body").delegate("click",function(aG){var aD=this;if(am!=aG.currentTarget){var aF=aG.currentTarget;if(!aF.one("img")){var aE=aF.get("parentNode");aq.set("values",{description:aF.get("innerHTML"),linkURL:aF.getAttribute("href")});at.get("node").attr("checked",(aF.getAttribute("target")=="_blank"));ar.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.EDIT_LINK);av.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.SAVE);am=aF;J.openOverlayToAlignNode(ay,ak,ao,aF);}}},"a");});}}};T[S]={children:[{icon:"insertunorderedlist",_titleKey:"INSERT_UNORDERED_LIST"},{icon:"insertorderedlist",_titleKey:"INSERT_ORDERED_LIST"}],generate:{init:function(ak){var A=this;ak.plug(s.Plugin.EditorLists);}}};T[c]={children:[{icon:"format",_titleKey:"REMOVE_FORMAT"},{icon:"source",_titleKey:"SOURCE"}],generate:{format:function(an,al,ak){var A=this;var am=al.button;am.on("click",function(ar){var ao=this;var at=ao.getInstance();var aq=new at.Selection();var ap=aq.getSelected();if(!aq.isCollapsed&&ap.size()){ap.each(function(aA,aw,aB){var au=this;aA.removeAttribute("style");var ay=aA.get("innerHTML");ay=ay.replace(/<([a-zA-Z0-9]*)\b[^>]*>/g,"<$1>");for(var ax=0;ax<z.length;ax++){var av=new RegExp("(<"+z[ax]+">|<\\/"+z[ax]+">)","ig");ay=ay.replace(av,"");}aA.set("innerHTML",ay);var az=aA.get("parentNode");if(!az.test("body")){az.removeAttribute("style");}});}},an);},source:function(ap,an,am){var A=this;var al=an.contentBox;var ao=an.button;var aq;var ak=s.Node.create(g);ap.on("toolbar:ready",function(){var ar=this;var au=ap.frame;var at=au.get("container");ak.hide();at.append(ak);});ao._visible=false;ao.on("click",function(aw){var ar=this;var ax=ap.frame;var au=ao._visible;if(au){ar.set("content",ak.val());ak.hide();ak.val("");ax.show();}else{var av=ax._iframe;ak.val(ar.getContent());var at=av.get("offsetHeight")-ak.getPadding("tb");ak.setStyle("height",at);ax.hide();ak.show();}au=!au;ao._visible=au;al.all("select").attr("disabled",au);al.all("button").attr("disabled",au);ao.get("contentBox").attr("disabled",false);},ap);}}};T[m]={children:[{icon:"styles",_titleKey:"STYLES"}],generate:{styles:function(ao,am,al){var A=this;var an=am.button;var ak=an.get("boundingBox");ao.plug(s.Plugin.EditorMenu);ao.menu.add(s.merge({align:{node:ak,points:["tl","bl"]},hideOn:"click",showOn:"click",trigger:ak},al));}}};T[Z]={children:[{icon:"subscript",_titleKey:"SUBSCRIPT"},{icon:"superscript",_titleKey:"SUPERSCRIPT"}]};T[Y]={children:[{icon:"bold",_titleKey:"BOLD"},{icon:"italic",_titleKey:"ITALIC"},{icon:"underline",_titleKey:"UNDERLINE"},{icon:"strikethrough",_titleKey:"LINE_THROUGH"}]};s.namespace("Plugin").EditorToolbar=J;},"@VERSION@",{requires:["aui-base","aui-button-item","aui-color-picker","aui-editor-menu-plugin","aui-editor-tools-plugin","aui-form-select","aui-overlay-context-panel","aui-panel","aui-toolbar","createlink-base","editor-lists","editor-base","plugin"]});