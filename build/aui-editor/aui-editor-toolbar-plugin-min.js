AUI.add("aui-editor-toolbar-plugin",function(S){var AG=S.Lang,c=AG.isArray,T=AG.isFunction,AB=S.ClassNameManager.getClassName,h="editortoolbar",AE="toolbar",W="alignment",d="align-left",u="align-inline",V="align-block",AF="align-right",j="color",o="content",P="font",AA="indent",L="input",q="insert",f="insertimage",v="insertlink",r="list",X="select",D="source",M="styles",x="subscript",w="text",m="circle-check",B="close",y={backcolor:true,forecolor:true,format:true,insertimage:true,insertlink:true,source:true,styles:true},Z=["b","big","font","em","i","small","s","strike","strong","sub","sup","u"],Q=AB("button","holder"),R=AB("field",L),Y=AB("field",L,"text"),H=AB("field","label"),g=AB("field","numeric"),N=AB(h,"align","node"),a=AB(h,f),K=AB(h,v),C=AB(h,X,"fontname"),z=AB(h,X,"fontsize"),F=AB(h,"size","separator"),I=AB(h,D,"textarea"),E=AB("state","active"),J=AB(h),b=AB(h,o),p='<div class="'+N+'"></div>',O="<a></a>",e="<img />",l='<a href="{0}"{2}>{1}</a>',G='<textarea class="'+I+'"></textarea>',AD='<div class="'+J+'"><div class="'+b+'"></div></div>',s='<div class="'+Q+'"></div>',AC='<select class="'+C+'">{0}</select>',U='<option selected="selected"></option>'+"<option>Arial</option>"+"<option>Arial Black</option>"+"<option>Comic Sans MS</option>"+"<option>Courier New</option>"+"<option>Lucida Console</option>"+"<option>Tahoma</option>"+"<option>Times New Roman</option>"+"<option>Trebuchet MS</option>"+"<option>Verdana</option>",t='<select class="'+z+'">{0}</select>',n='<option selected="selected"></option>'+'<option value="1">10</option>'+'<option value="2">13</option>'+'<option value="3">16</option>'+'<option value="4">18</option>'+'<option value="5">24</option>'+'<option value="6">32</option>'+'<option value="7">48</option>',k='<span class="'+F+'">x</span>';var i=S.Component.create({NAME:h,NS:AE,EXTENDS:S.Plugin.Base,ATTRS:{append:{value:null},groups:{value:[{type:P},{type:w},{type:x},{type:j},{type:W},{type:AA},{type:r},{type:q},{type:D}]}},prototype:{initializer:function(){var AX=this;var AN=AX.get("host");var AL=AN.frame.get("container");var AU=AX.get("append");var AY=AX.get("groups");var AJ=S.Node.create(AD);var AM=AJ.one("."+b);AL.placeBefore(AJ);var AP={boundingBox:AJ,contentBox:AM};var AO=[];AX.on("buttonitem:click",function(Ac){var Ab=this;var Aa=Ac.target.get("icon").split("-");if(!y[Aa[0]]){Ab.execCommand(Aa[0],(Aa[1]?Aa[1]:""));Ab.focus();}},AN);if(AU!=null&&c(AU)){for(var AT=0;AT<AU.length;AT++){if(AU[AT].index!=null){var AH=Math.min(AU[AT].index,AY.length);AY.splice(AH,0,AU[AT]);}else{AY.push(AU[AT]);}}}for(var AT=0;AT<AY.length;AT++){var AI=AY[AT];var AQ=GROUPS[AI.type];var AK;var A=[];for(var AS=0;AS<AQ.children.length;AS++){if(!AQ.children[AS].select){A.push(AQ.children[AS]);}}if(A.length>0){AK=new S.Toolbar(S.merge(AQ.config,AI.toolbar,{children:A})).render(AM);AK.addTarget(AX);AO.push(AK);}var AR=AQ.generate;if(AR&&T(AR.init)){AR.init.call(AX,AN,AP);}for(var AS=0;AS<AQ.children.length;AS++){var AW=AQ.children[AS];var AV=AW.icon;if(AR&&T(AR[AV])){var AZ=(AI.config?AI.config[AV]:null);AP.button=(AW.select||!AK?null:AK.item(AS));AR[AV].call(AX,AN,AP,AZ);}}}AP.toolbars=AO;},_updateToolbar:function(A,AM){var AN=this;if(A.changedNode){var AI=A.commands;var AO=AM.toolbars;var AQ=function(AS,AR,AU){var AT=!!(AI[AS.get("icon")]);AS.StateInteraction.set("active",AT);};if(AO){for(var AK=0;AK<AO.length;AK++){AO[AK].each(AQ);}}var AH=A.fontFamily;var AL=AM._fontNameOptions;var AP=A.fontSize;var AJ=AM._fontSizeOptions;if(AL){AL.item(0).set("selected",true);AL.each(function(AS,AR,AU){var AT=AS.get("value").toLowerCase();if(AT===AH.toLowerCase()){AS.set("selected",true);}});}if(AJ){AP=AP.replace("px","");AJ.item(0).set("selected",true);AJ.each(function(AT,AS,AV){var AU=AT.get("value").toLowerCase();var AR=AT.get("text");if(AR===AP){AT.set("selected",true);}});}}}}});i.generateOverlay=function(AJ,AI,A){var AH=new S["OverlayContext"+(A?"Panel":"")](S.merge({align:{node:AJ,points:["tl","bl"]},hideOn:"click",showOn:"click",trigger:AJ},AI)).render();return AH;};i.generateColorPicker=function(AM,AJ,AI,AN){var AL=AJ.button;var AH=AL.get("boundingBox");var A=new S.ColorPicker(S.merge({align:{node:AH,points:["tl","bl"]},trigger:AH},AI));if(AI&&AI.plugins){for(var AK=0;AK<AI.plugins.length;AK++){A.plug(AI.plugins[AK],AI);}}A.render(S.getBody());A.on("colorChange",function(AQ){var AO=this;var AP=A.get("rgb");AM.execCommand(AN,AP.hex);AM.focus();});};i.openOverlayToAlignNode=function(AI,AH,AJ,A){var AL=AJ.getXY();var AK=A.getXY();AL=[AL[0]+AK[0],AL[1]+AK[1]];AH.setStyle("width",A.get("offsetWidth"));AH.setStyle("height",A.get("offsetHeight"));AH.setXY(AL);AH.show();AI.set("align",{node:AH,points:["tl","bc"]});AI.show();};i.STRINGS={ALIGN:"Align",ALIGN_BLOCK:"Block",ALIGN_LEFT:"Left",ALIGN_INLINE:"Inline",ALIGN_RIGHT:"Right",BACKCOLOR:"Background Color",BOLD:"Bold",BORDER:"Border",DESCRIPTION:"Description",EDIT_IMAGE:"Edit Image",EDIT_LINK:"Edit Link",FORECOLOR:"Foreground Color",IMAGE_URL:"Image URL",INDENT:"Indent",INSERT:"Insert",INSERT_IMAGE:"Insert Image",INSERT_LINK:"Insert Link",INSERT_ORDERED_LIST:"Insert Numbered List",INSERT_UNORDERED_LIST:"Insert Bulleted List",ITALIC:"Italic",JUSTIFY_LEFT:"Justify Left",JUSTIFY_CENTER:"Justify Center",JUSTIFY_RIGHT:"Justify Right",LINK_URL:"Link URL",OPEN_IN_NEW_WINDOW:"Open in new window",OUTDENT:"Outdent",PADDING:"Padding",REMOVE_FORMAT:"Format Source",SAVE:"Save",SIZE:"Size",SOURCE:"Source",SUBSCRIPT:"Subscript",SUPERSCRIPT:"Superscript",LINE_THROUGH:"Line Through",UNDERLINE:"Underline"};GROUPS={};GROUPS[W]={children:[{icon:"justifyleft",title:i.STRINGS.JUSTIFY_LEFT},{icon:"justifycenter",title:i.STRINGS.JUSTIFY_CENTER},{icon:"justifyright",title:i.STRINGS.JUSTIFY_RIGHT}]};GROUPS[j]={children:[{icon:"forecolor",title:i.STRINGS.FORECOLOR},{icon:"backcolor",title:i.STRINGS.BACKCOLOR}],generate:{forecolor:function(AJ,AI,AH){var A=this;i.generateColorPicker(AJ,AI,AH,"forecolor");},backcolor:function(AJ,AI,AH){var A=this;i.generateColorPicker(AJ,AI,AH,"backcolor");
}}};GROUPS[P]={children:[{icon:"fontname",select:true},{icon:"fontsize",select:true}],generate:{init:function(AJ,AI){var A=this;var AH=AI.contentBox;S.delegate("change",function(AM){var AK=this;var AO=AM.currentTarget;var AL=AO.get("className");var AN=AL.substring(AL.lastIndexOf("-")+1);var AP=AO.get("value");AJ.execCommand(AN,AP);AJ.focus();},AH,"select");AJ.after("nodeChange",function(AL){var AK=this;switch(AL.changedType){case"keyup":case"mousedown":AK._updateToolbar(AL,AI);break;}},A);},fontname:function(AM,AL,AK){var A=this;var AH=AL.contentBox;var AJ;var AN=[U];if(AK&&AK.optionHtml){AN[0]=AK.optionHtml;}AJ=AG.sub(AC,AN);AH.append(AJ);var AI=AH.all("."+C+" option");AL._fontNameOptions=AI;},fontsize:function(AM,AL,AK){var A=this;var AH=AL.contentBox;var AJ;var AN=[n];if(AK&&AK.optionHtml){AN[0]=AK.optionHtml;}AJ=AG.sub(t,AN);AH.append(AJ);var AI=AH.all("."+z+" option");AL._fontSizeOptions=AI;}}};GROUPS[AA]={children:[{icon:"indent",title:i.STRINGS.INDENT},{icon:"outdent",title:i.STRINGS.OUTDENT}]};GROUPS[q]={children:[{icon:"insertimage",title:i.STRINGS.INSERT_IMAGE},{icon:"insertlink",title:i.STRINGS.INSERT_LINK}],generate:{insertimage:function(AK,AT,Ac){var Aa=this;var A=AT.button;var AN=A.get("boundingBox");var AZ=i.generateOverlay(AN,Ac,true);var AW=AZ.get("contentBox");var AR=new S.Panel({collapsible:false,title:i.STRINGS.INSERT_IMAGE,icons:[{icon:B,handler:{fn:AZ.hide,context:AZ}}]}).render(AW);AW=AR.bodyNode;if(Ac&&Ac.dataBrowser){Ac.dataBrowser.render(AW);}else{var AO=AK.frame._iframe;var AM;var Ad;var Ab=new S.Form({cssClass:a,labelAlign:"left"}).render(AW);var AQ=[{labelText:"none",value:"none"}];for(var AX=1;AX<6;AX++){AQ.push({labelText:AX+"px",value:AX+"px solid"});}Ab.add([{id:"imageURL",labelText:i.STRINGS.IMAGE_URL},{id:"size",labelText:i.STRINGS.SIZE,type:"hidden"},{id:"width",labelText:false,cssClass:g},{id:"height",labelText:false,cssClass:g},{id:"padding",labelText:i.STRINGS.PADDING},new S.Select({id:"border",labelText:i.STRINGS.BORDER,options:AQ}),{id:"align",labelText:i.STRINGS.ALIGN,type:"hidden"},{id:"description",labelText:i.STRINGS.DESCRIPTION},{id:"linkURL",labelText:i.STRINGS.LINK_URL},{id:"openInNewWindow",labelText:i.STRINGS.OPEN_IN_NEW_WINDOW,type:"checkbox"}],true);Ab.getField("width").get("boundingBox").placeAfter(k);var AL=Ab.get("contentBox");var AY=S.Node.create(s);var AS=Ab.getField("openInNewWindow");var AV=new S.ButtonItem({icon:m,label:i.STRINGS.INSERT}).render(AY);AV.on("click",function(Af){var Ap=this;var Ag;var Aj;var An;if(AM){Aj=AM;An=AM.get("parentNode");if(An.get("tagName").toLowerCase()=="a"){Ag=An;}}else{Aj=S.Node.create(e);}var Ai=Ab.get("fieldValues");var Ao=Ai.description;var Ak={src:Ai.imageURL,title:Ao,alt:Ao};var Am={border:Ai.border};var Aq=parseInt(Ai.height,10);var Ah=parseInt(Ai.width,10);if(!isNaN(Aq)){Ak.height=Aq;}if(!isNaN(Ah)){Ak.width=Ah;}var Al=parseInt(Ai.padding,10);if(!isNaN(Al)){Am.padding=Al;}AU.some(function(At,As,Av){var Ar=this;var Au=At.StateInteraction.get("active");if(Au){Am.display="";switch(As){case 0:Ak.align="left";break;case 1:Ak.align="";break;case 2:Ak.align="center";Am.display="block";break;case 3:Ak.align="right";break;}return true;}});Aj.setAttrs(Ak);Aj.setStyles(Am);var Ae=Ai.linkURL;if(Ae){if(!Ag){Ag=S.Node.create(O);if(AM){An.insert(Ag,AM);}Ag.append(Aj);}Ag.setAttribute("href",Ae);Ag.setAttribute("target",(AS.get("node").get("checked")?"_blank":""));Aj=Ag;}else{if(AM&&Ag){An.insert(AM,Ag);Ag.remove(true);}}if(!AM&&Ad&&Ad.anchorNode){Ad.anchorNode.append(Aj);}AZ.hide();});var AP=S.Node.create(e);var AH=Ab.getField("height");var AI=Ab.getField("width");AP.on("load",function(Af){var Ae=Af.currentTarget;if(!AH.get("value")||!AI.get("value")){Ab.set("values",{height:Ae.get("height"),width:Ae.get("width")});}});Ab.getField("imageURL").get("node").on("blur",function(Ae){AP.set("src",this.val());});AL.append(AY);var AU=new S.Toolbar({activeState:true,children:[{icon:d,title:i.STRINGS.ALIGN_LEFT},{icon:u,title:i.STRINGS.ALIGN_INLINE},{icon:V,title:i.STRINGS.ALIGN_BLOCK},{icon:AF,title:i.STRINGS.ALIGN_RIGHT}]});AU.after("buttonitem:click",function(Af){var Ae=Af.target;AU.each(function(Ah,Ag,Ai){if(Ah!=Ae){Ah.StateInteraction.set("active",false);}});});AU.render(Ab.getField("align").get("contentBox"));AZ.on("show",function(Ae){if(!Ad||!Ad.anchorNode){var Af=AK.getInstance();AK.focus();Ad=new Af.Selection();}});AZ.after("hide",function(Ae){Ab.resetValues();AU.each(function(Ag,Af,Ah){Ag.StateInteraction.set("active",false);});AS.get("node").set("checked",false);AR.set("title",i.STRINGS.INSERT_IMAGE);AV.set("label",i.STRINGS.INSERT);AJ.hide();AZ.set("align",{node:AN,points:["tl","bl"]});AM=null;});AO.on("mouseout",function(Ae){var Af=AK.getInstance();Ad=new Af.Selection();});var AJ=S.Node.create(p);AJ.hide();S.getBody().append(AJ);AK.on("frame:ready",function(Ae){var Af=AK.getInstance();Af.one("body").delegate("click",function(Al){var Ag=this;if(AM!=Al.currentTarget){var Ai=Al.currentTarget;var Ak=Ai.get("parentNode");var Ah=Ai.getStyle("borderWidth");var Am=Ai.getStyle("padding");var An=(Ak.get("tagName").toLowerCase()=="a");Ab.set("values",{border:(Ah?Ah+" solid":""),description:Ai.get("alt"),height:Ai.get("height"),imageURL:Ai.get("src"),linkURL:(An?Ak.get("href"):""),width:Ai.get("width"),padding:(Am?parseInt(Am):"")});var Aj=1;switch(Ai.getAttribute("align")){case"left":Aj=0;break;case"center":Aj=2;break;case"right":Aj=3;break;}AU.item(Aj).StateInteraction.set("active",true);AS.get("node").attr("checked",(An&&Ak.getAttribute("target")=="_blank"));AR.set("title",i.STRINGS.EDIT_IMAGE);AV.set("label",i.STRINGS.SAVE);AM=Ai;i.openOverlayToAlignNode(AZ,AJ,AO,Ai);}},"img");});}},insertlink:function(AI,AQ,AW){var AV=this;var A=AQ.button;var AK=A.get("boundingBox");var AU=i.generateOverlay(AK,AW,true);var AS=AU.get("contentBox");var AO=new S.Panel({collapsible:false,title:i.STRINGS.INSERT_LINK,icons:[{icon:B,handler:{fn:AU.hide,context:AU}}]}).render(AS);AS=AO.bodyNode;var AL=AI.frame._iframe;var AJ;var AX;var AN=new S.Form({cssClass:K,labelAlign:"left"}).render(AS);
AN.add([{id:"description",labelText:i.STRINGS.DESCRIPTION},{id:"linkURL",labelText:i.STRINGS.LINK_URL},{id:"openInNewWindow",labelText:i.STRINGS.OPEN_IN_NEW_WINDOW,type:"checkbox"}],true);var AM=AN.get("contentBox");var AT=S.Node.create(s);var AP=AN.getField("openInNewWindow");var AR=new S.ButtonItem({icon:m,label:i.STRINGS.INSERT}).render(AT);AR.on("click",function(Aa){var AY=this;var AZ=AN.get("fieldValues");if(AJ){AJ.setAttribute("href",AZ.linkURL);AJ.set("innerHTML",AZ.description);if(AP.get("node").get("checked")){AJ.setAttribute("target","_blank");}else{AJ.setAttribute("target","");}}else{AI.execCommand("inserthtml",AG.sub(l,[AZ.linkURL,AZ.description,(AP.get("node").get("checked")?' target="_blank"':"")]));}AU.hide();});AM.append(AT);AU.after("hide",function(AY){AN.resetValues();AP.get("node").set("checked",false);AO.set("title",i.STRINGS.CREATE_LINK);AR.set("label",i.STRINGS.INSERT);AH.hide();AU.set("align",{node:AK,points:["tl","bl"]});AJ=null;});var AH=S.Node.create(p);AH.hide();S.getBody().append(AH);AI.on("frame:ready",function(AY){var AZ=AI.getInstance();AZ.one("body").delegate("click",function(Ad){var Aa=this;if(AJ!=Ad.currentTarget){var Ac=Ad.currentTarget;if(!Ac.one("img")){var Ab=Ac.get("parentNode");AN.set("values",{description:Ac.get("innerHTML"),linkURL:Ac.getAttribute("href"),});AP.get("node").attr("checked",(Ac.getAttribute("target")=="_blank"));AO.set("title",i.STRINGS.EDIT_LINK);AR.set("label",i.STRINGS.SAVE);AJ=Ac;i.openOverlayToAlignNode(AU,AH,AL,Ac);}}},"a");});}}};GROUPS[r]={children:[{icon:"insertunorderedlist",title:i.STRINGS.INSERT_UNORDERED_LIST},{icon:"insertorderedlist",title:i.STRINGS.INSERT_ORDERED_LIST}],generate:{init:function(AH){var A=this;AH.plug(S.Plugin.EditorLists);}}};GROUPS[D]={children:[{icon:"format",title:i.STRINGS.REMOVE_FORMAT},{icon:"source",title:i.STRINGS.SOURCE}],generate:{format:function(AK,AI,AH){var A=this;var AL=AK.frame;var AJ=AI.button;AJ.on("click",function(AP){var AM=this;var AQ=AM.getInstance();var AO=new AQ.Selection();var AN=AO.getSelected();if(!AO.isCollapsed&&AN.size()){AN.each(function(AX,AT,AY){var AR=this;AX.removeAttribute("style");var AV=AX.get("innerHTML");AV=AV.replace(/<([a-zA-Z0-9]*)\b[^>]*>/g,"<$1>");for(var AU=0;AU<Z.length;AU++){var AS=new RegExp("(<"+Z[AU]+">|<\\/"+Z[AU]+">)","ig");AV=AV.replace(AS,"");}AX.set("innerHTML",AV);var AW=AX.get("parentNode");if(!AW.test("body")){AW.removeAttribute("style");}});}},AK);},source:function(AK,AN,AI){var AO=this;var AH=AK.frame;var A=AH.get("container");var AL=AN.contentBox;var AJ=AN.button;var AM=S.Node.create(G);AM.hide();A.append(AM);AJ._visible=false;AJ.on("click",function(AS){var AQ=AJ._visible;if(AQ){AK.set("content",AM.val());AM.hide();AM.val("");AH.show();}else{var AR=AH._iframe;AM.val(AK.getContent());var AP=AR.get("offsetHeight")-AM.getPadding("tb");AM.setStyle("height",AP);AH.hide();AM.show();}AQ=!AQ;AJ._visible=AQ;AL.all("select").attr("disabled",AQ);AL.all("button").attr("disabled",AQ);AJ.get("contentBox").attr("disabled",false);});}}};GROUPS[M]={children:[{icon:"styles"}],generate:{styles:function(AL,AJ,AI){var A=this;var AK=AJ.button;var AH=AK.get("boundingBox");AL.plug(S.Plugin.EditorMenu);AL.menu.add(S.merge({align:{node:AH,points:["tl","bl"]},hideOn:"click",showOn:"click",trigger:AH},AI));}}};GROUPS[x]={children:[{icon:"subscript",title:i.STRINGS.SUBSCRIPT},{icon:"superscript",title:i.STRINGS.SUPERSCRIPT}]};GROUPS[w]={children:[{icon:"bold",title:i.STRINGS.BOLD},{icon:"italic",title:i.STRINGS.ITALIC},{icon:"underline",title:i.STRINGS.UNDERLINE},{icon:"strikethrough",title:i.STRINGS.LINE_THROUGH}]};S.namespace("Plugin").EditorToolbar=i;},"@VERSION@",{requires:["aui-base","aui-button-item","aui-color-picker","aui-editor-menu-plugin","aui-editor-tools-plugin","aui-form-select","aui-overlay-context-panel","aui-panel","aui-toolbar","createlink-base","editor-lists","editor-base","plugin"]});