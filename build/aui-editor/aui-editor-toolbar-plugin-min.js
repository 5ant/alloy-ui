AUI.add("aui-editor-toolbar-plugin",function(S){var AH=S.Lang,c=AH.isArray,T=AH.isFunction,AC=S.ClassNameManager.getClassName,h="editortoolbar",AF="toolbar",W="alignment",d="align-left",u="align-inline",V="align-block",AG="align-right",j="color",o="content",P="font",AB="indent",L="input",q="insert",f="insertimage",v="insertlink",r="list",X="select",D="source",M="styles",x="subscript",w="text",m="circle-check",B="close",z={backcolor:true,forecolor:true,format:true,insertimage:true,insertlink:true,source:true,styles:true},Z=["b","big","font","em","i","small","s","strike","strong","sub","sup","u"],Q=AC("button","holder"),R=AC("field",L),Y=AC("field",L,"text"),H=AC("field","label"),g=AC("field","numeric"),N=AC(h,"align","node"),a=AC(h,f),K=AC(h,v),C=AC(h,X,"fontname"),AA=AC(h,X,"fontsize"),F=AC(h,"size","separator"),I=AC(h,D,"textarea"),E=AC("state","active"),J=AC(h),b=AC(h,o),p='<div class="'+N+'"></div>',O="<a></a>",e="<img />",l='<a href="{0}"{2}>{1}</a>',G='<textarea class="'+I+'"></textarea>',AE='<div class="'+J+'"><div class="'+b+'"></div></div>',s='<div class="'+Q+'"></div>',AD='<select class="'+C+'">{0}</select>',U='<option selected="selected"></option>'+"<option>Arial</option>"+"<option>Arial Black</option>"+"<option>Comic Sans MS</option>"+"<option>Courier New</option>"+"<option>Lucida Console</option>"+"<option>Tahoma</option>"+"<option>Times New Roman</option>"+"<option>Trebuchet MS</option>"+"<option>Verdana</option>",t='<select class="'+AA+'">{0}</select>',n='<option selected="selected"></option>'+'<option value="1">10</option>'+'<option value="2">13</option>'+'<option value="3">16</option>'+'<option value="4">18</option>'+'<option value="5">24</option>'+'<option value="6">32</option>'+'<option value="7">48</option>',k='<span class="'+F+'">x</span>';var i=S.Component.create({NAME:h,NS:AF,EXTENDS:S.Plugin.Base,ATTRS:{append:{value:null},groups:{value:[{type:P},{type:w},{type:x},{type:j},{type:W},{type:AB},{type:r},{type:q},{type:D}]}},prototype:{initializer:function(){var AZ=this;var AO=AZ.get("host");var AM=AO.frame.get("container");var AW=AZ.get("append");var Aa=AZ.get("groups");var AK=S.Node.create(AE);var AN=AK.one("."+b);AM.placeBefore(AK);var AQ={boundingBox:AK,contentBox:AN};var AP=[];if(AW!=null&&c(AW)){for(var AU=0;AU<AW.length;AU++){if(AW[AU].index!=null){var AI=AZ._isGroupIncluded("type",Aa,AW[AU].type);if(AI!=-1){Aa.splice(AI,1);}Aa.splice(Math.min(AW[AU].index,Aa.length),0,AW[AU]);}else{Aa.push(AW[AU]);}}}for(var AU=0;AU<Aa.length;AU++){var AJ=Aa[AU];var AR=GROUPS[AJ.type];var A=[];var AV;var AL;if(c(AJ.include)){AV=[];for(var AT=0;AT<AJ.include.length;AT++){var AI=AZ._isGroupIncluded("icon",AR.children,AJ.include[AT]);if(AI!=-1){AV.push(AR.children[AI]);}}}else{AV=AR.children;}for(var AT=0;AT<AV.length;AT++){if(!AV[AT].select){var Ac=YUI.AUI.defaults.EditorToolbar.STRINGS[AV[AT]._titleKey];AV[AT].title=(Ac!=null?Ac:y[AV[AT]._titleKey]);A.push(AV[AT]);}}if(A.length>0){AL=new S.Toolbar(S.merge(AR.config,AJ.toolbar,{children:AV})).render(AN);AL.on("buttonitem:click",function(Af){var Ae=this;var Ad=Af.target.get("icon").split("-");if(!z[Ad[0]]){Ae.execCommand(Ad[0],(Ad[1]?Ad[1]:""));Ae.focus();}},AO);AP.push(AL);}var AS=AR.generate;if(AS&&T(AS.init)){AS.init.call(AZ,AO,AQ);}for(var AT=0;AT<AV.length;AT++){var AY=AV[AT];var AX=AY.icon;if(AS&&T(AS[AX])){var Ab=(AJ.config?AJ.config[AX]:null);AQ.button=(AY.select||!AL?null:AL.item(AT));AS[AX].call(AZ,AO,AQ,Ab);}}}AQ.toolbars=AP;},_isGroupIncluded:function(AI,AK,AL){var A=this;for(var AJ=0;AJ<AK.length;AJ++){if(AK[AJ][AI]==AL){return AJ;}}return -1;},_updateToolbar:function(A,AN){var AO=this;if(A.changedNode){var AJ=A.commands;var AP=AN.toolbars;var AR=function(AT,AS,AV){var AU=!!(AJ[AT.get("icon")]);AT.StateInteraction.set("active",AU);};if(AP){for(var AL=0;AL<AP.length;AL++){AP[AL].each(AR);}}var AI=A.fontFamily;var AM=AN._fontNameOptions;var AQ=A.fontSize;var AK=AN._fontSizeOptions;if(AM){AM.item(0).set("selected",true);AM.each(function(AT,AS,AV){var AU=AT.get("value").toLowerCase();if(AU===AI.toLowerCase()){AT.set("selected",true);}});}if(AK){AQ=AQ.replace("px","");AK.item(0).set("selected",true);AK.each(function(AU,AT,AW){var AV=AU.get("value").toLowerCase();var AS=AU.get("text");if(AS===AQ){AU.set("selected",true);}});}}}}});i.generateOverlay=function(AK,AJ,A){var AI=new S["OverlayContext"+(A?"Panel":"")](S.merge({align:{node:AK,points:["tl","bl"]},hideOn:"click",showOn:"click",trigger:AK},AJ)).render();return AI;};i.generateColorPicker=function(AN,AK,AJ,AO){var AM=AK.button;var AI=AM.get("boundingBox");var A=new S.ColorPicker(S.merge({align:{node:AI,points:["tl","bl"]},trigger:AI},AJ));if(AJ&&AJ.plugins){for(var AL=0;AL<AJ.plugins.length;AL++){A.plug(AJ.plugins[AL],AJ);}}A.render(S.getBody());A.on("colorChange",function(AR){var AP=this;var AQ=A.get("rgb");AN.execCommand(AO,AQ.hex);AN.focus();});};i.openOverlayToAlignNode=function(AJ,AI,AK,A){var AM=AK.getXY();var AL=A.getXY();AM=[AM[0]+AL[0],AM[1]+AL[1]];AI.setStyle("width",A.get("offsetWidth"));AI.setStyle("height",A.get("offsetHeight"));AI.setXY(AM);AI.show();AJ.set("align",{node:AI,points:["tl","bc"]});AJ.show();};var y={ALIGN:"Align",ALIGN_BLOCK:"Block",ALIGN_LEFT:"Left",ALIGN_INLINE:"Inline",ALIGN_RIGHT:"Right",BACKCOLOR:"Background Color",BOLD:"Bold",BORDER:"Border",DESCRIPTION:"Description",EDIT_IMAGE:"Edit Image",EDIT_LINK:"Edit Link",FORECOLOR:"Foreground Color",IMAGE_URL:"Image URL",INDENT:"Indent",INSERT:"Insert",INSERT_IMAGE:"Insert Image",INSERT_LINK:"Insert Link",INSERT_ORDERED_LIST:"Insert Numbered List",INSERT_UNORDERED_LIST:"Insert Bulleted List",ITALIC:"Italic",JUSTIFY_LEFT:"Justify Left",JUSTIFY_CENTER:"Justify Center",JUSTIFY_RIGHT:"Justify Right",LINE_THROUGH:"Line Through",LINK_URL:"Link URL",OPEN_IN_NEW_WINDOW:"Open in new window",OUTDENT:"Outdent",PADDING:"Padding",REMOVE_FORMAT:"Format Source",SAVE:"Save",SIZE:"Size",SOURCE:"Source",SUBSCRIPT:"Subscript",SUPERSCRIPT:"Superscript",STYLES:"Styles",UNDERLINE:"Underline"};S.mix(YUI.AUI.defaults,{EditorToolbar:{STRINGS:y}});
GROUPS={};GROUPS[W]={children:[{icon:"justifyleft",_titleKey:"JUSTIFY_LEFT"},{icon:"justifycenter",_titleKey:"JUSTIFY_CENTER"},{icon:"justifyright",_titleKey:"JUSTIFY_RIGHT"}]};GROUPS[j]={children:[{icon:"forecolor",_titleKey:"FORECOLOR"},{icon:"backcolor",_titleKey:"BACKCOLOR"}],generate:{forecolor:function(AK,AJ,AI){var A=this;i.generateColorPicker(AK,AJ,AI,"forecolor");},backcolor:function(AK,AJ,AI){var A=this;i.generateColorPicker(AK,AJ,AI,"backcolor");}}};GROUPS[P]={children:[{icon:"fontname",select:true},{icon:"fontsize",select:true}],generate:{init:function(AK,AJ){var A=this;var AI=AJ.contentBox;S.delegate("change",function(AN){var AL=this;var AP=AN.currentTarget;var AM=AP.get("className");var AO=AM.substring(AM.lastIndexOf("-")+1);var AQ=AP.get("value");AK.execCommand(AO,AQ);AK.focus();},AI,"select");AK.after("nodeChange",function(AM){var AL=this;switch(AM.changedType){case"keyup":case"mousedown":AL._updateToolbar(AM,AJ);break;}},A);},fontname:function(AN,AM,AL){var A=this;var AI=AM.contentBox;var AK;var AO=[U];if(AL&&AL.optionHtml){AO[0]=AL.optionHtml;}AK=AH.sub(AD,AO);AI.append(AK);var AJ=AI.all("."+C+" option");AM._fontNameOptions=AJ;},fontsize:function(AN,AM,AL){var A=this;var AI=AM.contentBox;var AK;var AO=[n];if(AL&&AL.optionHtml){AO[0]=AL.optionHtml;}AK=AH.sub(t,AO);AI.append(AK);var AJ=AI.all("."+AA+" option");AM._fontSizeOptions=AJ;}}};GROUPS[AB]={children:[{icon:"indent",_titleKey:"INDENT"},{icon:"outdent",_titleKey:"OUTDENT"}]};GROUPS[q]={children:[{icon:"insertimage",_titleKey:"INSERT_IMAGE"},{icon:"insertlink",_titleKey:"INSERT_LINK"}],generate:{insertimage:function(AL,AU,Ad){var Ab=this;var A=AU.button;var AO=A.get("boundingBox");var Aa=i.generateOverlay(AO,Ad,true);var AX=Aa.get("contentBox");var AS=new S.Panel({collapsible:false,title:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT_IMAGE,icons:[{icon:B,handler:{fn:Aa.hide,context:Aa}}]}).render(AX);AX=AS.bodyNode;if(Ad&&Ad.dataBrowser){Ad.dataBrowser.render(AX);}else{var AP=AL.frame._iframe;var AN;var Ae;var Ac=new S.Form({cssClass:a,labelAlign:"left"}).render(AX);var AR=[{labelText:"none",value:"none"}];for(var AY=1;AY<6;AY++){AR.push({labelText:AY+"px",value:AY+"px solid"});}Ac.add([{id:"imageURL",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.IMAGE_URL},{id:"size",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.SIZE,type:"hidden"},{id:"width",labelText:false,cssClass:g},{id:"height",labelText:false,cssClass:g},{id:"padding",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.PADDING},new S.Select({id:"border",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.BORDER,options:AR}),{id:"align",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN,type:"hidden"},{id:"description",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.DESCRIPTION},{id:"linkURL",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.LINK_URL},{id:"openInNewWindow",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.OPEN_IN_NEW_WINDOW,type:"checkbox"}],true);Ac.getField("width").get("boundingBox").placeAfter(k);var AM=Ac.get("contentBox");var AZ=S.Node.create(s);var AT=Ac.getField("openInNewWindow");var AW=new S.ButtonItem({icon:m,label:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT}).render(AZ);AW.on("click",function(Ag){var Aq=this;var Ah;var Ak;var Ao;if(AN){Ak=AN;Ao=AN.get("parentNode");if(Ao.get("tagName").toLowerCase()=="a"){Ah=Ao;}}else{Ak=S.Node.create(e);}var Aj=Ac.get("fieldValues");var Ap=Aj.description;var Al={src:Aj.imageURL,title:Ap,alt:Ap};var An={border:Aj.border};var Ar=parseInt(Aj.height,10);var Ai=parseInt(Aj.width,10);if(!isNaN(Ar)){Al.height=Ar;}if(!isNaN(Ai)){Al.width=Ai;}var Am=parseInt(Aj.padding,10);if(!isNaN(Am)){An.padding=Am;}AV.some(function(Au,At,Aw){var As=this;var Av=Au.StateInteraction.get("active");if(Av){An.display="";switch(At){case 0:Al.align="left";break;case 1:Al.align="";break;case 2:Al.align="center";An.display="block";break;case 3:Al.align="right";break;}return true;}});Ak.setAttrs(Al);Ak.setStyles(An);var Af=Aj.linkURL;if(Af){if(!Ah){Ah=S.Node.create(O);if(AN){Ao.insert(Ah,AN);}Ah.append(Ak);}Ah.setAttribute("href",Af);Ah.setAttribute("target",(AT.get("node").get("checked")?"_blank":""));Ak=Ah;}else{if(AN&&Ah){Ao.insert(AN,Ah);Ah.remove(true);}}if(!AN&&Ae&&Ae.anchorNode){Ae.anchorNode.append(Ak);}Aa.hide();});var AQ=S.Node.create(e);var AI=Ac.getField("height");var AJ=Ac.getField("width");AQ.on("load",function(Ag){var Af=Ag.currentTarget;if(!AI.get("value")||!AJ.get("value")){Ac.set("values",{height:Af.get("height"),width:Af.get("width")});}});Ac.getField("imageURL").get("node").on("blur",function(Af){AQ.set("src",this.val());});AM.append(AZ);var AV=new S.Toolbar({activeState:true,children:[{icon:d,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_LEFT},{icon:u,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_INLINE},{icon:V,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_BLOCK},{icon:AG,title:YUI.AUI.defaults.EditorToolbar.STRINGS.ALIGN_RIGHT}]});AV.after("buttonitem:click",function(Ag){var Af=Ag.target;AV.each(function(Ai,Ah,Aj){if(Ai!=Af){Ai.StateInteraction.set("active",false);}});});AV.render(Ac.getField("align").get("contentBox"));Aa.on("show",function(Af){if(!Ae||!Ae.anchorNode){var Ag=AL.getInstance();AL.focus();Ae=new Ag.Selection();}});Aa.after("hide",function(Af){Ac.resetValues();AV.each(function(Ah,Ag,Ai){Ah.StateInteraction.set("active",false);});AT.get("node").set("checked",false);AS.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT_IMAGE);AW.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT);AK.hide();Aa.set("align",{node:AO,points:["tl","bl"]});AN=null;});AP.on("mouseout",function(Af){var Ag=AL.getInstance();Ae=new Ag.Selection();});var AK=S.Node.create(p);AK.hide();S.getBody().append(AK);AL.on("frame:ready",function(Af){var Ag=AL.getInstance();Ag.one("body").delegate("click",function(Am){var Ah=this;if(AN!=Am.currentTarget){var Aj=Am.currentTarget;var Al=Aj.get("parentNode");var Ai=Aj.getStyle("borderWidth");var An=Aj.getStyle("padding");var Ao=(Al.get("tagName").toLowerCase()=="a");
Ac.set("values",{border:(Ai?Ai+" solid":""),description:Aj.get("alt"),height:Aj.get("height"),imageURL:Aj.get("src"),linkURL:(Ao?Al.get("href"):""),width:Aj.get("width"),padding:(An?parseInt(An):"")});var Ak=1;switch(Aj.getAttribute("align")){case"left":Ak=0;break;case"center":Ak=2;break;case"right":Ak=3;break;}AV.item(Ak).StateInteraction.set("active",true);AT.get("node").attr("checked",(Ao&&Al.getAttribute("target")=="_blank"));AS.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.EDIT_IMAGE);AW.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.SAVE);AN=Aj;i.openOverlayToAlignNode(Aa,AK,AP,Aj);}},"img");});}},insertlink:function(AJ,AR,AX){var AW=this;var A=AR.button;var AL=A.get("boundingBox");var AV=i.generateOverlay(AL,AX,true);var AT=AV.get("contentBox");var AP=new S.Panel({collapsible:false,title:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT_LINK,icons:[{icon:B,handler:{fn:AV.hide,context:AV}}]}).render(AT);AT=AP.bodyNode;var AM=AJ.frame._iframe;var AK;var AY;var AO=new S.Form({cssClass:K,labelAlign:"left"}).render(AT);AO.add([{id:"description",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.DESCRIPTION},{id:"linkURL",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.LINK_URL},{id:"openInNewWindow",labelText:YUI.AUI.defaults.EditorToolbar.STRINGS.OPEN_IN_NEW_WINDOW,type:"checkbox"}],true);var AN=AO.get("contentBox");var AU=S.Node.create(s);var AQ=AO.getField("openInNewWindow");var AS=new S.ButtonItem({icon:m,label:YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT}).render(AU);AS.on("click",function(Ab){var AZ=this;var Aa=AO.get("fieldValues");if(AK){AK.setAttribute("href",Aa.linkURL);AK.set("innerHTML",Aa.description);if(AQ.get("node").get("checked")){AK.setAttribute("target","_blank");}else{AK.setAttribute("target","");}}else{AJ.execCommand("inserthtml",AH.sub(l,[Aa.linkURL,Aa.description,(AQ.get("node").get("checked")?' target="_blank"':"")]));}AV.hide();});AN.append(AU);AV.after("hide",function(AZ){AO.resetValues();AQ.get("node").set("checked",false);AP.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.CREATE_LINK);AS.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.INSERT);AI.hide();AV.set("align",{node:AL,points:["tl","bl"]});AK=null;});var AI=S.Node.create(p);AI.hide();S.getBody().append(AI);AJ.on("frame:ready",function(AZ){var Aa=AJ.getInstance();Aa.one("body").delegate("click",function(Ae){var Ab=this;if(AK!=Ae.currentTarget){var Ad=Ae.currentTarget;if(!Ad.one("img")){var Ac=Ad.get("parentNode");AO.set("values",{description:Ad.get("innerHTML"),linkURL:Ad.getAttribute("href"),});AQ.get("node").attr("checked",(Ad.getAttribute("target")=="_blank"));AP.set("title",YUI.AUI.defaults.EditorToolbar.STRINGS.EDIT_LINK);AS.set("label",YUI.AUI.defaults.EditorToolbar.STRINGS.SAVE);AK=Ad;i.openOverlayToAlignNode(AV,AI,AM,Ad);}}},"a");});}}};GROUPS[r]={children:[{icon:"insertunorderedlist",_titleKey:"INSERT_UNORDERED_LIST"},{icon:"insertorderedlist",_titleKey:"INSERT_ORDERED_LIST"}],generate:{init:function(AI){var A=this;AI.plug(S.Plugin.EditorLists);}}};GROUPS[D]={children:[{icon:"format",_titleKey:"REMOVE_FORMAT"},{icon:"source",_titleKey:"SOURCE"}],generate:{format:function(AL,AJ,AI){var A=this;var AM=AL.frame;var AK=AJ.button;AK.on("click",function(AQ){var AN=this;var AR=AN.getInstance();var AP=new AR.Selection();var AO=AP.getSelected();if(!AP.isCollapsed&&AO.size()){AO.each(function(AY,AU,AZ){var AS=this;AY.removeAttribute("style");var AW=AY.get("innerHTML");AW=AW.replace(/<([a-zA-Z0-9]*)\b[^>]*>/g,"<$1>");for(var AV=0;AV<Z.length;AV++){var AT=new RegExp("(<"+Z[AV]+">|<\\/"+Z[AV]+">)","ig");AW=AW.replace(AT,"");}AY.set("innerHTML",AW);var AX=AY.get("parentNode");if(!AX.test("body")){AX.removeAttribute("style");}});}},AL);},source:function(AL,AO,AJ){var AP=this;var AI=AL.frame;var A=AI.get("container");var AM=AO.contentBox;var AK=AO.button;var AN=S.Node.create(G);AN.hide();A.append(AN);AK._visible=false;AK.on("click",function(AT){var AR=AK._visible;if(AR){AL.set("content",AN.val());AN.hide();AN.val("");AI.show();}else{var AS=AI._iframe;AN.val(AL.getContent());var AQ=AS.get("offsetHeight")-AN.getPadding("tb");AN.setStyle("height",AQ);AI.hide();AN.show();}AR=!AR;AK._visible=AR;AM.all("select").attr("disabled",AR);AM.all("button").attr("disabled",AR);AK.get("contentBox").attr("disabled",false);});}}};GROUPS[M]={children:[{icon:"styles",_titleKey:"STYLES"}],generate:{styles:function(AM,AK,AJ){var A=this;var AL=AK.button;var AI=AL.get("boundingBox");AM.plug(S.Plugin.EditorMenu);AM.menu.add(S.merge({align:{node:AI,points:["tl","bl"]},hideOn:"click",showOn:"click",trigger:AI},AJ));}}};GROUPS[x]={children:[{icon:"subscript",_titleKey:"SUBSCRIPT"},{icon:"superscript",_titleKey:"SUPERSCRIPT"}]};GROUPS[w]={children:[{icon:"bold",_titleKey:"BOLD"},{icon:"italic",_titleKey:"ITALIC"},{icon:"underline",_titleKey:"UNDERLINE"},{icon:"strikethrough",_titleKey:"LINE_THROUGH"}]};S.namespace("Plugin").EditorToolbar=i;},"@VERSION@",{requires:["aui-base","aui-button-item","aui-color-picker","aui-editor-menu-plugin","aui-editor-tools-plugin","aui-form-select","aui-overlay-context-panel","aui-panel","aui-toolbar","createlink-base","editor-lists","editor-base","plugin"]});