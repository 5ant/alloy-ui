/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 3.2.0PR1
build: nightly
*/
YUI.add("cache-offline",function(F){function E(){E.superclass.constructor.apply(this,arguments);}var A=F.config.win.localStorage,C=F.Lang.isDate,D=F.JSON,G={NAME:"cacheOffline",ATTRS:{sandbox:{value:"default",writeOnce:"initOnly"},expires:{value:86400000,validator:function(H){return F.Lang.isDate(H)||(F.Lang.isNumber(H)&&H>=0);}},max:{value:null,readOnly:true},uniqueKeys:{value:true,readOnly:true,setter:function(){return true;}}},flushAll:function(){var H=A,I;if(H){if(H.clear){H.clear();}else{for(I in H){if(H.hasOwnProperty(I)){H.removeItem(I);delete H[I];}}}}else{}}},B=A?{_setMax:function(H){return null;},_getSize:function(){var J=0,I=0,H=A.length;for(;I<H;++I){if(A.key(I).indexOf(this.get("sandbox"))===0){J++;}}return J;},_getEntries:function(){var H=[],K=0,J=A.length,I=this.get("sandbox");for(;K<J;++K){if(A.key(K).indexOf(I)===0){H[K]=D.parse(A.key(K).substring(I.length));}}return H;},_defAddFn:function(L){var K=L.entry,J=K.request,H=this.get("expires");K.expires=C(H)?H:(H?new Date(new Date().getTime()+this.get("expires")):null);try{A.setItem(this.get("sandbox")+D.stringify({"request":J}),D.stringify(K));}catch(I){this.fire("error",{error:I});}},_defFlushFn:function(J){var I,H=A.length-1;for(;H>-1;--H){I=A.key(H);if(I.indexOf(this.get("sandbox"))===0){A.removeItem(I);}}},retrieve:function(K){this.fire("request",{request:K});var J,H,I;try{K=this.get("sandbox")+D.stringify({"request":K});try{J=D.parse(A.getItem(K));}catch(M){}}catch(L){}if(J){J.cached=new Date(J.cached);H=J.expires;H=!H?null:new Date(H);if(!H||new Date()<H){J.expires=H;this.fire("retrieve",{entry:J});return J;}}return null;}}:{_setMax:function(H){return null;},_defAddFn:function(I){var H=this.get("expires");I.entry.expires=C(H)?H:(H?new Date(new Date().getTime()+this.get("expires")):null);E.superclass._defAddFn.call(this,I);},_isMatch:function(I,H){if(!H.expires||new Date()<H.expires){return(I===H.request);}return false;}};F.mix(E,G);F.extend(E,F.Cache,B);F.CacheOffline=E;},"3.2.0PR1",{requires:["cache-base","json"]});