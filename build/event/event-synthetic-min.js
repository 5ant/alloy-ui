/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 3.2.0
build: nightly
*/
YUI.add("event-synthetic",function(A){var I=A.Env.evt.dom_map,B=A.Array,G=A.Lang,H=G.isObject,D=G.isString,E=A.Selector.query,J=function(){};function F(K,L){this.handle=K;this.emitFacade=L;}F.prototype.fire=function(Q){var L=B(arguments,0,true),K=this.handle,P=K.evt,N=K.sub,R=N.context,M=N.filter,O=Q||{};if(this.emitFacade){if(!Q||!Q.preventDefault){O=P._getFacade();if(H(Q)&&!Q.preventDefault){A.mix(O,Q,true);L[0]=O;}else{L.unshift(O);}}O.type=P.type;O.details=L.slice();if(M){O.container=P.host;}}else{if(M&&H(Q)&&Q.currentTarget){L.shift();}}N.context=R||O.currentTarget||P.host;P.fire.apply(P,L);N.context=R;};function C(){this._init.apply(this,arguments);}A.mix(C,{Notifier:F,getRegistry:function(Q,P,L){var O=Q._node,N=A.stamp(O),M="event:"+N+P+"_synth",K=I[N]||(I[N]={});if(!K[M]&&L){K[M]={type:"_synth",fn:J,capture:false,el:O,key:M,domkey:N,notifiers:[],detachAll:function(){var R=this.notifiers,S=R.length;while(--S>=0){R[S].detach();}}};}return(K[M])?K[M].notifiers:null;},_deleteSub:function(L){if(L&&L.fn){var K=this.eventDef,M=(L.filter)?"detachDelegate":"detach";this.subscribers={};this.subCount=0;K[M](L.node,L,this.notifier,L.filter);K._unregisterSub(L);delete L.fn;delete L.node;delete L.context;}},prototype:{constructor:C,_init:function(){var K=this.publishConfig||(this.publishConfig={});this.emitFacade=("emitFacade" in K)?K.emitFacade:true;K.emitFacade=false;},processArgs:J,on:J,detach:J,delegate:J,detachDelegate:J,_on:function(N,P){var O=[],L=N[2],Q=P?"delegate":"on",M,K;M=(D(L))?E(L):B(L);if(!M.length&&D(L)){K=A.on("available",function(){A.mix(K,A[Q].apply(A,N),true);},L);return K;}A.each(M,function(U){var S=N.slice(),R,T;U=A.one(U);if(U){R=this.processArgs(S,P);if(P){T=S.splice(3,1)[0];}S.splice(0,4,S[1],S[3]);if(!this.preventDups||!this.getSubs(U,N,null,true)){K=this._getNotifier(U,S,R,T);this[Q](U,K.sub,K.notifier,T);O.push(K);}}},this);return(O.length===1)?O[0]:new A.EventHandle(O);},_getNotifier:function(N,P,M,O){var R=new A.CustomEvent(this.type,this.publishConfig),L=R.on.apply(R,P),S=new F(L,this.emitFacade),Q=C.getRegistry(N,this.type,true),K=L.sub;L.notifier=S;K.node=N;K.filter=O;K._extra=M;A.mix(R,{eventDef:this,notifier:S,host:N,currentTarget:N,target:N,el:N._node,_delete:C._deleteSub},true);Q.push(L);return L;},_unregisterSub:function(M){var K=C.getRegistry(M.node,this.type),L;if(K){for(L=K.length-1;L>=0;--L){if(K[L].sub===M){K.splice(L,1);break;}}}},_detach:function(M){var R=M[2],P=(D(R))?E(R):B(R),Q,O,K,N,L;M.splice(2,1);for(O=0,K=P.length;O<K;++O){Q=A.one(P[O]);if(Q){N=this.getSubs(Q,M);if(N){for(L=N.length-1;L>=0;--L){N[L].detach();}}}}},getSubs:function(L,Q,P,N){var R=C.getRegistry(L,this.type),S=[],M,O,K;if(R){if(!P){P=this.subMatch;}for(M=0,O=R.length;M<O;++M){K=R[M];if(P.call(this,K.sub,Q)){if(N){return K;}else{S.push(R[M]);}}}}return S.length&&S;},subMatch:function(L,K){return !K[1]||L.fn===K[1];}}},true);A.SyntheticEvent=C;A.Event.define=function(M,L,O){if(!L){L={};}var N=(H(M))?M:A.merge({type:M},L),P,K;if(O||!A.Node.DOM_EVENTS[N.type]){P=function(){C.apply(this,arguments);};A.extend(P,C,N);K=new P();M=K.type;A.Node.DOM_EVENTS[M]=A.Env.evt.plugins[M]={eventDef:K,on:function(){return K._on(B(arguments));},delegate:function(){return K._on(B(arguments),true);},detach:function(){return K._detach(B(arguments));}};}return K;};},"3.2.0",{requires:["node-base","event-custom"]});