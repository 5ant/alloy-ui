/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 3.2.0
build: nightly
*/
YUI.add("event-delegate",function(F){var C=F.Array,A=F.Lang,E=A.isString,G=F.Selector.test,B=F.Env.evt.handles;function D(P,S,J,M){var O=C(arguments,0,true),Q=E(J)?J:null,H=P.split(/\|/),L,N,K,R,I;if(H.length>1){R=H.shift();P=H.shift();}L=F.Node.DOM_EVENTS[P];if(A.isObject(L)&&L.delegate){I=L.delegate.apply(L,arguments);}if(!I){if(!P||!S||!J||!M){return;}N=(Q)?F.Selector.query(Q,null,true):J;if(!N&&E(J)){I=F.on("available",function(){F.mix(I,F.delegate.apply(F,O),true);},J);}if(!I&&N){O.splice(2,2,N);I=F.Event._attach(O,{facade:false});I.sub.filter=M;I.sub._notify=D.notifySub;}}if(I&&R){K=B[R]||(B[R]={});K=K[P]||(K[P]=[]);K.push(I);}return I;}D.notifySub=function(N,J,M){J=J.slice();if(this.args){J.push.apply(J,this.args);}var O=D._applyFilter(this.filter,J,M),L,K,H,I;if(O){O=C(O);L=J[0]=new F.DOMEventFacade(J[0],M.el,M);L.container=F.one(M.el);for(K=0,H=O.length;K<H&&!L.stopped;++K){L.currentTarget=F.one(O[K]);I=this.fn.apply(this.context||L.currentTarget,J);if(I===false){break;}}return I;}};D.compileFilter=F.cached(function(H){return function(J,I){return G(J._node,H,I.currentTarget._node);};});D._applyFilter=function(H,J,M){var L=J[0],K=M.el,N=L.target||L.srcElement,I=[];if(N.nodeType===3){N=N.parentNode;}J.unshift(N);if(E(H)){while(N&&N!==K){if(G(N,H,K)){I.push(N);}N=N.parentNode;}}else{J[0]=F.one(N);J[1]=new F.DOMEventFacade(L,K,M);while(N&&N!==K){if(H.apply(J[0],J)){I.push(N);}N=N.parentNode;J[0]=F.one(N);}J[1]=L;}if(I.length<=1){I=I[0];}J.shift();return I;};F.delegate=F.Event.delegate=D;},"3.2.0",{requires:["node-base"]});