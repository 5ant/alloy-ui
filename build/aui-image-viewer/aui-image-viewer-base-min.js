AUI.add("aui-image-viewer-base",function(aq){var aj=aq.Lang,aH=aj.isBoolean,Q=aj.isNumber,D=aj.isObject,aM=aj.isString,at=aq.Plugin.NodeFX,aV="anim",e="arrow",M="arrowLeftEl",i="arrowRightEl",aT="auto",aP="bd",S="blank",az="body",p="boundingBox",aE="caption",x="captionEl",aC="captionFromTitle",d="centered",f="close",ar="closeEl",H="createDocumentFragment",aD="currentIndex",aN="easeBothStrong",aK="footer",n="helper",ag="hidden",t="hide",aA="href",af="icon",E="image",w="imageAnim",aJ="image-viewer",aw="info",P="infoEl",ak="infoTemplate",b="left",ao="link",W="links",aI="loader",aS="loading",K="loadingEl",v="lock",o="maxHeight",aO="maxWidth",U="modal",I="offsetHeight",aL="offsetWidth",X="opacity",l="overlay",av="preloadAllImages",ai="preloadNeighborImages",aa="px",j="region",k="right",u="scroll",an="show",C="showArrows",aF="showClose",q=" ",ay="src",aB="title",m="top",O="totalLinks",V="viewportRegion",ac="visible",ap="ownerDocument",aR=function(A){return(A instanceof aq.NodeList);},aQ=function(){return Array.prototype.slice.call(arguments).join(q);},a="ESC",k="RIGHT",b="LEFT",z=aq.getClassName,Y=z(n,u,v),R=z(af,aS),y=z(aJ,e),am=z(aJ,e,b),aG=z(aJ,e,k),F=z(aJ,aP),ab=z(aJ,aE),B=z(aJ,f),ah=z(aJ,E),c=z(aJ,aw),aU=z(aJ,ao),ax=z(aJ,aS),r=z(l,ag),ae={height:aT,width:aT},g=document.createTextNode(""),T="Image {current} of {total}",al='<a href="#" class="'+aQ(y,am)+'"></a>',au='<a href="#" class="'+aQ(y,aG)+'"></a>',s='<div class="'+ab+'"></div>',h='<a href="#" class="'+B+'"></a>',G='<img class="'+ah+'" />',Z='<div class="'+c+'"></div>',N='<div class="'+r+'"></div>',J='<div class="'+R+'"></div>';var ad=aq.Component.create({NAME:aJ,ATTRS:{anim:{value:true,validator:aH},bodyContent:{value:g},caption:{value:S,validator:aM},captionFromTitle:{value:true,validator:aH},centered:{value:true},currentIndex:{value:0,validator:Q},image:{readOnly:true,valueFn:function(){return aq.Node.create(G);}},imageAnim:{value:{},setter:function(A){return aq.merge({to:{opacity:1},easing:aN,duration:0.8},A);},validator:D},infoTemplate:{getter:function(A){return this._getInfoTemplate(A);},value:T,validator:aM},links:{setter:function(L){var A=this;if(aR(L)){return L;}else{if(aM(L)){return aq.all(L);}}return new aq.NodeList([L]);}},loading:{value:false,validator:aH},modal:{value:{opacity:0.8,background:"#000"}},preloadAllImages:{value:false,validator:aH},preloadNeighborImages:{value:true,validator:aH},showClose:{value:true,validator:aH},showArrows:{value:true,validator:aH},totalLinks:{readOnly:true,getter:function(A){return this.get(W).size();}},visible:{value:false},zIndex:{value:3000,validator:Q},arrowLeftEl:{readOnly:true,valueFn:function(){return aq.Node.create(al);}},arrowRightEl:{readOnly:true,valueFn:function(){return aq.Node.create(au);}},captionEl:{readOnly:true,valueFn:function(){return aq.Node.create(s);}},closeEl:{readOnly:true,valueFn:function(){return aq.Node.create(h);}},infoEl:{readOnly:true,valueFn:function(){return aq.Node.create(Z);}},loader:{readOnly:true,valueFn:function(){return aq.Node.create(N).appendTo(document.body);}},loadingEl:{valueFn:function(){return aq.Node.create(J);}},maxHeight:{value:Infinity,validator:Q},maxWidth:{value:Infinity,validator:Q}},EXTENDS:aq.OverlayBase,prototype:{_keyHandler:null,renderUI:function(){var A=this;A._renderControls();A._renderFooter();A.get(W).addClass(aU);},bindUI:function(){var A=this;var L=A.get(W);var aX=A.get(M);var aW=A.get(i);var aY=A.get(ar);aX.on("click",aq.bind(A._onClickLeftArrow,A));aW.on("click",aq.bind(A._onClickRightArrow,A));aY.on("click",aq.bind(A._onClickCloseEl,A));L.on("click",aq.bind(A._onClickLinks,A));A._keyHandler=aq.bind(A._onKeyInteraction,A);aq.getDoc().on("keydown",A._keyHandler);A.after("render",A._afterRender);A.after("loadingChange",A._afterLoadingChange);A.after("visibleChange",A._afterVisibleChange);},destructor:function(){var A=this;var L=A.get(W);A.close();L.detach("click");L.removeClass(aU);aq.getDoc().detach("keydown",A._keyHandler);A.get(M).remove(true);A.get(i).remove(true);A.get(ar).remove(true);A.get(aI).remove(true);},close:function(){var A=this;A.hide();A.hideMask();},getLink:function(L){var A=this;return A.get(W).item(L);},getCurrentLink:function(){var A=this;return A.getLink(A.get(aD));},loadImage:function(A){var a3=this;var aX=a3.bodyNode;var a2=a3.get(aI);a3.set(aS,true);var L=a3._activeImagePool;if(!L){L=[];var a1=a3.get(E);var a0=a1.clone();var aZ=a1.clone();var aY=aq.bind(a3._onLoadImage,a3);a0.on("load",aY);aZ.on("load",aY);L.push(a0,aZ);a3._activeImagePool=L;}var aW=L[0];aW.removeAttribute("height");aW.removeAttribute("width");aW.setStyles(ae);a2.append(aW);L.push(L.shift(aW));if(aq.UA.webkit){aW.attr(ay,"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==");}aW.attr(ay,A);a3.fire("request",{image:aW});},hasLink:function(L){var A=this;return A.getLink(L);},hasNext:function(){var A=this;return A.hasLink(A.get(aD)+1);},hasPrev:function(){var A=this;return A.hasLink(A.get(aD)-1);},hideControls:function(){var A=this;A.get(M).hide();A.get(i).hide();A.get(ar).hide();},hideMask:function(){aq.ImageViewerMask.hide();},next:function(){var A=this;if(A.hasNext()){A.set(aD,A.get(aD)+1);A.show();}},preloadAllImages:function(){var A=this;A.get(W).each(function(aW,L){A.preloadImage(L);});},preloadImage:function(L){var A=this;var aW=A.getLink(L);if(aW){var aX=aW.attr(aA);A._createPreloadImage(aX);}},prev:function(){var A=this;if(A.hasPrev()){A.set(aD,A.get(aD)-1);A.show();}},showLoading:function(){var A=this;var L=A.get(K);A.setStdModContent(az,L);L.center(A.bodyNode);},showMask:function(){var A=this;var L=A.get(U);if(D(L)){aq.each(L,function(aX,aW){aq.ImageViewerMask.set(aW,aX);});}if(L){aq.ImageViewerMask.show();}},show:function(){var A=this;var L=A.getCurrentLink();if(L){A.showMask();ad.superclass.show.apply(this,arguments);A.loadImage(L.attr(aA));}},_clearPreloadImageFn:function(){var A=this;var aW=A._preloadImagePool;var aX;for(var L in aW){aX=aW[L];if(aX&&aX.complete){aW[L]=null;}}},_createPreloadImage:function(aX){var A=this;
var L=A._preloadImagePool;if(!L){L=A._preloadImagePool={};A._clearPreloadImageTask=aq.debounce(A._clearPreloadImageFn,50,A);}if(!(aX in L)){var aW=new Image();aW.onload=A._clearPreloadImageTask;aW.src=aX;L[aX]=aW;}},_renderControls:function(){var L=this;var A=aq.one(az);A.append(L.get(M).hide());A.append(L.get(i).hide());A.append(L.get(ar).hide());},_renderFooter:function(){var A=this;var L=A.get(p);var aW=L.get(ap).invoke(H);aW.append(A.get(x));aW.append(A.get(P));A.setStdModContent(aK,aW);},_syncCaptionUI:function(){var A=this;var aW=A.get(aE);var aY=A.get(x);var L=A.get(aC);if(L){var aX=A.getCurrentLink();if(aX){var aZ=aX.attr(aB);if(aZ){aW=aX.attr(aB);}}}aY.html(aW);},_syncControlsUI:function(){var A=this;var aW=A.get(p);var aX=A.get(M);var L=A.get(i);var a0=A.get(ar);if(A.get(ac)){if(A.get(C)){var aZ=aW.get(V);var aY=Math.floor(aZ.height/2)+aZ.top;aX[A.hasPrev()?an:t]();L[A.hasNext()?an:t]();aX.setStyle(m,aY-aX.get(I)+aa);L.setStyle(m,aY-L.get(I)+aa);}if(A.get(aF)){a0.show();}}else{A.hideControls();}},_syncImageViewerUI:function(){var A=this;A._syncControlsUI();A._syncCaptionUI();A._syncInfoUI();},_syncInfoUI:function(){var A=this;var L=A.get(P);L.html(A.get(ak));},_getRatio:function(aY,L){var A=this;var aX=1;var a0=A.get(o);var aZ=A.get(aO);if((L>a0)||(aY>aZ)){var a1=(L/a0);var aW=(aY/aZ);aX=Math.max(a1,aW);}return aX;},_getInfoTemplate:function(L){var A=this;var aW=A.get(O);var aX=A.get(aD)+1;return aq.substitute(L,{current:aX,total:aW});},_afterRender:function(){var A=this;var L=A.bodyNode;L.addClass(F);if(A.get(av)){A.preloadAllImages();}},_afterLoadingChange:function(aW){var A=this;var L=A.get(p);if(aW.newVal){L.addClass(ax);A.showLoading();}else{L.removeClass(ax);}},_afterVisibleChange:function(L){var A=this;A._syncControlsUI();},_onClickCloseEl:function(L){var A=this;A.close();L.halt();},_onClickLeftArrow:function(L){var A=this;A.prev();L.halt();},_onClickRightArrow:function(L){var A=this;A.next();L.halt();},_onClickLinks:function(L){var A=this;var aW=L.currentTarget;A.set(aD,A.get(W).indexOf(aW));A.show();L.preventDefault();},_onKeyInteraction:function(L){var A=this;if(!A.get(ac)){return false;}if(L.isKey(b)){A.prev();}else{if(L.isKey(k)){A.next();}else{if(L.isKey(a)){A.close();}}}},_onLoadImage:function(aW){var A=this;var aX=aW.currentTarget;var aY=A.get(w);if(A.get(aV)){aX.setStyle(X,0);aX.unplug(at).plug(at);aX.fx.on("end",function(aZ){A.fire("anim",{anim:aZ,image:aX});});aX.fx.setAttrs(aY);aX.fx.stop().run();}A.setStdModContent(az,aX);A._uiSetImageSize(aX);A._syncImageViewerUI();A._setAlignCenter(true);A.set(aS,false);A.fire("load",{image:aX});if(A.get(ai)){var L=A.get(aD);A.preloadImage(L+1);A.preloadImage(L-1);}},_uiSetImageSize:function(a0){var L=this;var aY=L.bodyNode;var aZ=a0.get(j);var aX=L._getRatio(aZ.width,aZ.height);var A=(aZ.height/aX);var aW=(aZ.width/aX);a0.set(I,A);a0.set(aL,aW);aY.setStyles({height:A+aa,width:aW+aa});}}});aq.ImageViewer=ad;aq.ImageViewerMask=new aq.OverlayMask().render();},"@VERSION@",{requires:["anim","aui-overlay-mask","substitute"],skinnable:true});