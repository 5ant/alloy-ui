AUI.add("aui-form-builder-base",function(aW){var aM=aW.Lang,i=aM.isArray,O=aM.isString,bc=aM.isObject,aX=aM.isValue,aP=function(A){return(A instanceof aW.Node);},bv=function(A){return(A instanceof aW.NodeList);},M=function(A){return(A instanceof aW.FormBuilder);},R=function(A){return(A instanceof aW.FormBuilderField);},aq=aW.DD.DDM,F="active",bp="acceptChildren",av="availableFields",m="append",G="boundingBox",bs="builder",aY="button",W="buttons",a4="buttonsNode",o="children",al="clonable-portal-layout",t="cloneNode",aS="content",N="contentBox",u="container",aw="delete",aO="dd",at="default",aN=".",bw="duplicate",X="drag",aT="dragging",ag="dragContainer",U="dragContainerNode",bz="dragNodesList",V="dragPortalLayout",bu="drop",aA="dropContainer",B="dropContainerNode",aL="dropPortalLayout",ak="dropNode",ah="dropZoneNode",am="edit",I="",bj="field",J="fields",T="first",aR="firstChild",S="focused",aQ="form",ar="formBuilder",bC="form-layout",bb="id",aH="icon",aB="input",ae="items",a1="label",bh="labelNode",l="last",aK="lastChild",a9="list",aD="nestedList",D="node",a3="over",k="parent",q="parentNode",aj="placeholder",a5="placeAfter",f="placeBefore",ao="prepend",z="helper",aJ="hidden",s="render",bd="save",bn="selected",bt="settings",au="settingsFormNode",Q="settingsButtonsNode",ba="srcNode",H=" ",ax="state",a8="strings",e="tabs",y="tabsNode",bm="tabsContentNode",d="tabsListNode",p="tabview",c="target",E="templateNode",n="type",bq="value",Y="values",bi="zone",g="region",aV="stringEmptySelection",aa=aW.ClassNameManager.getClassName,a7=aa(aY,aB),ai=aa(aO,aT),r=aa(z,aJ),b=aa(aQ,bs,aY,aw),a=aa(aQ,bs,aY,bw),az=aa(aQ,bs,aY,am),br=aa(aQ,bs,aY,bd),ab=aa(aQ,bs,X,u),a6=aa(aQ,bs,X,D),w=aa(aQ,bs,bu,F),a2=aa(aQ,bs,bu,u),bl=aa(aQ,bs,bu,D),K=aa(aQ,bs,bu,bi),aC=aa(aQ,bs,bj),ad=aa(aQ,bs,bj,W),ay=aa(aQ,bs,bj,aS),ap=aa(aQ,bs,bj,a3),aZ=aa(aQ,bs,bj,bn),h=aa(aQ,bs,z),aE=aa(aQ,bs,aH),an=aa(aQ,bs,a1),bo=aa(aQ,bs,aj),be=aa(aQ,bs,bt),ac=aa(aQ,bs,bt,W),bg=aa(aQ,bs,e,u),C=aa(p,aS),x=aa(p,a9),bA=aa(aH),v='<ul class="'+ab+'"></ul>',by='<li class="'+[a6,aC].join(H)+'" data-type="{type}">'+'<span class="'+[aE,bA].join(H)+' {icon}"></span>'+'<span class="'+an+'">{label}</span>'+"</li>",Z='<ul class="'+[a2].join(H)+'"></ul>',aG='<div class="'+h+'"></div>',a0='<li class="'+bo+'"></li>',bk='<div class="'+bg+'"></div>',bf='<div class="'+C+'"></div>',P='<ul class="'+x+'"></ul>',aF='<form class="'+be+'"></form>',bx='<div class="aui-button-row">'+'<span class="aui-button aui-button-submit aui-state-positive aui-priority-primary">'+'<span class="aui-button-content">'+'<input type="button" value="Save" class="aui-button-input aui-form-builder-button-save">'+"</span>"+"</span>"+'<span class="aui-button aui-button-submit aui-state-positive aui-priority-secondary">'+'<span class="aui-button-content">'+'<input type="button" value="Close" class="aui-button-input aui-form-builder-button-close">'+"</span>"+"</span>"+"</div>",bB=0,af=1,aU=aW.Array([G,N,ba,J,bb,bn,E,bh]);var aI=function(){};aI.ATTRS={fields:{value:[],setter:"_setFields",validator:i}};aW.mix(aI.prototype,{addField:function(bD){var A=this;var L=A.get(J);L=A._removeFromParent(bD);L.push(bD);A.set(J,L);},addFields:function(L){var A=this;aW.Array.each(A._normalizeFields(L),aW.bind(A.addField,A));},contains:function(bG,L){var A=this;var bF=A.get(J);if(L){for(var bD=0;bD<bF.length;bD++){var bE=bF[bD];if((bE==bG)||bE.contains(bG,L)){return true;}}}return(A.indexOf(bG)>-1);},indexOf:function(bD){var A=this;var L=A.get(J);return aW.Array.indexOf(L,bD);},insertField:function(L,bE){var A=this;var bD=A.get(J);bD=A._removeFromParent(bE);bD.splice(L,0,bE);A.set(J,bD);},removeField:function(bD){var A=this;var L=A.get(J);L=A._removeFromParent(bD);bD.removeTarget(A);A.set(J,L);},removeFields:function(L){var A=this;aW.Array.each(A._normalizeFields(L),aW.bind(A.removeField,A));},_normalizeFields:function(bD){var A=this;var L=[];bD=aW.Array(bD);aW.Array.each(bD,function(bG,bE){var bF=A.get(ar)||A;if(!R(bG)){bG=bF._renderField(bG);}if(bG){L.push(bG);bG.addTarget(bF);bG.set(k,A);}});return L;},_removeFromParent:function(bE){var A=this;var bD=A.get(J);if(R(bE)){var L=bE.get(k);if(L&&L!=A){L.removeField(bE);}else{if(A.contains(bE)){aW.Array.removeItem(bD,bE);}}}return bD;},_setFields:function(L){var A=this;return A._normalizeFields(L);}});aW.FormBuilderFieldSupport=aI;var j=aW.Component.create({NAME:ar,ATTRS:{availableFields:{value:{},validator:bc},nestedList:{setter:function(bD){var A=this;var L=aW.merge({dd:{plugins:[{cfg:{horizontal:false,scrollDelay:30},fn:aW.Plugin.DDWinScroll}]},dropCondition:function(bF){var bG=false;var bE=bF.drop.get(D);var bH=bE.getData(bj);if(bH&&bH.get(bp)){bG=true;}return bG;},dropOn:aN+K,placeholder:aW.Node.create(a0),sortCondition:function(bF){var bE=A.get(B);return bE.contains(bF.drop.get(D));}},bD);return L;},value:{}},strings:{value:{stringEmptySelection:"No field selected"}},dragContainerNode:{valueFn:function(){return aW.Node.create(v);}},dragNodesList:{valueFn:"_valueDragNodesList"},dropContainerNode:{valueFn:function(){return aW.Node.create(Z);}},settingsButtonsNode:{valueFn:function(){return aW.Node.create(bx);}},settingsFormNode:{valueFn:function(){return aW.Node.create(aF);}},tabsNode:{valueFn:function(){return aW.Node.create(bk);}},tabsContentNode:{valueFn:function(){return aW.Node.create(bf);}},tabsListNode:{valueFn:function(){return aW.Node.create(P);}}},AUGMENTS:[aW.FormBuilderFieldSupport],HTML_PARSER:{dragContainerNode:aN+ab,dragNodesList:function(L){var A=L.all(aN+a6);return(A.size()<=0)?null:A;},dropContainerNode:aN+a2,settingsFormNode:aQ+aN+be,settingsButtonsNode:aN+ac,tabsNode:aN+bg,tabsContentNode:aN+C,tabsListNode:aN+x},EXTENDS:aW.Widget,prototype:{initializer:function(){var A=this;A.boundingBox=A.get(G);A.dragContainerNode=A.get(U);A.dragNodesList=A.get(bz);A.dropContainerNode=A.get(B);A.settingsButtonsNode=A.get(Q);A.settingsFormNode=A.get(au);A.tabsNode=A.get(y);A.tabsContentNode=A.get(bm);A.tabsListNode=A.get(d);A._dragNestedList=new aW.NestedList(A.get(aD));
A._dropNestedList=new aW.NestedList(A.get(aD));A._tabs=new aW.TabView({boundingBox:A.tabsNode,contentNode:A.tabsContentNode,listNode:A.tabsListNode});if(!A.tabsContentNode.inDoc()){A._tabs.set(ae,[{label:"Add a field",contentNode:A.dragContainerNode},{label:"Field settings",content:A.settingsFormNode}]);}},renderUI:function(){var A=this;A.dragContainerNode.setContent(A.dragNodesList);A._tabs.render();},bindUI:function(){var A=this;var bD=A.boundingBox;var L=A.dropContainerNode;var bE=A.settingsButtonsNode;A._dragNestedList.on("drag:end",aW.bind(A._onDragEndDragNestedList,A));A._dragNestedList.on("drag:start",aW.bind(A._onDragStartDragNestedList,A));A._dropNestedList.on("drag:end",aW.bind(A._onDragEndDropNestedList,A));A._tabs.after("activeTabChange",aW.bind(A._afterActiveTabChange,A));L.delegate("click",aW.bind(A._onClickFieldDelete,A),aN+b);L.delegate("click",aW.bind(A._onClickFieldDuplicate,A),aN+a);L.delegate("click",aW.bind(A._onClickFieldEdit,A),aN+az);L.delegate("dblclick",aW.bind(A._onDbClickField,A),aN+aC);L.delegate("mouseenter",aW.bind(A._onMouseEnterField,A),aN+aC);L.delegate("mouseleave",aW.bind(A._onMouseLeaveField,A),aN+aC);bE.delegate("click",aW.bind(A._onClickSettingsButton,A),aN+a7);A.after("*:fieldsChange",aW.bind(A.syncFieldsUI,A));A.after("*:selectedChange",aW.bind(A._afterSelectedChange,A));},syncUI:function(){var A=this;A.syncFieldsUI();A._syncNestedList();},appendFields:function(bD,L){var A=this;L.setContent(I);aW.each(bD,function(bF){var bE=bF.get(J);L.append(bF.get(G));A.appendFields(bE,bF.get(ah));});},duplicateField:function(bE){var A=this;var bF=A._cloneField(bE);var L=bE.get(k);var bD=L.indexOf(bE);L.insertField(++bD,bF);A.selectField(bF);},selectField:function(bD){var A=this;bD.set(bn,true);var L=A.settingsFormNode.one(aB);if(L){L.focus();L.select();}A._tabs.selectTab(af);},syncFieldsUI:function(bD){var A=this;var bE=A.get(J);var L=A.get(B);if(bD&&R(bD.target)){var bF=bD.target;bE=bF.get(J);L=bF.get(ah);}A.appendFields(bE,L);A._syncNestedList();},_afterActiveTabChange:function(bF){var A=this;var bE=A.selectedField;var L=A.get(au);var bD=A.get(Q);var bG=A.get(a8);var bH=A.contains(bE,true);if(!bH){L.setContent(bG[aV]);}bD.toggleClass(r,!bH);},_afterSelectedChange:function(bD){var A=this;var bE=bD.target;var L=A.selectedField;A._syncSelectedFieldUI(bE);if(bE.get(bn)){A.selectedField=bE;if(L&&L!=bE){L.set(bn,false);}bE.renderSettings();}},_cloneField:function(bF){var A=this;var bE=bF.get(n);var bD={};aW.each(bF.getAttrs(),function(bH,bG){if(aU.indexOf(bG)===-1&&!aP(bH)){bD[bG]=bH;}});var L=[];aW.each(bF.get(J),function(bG){L.push(A._cloneField(bG));});bD[J]=L;return A._renderField(bD,bE);},_dropField:function(bG,bF){var A=this;var bH=bG.get(q);var bD=bH.all("> "+aN+aC);var bI=bG.getData(bj);if(!bI){var bE=A._getFieldDefaultConfig(bF);bI=A._renderField(bE);}var L=A._getFieldParentByNode(bG);L.insertField(bD.indexOf(bG),bI);return bI;},_getFieldDefaultConfig:function(L){var A=this;var bD=A.get(av);return aW.merge(bD[L],{type:L});},_getFieldInstance:function(L,bE){var A=this;var bE=bE||L.type;var bD=aW.FormBuilder.types;var bF=O(bE)?bD[bE]:bE;if(bF!==undefined){return new bF(L);}else{aW.log("The field type: ["+bE+"] couldn't be found.");}return null;},_getFieldParentByNode:function(L){var A=this;var bD=L.ancestor(aN+aC);if(bD){return bD.getData(bj);}return A;},_getFieldParentNode:function(bD){var A=this;var L=bD.get(k);if(R(L)){return L.get(G);}return A.get(B);},_onClickFieldDelete:function(bD){var A=this;var bG=bD.currentTarget;var bE=bG.ancestor(aN+aC);var bF=bE.getData(bj);if(bF){var L=A.selectedField;if(bF==L||bF.contains(L,true)){A._tabs.selectTab(bB);}bF.get(k).removeField(bF);bF.set(bn,false);}},_onClickFieldDuplicate:function(L){var A=this;var bF=L.currentTarget;var bD=bF.ancestor(aN+aC);var bE=bD.getData(bj);if(bE){A.duplicateField(bE);}},_onClickFieldEdit:function(L){var A=this;var bF=L.currentTarget;var bD=bF.ancestor(aN+aC);var bE=bD.getData(bj);if(bE){A.selectField(bE);}},_onClickSettingsButton:function(bD){var A=this;var bE=bD.currentTarget;if(bE.hasClass(br)){var L=A.selectedField;if(L){L.saveSettings();}}A._tabs.selectTab(bB);},_onDbClickField:function(L){var A=this;var bE=L.target;if(!bE.getData(bj)){bE=bE.ancestor(aN+aC);}if(bE){var bD=bE.getData(bj);if(bD){A.selectField(bD);}}return false;},_onDragEndDragNestedList:function(L){var bJ=this;var bF=L.target;var bD=bF.get(D);var bG=bJ.dragContainerNode;var bE=bJ.dropContainerNode;var A=bE.one(aN+a6);if(A){var bH=A.getAttribute("data-type");var bI=bJ._dropField(A,bH);bJ.selectField(bI);}else{if(bD){bD.remove();}}if(bG.contains(bD)&&bG.contains(bJ.originalNode)){bD.remove();}},_onDragEndDropNestedList:function(bE){var L=this;var bD=bE.target;var A=bD.get(D);L._dropField(A);},_onDragStartDragNestedList:function(bF){var L=this;var bE=bF.target;var A=bE.get(D);var bG=A.clone();bG.placeBefore(A);bE.set(D,bG);bG.attr(bb,I);bG.show();A.removeClass(ai);A.show();L.originalNode=A;var bD=aW.merge(L.get(aD),{nodes:bG});(new aW.NestedList(bD));},_onMouseEnterField:function(L){var A=this;var bD=L.currentTarget;var bE=bD.getData(bj);if(bE){A._toggleFieldButtonsNode(bE,true);}},_onMouseLeaveField:function(L){var A=this;var bD=L.currentTarget;var bE=bD.getData(bj);var bF=false;if(bE){if(bE.get(bn)){bF=true;}A._toggleFieldButtonsNode(bE,bF);}},_renderField:function(L,bD){var A=this;L[ar]=A;L[s]=true;return A._getFieldInstance(L,bD);},_syncNestedList:function(){var A=this;A._syncNodes();A._dragNestedList.addAll(A.dragNodes);A._dropNestedList.addAll(A.dropNodes);},_syncNodes:function(){var A=this;var bD=A.dragContainerNode;var L=A.dropContainerNode;A.dragNodes=bD.all(aN+aC);A.dropNodes=L.all(aN+aC);},_syncSelectedFieldUI:function(bF){var A=this;var bE=bF.get(bn);var bD=bF.get(G);var L=A.selectedField;bD.toggleClass(aZ,bE);if(!bE&&bF.contains(L)){bE=true;}A._toggleFieldButtonsNode(bF,bE);},_toggleFieldButtonsNode:function(bD,bE){var A=this;var L=bD.buttonsNode;if(L){L.toggleClass(r,!bE);}},_valueDragNodesList:function(){var A=this;
var bD=A.get(av);var L=[];aW.each(bD,function(bF,bE){L.push(aW.substitute(by,{icon:bF.icon,label:bF.fieldLabel,type:bE}));});return aW.NodeList.create(L.join(I));}}});aW.FormBuilder=j;aW.FormBuilder.types={};},"@VERSION@",{requires:["aui-base","aui-button-item","aui-nested-list","aui-tabs","substitute"],skinnable:true});