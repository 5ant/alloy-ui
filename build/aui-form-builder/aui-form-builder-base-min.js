AUI.add("aui-form-builder-base",function(bs){var bl=bs.Lang,aA=bl.isArray,aC=bl.isBoolean,bi=bl.isString,bP=bl.isObject,ac=bl.isValue,bM=bs.Array,bR=bs.AvailableField.getAvailableFieldById,e=function(A){return(A instanceof bs.AvailableField);},aZ=function(A){return(A instanceof bs.Node);},aH=function(A){return(A instanceof bs.NodeList);},bQ=function(A){return(A instanceof bs.FormBuilder);},bh=function(A){return(A instanceof bs.FormBuilderField);},a1=bs.DD.DDM,d="acceptChildren",bn="active",aY="allowRemoveRequiredFields",H="add",bJ="append",o="autoSelectFields",bv="availableField",bO="availableFields",X="base",ax="boundingBox",bz="builder",bE="button",z="buttons",s="buttonsNode",i="children",bk="click",al="cloneNode",az="component",at="container",ar="content",bL="contentBox",a0="data",ad="dblclick",Y="dd",bD="default",ag="defaultMessage",B="defaultMessageNode",aB="delete",j="diagram",bc=".",aM="drag",am="dragContainer",r="dragContainerNode",bo="dragNodesList",bd="draggable",n="dragging",ai="drop",aS="dropContainer",aV="dropContainerNode",bu="dropNode",aF="dropZoneNode",ao="duplicate",C="edit",bG="editing",be="emptySelection",a7="",bt="enableEditing",aW="field",c="fields",D="fieldsNestedListConfig",aj="first",m="firstChild",aJ="fixed",P="focused",k="form",aP="formBuilder",Q="form-layout",h="helper",aa="hidden",l="icon",bB="id",bK="inactive",by="index",aE="input",b="items",bS="key",R="label",bq="labelNode",av="last",aI="lastChild",af="list",aK="localizationMap",aX="message",bf="mouseenter",w="mouseleave",ak="name",a4="nestedList",bT="node",N="options",aL="over",ah="parent",G="parentNode",S="placeAfter",y="placeBefore",br="placeholder",au="predefinedValue",aO="prepend",bw="readOnlyAttributes",a9="records",bA="recordset",T="region",bN="remove",t="render",ay="rendered",W="required",bb="save",aQ="selected",aD="settings",aU="settingsButtonsNode",Z="settingsFormNode",I="showLabel",J=" ",aR="srcNode",a6="state",bm="strings",aN="tabs",U="tabsContentNode",a3="tabsListNode",a="tabsNode",bF="tabview",p="target",M="templateNode",a8="text",q="tip",K="type",an="unique",f="value",E="values",aT="widget",a2="width",bj="zone",g=",",bI="-",ab=".",x="",bp="#",aG="_",v=bs.getClassName,bg=bO+aG+aW+aG,bx=c+aG+aW+aG,O=v(Y,n),bH=v(j,bz,ai,at),bC=v(j,bz,aW,bd),V=v(k,bz,ai,bj),ba=v(k,bz,aW),aq=v(k,bz,aW,bG),u=v(k,bz,br),a5=v(k,bz,an),ap=[bB,ak],ae='<div class="'+u+'"></div>';var F=bs.Component.create({NAME:bv,ATTRS:{predefinedValue:{value:x,},readOnlyAttributes:{value:[],validator:aA},unique:{value:false,validator:aC}},EXTENDS:bs.AvailableField});bs.FormBuilderAvailableField=F;var aw=bs.Component.create({NAME:aP,ATTRS:{allowRemoveRequiredFields:{validator:aC,value:false},autoSelectFields:{value:false},enableEditing:{value:true},fieldsNestedListConfig:{setter:"_setFieldsNestedListConfig",validator:bP,value:null},strings:{value:{addNode:"Add field",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}}},UI_ATTRS:[aY],EXTENDS:bs.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{uniqueFields:new bs.DataSet(),initializer:function(){var A=this;A.on({cancel:A._onCancel,"drag:end":A._onDragEnd,"drag:start":A._onDragStart,"drag:mouseDown":A._onDragMouseDown,save:A._onSave});A.uniqueFields.after(H,bs.bind(A._afterUniqueFieldsAdd,A));A.uniqueFields.after(bN,bs.bind(A._afterUniqueFieldsRemove,A));A.dropContainer.delegate(bk,bs.bind(A._onClickField,A),ab+ba);A.dropContainer.delegate(ad,bs.bind(A._onDblClickField,A),ab+ba);},syncUI:function(){var A=this;A._setupAvailableFieldsNestedList();A._setupFieldsNestedList();},closeEditProperties:function(){var A=this;var L=A.editingField;A.tabView.selectTab(bs.FormBuilder.FIELDS_TAB);if(L&&L.get(ay)){L.get(ax).removeClass(aq);}A.editingField=null;},createField:function(L){var A=this;if(!bh(L)){L=new (A.getFieldClass(L.type||aW))(L);}L.set(bz,A);L.set(ah,A);return L;},duplicateField:function(bU){var A=this;var L=A._getFieldNodeIndex(bU.get(ax));var bV=A._cloneField(bU,true);A.insertField(bV,++L,bU.get(ah));},editField:function(L){var A=this;if(bh(L)){A.closeEditProperties();A.tabView.selectTab(bs.FormBuilder.SETTINGS_TAB);A.propertyList.set(bA,L.getProperties());L.get(ax).addClass(aq);A.editingField=A.selectedField=L;}},getFieldClass:function(bU){var A=this;var L=bs.FormBuilder.types[bU];if(L){return L;}else{bs.log("The field type: ["+bU+"] couldn't be found.");return null;}},insertField:function(bV,L,bU){var A=this;bU=bU||A;bV.get(ah).removeField(bV);bU.addField(bV,L);},plotField:function(bV,L){var A=this;var bU=bV.get(ax);if(!bV.get(ay)){bV.render(L);}else{L.append(bU);}A._syncUniqueField(bV);A.fieldsNestedList.add(bU);},plotFields:function(L,bU){var A=this;bU=bU||A.dropContainer;L=L||A.get(c);bU.setContent(a7);bs.each(L,function(bV){A.plotField(bV,bU);});},select:function(L){var A=this;A.unselectFields();A.selectedField=L.set(aQ,true).focus();},unselectFields:function(){var A=this;var L=A.selectedField;if(L){L.set(aQ,false);}A.selectedField=null;},_afterUniqueFieldsAdd:function(bU){var A=this;var bV=bU.attrName;if(e(bV)){var L=bV.get(bT);bV.set(bd,false);L.unselectable();}},_afterUniqueFieldsRemove:function(bU){var A=this;var bV=bU.attrName;if(e(bV)){var L=bV.get(bT);bV.set(bd,true);L.selectable();}},_cloneField:function(bV,L){var A=this;var bU={};bM.each(bV.getProperties(),function(bX){var bW=bX.attributeName;if(bM.indexOf(ap,bW)===-1){bU[bW]=bX.value;}});if(L){bU[c]=[];bs.each(bV.get(c),function(bX,bW){if(!bX.get(an)){bU[c][bW]=A._cloneField(bX,L);}});}return A.createField(bU);},_dropField:function(bW){var L=this;var bY=bW.getData(bv);var bX=bs.Widget.getByNode(bW);var A=bW.get(G);if(e(bY)){var bZ=bY.get(bB).replace(bg,x);bX=L.createField({fixed:bY.get(aJ),id:bZ,label:bY.get(R),localizationMap:bY.get(aK),options:bY.get(N),predefinedValue:bY.get(au),readOnlyAttributes:bY.get(bw),required:bY.get(W),showLabel:bY.get(I),tip:bY.get(q),type:bY.get(K),unique:bY.get(an),width:bY.get(a2)});if(bY.get(an)){bX.set(ak,bY.get(ak));}L.select(bX);}if(bh(bX)){var bV=bs.Widget.getByNode(A);
if(!bh(bV)){bV=L;}var bU=L._getFieldNodeIndex(bW);L.insertField(bX,bU,bV);}},_getFieldId:function(bU){var A=this;var bV=bU.get(bB);var L;if(e(bU)){L=bg;}else{L=bx;}return bV.replace(L,x);},_getFieldNodeIndex:function(L){var A=this;return L.get(G).all("> *:not("+ab+u+")").indexOf(L);},_onClickField:function(L){var A=this;var bU=bs.Widget.getByNode(L.currentTarget);A.select(bU);L.stopPropagation();},_onDblClickField:function(L){var A=this;if(!L.target.ancestor(ab+ba,true)){return;}var bU=bs.Widget.getByNode(L.currentTarget);if(bU){A.editField(bU);}L.stopPropagation();},_onDragEnd:function(bU){var A=this;var L=bU.target;var bV=L.get(bT);A._dropField(bV);if(!bh(bs.Widget.getByNode(bV))){bV.remove();L.set(bT,A._originalDragNode);}},_onDragMouseDown:function(L){var A=this;var bU=L.target.get(bT);var bV=bs.AvailableField.getAvailableFieldByNode(bU);if(e(bV)&&!bV.get(bd)){L.halt();}},_onDragStart:function(bV){var A=this;var bU=bV.target;var bX=bU.get(bT);if(bh(bs.Widget.getByNode(bX))){return;}A._originalDragNode=bX;var bW=bX.clone();bX.placeBefore(bW);bU.set(bT,bW);var L=bX.getData(bv);bW.setData(bv,L);bW.attr(bB,a7);bW.hide();bX.removeClass(O);bX.show();A.fieldsNestedList.add(bW);},_onSave:function(bU){var A=this;var L=A.editingField;if(L){var bV=A.propertyList.get(bA);bM.each(bV.get(a9),function(bW){var bX=bW.get(a0);L.set(bX.attributeName,bX.value);});A._syncUniqueField(L);}},_setAvailableFields:function(bU){var L=this;var A=[];bM.each(bU,function(bW,bV){A.push(e(bW)?bW:new bs.FormBuilderAvailableField(bW));});return A;},_setFieldsNestedListConfig:function(bU){var A=this;var L=A.dropContainer;return bs.merge({bubbleTargets:A,dd:{groups:[bO],plugins:[{cfg:{horizontal:false,scrollDelay:150},fn:bs.Plugin.DDWinScroll}]},dropCondition:function(bW){var bV=bW.drop.get(bT);var bX=bs.Widget.getByNode(bV);if(bh(bX)){return true;}return false;},placeholder:bs.Node.create(ae),dropOn:ab+V,sortCondition:function(bW){var bV=bW.drop.get(bT);return(bV!==A.dropContainer&&L.contains(bV));}},bU||{});},_setupAvailableFieldsNestedList:function(){var A=this;if(!A.availableFieldsNestedList){var L=A.fieldsContainer.all(ab+bC);A.availableFieldsNestedList=new bs.NestedList(bs.merge(A.get(D),{nodes:L}));}},_setupFieldsNestedList:function(){var A=this;if(!A.fieldsNestedList){A.fieldsNestedList=new bs.NestedList(A.get(D));}},_syncUniqueField:function(bU){var A=this;var L=A.uniqueFields;var bV=bR(A._getFieldId(bU));if(e(bV)){if(bV.get(an)||bU.get(an)){bU.set(bw,bV.get(bw));bU.set(an,bV.get(an));bM.each(bU.getProperties(),function(bX){var bW=bX.attributeName;if(bW===bB){return;}bV.set(bW,bX.value);});bV.set(aK,bU.get(aK));L.add(bV,bU);}}},_uiSetAllowRemoveRequiredFields:function(L){var A=this;A.get(c).each(function(bU){bU._uiSetRequired(bU.get(W));});}}});bs.FormBuilder=aw;bs.FormBuilder.types={};},"@VERSION@",{skinnable:true,requires:["aui-base","aui-button-item","aui-data-set","aui-diagram-builder-base","aui-nested-list","aui-tabs"]});