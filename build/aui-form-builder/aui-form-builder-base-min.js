AUI.add("aui-form-builder-base",function(aS){var aL=aS.Lang,e=aL.isArray,bo=aL.isString,Y=aL.isObject,aU=aL.isValue,at=function(A){return(A instanceof aS.Node);},bx=function(A){return(A instanceof aS.NodeList);},bp=function(A){return(A instanceof aS.FormBuilder);},bl=function(A){return(A instanceof aS.FormBuilderField);},an=aS.DD.DDM,H="active",K="acceptChildren",ar="availableFields",i="append",G="boundingBox",bv="builder",aV="button",U="buttons",ai="buttonsNode",m="children",aj="clonable-portal-layout",c="cloneNode",aO="content",O="contentBox",a="container",au="delete",aM="dd",aR="default",aK=".",z="duplicate",V="drag",ao="dragging",a5="dragContainer",bi="dragContainerNode",y="dragNodesList",S="dragPortalLayout",bw="drop",aJ="dropContainer",E="dropContainerNode",ax="dropPortalLayout",a2="dropNode",a4="dropZoneNode",ak="edit",M="",bg="field",N="fields",Q="first",ap="firstChild",P="focused",aN="form",aT="formBuilder",w="form-layout",a9="id",aF="icon",az="input",ab="items",aY="label",T="labelNode",h="last",ay="lastChild",a7="list",aB="nestedList",F="node",a1="over",o="parent",k="parentNode",a3="placeholder",ag="placeAfter",t="placeBefore",am="prepend",C="helper",aH="hidden",g="render",ba="save",bn="selected",D="settings",aq="settingsFormNode",bk="settingsButtonsNode",a8="srcNode",J=" ",av="state",af="strings",b="tabs",B="tabsNode",bj="tabsContentNode",s="tabsListNode",j="tabview",r="target",bs="templateNode",l="type",br="value",bd="values",bf="zone",p="region",aQ="stringEmptySelection",X=aS.ClassNameManager.getClassName,ae=X(aV,az),ah=X(aM,ao),n=X(C,aH),q=X(aN,bv,aV,au),u=X(aN,bv,aV,z),aw=X(aN,bv,aV,ak),bu=X(aN,bv,aV,ba),a6=X(aN,bv,V,a),ad=X(aN,bv,V,F),v=X(aN,bv,bw,H),a0=X(aN,bv,bw,a),R=X(aN,bv,bw,F),bq=X(aN,bv,bw,bf),aA=X(aN,bv,bg),aa=X(aN,bv,bg,U),aI=X(aN,bv,bg,aO),aZ=X(aN,bv,bg,a1),aW=X(aN,bv,bg,bn),d=X(aN,bv,C),aC=X(aN,bv,aF),al=X(aN,bv,aY),I=X(aN,bv,a3),bc=X(aN,bv,D),Z=X(aN,bv,D,U),be=X(aN,bv,b,a),bt=X(j,aO),by=X(j,a7),x=X(aF),bC='<ul class="'+a6+'"></ul>',bA='<li class="'+[ad,aA].join(J)+'" data-type="{type}">'+'<span class="'+[aC,x].join(J)+' {icon}"></span>'+'<span class="'+al+'">{label}</span>'+"</li>",bb='<ul class="'+[a0].join(J)+'"></ul>',aE='<div class="'+d+'"></div>',aX='<li class="'+I+'"></li>',bh='<div class="'+be+'"></div>',W='<div class="'+bt+'"></div>',bm='<ul class="'+by+'"></ul>',aD='<form class="'+bc+'"></form>',bz='<div class="aui-button-row">'+'<span class="aui-button aui-button-submit aui-state-positive aui-priority-primary">'+'<span class="aui-button-content">'+'<input type="button" value="Save" class="aui-button-input aui-form-builder-button-save">'+"</span>"+"</span>"+'<span class="aui-button aui-button-submit aui-state-positive aui-priority-secondary">'+'<span class="aui-button-content">'+'<input type="button" value="Close" class="aui-button-input aui-form-builder-button-close">'+"</span>"+"</span>"+"</div>",bB=0,ac=1,aP=aS.Array([G,O,a8,N,a9,bn,bs,T]);var aG=function(){};aG.ATTRS={fields:{value:[],setter:"_setFields",validator:e}};aS.mix(aG.prototype,{addField:function(bD){var L=this;var A=L.get(N);A=L._removeFromParent(bD);A.push(bD);L.set(N,A);},addFields:function(L){var A=this;aS.Array.each(A._normalizeFields(L),aS.bind(A.addField,A));},contains:function(bG,bD){var L=this;var A=L.get(N);if(bD){for(var bE=0;bE<A.length;bE++){var bF=A[bE];if((bF==bG)||bF.contains(bG,bD)){return true;}}}return(L.indexOf(bG)>-1);},indexOf:function(bD){var L=this;var A=L.get(N);return aS.Array.indexOf(A,bD);},insertField:function(bD,bE){var L=this;var A=L.get(N);A=L._removeFromParent(bE);A.splice(bD,0,bE);L.set(N,A);},removeField:function(bD){var L=this;var A=L.get(N);A=L._removeFromParent(bD);bD.removeTarget(L);L.set(N,A);},removeFields:function(L){var A=this;aS.Array.each(A._normalizeFields(L),aS.bind(A.removeField,A));},_normalizeFields:function(L){var A=this;var bD=[];L=aS.Array(L);aS.Array.each(L,function(bG,bF){var bE=A.get(aT)||A;if(!bl(bG)){bG=bE._renderField(bG);}if(bG){bD.push(bG);bG.addTarget(bE);bG.set(o,A);}});return bD;},_removeFromParent:function(bE){var L=this;var A=L.get(N);if(bl(bE)){var bD=bE.get(o);if(bD&&bD!=L){bD.removeField(bE);}else{if(L.contains(bE)){aS.Array.removeItem(A,bE);}}}return A;},_setFields:function(L){var A=this;return A._normalizeFields(L);}});aS.FormBuilderFieldSupport=aG;var f=aS.Component.create({NAME:aT,ATTRS:{availableFields:{value:{},validator:Y},nestedList:{setter:function(bD){var A=this;var L=aS.merge({dd:{plugins:[{cfg:{horizontal:false,scrollDelay:30},fn:aS.Plugin.DDWinScroll}]},dropCondition:function(bF){var bG=false;var bE=bF.drop.get(F);var bH=bE.getData(bg);if(bH&&bH.get(K)){bG=true;}return bG;},dropOn:aK+bq,placeholder:aS.Node.create(aX),sortCondition:function(bF){var bE=A.get(E);return bE.contains(bF.drop.get(F));}},bD);return L;},value:{}},strings:{value:{stringEmptySelection:"No field selected"}},dragContainerNode:{valueFn:function(){return aS.Node.create(bC);}},dragNodesList:{valueFn:"_valueDragNodesList"},dropContainerNode:{valueFn:function(){return aS.Node.create(bb);}},settingsButtonsNode:{valueFn:function(){return aS.Node.create(bz);}},settingsFormNode:{valueFn:function(){return aS.Node.create(aD);}},tabsNode:{valueFn:function(){return aS.Node.create(bh);}},tabsContentNode:{valueFn:function(){return aS.Node.create(W);}},tabsListNode:{valueFn:function(){return aS.Node.create(bm);}}},AUGMENTS:[aS.FormBuilderFieldSupport],HTML_PARSER:{dragContainerNode:aK+a6,dragNodesList:function(L){var A=L.all(aK+ad);return(A.size()<=0)?null:A;},dropContainerNode:aK+a0,settingsFormNode:aN+aK+bc,settingsButtonsNode:aK+Z,tabsNode:aK+be,tabsContentNode:aK+bt,tabsListNode:aK+by},EXTENDS:aS.Widget,prototype:{initializer:function(){var A=this;A.boundingBox=A.get(G);A.dragContainerNode=A.get(bi);A.dragNodesList=A.get(y);A.dropContainerNode=A.get(E);A.settingsButtonsNode=A.get(bk);A.settingsFormNode=A.get(aq);A.tabsNode=A.get(B);A.tabsContentNode=A.get(bj);A.tabsListNode=A.get(s);A._dragNestedList=new aS.NestedList(A.get(aB));A._dropNestedList=new aS.NestedList(A.get(aB));
A._tabs=new aS.TabView({boundingBox:A.tabsNode,contentNode:A.tabsContentNode,listNode:A.tabsListNode});if(!A.tabsContentNode.inDoc()){A._tabs.set(ab,[{label:"Add a field",contentNode:A.dragContainerNode},{label:"Field settings",content:A.settingsFormNode}]);}},renderUI:function(){var A=this;A.dragContainerNode.setContent(A.dragNodesList);A._tabs.render();},bindUI:function(){var A=this;var bD=A.boundingBox;var L=A.dropContainerNode;var bE=A.settingsButtonsNode;A._dragNestedList.on("drag:end",aS.bind(A._onDragEndDragNestedList,A));A._dragNestedList.on("drag:start",aS.bind(A._onDragStartDragNestedList,A));A._dropNestedList.on("drag:end",aS.bind(A._onDragEndDropNestedList,A));A._tabs.after("activeTabChange",aS.bind(A._afterActiveTabChange,A));L.delegate("click",aS.bind(A._onClickFieldDelete,A),aK+q);L.delegate("click",aS.bind(A._onClickFieldDuplicate,A),aK+u);L.delegate("click",aS.bind(A._onClickFieldEdit,A),aK+aw);L.delegate("dblclick",aS.bind(A._onDbClickField,A),aK+aA);L.delegate("mouseenter",aS.bind(A._onMouseEnterField,A),aK+aA);L.delegate("mouseleave",aS.bind(A._onMouseLeaveField,A),aK+aA);bE.delegate("click",aS.bind(A._onClickSettingsButton,A),aK+ae);A.after("*:fieldsChange",aS.bind(A.syncFieldsUI,A));A.after("*:selectedChange",aS.bind(A._afterSelectedChange,A));},syncUI:function(){var A=this;A.syncFieldsUI();A._syncNestedList();},appendFields:function(L,bD){var A=this;bD.setContent(M);aS.each(L,function(bF){var bE=bF.get(N);bD.append(bF.get(G));A.appendFields(bE,bF.get(a4));});},duplicateField:function(bE){var A=this;var bF=A._cloneField(bE);var bD=bE.get(o);var L=bD.indexOf(bE);bD.insertField(++L,bF);A.selectField(bF);},selectField:function(bD){var A=this;bD.set(bn,true);var L=A.settingsFormNode.one(az);if(L){L.focus();L.select();}A._tabs.selectTab(ac);},syncFieldsUI:function(bE){var L=this;var A=L.get(N);var bD=L.get(E);if(bE&&bl(bE.target)){var bF=bE.target;A=bF.get(N);bD=bF.get(a4);}L.appendFields(A,bD);L._syncNestedList();},_afterActiveTabChange:function(bG){var L=this;var bF=L.selectedField;var bD=L.get(aq);var bE=L.get(bk);var A=L.get(af);var bH=L.contains(bF,true);if(!bH){bD.setContent(A[aQ]);}bE.toggleClass(n,!bH);},_afterSelectedChange:function(bD){var A=this;var bE=bD.target;var L=A.selectedField;A._syncSelectedFieldUI(bE);if(bE.get(bn)){A.selectedField=bE;if(L&&L!=bE){L.set(bn,false);}bE.renderSettings();}},_cloneField:function(bF){var A=this;var bE=bF.get(l);var L={};aS.each(bF.getAttrs(),function(bH,bG){if(aP.indexOf(bG)===-1&&!at(bH)){L[bG]=bH;}});var bD=[];aS.each(bF.get(N),function(bG){bD.push(A._cloneField(bG));});L[N]=bD;return A._renderField(L,bE);},_dropField:function(bH,bG){var L=this;var A=bH.get(k);var bD=A.all("> "+aK+aA);var bI=bH.getData(bg);if(!bI){var bE=L._getFieldDefaultConfig(bG);bI=L._renderField(bE);}var bF=L._getFieldParentByNode(bH);bF.insertField(bD.indexOf(bH),bI);return bI;},_getFieldDefaultConfig:function(L){var A=this;var bD=A.get(ar);return aS.merge(bD[L],{type:L});},_getFieldInstance:function(bD,bE){var A=this;var bE=bE||bD.type;var L=aS.FormBuilder.types;var bF=bo(bE)?L[bE]:bE;if(bF!==undefined){return new bF(bD);}else{aS.log("The field type: ["+bE+"] couldn't be found.");}return null;},_getFieldParentByNode:function(bD){var L=this;var A=bD.ancestor(aK+aA);if(A){return A.getData(bg);}return L;},_getFieldParentNode:function(bD){var A=this;var L=bD.get(o);if(bl(L)){return L.get(G);}return A.get(E);},_onClickFieldDelete:function(bE){var L=this;var bG=bE.currentTarget;var A=bG.ancestor(aK+aA);var bF=A.getData(bg);if(bF){var bD=L.selectedField;if(bF==bD||bF.contains(bD,true)){L._tabs.selectTab(bB);}bF.get(o).removeField(bF);bF.set(bn,false);}},_onClickFieldDuplicate:function(bD){var L=this;var bF=bD.currentTarget;var A=bF.ancestor(aK+aA);var bE=A.getData(bg);if(bE){L.duplicateField(bE);}},_onClickFieldEdit:function(bD){var L=this;var bF=bD.currentTarget;var A=bF.ancestor(aK+aA);var bE=A.getData(bg);if(bE){L.selectField(bE);}},_onClickSettingsButton:function(bD){var A=this;var bE=bD.currentTarget;if(bE.hasClass(bu)){var L=A.selectedField;if(L){L.saveSettings();}}A._tabs.selectTab(bB);},_onDbClickField:function(L){var A=this;var bE=L.target;if(!bE.getData(bg)){bE=bE.ancestor(aK+aA);}if(bE){var bD=bE.getData(bg);if(bD){A.selectField(bD);}}return false;},_onDragEndDragNestedList:function(L){var bJ=this;var bF=L.target;var bE=bF.get(F);var bD=bJ.dragContainerNode;var bG=bJ.dropContainerNode;var A=bG.one(aK+ad);if(A){var bH=A.getAttribute("data-type");var bI=bJ._dropField(A,bH);bJ.selectField(bI);}else{if(bE){bE.remove();}}if(bD.contains(bE)&&bD.contains(bJ.originalNode)){bE.remove();}},_onDragEndDropNestedList:function(bD){var A=this;var L=bD.target;var bE=L.get(F);A._dropField(bE);},_onDragStartDragNestedList:function(bE){var A=this;var bD=bE.target;var bG=bD.get(F);var bF=bG.clone();bF.placeBefore(bG);bD.set(F,bF);bF.attr(a9,M);bF.show();bG.removeClass(ah);bG.show();A.originalNode=bG;var L=aS.merge(A.get(aB),{nodes:bF});(new aS.NestedList(L));},_onMouseEnterField:function(bD){var L=this;var A=bD.currentTarget;var bE=A.getData(bg);if(bE){L._toggleFieldButtonsNode(bE,true);}},_onMouseLeaveField:function(bD){var L=this;var A=bD.currentTarget;var bE=A.getData(bg);var bF=false;if(bE){if(bE.get(bn)){bF=true;}L._toggleFieldButtonsNode(bE,bF);}},_renderField:function(L,bD){var A=this;L[aT]=A;L[g]=true;return A._getFieldInstance(L,bD);},_syncNestedList:function(){var A=this;A._syncNodes();A._dragNestedList.addAll(A.dragNodes);A._dropNestedList.addAll(A.dropNodes);},_syncNodes:function(){var A=this;var bD=A.dragContainerNode;var L=A.dropContainerNode;A.dragNodes=bD.all(aK+aA);A.dropNodes=L.all(aK+aA);},_syncSelectedFieldUI:function(bF){var L=this;var bE=bF.get(bn);var A=bF.get(G);var bD=L.selectedField;A.toggleClass(aW,bE);if(!bE&&bF.contains(bD)){bE=true;}L._toggleFieldButtonsNode(bF,bE);},_toggleFieldButtonsNode:function(L,bD){var A=this;var bE=L.buttonsNode;if(bE){bE.toggleClass(n,!bD);}},_valueDragNodesList:function(){var A=this;var bD=A.get(ar);var L=[];
aS.each(bD,function(bF,bE){L.push(aS.substitute(bA,{icon:bF.icon,label:bF.fieldLabel,type:bE}));});return aS.NodeList.create(L.join(M));}}});aS.FormBuilder=f;aS.FormBuilder.types={};},"@VERSION@",{requires:["aui-base","aui-button-item","aui-nested-list","aui-tabs","substitute"],skinnable:true});