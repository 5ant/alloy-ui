AUI.add("aui-form-builder-base",function(p){var m=p.Lang,n=m.isArray,c=m.isString,f=m.isObject,u=m.isValue,v=function(A){return(A instanceof p.Node);},q=function(A){return(A instanceof p.NodeList);},o=function(A){return(A instanceof p.FormBuilder);},z=function(A){return(A instanceof p.FormBuilderField);},g=p.DD.DDM,j="active",r="acceptChildren",y="autoSelectFields",x="availableFields",w="append",B="boundingBox",i="builder",d="button",l="buttons",e="buttonsNode",h="children",b="clonable-portal-layout",t="cloneNode",k=", ";COMPONENT="component",CONTENT="content",CONTENT_BOX="contentBox",CONTAINER="container",DELETE="delete",DD="dd",DEFAULT="default",DEFAULT_MESSAGE="defaultMessage",DEFAULT_MESSAGE_NODE="defaultMessageNode",DOT=".",DUPLICATE="duplicate",DRAG="drag",DRAGGING="dragging",DRAG_CONTAINER="dragContainer",DRAG_CONTAINER_NODE="dragContainerNode",DRAG_NODES_LIST="dragNodesList",DRAG_PORTAL_LAYOUT="dragPortalLayout",DROP="drop",DROP_CONTAINER="dropContainer",DROP_CONTAINER_NODE="dropContainerNode",DROP_PORTAL_LAYOUT="dropPortalLayout",DROP_NODE="dropNode",DROP_ZONE_NODE="dropZoneNode",EDIT="edit",EMPTY_SELECTION="emptySelection",EMPTY_STR="",ENABLE_EDITING="enableEditing",FIELD="field",FIELDS="fields",KEY="key",FIRST="first",FIRST_CHILD="firstChild",FOCUSED="focused",FORM="form",FORM_BUILDER="formBuilder",FORM_LAYOUT="form-layout",ID="id",ICON="icon",INACTIVE="inactive",INDEX="index",INPUT="input",ITEMS="items",LABEL="label",LABEL_NODE="labelNode",LAST="last",LAST_CHILD="lastChild",LIST="list",MESSAGE="message",NAME="name",NESTED_LIST="nestedList",NODE="node",OVER="over",PARENT="parent",PARENT_NODE="parentNode",PLACEHOLDER="placeholder",PLACE_AFTER="placeAfter",PLACE_BEFORE="placeBefore",PREPEND="prepend",HELPER="helper",HIDDEN="hidden",READ_ONLY_ATTRIBUTES="readOnlyAttributes",RENDER="render",SAVE="save",SELECTED="selected",SETTINGS="settings",SETTINGS_FORM_NODE="settingsFormNode",SETTINGS_BUTTONS_NODE="settingsButtonsNode",SRC_NODE="srcNode",SPACE=" ",STATE="state",STRINGS="strings",TABS="tabs",TABS_NODE="tabsNode",TABS_CONTENT_NODE="tabsContentNode",TABS_LIST_NODE="tabsListNode",TABVIEW="tabview",TARGET="target",TEMPLATE_NODE="templateNode",TEXT="text",TYPE="type",UNIQUE="unique",VALUE="value",VALUES="values",ZONE="zone",REGION="region",WIDGET="widget",getCN=p.getClassName,CSS_BUTTON_INPUT=getCN(d,INPUT),CSS_COMPONENT=getCN(COMPONENT),CSS_DD_DRAGGING=getCN(DD,DRAGGING),CSS_HELPER_HIDDEN=getCN(HELPER,HIDDEN),CSS_FORM_BUILDER_BUTTON_DELETE=getCN(FORM,i,d,DELETE),CSS_FORM_BUILDER_BUTTON_DUPLICATE=getCN(FORM,i,d,DUPLICATE),CSS_FORM_BUILDER_BUTTON_EDIT=getCN(FORM,i,d,EDIT),CSS_FORM_BUILDER_BUTTON_SAVE=getCN(FORM,i,d,SAVE),CSS_FORM_BUILDER_DEFAULT_MESSAGE=getCN(FORM,i,DEFAULT,MESSAGE),CSS_FORM_BUILDER_DRAG_CONTAINER=getCN(FORM,i,DRAG,CONTAINER),CSS_FORM_BUILDER_DRAG_NODE=getCN(FORM,i,DRAG,NODE),CSS_FORM_BUILDER_DROP_ACTIVE=getCN(FORM,i,DROP,j),CSS_FORM_BUILDER_DROP_CONTAINER=getCN(FORM,i,DROP,CONTAINER),CSS_FORM_BUILDER_DROP_NODE=getCN(FORM,i,DROP,NODE),CSS_FORM_BUILDER_DROP_ZONE=getCN(FORM,i,DROP,ZONE),CSS_FORM_BUILDER_FIELD=getCN(FORM,i,FIELD),CSS_FORM_BUILDER_FIELD_BUTTONS=getCN(FORM,i,FIELD,l),CSS_FORM_BUILDER_FIELD_CONTENT=getCN(FORM,i,FIELD,CONTENT),CSS_FORM_BUILDER_FIELD_HIDDEN=getCN(FORM,i,FIELD,HIDDEN),CSS_FORM_BUILDER_FIELD_ICON=getCN(FORM,i,FIELD,ICON),CSS_FORM_BUILDER_FIELD_ICON_TEXT=getCN(FORM,i,FIELD,ICON,TEXT),CSS_FORM_BUILDER_FIELD_OVER=getCN(FORM,i,FIELD,OVER),CSS_FORM_BUILDER_FIELD_SELECTED=getCN(FORM,i,FIELD,SELECTED),CSS_FORM_BUILDER_HELPER=getCN(FORM,i,HELPER),CSS_FORM_BUILDER_ICON=getCN(FORM,i,ICON),CSS_FORM_BUILDER_INACTIVE=getCN(FORM,i,INACTIVE),CSS_FORM_BUILDER_LABEL=getCN(FORM,i,LABEL),CSS_FORM_BUILDER_PLACEHOLDER=getCN(FORM,i,PLACEHOLDER),CSS_FORM_BUILDER_SETTINGS=getCN(FORM,i,SETTINGS),CSS_FORM_BUILDER_SETTINGS_BUTTONS=getCN(FORM,i,SETTINGS,l),CSS_FORM_BUILDER_TABS_CONTAINER=getCN(FORM,i,TABS,CONTAINER),CSS_TABVIEW_CONTENT=getCN(TABVIEW,CONTENT),CSS_TABVIEW_LIST=getCN(TABVIEW,LIST),CSS_ICON=getCN(ICON),CSS_WIDGET=getCN(WIDGET),TPL_DEFAULT_MESSAGE='<li class="'+CSS_FORM_BUILDER_DEFAULT_MESSAGE+'"></li>',TPL_DRAG_CONTAINER='<ul class="'+CSS_FORM_BUILDER_DRAG_CONTAINER+'"></ul>',TPL_DRAG_NODE='<li class="'+[CSS_FORM_BUILDER_DRAG_NODE,CSS_FORM_BUILDER_FIELD].join(SPACE)+'" data-key="{key}">'+'<span class="'+[CSS_FORM_BUILDER_ICON,CSS_ICON].join(SPACE)+' {icon}"></span>'+'<span class="'+CSS_FORM_BUILDER_LABEL+'">{label}</span>'+"</li>",TPL_DROP_CONTAINER='<ul class="'+[CSS_FORM_BUILDER_DROP_CONTAINER].join(SPACE)+'"></ul>',TPL_FIELD_BOUNDING_BOX='<li class="'+[CSS_WIDGET,CSS_COMPONENT,CSS_FORM_BUILDER_FIELD,CSS_HELPER_HIDDEN].join(SPACE)+'"></li>',TPL_HELPER='<div class="'+CSS_FORM_BUILDER_HELPER+'"></div>',TPL_PLACEHOLDER='<li class="'+CSS_FORM_BUILDER_PLACEHOLDER+'"></li>',TPL_TABS='<div class="'+CSS_FORM_BUILDER_TABS_CONTAINER+'"></div>',TPL_TABS_CONTENT='<div class="'+CSS_TABVIEW_CONTENT+'"></div>',TPL_TABS_LIST='<ul class="'+CSS_TABVIEW_LIST+'"></ul>',TPL_SETTINGS='<form class="'+CSS_FORM_BUILDER_SETTINGS+'"></form>',TPL_SETTINGS_BUTTONS='<div class="yui3-aui-button-row">'+'<span class="yui3-aui-button yui3-aui-button-submit yui3-aui-state-positive yui3-aui-priority-primary">'+'<span class="yui3-aui-button-content">'+'<input type="button" value="Save" class="yui3-aui-button-input yui3-aui-form-builder-button-save">'+"</span>"+"</span>"+'<span class="yui3-aui-button yui3-aui-button-submit yui3-aui-state-positive yui3-aui-priority-secondary">'+'<span class="yui3-aui-button-content">'+'<input type="button" value="Close" class="yui3-aui-button-input yui3-aui-form-builder-button-close">'+"</span>"+"</span>"+"</div>",TAB_INDEX_DRAG=0,TAB_INDEX_SETTINGS=1,DEFAULT_ICON_CLASS=[CSS_FORM_BUILDER_FIELD_ICON,CSS_FORM_BUILDER_FIELD_ICON_TEXT].join(SPACE),INVALID_CLONE_ATTRS=[B,CONTENT_BOX,SRC_NODE,FIELDS,ID,SELECTED,TEMPLATE_NODE,LABEL_NODE,NAME],INVALID_DBCLICK_TARGETS="button,input,label,select,textarea";var a=function(){};a.ATTRS={fields:{value:[],setter:"_setFields",getter:function(A){return A||[];
},validator:n}};p.mix(a.prototype,{addField:function(D){var A=this;var C=A.get(FIELDS);C=A._removeFromParent(D);C.push(D);A.set(FIELDS,C);},addFields:function(C){var A=this;p.Array.each(A._normalizeFields(C),p.bind(A.addField,A));},contains:function(G,C){var A=this;var F=A.get(FIELDS);if(C){for(var D=0;D<F.length;D++){var E=F[D];if((E==G)||E.contains(G,C)){return true;}}}return(A.indexOf(G)>-1);},getField:function(C){var A=this;var D=A.get(FIELDS);return D[C];},indexOf:function(D){var A=this;var C=A.get(FIELDS);return p.Array.indexOf(C,D);},insertField:function(C,E){var A=this;var D=A.get(FIELDS);D=A._removeFromParent(E);D.splice(C,0,E);A.set(FIELDS,D);},removeField:function(D){var A=this;var C=A.get(FIELDS);C=A._removeFromParent(D);D.removeTarget(A);A.set(FIELDS,C);},removeFields:function(C){var A=this;p.Array.each(A._normalizeFields(C),p.bind(A.removeField,A));},_getFormBuilder:function(){return(this.get(FORM_BUILDER)||this);},_getRenderedField:function(C,E){var A=this;var D=A._getFormBuilder();if(!z(E)){E=D._renderField(A,C,E);}E.addTarget(D);E.set(PARENT,A);return E;},_normalizeFields:function(F){var A=this;var D=[];var E=A._getFormBuilder();var G=E.get(x);var C=E.uniqueFields;F=p.Array(F);p.Array.each(F,function(J,I){J=A._getRenderedField(I,J);var H=J.get(KEY);var K=J.get(UNIQUE);if(K&&!C.containsKey(H)){C.add(H,J);}if(K&&C.contains(J)){D.push(J);}else{if(K&&!C.contains(J)){J.destroy();}else{D.push(J);}}});return D;},_removeFromParent:function(E){var A=this;var D=A.get(FIELDS);if(z(E)){var C=E.get(PARENT);if(C&&C!=A){C.removeField(E);}else{if(A.contains(E)){p.Array.removeItem(D,E);}}}return D;},_setFields:function(C){var A=this;return A._normalizeFields(C);}});p.FormBuilderFieldSupport=a;var s=p.Component.create({NAME:FORM_BUILDER,ATTRS:{autoSelectFields:{value:false},availableFields:{lazyAdd:false,value:[],validator:n,setter:function(A){p.each(A,function(D,C){D.key=D.key||C;});return A;}},enableEditing:{value:true},nestedList:{setter:function(D){var A=this;var C=p.merge({dd:{plugins:[{cfg:{horizontal:false,scrollDelay:30},fn:p.Plugin.DDWinScroll}]},dropCondition:function(F){var G=false;var E=F.drop.get(NODE);var H=E.getData(FIELD);if(H&&H.get(r)){G=true;}return G;},dropOn:DOT+CSS_FORM_BUILDER_DROP_ZONE,placeholder:p.Node.create(TPL_PLACEHOLDER),sortCondition:function(F){var E=A.get(DROP_CONTAINER_NODE);return E.contains(F.drop.get(NODE));}},D);return C;},value:{}},strings:{value:{defaultMessage:"Drop a field here",emptySelection:"No field selected",type:"Type"}},defaultMessageNode:{valueFn:function(){return p.Node.create(TPL_DEFAULT_MESSAGE);}},dragContainerNode:{valueFn:function(){return p.Node.create(TPL_DRAG_CONTAINER);}},dragNodesList:{setter:function(A){p.each(A,function(D,C){D.setData(INDEX,C);});},valueFn:"_valueDragNodesList"},dropContainerNode:{valueFn:function(){return p.Node.create(TPL_DROP_CONTAINER);}},settingsButtonsNode:{valueFn:function(){return p.Node.create(TPL_SETTINGS_BUTTONS);}},settingsFormNode:{valueFn:function(){return p.Node.create(TPL_SETTINGS);}},tabsNode:{valueFn:function(){return p.Node.create(TPL_TABS);}},tabsContentNode:{valueFn:function(){return p.Node.create(TPL_TABS_CONTENT);}},tabsListNode:{valueFn:function(){return p.Node.create(TPL_TABS_LIST);}}},AUGMENTS:[p.FormBuilderFieldSupport],HTML_PARSER:{defaultMessageNode:DOT+CSS_FORM_BUILDER_DEFAULT_MESSAGE,dragContainerNode:DOT+CSS_FORM_BUILDER_DRAG_CONTAINER,dragNodesList:function(C){var A=C.all(DOT+CSS_FORM_BUILDER_DRAG_NODE);return(A.size()<=0)?null:A;},dropContainerNode:DOT+CSS_FORM_BUILDER_DROP_CONTAINER,settingsFormNode:FORM+DOT+CSS_FORM_BUILDER_SETTINGS,settingsButtonsNode:DOT+CSS_FORM_BUILDER_SETTINGS_BUTTONS,tabsNode:DOT+CSS_FORM_BUILDER_TABS_CONTAINER,tabsContentNode:DOT+CSS_TABVIEW_CONTENT,tabsListNode:DOT+CSS_TABVIEW_LIST},EXTENDS:p.Widget,prototype:{initializer:function(){var A=this;A.boundingBox=A.get(B);A.dragContainerNode=A.get(DRAG_CONTAINER_NODE);A.dragNodesList=A.get(DRAG_NODES_LIST);A.dropContainerNode=A.get(DROP_CONTAINER_NODE);A.settingsButtonsNode=A.get(SETTINGS_BUTTONS_NODE);A.settingsFormNode=A.get(SETTINGS_FORM_NODE);A.tabsNode=A.get(TABS_NODE);A.tabsContentNode=A.get(TABS_CONTENT_NODE);A.tabsListNode=A.get(TABS_LIST_NODE);A._dragNestedList=new p.NestedList(A.get(NESTED_LIST));A._dropNestedList=new p.NestedList(A.get(NESTED_LIST));A._tabs=new p.TabView({boundingBox:A.tabsNode,contentNode:A.tabsContentNode,listNode:A.tabsListNode});if(!A.tabsContentNode.inDoc()){A._tabs.set(ITEMS,[{label:"Add a field",contentNode:A.dragContainerNode},{label:"Field settings",content:A.settingsFormNode}]);}},renderUI:function(){var A=this;A.dragNodesList.appendTo(A.dragContainerNode);A._tabs.render();},bindUI:function(){var A=this;var D=A.boundingBox;var C=A.dropContainerNode;var E=A.settingsButtonsNode;A._dragNestedList.on("drag:end",p.bind(A._onDragEndDragNestedList,A));A._dragNestedList.on("drag:start",p.bind(A._onDragStartDragNestedList,A));A._dropNestedList.on("drag:end",p.bind(A._onDragEndDropNestedList,A));A._tabs.after("activeTabChange",p.bind(A._afterActiveTabChange,A));A.uniqueFields.after("add",p.bind(A._afterUniqueFieldsAdd,A));A.uniqueFields.after("remove",p.bind(A._afterUniqueFieldsRemove,A));C.delegate("click",p.bind(A._onClickFieldDelete,A),DOT+CSS_FORM_BUILDER_BUTTON_DELETE);C.delegate("click",p.bind(A._onClickFieldDuplicate,A),DOT+CSS_FORM_BUILDER_BUTTON_DUPLICATE);C.delegate("click",p.bind(A._onClickFieldEdit,A),DOT+CSS_FORM_BUILDER_BUTTON_EDIT);C.delegate("dblclick",p.bind(A._onDbClickField,A),DOT+CSS_FORM_BUILDER_FIELD);C.delegate("mouseenter",p.bind(A._onMouseEnterField,A),DOT+CSS_FORM_BUILDER_FIELD);C.delegate("mouseleave",p.bind(A._onMouseLeaveField,A),DOT+CSS_FORM_BUILDER_FIELD);E.delegate("click",p.bind(A._onClickSettingsButton,A),DOT+CSS_BUTTON_INPUT);A.after("*:fieldsChange",p.bind(A._afterFieldsChange,A));A.after("*:selectedChange",p.bind(A._afterSelectedChange,A));},syncUI:function(){var A=this;A.syncFieldsUI();A._syncDefaultMessage();A._syncUniqueFields();A._syncNestedList();
},uniqueFields:new p.DataSet(),appendFields:function(D,C){var A=this;C.setContent(EMPTY_STR);p.each(D,function(F){var E=F.get(FIELDS);C.append(F.get(B));A.appendFields(E,F.get(DROP_ZONE_NODE));});},duplicateField:function(F){var A=this;var C=F.get(PARENT);var D=C.indexOf(F);var E=A._cloneField(F,true);C.insertField(++D,E);},selectField:function(D){var A=this;D.set(SELECTED,true);var C=A.settingsFormNode.one(INPUT);if(C){C.focus();C.select();}A._tabs.selectTab(TAB_INDEX_SETTINGS);},syncFieldsUI:function(D){var A=this;var E=A.get(FIELDS);var C=A.get(DROP_CONTAINER_NODE);if(D&&z(D.target)){var F=D.target;E=F.get(FIELDS);C=F.get(DROP_ZONE_NODE);}A.appendFields(E,C);},_afterActiveTabChange:function(F){var A=this;var E=A.selectedField;var C=A.get(SETTINGS_FORM_NODE);var D=A.get(SETTINGS_BUTTONS_NODE);var G=A.get(STRINGS);var H=A.contains(E,true);if(!H){C.setContent(G[EMPTY_SELECTION]);}D.toggleClass(CSS_HELPER_HIDDEN,!H);},_afterFieldsChange:function(){var A=this;A.syncUI();},_afterSelectedChange:function(D){var A=this;var E=D.target;var C=A.selectedField;A._syncSelectedFieldUI(E);if(E.get(SELECTED)){A.selectedField=E;if(C&&C!=E){C.set(SELECTED,false);}E.renderSettings();}},_afterUniqueFieldsAdd:function(E){var C=this;var D=E.attrName;var A=C._getDragNodeByKey(D);A.addClass(CSS_FORM_BUILDER_INACTIVE);A.unselectable();},_afterUniqueFieldsRemove:function(E){var C=this;var D=E.attrName;var A=C._getDragNodeByKey(D);A.removeClass(CSS_FORM_BUILDER_INACTIVE);A.selectable();},_cloneField:function(G,C){var A=this;var F=G.get(TYPE);var E={};p.each(G.getAttrs(),function(I,H){if(p.Array.indexOf(INVALID_CLONE_ATTRS,H)===-1&&!v(I)){E[H]=I;}});if(C){var D=[];p.each(G.get(FIELDS),function(H){D.push(A._cloneField(H,C));});E[FIELDS]=D;}E[TYPE]=F;return E;},_dropField:function(D){var I=this;var E=D.get(PARENT_NODE);var A=E.all("> "+DOT+CSS_FORM_BUILDER_FIELD);var H=D.getData(FIELD);var C=I.get(DEFAULT_MESSAGE_NODE);if(C.inDoc()){C.remove();}var J=I._getFieldParentByNode(D);var F=A.indexOf(D);if(!H){var G=I.get(x);H=G[D.getData(INDEX)];D.remove();}J.insertField(F,H);return J.getField(F);},_getDragNodeByKey:function(D){var A=this;var E=A.get(DRAG_NODES_LIST);var F=A.get(x);for(var C=0;C<F.length;C++){if(D==F[C].key){return E.item(C);}}return null;},_getFieldInstance:function(C,E){var A=this;var E=E||C.type;var D=p.FormBuilder.types;var F=c(E)?D[E]:E;if(F!==undefined){return new F(C);}else{p.log("The field type: ["+E+"] couldn't be found.");}return null;},_getFieldParentByNode:function(C){var A=this;var D=C.ancestor(DOT+CSS_FORM_BUILDER_FIELD);if(D){return D.getData(FIELD);}return A;},_getFieldParentNode:function(D){var A=this;var C=D.get(PARENT);if(z(C)){return C.get(B);}return A.get(DROP_CONTAINER_NODE);},_onClickFieldDelete:function(D){var A=this;var G=D.currentTarget;var E=G.ancestor(DOT+CSS_FORM_BUILDER_FIELD);var F=E.getData(FIELD);if(z(F)){var C=A.selectedField;if(F==C||F.contains(C,true)){A._tabs.selectTab(TAB_INDEX_DRAG);}F.set(SELECTED,false);F.get(PARENT).removeField(F);}},_onClickFieldDuplicate:function(C){var A=this;var F=C.currentTarget;var D=F.ancestor(DOT+CSS_FORM_BUILDER_FIELD);var E=D.getData(FIELD);if(E){A.duplicateField(E);}},_onClickFieldEdit:function(C){var A=this;var F=C.currentTarget;var D=F.ancestor(DOT+CSS_FORM_BUILDER_FIELD);var E=D.getData(FIELD);if(E){A.selectField(E);}},_onClickSettingsButton:function(D){var A=this;var E=D.currentTarget;if(E.hasClass(CSS_FORM_BUILDER_BUTTON_SAVE)){var C=A.selectedField;if(C){C.saveSettings();}}A._tabs.selectTab(TAB_INDEX_DRAG);},_onDbClickField:function(C){var A=this;var E=C.target;if(E.test(INVALID_DBCLICK_TARGETS)){C.stopPropagation();return false;}if(!E.getData(FIELD)){E=E.ancestor(DOT+CSS_FORM_BUILDER_FIELD);}if(E){var D=E.getData(FIELD);if(D){A.selectField(D);}}return false;},_onDragEndDragNestedList:function(G){var C=this;var F=G.target;var A=F.get(NODE);var E=C.dragContainerNode;var D=C.dropContainerNode;var I=D.one(DOT+CSS_FORM_BUILDER_DRAG_NODE);if(I){var H=C._dropField(I);if(C.get(y)){C.selectField(H);}}else{F.set(NODE,C.originalNode);}if(E.contains(A)&&E.contains(C.originalNode)){A.remove();}},_onDragEndDropNestedList:function(E){var C=this;var D=E.target;var A=D.get(NODE);if(A.hasClass(CSS_FORM_BUILDER_FIELD)){C._dropField(A);}},_onDragStartDragNestedList:function(G){var C=this;var F=G.target;var A=F.get(NODE);var D=A.getData(INDEX);var H=A.clone();A.placeBefore(H);H.setData(INDEX,D);F.set(NODE,H);H.attr(ID,EMPTY_STR);H.hide();A.removeClass(CSS_DD_DRAGGING);A.show();C.originalNode=A;var E=p.merge(C.get(NESTED_LIST),{nodes:H});(new p.NestedList(E));},_onMouseEnterField:function(C){var A=this;var D=C.currentTarget;var E=D.getData(FIELD);if(E){A._toggleFieldButtonsNode(E,true);}},_onMouseLeaveField:function(C){var A=this;var D=C.currentTarget;var E=D.getData(FIELD);var F=false;if(E){if(E.get(SELECTED)){F=true;}A._toggleFieldButtonsNode(E,F);}},_renderField:function(C,D,F){var A=this;var G=C.get(DROP_CONTAINER_NODE);if(z(C)){G=C.get(DROP_ZONE_NODE);}var E=p.Node.create(TPL_FIELD_BOUNDING_BOX);var H=C.get(FIELDS);if(H.length>0){G.insert(E,D);}else{G.append(E);}F=p.merge(F,{boundingBox:E,key:F.key,formBuilder:A,render:true,after:{render:function(){E.removeClass(CSS_HELPER_HIDDEN);}}});if(F.disabled===undefined){F.disabled=!A.get(ENABLE_EDITING);}return A._getFieldInstance(F);},_syncDefaultMessage:function(){var A=this;if(!A.dropContainerNode.hasChildNodes()){var C=A.get(STRINGS);var D=A.get(DEFAULT_MESSAGE_NODE);D.setContent(C[DEFAULT_MESSAGE]);A.dropContainerNode.append(D);}},_syncNestedList:function(){var A=this;var D=A.get(x);var C=A.uniqueFields;A._syncNodes();A.dragNodes.each(function(F,E){var G=D[E];if(!C.containsKey(G.key)){A._dragNestedList.add(F);}});A._dropNestedList.addAll(A.dropNodes);},_syncNodes:function(){var A=this;var D=A.dragContainerNode;var C=A.dropContainerNode;A.dragNodes=D.all(DOT+CSS_FORM_BUILDER_FIELD);A.dropNodes=C.all([DOT+CSS_FORM_BUILDER_FIELD,DOT+CSS_FORM_BUILDER_DEFAULT_MESSAGE].join(k));},_syncSelectedFieldUI:function(F){var A=this;
var E=F.get(SELECTED);var D=F.get(B);var C=A.selectedField;D.toggleClass(CSS_FORM_BUILDER_FIELD_SELECTED,E);if(!E&&F.contains(C)){E=true;}A._toggleFieldButtonsNode(F,E);},_syncUniqueFields:function(){var A=this;var E=A.get(x);var D=A.get(FIELDS);var C=A.uniqueFields;C.each(function(F,G){if(!A.contains(F,true)){C.remove(F);}});p.each(E,function(H,F){if(H.unique){var G=H.key;p.each(D,function(J){if(J.get(KEY)==G){var I=p.merge(A._cloneField(J,false),H);J.set(READ_ONLY_ATTRIBUTES,I.readOnlyAttributes);J.set(UNIQUE,true);E[F]=I;C.add(G,J);}});}});},_toggleFieldButtonsNode:function(D,E){var A=this;var C=D.get(e);if(C){C.toggleClass(CSS_HELPER_HIDDEN,!E);}},_valueDragNodesList:function(){var A=this;var D=A.get(x);var C=[];p.each(D,function(F,E,G){C.push(p.substitute(TPL_DRAG_NODE,{icon:F.iconClass||DEFAULT_ICON_CLASS,label:F.label,key:F.key||E,type:F.type,unique:F.unique}));});return p.NodeList.create(C.join(EMPTY_STR));}}});p.FormBuilder=s;p.FormBuilder.types={};},"@VERSION@",{requires:["aui-base","aui-button-item","aui-nested-list","aui-tabs","substitute"],skinnable:true});AUI.add("aui-form-builder-field",function(bL){var bF=bL.Lang,aG=bF.isArray,ah=bF.isString,c="acceptChildren",az="boundingBox",bU="builder",b2="button",C="buttons",b7="buttonsNode",bf="checkbox",D="checked",cc="children",bY="clearfix",aA="close",aC="component",b6="contentBox",ba="container",n="dataType",y="default",aI="delete",bp="disabled",bz=".",aS="drag",bj="dragContainer",b8="dragContainerNode",ad="dragNodesList",ar="drop",aK="dropContainer",a4="dropContainerNode",W="dropNode",aB="dropZone",aZ="dropZoneNode",bh="duplicate",G="edit",bo="",a5="field",f="fields",bv="for",r="form",aQ="formBuilder",be="form-builder-field",o="helper",am="hidden",q="icon",bX="id",aa="label",Y="labelNode",aX="metadata",at="name",ce="node",a="panel",aR="portalLayout",a9="predefinedValue",a6="proxy",bR="readOnlyAttributes",aj="required",bq="state",a1="settings",ak="settingsFormNode",bP="showLabel",ao="size",P=" ",ai="string",ae="strings",bN="templateNode",bs="text",O="type",bg="unique",bC="zone",aJ="widget",w=bL.getClassName,a3=w(aC),bc=w(a5,aa),ca=w(o,bY),V=w(o,am),by=w(bq,y),b=w(a5),bb=w(a5,bs),x=w(r,bU,b2),an=w(r,bU,b2,aI),aW=w(r,bU,b2,bh),H=w(r,bU,b2,G),cd=w(r,bU,q),i=w(r,bU,q,aI),t=w(r,bU,q,bh),bH=w(r,bU,q,G),bu=w(r,bU,a5),bi=w(r,bU,a5,C),a0=w(r,bU,ar,ce),bD=w(r,bU,ar,bC),br=w(r,bU,bg),bW=w(aJ),bJ='<li class="'+[bW,a3,bu].join(P)+'"></li>',l='<div class="'+[bi,V].join(P)+'">'+'<a class="'+[x,H].join(P)+'" href="javascript:;" title="Edit">'+'<div class="'+[cd,bH].join(P)+'"></div>'+"</a>"+'<a class="'+[x,aW].join(P)+'" href="javascript:;" title="Duplicate">'+'<div class="'+[cd,t].join(P)+'"></div>'+"</a>"+'<a class="'+[x,an].join(P)+'" href="javascript:;" title="Delete">'+'<div class="'+[cd,i].join(P)+'"></div>'+"</a>"+"</div>",bZ='<div class="'+ca+'"></div>',U='<ul class="'+bD+'"></ul>',ab='<span class="'+[b,bb].join(P)+'"></span>',aO='<label class="'+bc+'"></label>',cb="<p></p>";var b9=bL.Component.create({NAME:be,ATTRS:{acceptChildren:{value:true},dataType:{value:ai},disabled:{value:false},key:{value:bo},formBuilder:{value:undefined},id:{value:bo},icon:{value:bo},label:{value:bo},name:{valueFn:function(){var A=this;return A.get(O)+(++bL.Env._uidx);}},parent:{value:null},predefinedValue:{value:bo},readOnlyAttributes:{value:[],validator:aG},required:{setter:bL.DataType.Boolean.parse,value:false},selected:{setter:bL.DataType.Boolean.parse,value:false},showLabel:{setter:bL.DataType.Boolean.parse,value:true},template:{value:bo},type:{value:bo},unique:{setter:bL.DataType.Boolean.parse,value:false},buttonsNode:{valueFn:function(){return bL.Node.create(l);}},dropZoneNode:{valueFn:function(){return bL.Node.create(U);}},labelNode:{valueFn:function(){return bL.Node.create(aO);}},templateNode:{valueFn:"getNode"}},AUGMENTS:[bL.FormBuilderFieldSupport],UI_ATTRS:[c,bp,aa,at,a9,bP,bg],HTML_PARSER:{buttonsNode:bz+bi,dropZoneNode:bz+bD,labelNode:aa+bz+bc},prototype:{BOUNDING_TEMPLATE:bJ,initializer:function(){var A=this;A.get(az).setData(a5,A);},bindUI:function(){var A=this;},renderUI:function(){var A=this;var ci=A.get(az);var cj=A.get(b7);var L=A.get(b6);var ch=A.get(Y);var cg=A.get(bN);if(!ci.contains(cj)){ci.prepend(cj);}if(!L.contains(ch)){L.append(ch);ch.setAttribute(bv,cg.get(bX));}if(!L.contains(cg)){L.append(cg);}},settingsNodesMap:{},saveSettings:function(){var A=this;var L=A.get(aQ);var cg=L.get(ak);bL.Array.each(bL.io._serialize(cg._node).split("&"),function(ch){var ci=ch.split("=");A.set(ci[0],decodeURIComponent(ci[1]));});},renderSettings:function(){var co=this;var ci=co.get(aQ);var cg=ci.get(ak);var cp=ci.get(ae);var cj=co.settingsNodesMap;if(!co.fieldSettingsNode){co.fieldSettingsNode=bL.Node.create(bZ);var cn=bL.Node.create(bZ);var cl=bL.Node.create(ab);var cm=bL.Node.create(aO);var A=bL.Node.create(cb);cm.setContent(cp[O]);A.setContent(co.get(n)||co.get(O));cl.append(cm);cl.append(A);cl.appendTo(cn);co._renderSettingsFields([{type:"text",name:aa,labelText:"Label",value:co.get(aa)},{type:"checkbox",name:bP,labelText:"Show label",labelAlign:"left",value:co.get(bP)},{type:"text",name:at,labelText:"Name",value:co.get(at)},{type:"text",name:a9,labelText:"Default value",value:co.get(a9)},{type:"checkbox",name:aj,labelText:"Required",labelAlign:"left",value:aj}],cn);var ch=cj["labelSettingNode"];ch.on({input:bL.bind(co._onLabelInput,co)});var L=cj["showLabelSettingNode"];L.set(D,co.get(bP));L.on({change:bL.bind(co._onSettingsFieldChange,co)});var ck=cj["requiredSettingNode"];ck.set(D,co.get(aj));ck.on({change:bL.bind(co._onSettingsFieldChange,co)});co.propertiesPanel=new bL.Panel({bodyContent:cn,collapsible:true,title:"Properties"}).render();co.fieldSettingsNode.append(co.propertiesPanel.get(az));}cg.setContent(co.fieldSettingsNode);},getHTML:function(){},getNode:function(){},_onLabelInput:function(L){var A=this;var ch=L.target;var cg=ch.val();A.set(aa,cg);},_onSettingsFieldChange:function(L){var A=this;var ch=L.target;var cg=ch.val();if(ch.get(O)==bf){cg=ch.get(D);
}A.set(ch.get(at),cg);},_renderSettingsFields:function(ch,cg){var A=this;var L=A.get(bR);bL.each(ch,function(cj){var ck;if(bL.Array.indexOf(L,cj.name)>-1){cj.disabled=true;}if(cj.type=="select"){ck=new bL.Select(cj);}else{ck=new bL.Field(cj);}ck.render(cg);var ci=ck.get(ce);if(cj.type==bf){ci.set(D,cj.value);}A.settingsNodesMap[cj.name+"SettingNode"]=ci;});},_uiSetAcceptChildren:function(ci){var A=this;var cg=A.get(az);var ch=A.get(aZ);var L=cg.one(bz+bD);if(ci&&!L){cg.append(ch);}else{if(!ci&&L){L.remove();}else{if(ci&&L){A.set(aZ,L);}}}},_uiSetDisabled:function(cg){var A=this;var L=A.get(bN);if(cg){L.setAttribute(bp,cg);}else{L.removeAttribute(bp);}},_uiSetLabel:function(cg){var A=this;var L=A.get(Y);L.setContent(cg);},_uiSetName:function(cg){var A=this;var L=A.get(bN);L.set(at,cg);},_uiSetPredefinedValue:function(cg){var A=this;var L=A.get(bN);L.val(cg);},_uiSetShowLabel:function(cg){var A=this;var L=A.get(Y);L.toggleClass(V,!cg);},_uiSetUnique:function(ch){var A=this;var L=A.get(az);var cg=A.get(b7);L.toggleClass(br,ch);cg.one(bz+aW).toggleClass(V,ch);}}});bL.FormBuilderField=b9;bL.FormBuilder.types["field"]=bL.FormBuilderField;var bF=bL.Lang,aG=bF.isArray,bl=bF.isNumber,ah=bF.isString,av=function(A){return(A instanceof bL.Node);},aP=function(A){return(A instanceof bL.NodeList);},aV=bL.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),az="boundingBox",b2="button",b0="buttonType",b6="contentBox",ba="container",bz=".",aS="drag",bj="dragContainer",b8="dragContainerNode",ad="dragNodesList",ar="drop",aK="dropContainer",a4="dropContainerNode",bo="",a5="field",f="fields",be="form-builder-field",ag="form-builder-button-field",bX="id",q="icon",aL="input",aa="label",at="name",ce="node",bQ="option",bO="options",aR="portalLayout",a9="predefinedValue",a6="proxy",bA="reset",aY="selected",bE="selectedIndex",bn="submit",P=" ",ae="strings",bd="template",bN="templateNode",bs="text",O="type",m="value",w=bL.getClassName,aw=w(a5,aL),bT=w(a5,aL,bs),bu=w(be),Q=w(be,ce),by=w(bq,y),bt='<input id="{id}" class="'+[Q,aw].join(P)+'" name="{name}" type="{type}" value="{value}" />',cf=[bn,bA,b2];var S=bL.Component.create({NAME:ag,ATTRS:{acceptChildren:{value:false,readOnly:true},buttonType:{value:bn,validator:function(A){return bL.Array(cf).indexOf(A.toLowerCase())>-1;}},predefinedValue:{value:aV(bn)},showLabel:{value:false},strings:{value:{button:"Button",reset:"Reset",submit:"Submit"}},template:{valueFn:function(){return bt;}}},UI_ATTRS:bL.FormBuilderField.UI_ATTRS.concat([b0]),CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderField,prototype:{getHTML:function(){var A=this;var cg=A.get(bd);var ck=A.get(bX);var ci=A.get(aa);var ch=A.get(at);var L=A.get(b0);var cj=A.get(a9);return bL.substitute(cg,{id:ck,label:ci,name:ch,type:L,value:cj});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},renderSettings:function(){var cl=this;var cg=cl.get(aQ);var L=cg.get(ak);var ck=cl.get(b0);var cm=cl.get(ae);var ch=cl.settingsNodesMap;bL.FormBuilderButtonField.superclass.renderSettings.apply(cl,arguments);if(!cl._renderedButtonSettings){cl._renderedButtonSettings=true;var cj=cl.propertiesPanel.get(d);var cn=[];bL.each(cf,function(co){cn.push({labelText:cm[co],value:co});});cl._renderSettingsFields([{labelText:"Button type",name:b0,options:cn,type:"select"}],cj.item(0));var A=ch["buttonTypeSettingNode"];A.on({change:bL.bind(cl._onButtonTypeChange,cl)});var ci=bL.Array(cf).indexOf(ck);A.all(bQ).item(ci).set(aY,true);}},_onButtonTypeChange:function(L){var A=this;var cg=L.target;A.set(b0,cg.get(m));},_uiSetButtonType:function(cg){var A=this;var L=A.get(bN);L.setAttribute(O,cg);}}});bL.FormBuilderButtonField=S;bL.FormBuilder.types["button"]=bL.FormBuilderButtonField;var bF=bL.Lang,aG=bF.isArray,a2=bF.isBoolean,bl=bF.isNumber,ah=bF.isString,aE="boolean",az="boundingBox",d="bodyContent",bf="checkbox",D="checked",aq="choice",b6="contentBox",ba="container",bz=".",aS="drag",bj="dragContainer",b8="dragContainerNode",ad="dragNodesList",ar="drop",aK="dropContainer",a4="dropContainerNode",bo="",a5="field",f="fields",be="form-builder-field",b3="form-builder-checkbox-field",bX="id",q="icon",aM="inline",aa="label",g="labels",at="name",ce="node",aR="portalLayout",a9="predefinedValue",a6="proxy",ao="size",P=" ",bd="template",bN="templateNode",m="value",w=bL.getClassName,b=w(a5),bB=w(a5,bf),bI=w(a5,aq),bu=w(be),b4=w(be,bf),Q=w(be,ce),by=w(bq,y),ac=w(a5,g,aM),bJ='<li class="'+[bW,a3,bu,b4].join(P)+'"></li>',aD='<input id="{id}" class="'+[Q,b,bB,bI].join(P)+'" name="{name}" type="checkbox" value="{value}" {checked} />';var T=bL.Component.create({NAME:b3,ATTRS:{dataType:{value:aE},predefinedValue:{setter:bL.DataType.Boolean.parse,value:false},template:{valueFn:function(){return aD;}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderField,prototype:{BOUNDING_TEMPLATE:bJ,bindUI:function(){var A=this;bL.FormBuilderCheckBoxField.superclass.bindUI.apply(A,arguments);var L=A.get(bN);L.on({"change":bL.bind(A._onValueChange,A)});},renderUI:function(){var A=this;var L=A.get(b6);var cg=A.get(bN);var ch=A.get(Y);bL.FormBuilderCheckBoxField.superclass.renderUI.apply(A,arguments);ch.insert(cg,ch,"before");},getHTML:function(){var A=this;var L=A.get(bd);var ci=A.get(D);var ck=A.get(bX);var ch=A.get(aa);var cg=A.get(at);var cj=A.get(a9);return bL.substitute(L,{checked:ci?'checked="checked"':bo,id:ck,label:ch,name:cg,value:cj});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},renderSettings:function(){var L=this;var cg=L.get(aQ);var ch=cg.get(ak);var cj=L.settingsNodesMap;bL.FormBuilderCheckBoxField.superclass.renderSettings.apply(L,arguments);if(!L._renderedCheckboxSettings){L._renderedCheckboxSettings=true;cj["predefinedValueSettingNode"].remove();var A=L.propertiesPanel.get(d);L._renderSettingsFields([{type:"checkbox",name:a9,labelText:"Checked",labelAlign:"left"}],A.item(0));var ci=cj["predefinedValueSettingNode"];ci.on({change:bL.bind(L._onValueChange,L)});
ci.set(D,L.get(a9));}},_onValueChange:function(L){var A=this;var cg=L.target;A.set(a9,cg.get(D));},_uiSetPredefinedValue:function(ch){var A=this;var L=A.get(bN);var ci=A.settingsNodesMap;var cg=ci["predefinedValueSettingNode"];if(cg){cg.set(D,ch);}L.set(D,ch);}}});bL.FormBuilderCheckBoxField=T;bL.FormBuilder.types["checkbox"]=bL.FormBuilderCheckBoxField;var bF=bL.Lang,aG=bF.isArray,bl=bF.isNumber,ah=bF.isString,av=function(A){return(A instanceof bL.Node);},aP=function(A){return(A instanceof bL.NodeList);},az="boundingBox",b6="contentBox",ba="container",n="dataType",bz=".",ar="drop",bo="",a5="field",f="fields",be="form-builder-field",B="form-builder-fieldset-field",bX="id",q="icon",aa="label",at="name",ce="node",a9="predefinedValue",P=" ",ae="strings",bd="template",bN="templateNode",bs="text",O="type",m="value",bC="zone",w=bL.getClassName,bu=w(be),Q=w(be,ce),bD=w(r,bU,ar,bC),a8='<fieldset id="{id}" class="'+[Q].join(P)+'"></fieldset>',j='<legend class="'+bc+'"></legend>';var u=bL.Component.create({NAME:B,ATTRS:{acceptChildren:{value:true,readOnly:true},dataType:{value:undefined},template:{valueFn:function(){return a8;}},labelNode:{valueFn:function(){return bL.Node.create(j);}},templateNode:{valueFn:"getNode"}},UI_ATTRS:[c,aa,bP],CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderField,prototype:{CONTENT_TEMPLATE:a8,renderUI:function(){var A=this;var ci=A.get(az);var cj=A.get(b7);var L=A.get(b6);var ch=A.get(Y);var cg=A.get(bN);if(!ci.contains(cj)){ci.prepend(cj);}if(!L.contains(ch)){L.append(ch);}},getHTML:function(){var A=this;var L=A.get(bd);var cg=A.get(bX);return bL.substitute(L,{id:cg});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},renderSettings:function(){var cn=this;var ci=cn.get(aQ);var cg=ci.get(ak);var co=ci.get(ae);var cj=cn.settingsNodesMap;if(!cn._renderedFieldsetSettings){cn._renderedFieldsetSettings=true;cn.fieldSettingsNode=bL.Node.create(bZ);var cm=bL.Node.create(bZ);var ck=bL.Node.create(ab);var cl=bL.Node.create(aO);var A=bL.Node.create(cb);cl.setContent(co[O]);A.setContent(cn.get(n)||cn.get(O));ck.append(cl);ck.append(A);ck.appendTo(cm);cn._renderSettingsFields([{type:"text",name:aa,labelText:"Label",value:cn.get(aa)},{type:"checkbox",name:bP,labelText:"Show label",labelAlign:"left",value:cn.get(bP)}],cm);var ch=cj["labelSettingNode"];ch.on({input:bL.bind(cn._onLabelInput,cn)});var L=cj["showLabelSettingNode"];L.set(D,cn.get(bP));L.on({change:bL.bind(cn._onSettingsFieldChange,cn)});cn.propertiesPanel=new bL.Panel({bodyContent:cm,collapsible:true,title:"Properties"}).render();cn.fieldSettingsNode.append(cn.propertiesPanel.get(az));}cg.setContent(cn.fieldSettingsNode);},_uiSetAcceptChildren:function(ci){var A=this;var L=A.get(b6);var ch=A.get(aZ);var cg=L.one(bz+bD);if(ci&&!cg){L.append(ch);}else{if(!ci&&cg){cg.remove();}else{if(ci&&cg){A.set(aZ,cg);}}}}}});bL.FormBuilderFieldsetField=u;bL.FormBuilder.types["fieldset"]=bL.FormBuilderFieldsetField;var bF=bL.Lang,aG=bF.isArray,bl=bF.isNumber,ah=bF.isString,av=function(A){return(A instanceof bL.Node);},aP=function(A){return(A instanceof bL.NodeList);},az="boundingBox",b6="contentBox",ba="container",n="dataType",bz=".",bo="",a5="field",f="fields",be="form-builder-field",b5="form-builder-file-upload-field",bX="id",q="icon",aa="label",at="name",ce="node",a9="predefinedValue",P=" ",ae="strings",bd="template",bN="templateNode",bs="text",O="type",m="value",w=bL.getClassName,bu=w(be),Q=w(be,ce),by=w(bq,y),bm='<input id="{id}" class="'+[Q].join(P)+'" name="{name}" type="file" value="{value}" />';var E=bL.Component.create({NAME:b5,ATTRS:{template:{valueFn:function(){return bm;}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderField,prototype:{getHTML:function(){var A=this;var L=A.get(bd);var ck=A.get(bX);var ch=A.get(aa);var cg=A.get(at);var ci=A.get(ao);var cj=A.get(a9);return bL.substitute(L,{id:ck,label:ch,name:cg,value:cj});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},renderSettings:function(){var cn=this;var ci=cn.get(aQ);var cg=ci.get(ak);var co=ci.get(ae);var cj=cn.settingsNodesMap;if(!cn._renderedFileUploadSettings){cn._renderedFileUploadSettings=true;cn.fieldSettingsNode=bL.Node.create(bZ);var cm=bL.Node.create(bZ);var ck=bL.Node.create(ab);var cl=bL.Node.create(aO);var A=bL.Node.create(cb);cl.setContent(co[O]);A.setContent(cn.get(n)||cn.get(O));ck.append(cl);ck.append(A);ck.appendTo(cm);cn._renderSettingsFields([{type:"text",name:aa,labelText:"Label",value:cn.get(aa)},{type:"checkbox",name:bP,labelText:"Show label",labelAlign:"left",value:cn.get(bP)},{type:"text",name:at,labelText:"Name",value:cn.get(at)},{type:"checkbox",name:aj,labelText:"Required",labelAlign:"left",value:cn.get(aj)}],cm);var ch=cj["labelSettingNode"];ch.on({input:bL.bind(cn._onLabelInput,cn)});var L=cj["showLabelSettingNode"];L.set(D,cn.get(bP));L.on({change:bL.bind(cn._onSettingsFieldChange,cn)});cn.propertiesPanel=new bL.Panel({bodyContent:cm,collapsible:true,title:"Properties"}).render();cn.fieldSettingsNode.append(cn.propertiesPanel.get(az));}cg.setContent(cn.fieldSettingsNode);}}});bL.FormBuilderFileUploadField=E;bL.FormBuilder.types["fileupload"]=bL.FormBuilderFileUploadField;var bF=bL.Lang,aG=bF.isArray,bl=bF.isNumber,ah=bF.isString,av=function(A){return(A instanceof bL.Node);},aP=function(A){return(A instanceof bL.NodeList);},aV=bL.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),I="add",af="addNode",az="boundingBox",b2="button",b0="buttonType",b6="contentBox",ba="container",y="default",al="defaultLabel",s="defaultOptions",z="defaultValue",bz=".",aS="drag",bj="dragContainer",b8="dragContainerNode",ad="dragNodesList",ar="drop",aK="dropContainer",a4="dropContainerNode",bo="",a5="field",f="fields",be="form-builder-field",F="form-builder-multiple-choice-field",q="icon",bX="id",aL="input",Z="item",aa="label",b1="multiple",at="name",ce="node",bQ="option",bk="optionTemplate",bO="options",a9="predefinedValue",a6="proxy",p="remove",bA="reset",bn="submit",P=" ",bd="template",bN="templateNode",bs="text",O="type",m="value",w=bL.getClassName,aw=w(a5,aL),bT=w(a5,aL,bs),k=w(a5,bO,I),M=w(a5,bO,Z),K=w(a5,bO,Z,aL),a7=w(a5,bO,Z,aL,aa),bM=w(a5,bO,Z,aL,m),aU=w(a5,bO,Z,p),bu=w(be),Q=w(be,ce),by=w(bq,y),bx='<div class="'+[M,ac,ca].join(P)+'">'+'<input type="text" class="'+[K,a7,aw,bT].join(P)+'" value="{label}" />'+'<input type="text" class="'+[K,bM,aw,bT].join(P)+'" value="{value}" />'+'<a href="javascript:;" class="'+aU+'">&nbsp;</a>'+"</div>";
TPL_ADD='<a class="'+k+'" href="javascript:;">Add an option</a>',ENTER="ENTER";var aH=bL.Component.create({NAME:bO,ATTRS:{allowClear:{value:false},defaultLabel:{value:bo},defaultValue:{value:bo},disabled:{value:false,validator:a2},options:{value:[],getter:"_getOptions",validator:aG},addNode:{valueFn:function(){return bL.Node.create(TPL_ADD);}}},HTML_PARSER:{addNode:bz+k},UI_ATTRS:[bO,bp],EXTENDS:bL.Widget,prototype:{renderUI:function(){var A=this;var L=A.get(az);var cg=A.get(af);if(!cg.inDoc()){L.append(cg);}},bindUI:function(){var A=this;var L=A.get(az);var cg=A.get(af);cg.on("click",bL.bind(A._onClickAdd,A));L.delegate("click",bL.bind(A._onClickOptionRemove,A),bz+aU);L.delegate("keypress",bL.bind(A._onKeyPressOption,A),bz+K);},add:function(L){var A=this;var cg=A.get(bO);cg.push(L);A.set(bO,cg);},clear:function(){var A=this;if(A.get(ALLOW_CLEAR)){A.set(bO,[]);}},remove:function(cg){var A=this;var L=A.get(b6);var ch=A._getOptionNode(cg);if(A.get(bp)){return false;}if(ch){ch.remove();}A.items=L.all(bz+M);},_addNewOption:function(){var L=this;var cg=L.get(b6);if(L.get(bp)){return false;}var ch=L._createOption({label:L.get(al),value:L.get(z)});ch=bL.Node.create(ch);cg.append(ch);var A=ch.one(aL);A.focus();A.select();L.items=cg.all(bz+M);return ch;},_createOption:function(L){var A=this;return bL.substitute(bx,L);},_getOptionNode:function(L){var A=this;return A.items.item(L);},_getOptions:function(cg){var A=this;var L=[];if(A.items){bL.each(A.items,function(ch){var cj=ch.one(bz+a7);var ci=ch.one(bz+bM);L.push({label:cj.val(),value:ci.val()});});}else{L=cg;}return L;},_indexOfTarget:function(cg){var A=this;var L=cg.ancestor(bz+M);return A.items.indexOf(L);},_onClickAdd:function(L){var A=this;A._addNewOption();},_onClickOptionRemove:function(ch){var A=this;var cg=A.get(bO);var L=A._indexOfTarget(ch.target);A.remove(L);},_onKeyPressOption:function(ci){var A=this;var ch=A.get(bO);var ck=ci.currentTarget;var L=A.items;if(ci.isKey(ENTER)){var cg=A._indexOfTarget(ck);var cj=ck.hasClass(bM);if((cg==L.size()-1)&&cj){A._addNewOption();}}},_uiSetDisabled:function(ch){var A=this;var cg=A.get(af);var L=A.get(az);cg.toggleClass(V,ch);L.all(bz+aU).toggleClass(V,ch);if(ch){L.all(aL).setAttribute(bp,ch);}else{L.all(aL).removeAttribute(bp);}},_uiSetOptions:function(ch){var A=this;var cg=[];var L=A.get(b6);L.empty();bL.each(ch,function(ci){L.append(A._createOption(ci));});A.items=L.all(bz+M);}}});var e=bL.Component.create({NAME:F,ATTRS:{acceptChildren:{value:false,readOnly:true},options:{value:[{label:"option 1",value:"value 1"},{label:"option 2",value:"value 2"},{label:"option 3",value:"value 3"}]},optionTemplate:{value:'<option value="{value}">{label}</option>'}},UI_ATTRS:[c,a9,aa,at,bO,bP],CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderField,prototype:{initializer:function(){var A=this;bL.FormBuilderMultipleChoiceField.superclass.initializer.apply(A,arguments);},getNode:function(){var A=this;return bL.FormBuilderMultipleChoiceField.superclass.getNode.apply(A,arguments);},renderSettings:function(){var A=this;var L=A.get(bR);bL.FormBuilderMultipleChoiceField.superclass.renderSettings.apply(A,arguments);if(!A._renderedMultipleChoiceSettings){A._renderedMultipleChoiceSettings=true;var ch=bL.Node.create(bZ);A.optionsPanel=new bL.Panel({bodyContent:ch,collapsible:true,title:"Options"}).render();var cg=bL.Array.indexOf(L,bO)>-1;A.options=new aH({disabled:cg,options:A.get(bO)}).render(ch);A.fieldSettingsNode.append(A.optionsPanel.get(az));}},saveSettings:function(){var A=this;bL.FormBuilderMultipleChoiceField.superclass.saveSettings.apply(A,arguments);A.set(bO,A.options.get(bO));},_uiSetOptions:function(cg){var A=this;var L=A.get(bN);L.empty();bL.each(cg,function(ch){L.append(bL.substitute(A.get(bk),ch));});}}});bL.FormBuilderMultipleChoiceField=e;bL.FormBuilder.types["multiple-choice"]=bL.FormBuilderMultipleChoiceField;var bF=bL.Lang,aG=bF.isArray,a2=bF.isBoolean,bl=bF.isNumber,ah=bF.isString,az="boundingBox",d="bodyContent",D="checked",aq="choice",b6="contentBox",ba="container",bz=".",bo="",a5="field",f="fields",be="form-builder-field",aT="form-builder-radio-field",bX="id",q="icon",aM="inline",aa="label",g="labels",at="name",ce="node",bV="optionsContainerNode",a9="predefinedValue",J="radio",ao="size",P=" ",bd="template",bN="templateNode",m="value",w=bL.getClassName,b=w(a5),bI=w(a5,aq),bu=w(be),ay=w(be,J),Q=w(be,ce),N=w(be,bO,ba),by=w(bq,y),ac=w(a5,g,aM),bJ='<li class="'+[bW,a3,bu,ay].join(P)+'"></li>',R='<div class="'+N+'"></div>',aF='<input id="{id}" class="'+[Q,b,bI].join(P)+'" name="{name}" type="radio" value="{value}" {checked} />';var h=bL.Component.create({NAME:aT,ATTRS:{name:{value:J},optionTemplate:{value:aF},template:{valueFn:function(){return aF;}},optionsContainerNode:{valueFn:function(){return bL.Node.create(R);}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bu,HTML_PARSER:{optionsContainerNode:bz+N,templateNode:bz+Q},EXTENDS:bL.FormBuilderMultipleChoiceField,prototype:{BOUNDING_TEMPLATE:bJ,renderUI:function(){var A=this;var ch=A.get(az);var cj=A.get(b7);var L=A.get(b6);var cg=A.get(Y);if(!ch.contains(cj)){ch.prepend(cj);}if(!L.contains(cg)){L.append(cg);}var ci=A.get(bV);if(!L.contains(ci)){L.append(ci);}},getHTML:function(){var A=this;var L=A.get(bd);var ci=A.get(D);var ck=A.get(bX);var ch=A.get(aa);var cg=A.get(at);var cj=A.get(a9);return bL.substitute(L,{checked:ci?'checked="checked"':bo,id:ck,label:ch,name:cg,value:cj});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},_onFieldChange:function(L){var A=this;var cg=L.target;A.set(a9,cg.val());},_uiSetDisabled:function(cg){var A=this;var L=A.get(bV);L.all(aL).each(function(ch){if(cg){ch.setAttribute(bp,cg);}else{ch.removeAttribute(bp);}});},_uiSetOptions:function(ci){var A=this;var L=A.get(b6);var ch=A.get(bV);var cg=A.get(bN);ch.empty();bL.each(ci,function(cl){var cj=new bL.Field({type:J,disabled:A.get(bp),name:A.get(at),labelText:cl.label,labelAlign:"left",value:cl.value}).render(ch);var ck=cj.get(ce);if(cl.value==A.get(a9)){ck.set(D,true);
}if(A.get(bp)){ck.setAttribute(bp,ci);}else{ck.removeAttribute(bp);}ck.on({change:bL.bind(A._onFieldChange,A)});});},_uiSetPredefinedValue:function(ci){var A=this;var L=A.get(aQ);var cg=L.get(ak);var ch=cg.one("input[name=predefinedValue]");if(ch){ch.val(ci);}}}});bL.FormBuilderRadioField=h;bL.FormBuilder.types["radio"]=bL.FormBuilderRadioField;var bF=bL.Lang,aG=bF.isArray,bl=bF.isNumber,ah=bF.isString,av=function(A){return(A instanceof bL.Node);},aP=function(A){return(A instanceof bL.NodeList);},aV=bL.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),az="boundingBox",b2="button",b0="buttonType",b6="contentBox",ba="container",s="defaultOptions",bz=".",aS="drag",bj="dragContainer",b8="dragContainerNode",ad="dragNodesList",ar="drop",aK="dropContainer",a4="dropContainerNode",bo="",a5="field",f="fields",be="form-builder-field",bK="form-builder-select-field",bX="id",q="icon",aL="input",aa="label",b1="multiple",at="name",ce="node",bQ="option",bO="options",aR="portalLayout",a9="predefinedValue",a6="proxy",bA="reset",bE="selectedIndex",bn="submit",P=" ",bd="template",bN="templateNode",bs="text",O="type",m="value",w=bL.getClassName,aw=w(a5,aL),bT=w(a5,aL,bs),bu=w(be),Q=w(be,ce),by=w(bq,y),ap='<select id="{id}" class="'+[Q].join(P)+'" name="{name}" value="{value}"></select>';var X=bL.Component.create({NAME:bK,ATTRS:{multiple:{setter:bL.DataType.Boolean.parse,value:false},template:{valueFn:function(){return ap;}},templateNode:{valueFn:"getNode"}},UI_ATTRS:bL.FormBuilderField.UI_ATTRS.concat([b1]),CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderMultipleChoiceField,prototype:{getHTML:function(){var A=this;var L=A.get(bd);var cj=A.get(bX);var ch=A.get(aa);var cg=A.get(at);var ci=A.get(a9);return bL.substitute(L,{id:cj,label:ch,name:cg,value:ci});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},renderSettings:function(){var cg=this;var ch=cg.get(aQ);var ci=ch.get(ak);var cj=cg.settingsNodesMap;bL.FormBuilderSelectField.superclass.renderSettings.apply(cg,arguments);if(!cg._renderedSelectSettings){cg._renderedSelectSettings=true;var L=cg.propertiesPanel.get(d);cg._renderSettingsFields([{type:"checkbox",name:b1,labelText:"Multiple",labelAlign:"left"}],L.item(0));var A=cj["multipleSettingNode"];A.on({change:bL.bind(cg._onSettingsFieldChange,cg)});A.set(D,cg.get(b1));}},_uiSetMultiple:function(cg){var A=this;var L=A.get(bN);if(cg){L.setAttribute(b1,b1);}else{L.removeAttribute(b1);}}}});bL.FormBuilderSelectField=X;bL.FormBuilder.types["select"]=bL.FormBuilderSelectField;var bF=bL.Lang,aG=bF.isArray,bl=bF.isNumber,ah=bF.isString,av=function(A){return(A instanceof bL.Node);},aP=function(A){return(A instanceof bL.NodeList);},az="boundingBox",b6="contentBox",ba="container",bz=".",aS="drag",bj="dragContainer",b8="dragContainerNode",ad="dragNodesList",ar="drop",aK="dropContainer",a4="dropContainerNode",bo="",a5="field",f="fields",be="form-builder-field",aN="form-builder-input-field",bX="id",q="icon",aL="input",aa="label",at="name",ce="node",aR="portalLayout",a9="predefinedValue",a6="proxy",P=" ",bd="template",bN="templateNode",bs="text",m="value",w=bL.getClassName,aw=w(a5,aL),bT=w(a5,aL,bs),bu=w(be),Q=w(be,ce),by=w(bq,y),bt='<input id="{id}" class="'+[Q,aw,bT].join(P)+'" name="{name}" type="text" value="{value}" />';var au=bL.Component.create({NAME:aN,ATTRS:{template:{valueFn:function(){return bt;}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderField,prototype:{bindUI:function(){var A=this;bL.FormBuilderTextField.superclass.bindUI.apply(A,arguments);var L=A.get(bN);L.on({"keyup":bL.bind(A._onValueKeyUp,A)});},getHTML:function(){var A=this;var L=A.get(bd);var ck=A.get(bX);var ch=A.get(aa);var cg=A.get(at);var ci=A.get(ao);var cj=A.get(a9);return bL.substitute(L,{id:ck,label:ch,name:cg,value:cj});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},renderSettings:function(){var A=this;var L=A.get(aQ);var cg=L.get(ak);var ci=A.settingsNodesMap;bL.FormBuilderTextField.superclass.renderSettings.apply(A,arguments);if(!A._renderedInputSettings){A._renderedInputSettings=true;var ch=ci["predefinedValueSettingNode"];ch.on({input:bL.bind(A._onValueInput,A)});}},_onValueInput:function(L){var A=this;var cg=L.target;A.set(a9,cg.val());}}});bL.FormBuilderTextField=au;bL.FormBuilder.types["text"]=bL.FormBuilderTextField;var bF=bL.Lang,aG=bF.isArray,bl=bF.isNumber,ah=bF.isString,az="boundingBox",b6="contentBox",ba="container",bz=".",aS="drag",bj="dragContainer",b8="dragContainerNode",ad="dragNodesList",ar="drop",aK="dropContainer",a4="dropContainerNode",bo="",a5="field",f="fields",be="form-builder-field",v="form-builder-textarea-field",bX="id",q="icon",aa="label",at="name",ce="node",aR="portalLayout",a9="predefinedValue",a6="proxy",ao="size",P=" ",bd="template",bN="templateNode",bs="text",bw="textarea",m="value",w=bL.getClassName,b=w(a5),bb=w(a5,bs),bS=w(a5,bw),bu=w(be),Q=w(be,ce),by=w(bq,y),bG='<textarea id="{id}" class="'+[Q,b,bb,bS].join(P)+'" name="{name}">{value}</textarea>';var ax=bL.Component.create({NAME:v,ATTRS:{template:{valueFn:function(){return bG;}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bu,HTML_PARSER:{templateNode:bz+Q},EXTENDS:bL.FormBuilderField,prototype:{bindUI:function(){var A=this;bL.FormBuilderTextAreaField.superclass.bindUI.apply(A,arguments);var L=A.get(bN);L.on({"keyup":bL.bind(A._onValueKeyUp,A)});},getHTML:function(){var A=this;var L=A.get(bd);var ck=A.get(bX);var ch=A.get(aa);var cg=A.get(at);var ci=A.get(ao);var cj=A.get(a9);return bL.substitute(L,{id:ck,label:ch,name:cg,value:cj});},getNode:function(){var A=this;return bL.Node.create(A.getHTML());},renderSettings:function(){var A=this;var L=A.get(aQ);var cg=L.get(ak);var ci=A.settingsNodesMap;bL.FormBuilderTextAreaField.superclass.renderSettings.apply(A,arguments);if(!A._renderedTextareaSettings){A._renderedTextareaSettings=true;var ch=ci["predefinedValueSettingNode"];ch.on({input:bL.bind(A._onValueInput,A)});}},_onValueInput:function(L){var A=this;
var cg=L.target;A.set(a9,cg.val());}}});bL.FormBuilderTextAreaField=ax;bL.FormBuilder.types["textarea"]=bL.FormBuilderTextAreaField;},"@VERSION@",{requires:["aui-datatype","aui-form","aui-panel","io","substitute"],skinnable:true});AUI.add("aui-form-builder",function(a){},"@VERSION@",{skinnable:true,use:["aui-form-builder-base","aui-form-builder-field"]});