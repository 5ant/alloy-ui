AUI.add("aui-data-browser",function(J){var q=J.Lang,O=q.isArray,G=q.isString,f=q.isNull,K=q.isFunction,l=J.ClassNameManager.getClassName,Y="databrowser",c="bindUI",W="icon",H="search",S="folder-open",E="image",V="renderUI",R="search",j="text",e="tree",T=Y+"-"+R+"-ui",D=Y+"-"+e+"-ui",k=function(r){for(var A in r){if(r[A].children||(r[A].leaf!=undefined&&!r[A].leaf)){k(r[A].children);}else{r[A].cssClass=(r[A].cssClass?" ":"")+m;}}},U=function(A){return A.hasClass(m);},C=function(A){return(A instanceof J.TreeView);},m=l(Y,"results","item"),Q=l(Y,R),a=l(Y,R,"list"),L=l(Y,R,"list","item"),h=l(Y,R,"view","only"),B=l(Y,e),i=l(e,"node","leaf"),P=l(Y,e,"view","only"),F='<div class="'+Q+'"></div>',p='<ul class="'+a+'"></ul>',b='<li class="'+m+" "+L+'-{1}">{0}</li>',N='<img src="{2}" title="{1}" alt="" /><div>{0}</div>',M='<span class="{2}" title="{1}"></span><div>{0}</div>',Z='<div title="{1}">{0}</div>',d='<div class="'+B+'"></div>';var X=function(){var A=this;J.after(A._renderUISearchBrowserView,A,V);J.after(A._bindUISearchBrowserView,A,c);};X.ATTRS={displayName:{value:false},matchKey:{value:""}};X.prototype={_renderUISearchBrowserView:function(){var A=this;var r=J.Node.create(F);A.get("contentBox").append(r);A._viewNode=r;},_bindUISearchBrowserView:function(){var A=this;A.on("handleResponse",A._populateResultView,A);},hideView:function(){var A=this;A._viewNode.hide();},showView:function(){var A=this;A._viewNode.show();},_populateResultView:function(AA){var AF=this;var r=AA.response;var x=AF.doBeforeLoadData(AA);if(x&&!AA.error){AF.fire("dataReturn",AA);var AC=r.results;var t=AF.get("displayName");var u=AF.get("matchKey");var A=[];if(u){var w=[];var AG=[];var v=0;for(var AB=0;AB<AC.length;AB++){var AJ=AC[AB][u];if(AJ!=null){if(w[AJ]!=null){A[w[AJ]].data.push(AC[AB]);}else{w[AJ]=v;A[v]={name:AJ,data:[AC[AB]]};v++;}}else{AG.push(AC[AB]);}}A.sort(function(AL,AK){return(AL.data.length==AK.data.length?0:(AL.data.length>AK.data.length?-1:1));});if(AG.length>0){A.push({name:"",data:AG});}}else{A.push({name:"",data:AC});}AF._viewNode.html("");for(var AB=0;AB<A.length;AB++){var y=J.Node.create(p);for(var z=0;z<A[AB].data.length;z++){var AH=A[AB].data[z];var AI;var AD;var s;if(AH.imageUri){AI=N;AD=AH.imageUri;s=E;}else{if(AH.iconCss){AI=M;AD=AH.iconCss;s=W;}else{AI=Z;s=j;}}AI=q.sub(b,[q.sub(AI,[(t?AH.name:""),AH.title||"",AD||""]),s]);var AE=J.Node.create(AI);AE.setData(Y,AH);y.append(AE);}if(u){new J.Panel({collapsible:true,collapsed:(AF._viewNode.html()!=""),headerContent:A[AB].name,bodyContent:y}).render(AF._viewNode);}else{AF._viewNode.append(y);}}}},_uiSetHeight:function(u){var r=this;var A=parseInt(u);var s=r._viewNode;if(A){var t=s.getBorderWidth("tb")+s.getPadding("tb");s.setStyle("height",(A-t));}else{s.setStyle("height","");}}};var n=J.Base.build(T,J.Component,[J.DataSourceControl,J.InputTextControl,X]);var o=function(){var A=this;J.after(A._renderUITreeBrowserView,A,V);J.after(A._bindUITreeBrowserView,A,c);};o.ATTRS={rootLabel:{value:""}};o.prototype={_renderUITreeBrowserView:function(){var A=this;var s=A.get("contentBox");var u=A.get("dataSource");var r=J.Node.create(d);s.append(r);var t=new J.TreeView().render(r);t.on("expand",function(x){var v=this;var w=x.tree.node;v._expandNode(w,u);},A);A._treeView=t;A._viewNode=r;},_bindUITreeBrowserView:function(){var A=this;A._expandNode(A._treeView,A.get("dataSource"));},doBeforeLoadData:function(A){return true;},hideView:function(){var A=this;A._viewNode.hide();},showView:function(){var A=this;A._viewNode.show();},_expandNode:function(s,t){var A=this;if(s&&!s.hasChildNodes()){var r={cfg:(!C(s)?s._originalConfig:null),callback:{success:function(u){A._populateResultView(J.mix(u,{node:s}));}}};A.fire("dataRequest",null,r);t.sendRequest(r);}},_populateResultView:function(x){var r=this;var u=x.response;var w=x.node;var v=r.doBeforeLoadData(x);if(v&&!x.error&&w){r.fire("dataReturn",x);var A=u.results;if(A.length>0){var s=r.get("rootLabel");if(s&&C(w)){var t=new J.TreeNode({label:s,children:A});w.appendChild(t);}else{J.each(A,function(y){var z=w.createNode.apply(r,[y]);w.appendChild(z);});}}}else{r.fire("dataError",x);}},_uiSetHeight:function(u){var r=this;var A=parseInt(u);var s=r._viewNode;if(A){var t=s.getBorderWidth("tb")+s.getPadding("tb");s.setStyle("height",(A-t));}else{s.setStyle("height","");}}};var I=J.Base.build(D,J.Component,[J.DataSourceControl,o]);var g=J.Component.create({NAME:Y,ATTRS:{currentView:{value:R},searchView:{value:null},treeView:{value:null}},prototype:{renderUI:function(){var A=this;var r=A.get("contentBox");var x=A.get("searchView");var t=A.get("treeView");if(x){var s=new n(J.mix({iconButton:"circle-triangle-r"},x)).render(r);A._searchBrowser=s;}else{r.addClass(P);}if(t){var w=new I(t).render(r);A._treeBrowser=w;}else{r.addClass(h);}if(x&&t){var v=A._searchBrowser.comboBox;var u=new J.Toolbar({children:[{icon:H,handler:{fn:function(){var y=this;y.set("currentView",R);y._updateViews();},context:A}},{icon:S,handler:{fn:function(){var y=this;y.set("currentView",e);y._updateViews();},context:A}}]}).render(v.get("boundingBox"));}},bindUI:function(){var A=this;A.get("contentBox").delegate("click",function(s){var r=s.currentTarget;var t;if(U(r)){t=r.getData(Y);}else{r=J.Widget.getByNode(r);if(r){t=r._originalConfig;}}if(t){A.fire("itemSelected",{item:t,node:r});}else{A.fire("itemError",s);}},"."+m+", ."+i);},syncUI:function(){var A=this;A._syncDimensions();A._updateViews();},_syncDimensions:function(){var v=this;var x=v.get("height");if(x){var r=v.get("boundingBox");var u=v._searchBrowser;var A=v._treeBrowser;var s=0;if(u){var t=u.comboBox;if(t){var w=t.get("boundingBox");s+=w.getBorderWidth("tb")+w.getMargin("tb")+w.get("offsetHeight");}}var y=parseInt(v.get("height"),10)-s;if(u){u.set("height",y);}if(A){A.set("height",y);}}},_updateViews:function(){var A=this;var t=A.get("currentView");var r=A._searchBrowser;var s=A._treeBrowser;if(r&&s){if(t==R){s.hideView();r.showView();}else{if(t==e){r.hideView();s.showView();}}}}}});J.DataBrowser=g;
},"@VERSION@",{requires:["aui-base","aui-datasource-control-base","aui-input-text-control","aui-tree","aui-panel"],skinnable:true});