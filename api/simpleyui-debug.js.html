<!DOCTYPE>
<html class="ltr" xmlns:yui="http://yuilibrary.com/rdf/1.0/yui.rdf#">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>API: yui   simpleyui-debug.js  (YUI Library)</title>

	<link rel="stylesheet" href="../build/aui-skin-classic/css/aui-skin-classic-all-min.css" type="text/css" media="screen" />
	<link rel="stylesheet" type="text/css" href="assets/custom.css" />

    <script type="text/javascript" src="assets/api-js"></script>
    <script type="text/javascript" src="assets/ac-js"></script>
</head>

<body>

<div id="wrapper">
	<div class="aui-header">
		<h1>
			<a class="aui-header-text" href="http://alloy.liferay.com/deploy/api" title="Alloy UI">Alloy UI</a>
		</h1>

		<h3>
			yui&nbsp; <span class="subtitle">1.0.1</span>
		</h3>

		<p class="breadcrumbs">
			<a href="./index.html" title="Alloy UI">Alloy UI</a>

	            <span class="separator">&gt;</span>

				<a class="modulename" href="./module_yui.html" title="yui">yui</a>

	                

	                 <span class="separator">&gt;</span> <span class="filename">simpleyui-debug.js (source view)</span> 
		</p>

		<form onsubmit="return false;">
            <div id="propertysearch">
				<span class="aui-field aui-field-text aui-field-labels-inline aui-field-labels-right">
					<span class="aui-field-content">
						<label class="aui-field-label" for="searchinput">Search:</label>
						<input class="aui-field-input aui-field-input-text" id="searchinput" name="searchinput" type="text" value="" />
					</span>
				</span>
                <div id="searchresults">
                    &nbsp;
                </div>
            </div>
        </form>
	</div>

	<div class="aui-body">
		<form action="#" name="classOptions" id="classOptions">
			<fieldset>
				<legend>Filters</legend>

				<span class="aui-field aui-field-checkbox aui-field-choice aui-field-inline">
					<span class="aui-field-content">
						<label class="aui-field-label" for="show_private">
							<input class="aui-field-input aui-field-input-checkbox aui-field-input-choice" id="show_private" name="show_private" type="checkbox" value="" />
						Show Private</label>
					</span>
				</span>

				<span class="aui-field aui-field-checkbox aui-field-choice aui-field-inline">
					<span class="aui-field-content">
						<label class="aui-field-label" for="show_protected">
							<input class="aui-field-input aui-field-input-checkbox aui-field-input-choice" id="show_protected" name="show_protected" type="checkbox" value="" />
						Show Protected</label>
					</span>
				</span>

				<span class="aui-field aui-field-checkbox aui-field-choice aui-field-inline">
					<span class="aui-field-content">
						<label class="aui-field-label" for="show_deprecated">
							<input class="aui-field-input aui-field-input-checkbox aui-field-input-choice" id="show_deprecated" name="show_deprecated" type="checkbox" value="" />
						Show Deprecated</label>
					</span>
				</span>
			</fieldset>
		</form>

		<div class="aui-layout">
			<div class="aui-layout-content">
				<div class="aui-column aui-w25 aui-column-first">
					<div class="aui-column-content aui-column-content-first">

						<div class="yui3-widget aui-list aui-list-modules">
							<div class="yui3-widget-content">
								<div class="yui3-widget-hd aui-list-hd aui-list-modules-hd">
									<span class="yui3-widget-hd-text">Modules</span>
								</div>

								<div class="yui3-widget-bd aui-list-bd">
									<h4 class="aui-module-section-heading">Alloy Modules</h4>
									<ul class="content">



				                                <li class=""><a href="module_aui-autocomplete.html" title="aui-autocomplete">aui-autocomplete</a></li>



				                                <li class=""><a href="module_aui-button-item.html" title="aui-button-item">aui-button-item</a></li>



				                                <li class=""><a href="module_aui-calendar.html" title="aui-calendar">aui-calendar</a></li>



				                                <li class=""><a href="module_aui-char-counter.html" title="aui-char-counter">aui-char-counter</a></li>



				                                <li class=""><a href="module_aui-color-picker.html" title="aui-color-picker">aui-color-picker</a></li>



				                                <li class=""><a href="module_aui-component.html" title="aui-component">aui-component</a></li>



				                                <li class=""><a href="module_aui-datatype.html" title="aui-datatype">aui-datatype</a></li>



				                                <li class=""><a href="module_aui-delayed-task.html" title="aui-delayed-task">aui-delayed-task</a></li>



				                                <li class=""><a href="module_aui-dialog.html" title="aui-dialog">aui-dialog</a></li>



				                                <li class=""><a href="module_aui-editable.html" title="aui-editable">aui-editable</a></li>



				                                <li class=""><a href="module_aui-event.html" title="aui-event">aui-event</a></li>



				                                <li class=""><a href="module_aui-image-viewer.html" title="aui-image-viewer">aui-image-viewer</a></li>



				                                <li class=""><a href="module_aui-io.html" title="aui-io">aui-io</a></li>



				                                <li class=""><a href="module_aui-live-search.html" title="aui-live-search">aui-live-search</a></li>



				                                <li class=""><a href="module_aui-loading-mask.html" title="aui-loading-mask">aui-loading-mask</a></li>



				                                <li class=""><a href="module_aui-nested-list.html" title="aui-nested-list">aui-nested-list</a></li>



				                                <li class=""><a href="module_aui-node.html" title="aui-node">aui-node</a></li>



				                                <li class=""><a href="module_aui-overlay.html" title="aui-overlay">aui-overlay</a></li>



				                                <li class=""><a href="module_aui-paginator.html" title="aui-paginator">aui-paginator</a></li>



				                                <li class=""><a href="module_aui-panel.html" title="aui-panel">aui-panel</a></li>



				                                <li class=""><a href="module_aui-parse-content.html" title="aui-parse-content">aui-parse-content</a></li>



				                                <li class=""><a href="module_aui-portal-layout.html" title="aui-portal-layout">aui-portal-layout</a></li>



				                                <li class=""><a href="module_aui-progressbar.html" title="aui-progressbar">aui-progressbar</a></li>



				                                <li class=""><a href="module_aui-rating.html" title="aui-rating">aui-rating</a></li>



				                                <li class=""><a href="module_aui-resize.html" title="aui-resize">aui-resize</a></li>



				                                <li class=""><a href="module_aui-textboxlist.html" title="aui-textboxlist">aui-textboxlist</a></li>



				                                <li class=""><a href="module_aui-toolbar.html" title="aui-toolbar">aui-toolbar</a></li>



				                                <li class=""><a href="module_aui-tooltip.html" title="aui-tooltip">aui-tooltip</a></li>



				                                <li class=""><a href="module_aui-tree.html" title="aui-tree">aui-tree</a></li>
			                        </ul>

									<h4 class="aui-module-section-heading">YUI Modules</h4>
									<ul class="content">



			                                
													<li class=""><a href="module_align-plugin.html" title="align-plugin">align-plugin</a></li>



			                                
													<li class=""><a href="module_anim.html" title="anim">anim</a></li>



			                                
													<li class=""><a href="module_app.html" title="app">app</a></li>



			                                
													<li class=""><a href="module_arraysort.html" title="arraysort">arraysort</a></li>



			                                
													<li class=""><a href="module_async-queue.html" title="async-queue">async-queue</a></li>



			                                
													<li class=""><a href="module_attribute.html" title="attribute">attribute</a></li>



			                                
													<li class=""><a href="module_autocomplete.html" title="autocomplete">autocomplete</a></li>



			                                
													<li class=""><a href="module_base.html" title="base">base</a></li>



			                                
													<li class=""><a href="module_cache.html" title="cache">cache</a></li>



			                                
													<li class=""><a href="module_calendar.html" title="calendar">calendar</a></li>



			                                
													<li class=""><a href="module_classnamemanager.html" title="classnamemanager">classnamemanager</a></li>



			                                
													<li class=""><a href="module_collection.html" title="collection">collection</a></li>



			                                
													<li class=""><a href="module_console.html" title="console">console</a></li>



			                                
													<li class=""><a href="module_console-filters.html" title="console-filters">console-filters</a></li>



			                                
													<li class=""><a href="module_cookie.html" title="cookie">cookie</a></li>



			                                
													<li class=""><a href="module_dataschema.html" title="dataschema">dataschema</a></li>



			                                
													<li class=""><a href="module_datasource.html" title="datasource">datasource</a></li>



			                                
													<li class=""><a href="module_datatable.html" title="datatable">datatable</a></li>



			                                
													<li class=""><a href="module_datatype.html" title="datatype">datatype</a></li>



			                                
													<li class=""><a href="module_dd.html" title="dd">dd</a></li>



			                                
													<li class=""><a href="module_dial.html" title="dial">dial</a></li>



			                                
													<li class=""><a href="module_dom.html" title="dom">dom</a></li>



			                                
													<li class=""><a href="module_dump.html" title="dump">dump</a></li>



			                                
													<li class=""><a href="module_editor.html" title="editor">editor</a></li>



			                                
													<li class=""><a href="module_escape.html" title="escape">escape</a></li>



			                                
													<li class=""><a href="module_event.html" title="event">event</a></li>



			                                
													<li class=""><a href="module_event-custom.html" title="event-custom">event-custom</a></li>



			                                
													<li class=""><a href="module_event-gestures.html" title="event-gestures">event-gestures</a></li>



			                                
													<li class=""><a href="module_event-simulate.html" title="event-simulate">event-simulate</a></li>



			                                
													<li class=""><a href="module_event-touch.html" title="event-touch">event-touch</a></li>



			                                
													<li class=""><a href="module_event-valuechange.html" title="event-valuechange">event-valuechange</a></li>



			                                
													<li class=""><a href="module_graphics.html" title="graphics">graphics</a></li>



			                                
													<li class=""><a href="module_highlight.html" title="highlight">highlight</a></li>



			                                
													<li class=""><a href="module_history.html" title="history">history</a></li>



			                                
													<li class=""><a href="module_imageloader.html" title="imageloader">imageloader</a></li>



			                                
													<li class=""><a href="module_intl.html" title="intl">intl</a></li>



			                                
													<li class=""><a href="module_io.html" title="io">io</a></li>



			                                
													<li class=""><a href="module_json.html" title="json">json</a></li>



			                                
													<li class=""><a href="module_jsonp.html" title="jsonp">jsonp</a></li>



			                                
													<li class=""><a href="module_loader.html" title="loader">loader</a></li>



			                                
													<li class=""><a href="module_node.html" title="node">node</a></li>



			                                
													<li class=""><a href="module_node-flick.html" title="node-flick">node-flick</a></li>



			                                
													<li class=""><a href="module_node-focusmanager.html" title="node-focusmanager">node-focusmanager</a></li>



			                                
													<li class=""><a href="module_node-menunav.html" title="node-menunav">node-menunav</a></li>



			                                
													<li class=""><a href="module_oop.html" title="oop">oop</a></li>



			                                
													<li class=""><a href="module_overlay.html" title="overlay">overlay</a></li>



			                                
													<li class=""><a href="module_plugin.html" title="plugin">plugin</a></li>



			                                
													<li class=""><a href="module_pluginhost.html" title="pluginhost">pluginhost</a></li>



			                                
													<li class=""><a href="module_pluginhost-base.html" title="pluginhost-base">pluginhost-base</a></li>



			                                
													<li class=""><a href="module_profiler.html" title="profiler">profiler</a></li>



			                                
													<li class=""><a href="module_querystring.html" title="querystring">querystring</a></li>



			                                
													<li class=""><a href="module_queue-promote.html" title="queue-promote">queue-promote</a></li>



			                                
													<li class=""><a href="module_recordset.html" title="recordset">recordset</a></li>



			                                
													<li class=""><a href="module_resize.html" title="resize">resize</a></li>



			                                
													<li class=""><a href="module_resize-plugin.html" title="resize-plugin">resize-plugin</a></li>



			                                
													<li class=""><a href="module_scrollview.html" title="scrollview">scrollview</a></li>



			                                
													<li class=""><a href="module_scrollview-base.html" title="scrollview-base">scrollview-base</a></li>



			                                
													<li class=""><a href="module_scrollview-base-ie.html" title="scrollview-base-ie">scrollview-base-ie</a></li>



			                                
													<li class=""><a href="module_scrollview-paginator.html" title="scrollview-paginator">scrollview-paginator</a></li>



			                                
													<li class=""><a href="module_scrollview-scrollbars.html" title="scrollview-scrollbars">scrollview-scrollbars</a></li>



			                                
													<li class=""><a href="module_shim-plugin.html" title="shim-plugin">shim-plugin</a></li>



			                                
													<li class=""><a href="module_slider.html" title="slider">slider</a></li>



			                                
													<li class=""><a href="module_sortable.html" title="sortable">sortable</a></li>



			                                
													<li class=""><a href="module_stylesheet.html" title="stylesheet">stylesheet</a></li>



			                                
													<li class=""><a href="module_substitute.html" title="substitute">substitute</a></li>



			                                
													<li class=""><a href="module_swf.html" title="swf">swf</a></li>



			                                
													<li class=""><a href="module_swfdetect.html" title="swfdetect">swfdetect</a></li>



			                                
													<li class=""><a href="module_tabview.html" title="tabview">tabview</a></li>



			                                
													<li class=""><a href="module_test.html" title="test">test</a></li>



			                                
													<li class=""><a href="module_text.html" title="text">text</a></li>



			                                
													<li class=""><a href="module_transition.html" title="transition">transition</a></li>



			                                
													<li class=""><a href="module_uploader.html" title="uploader">uploader</a></li>



			                                
													<li class=""><a href="module_widget.html" title="widget">widget</a></li>



			                                
													<li class=""><a href="module_widget-anim.html" title="widget-anim">widget-anim</a></li>



			                                
													<li class=""><a href="module_widget-autohide.html" title="widget-autohide">widget-autohide</a></li>



			                                
													<li class=""><a href="module_widget-base-ie.html" title="widget-base-ie">widget-base-ie</a></li>



			                                
													<li class=""><a href="module_widget-child.html" title="widget-child">widget-child</a></li>



			                                
													<li class=""><a href="module_widget-locale.html" title="widget-locale">widget-locale</a></li>



			                                
													<li class=""><a href="module_widget-parent.html" title="widget-parent">widget-parent</a></li>



			                                
													<li class=""><a href="module_widget-position.html" title="widget-position">widget-position</a></li>



			                                
													<li class=""><a href="module_widget-position-align.html" title="widget-position-align">widget-position-align</a></li>



			                                
													<li class=""><a href="module_widget-position-constrain.html" title="widget-position-constrain">widget-position-constrain</a></li>



			                                
													<li class=""><a href="module_widget-stack.html" title="widget-stack">widget-stack</a></li>



			                                
													<li class=""><a href="module_widget-stdmod.html" title="widget-stdmod">widget-stdmod</a></li>



			                                
													<li class=""><a href="module_yql.html" title="yql">yql</a></li>



			                                
													<li class="selected"><a href="module_yui.html" title="yui">yui</a></li>
			                        </ul>
								</div>
							</div>
						</div>

							<div class="yui3-widget aui-list aui-list-classes">
								<div class="yui3-widget-content">
									<div class="yui3-widget-hd aui-list-hd aui-list-classes-hd">
										<span class="yui3-widget-hd-text">Classes</span>
									</div>

									<div class="yui3-widget-bd aui-list-bd">
										<ul class="content">


				                                <li class=""><a href="Array.html" title="Array">Array</a></li>


				                                <li class=""><a href="config.html" title="config">config</a></li>


				                                <li class=""><a href="Get.html" title="Get">Get</a></li>


				                                <li class=""><a href="Intl.html" title="Intl">Intl</a></li>


				                                <li class=""><a href="Lang.html" title="Lang">Lang</a></li>


				                                <li class=""><a href="Object.html" title="Object">Object</a></li>


				                                <li class=""><a href="Queue.html" title="Queue">Queue</a></li>


				                                <li class=""><a href="rls.html" title="rls">rls</a></li>


				                                <li class=""><a href="UA.html" title="UA">UA</a></li>


				                                <li class=""><a href="YUI.html" title="YUI">YUI</a></li>
				                        </ul>
									</div>
								</div>
							</div>




					</div>

						<div class="yui3-widget aui-list aui-list-files">
							<div class="yui3-widget-content">
								<div class="yui3-widget-hd aui-list-hd aui-list-files-hd">
									<span class="yui3-widget-hd-text">Files</span>
								</div>

								<div class="yui3-widget-bd aui-list-bd">
									<ul class="content">


			                                <li class=""><a href="aui-aria-debug.js.html" title="aui-aria-debug.js">aui-aria-debug.js</a></li>


			                                <li class=""><a href="aui-aria-min.js.html" title="aui-aria-min.js">aui-aria-min.js</a></li>


			                                <li class=""><a href="aui-aria.js.html" title="aui-aria.js">aui-aria.js</a></li>


			                                <li class=""><a href="aui-min.js.html" title="aui-min.js">aui-min.js</a></li>


			                                <li class=""><a href="aui.js.html" title="aui.js">aui.js</a></li>


			                                <li class=""><a href="features-debug.js.html" title="features-debug.js">features-debug.js</a></li>


			                                <li class=""><a href="features-min.js.html" title="features-min.js">features-min.js</a></li>


			                                <li class=""><a href="features.js.html" title="features.js">features.js</a></li>


			                                <li class=""><a href="get-debug.js.html" title="get-debug.js">get-debug.js</a></li>


			                                <li class=""><a href="get-min.js.html" title="get-min.js">get-min.js</a></li>


			                                <li class=""><a href="get.js.html" title="get.js">get.js</a></li>


			                                <li class=""><a href="intl-base-debug.js.html" title="intl-base-debug.js">intl-base-debug.js</a></li>


			                                <li class=""><a href="intl-base-min.js.html" title="intl-base-min.js">intl-base-min.js</a></li>


			                                <li class=""><a href="intl-base.js.html" title="intl-base.js">intl-base.js</a></li>


			                                <li class=""><a href="rls-debug.js.html" title="rls-debug.js">rls-debug.js</a></li>


			                                <li class=""><a href="rls-min.js.html" title="rls-min.js">rls-min.js</a></li>


			                                <li class=""><a href="rls.js.html" title="rls.js">rls.js</a></li>


			                                <li class="selected"><a href="simpleyui-debug.js.html" title="simpleyui-debug.js">simpleyui-debug.js</a></li>


			                                <li class=""><a href="yui-base-debug.js.html" title="yui-base-debug.js">yui-base-debug.js</a></li>


			                                <li class=""><a href="yui-base-min.js.html" title="yui-base-min.js">yui-base-min.js</a></li>


			                                <li class=""><a href="yui-base.js.html" title="yui-base.js">yui-base.js</a></li>


			                                <li class=""><a href="yui-core-debug.js.html" title="yui-core-debug.js">yui-core-debug.js</a></li>


			                                <li class=""><a href="yui-core-min.js.html" title="yui-core-min.js">yui-core-min.js</a></li>


			                                <li class=""><a href="yui-core.js.html" title="yui-core.js">yui-core.js</a></li>


			                                <li class=""><a href="yui-debug.js.html" title="yui-debug.js">yui-debug.js</a></li>


			                                <li class=""><a href="yui-later-debug.js.html" title="yui-later-debug.js">yui-later-debug.js</a></li>


			                                <li class=""><a href="yui-later-min.js.html" title="yui-later-min.js">yui-later-min.js</a></li>


			                                <li class=""><a href="yui-later.js.html" title="yui-later.js">yui-later.js</a></li>


			                                <li class=""><a href="yui-log-debug.js.html" title="yui-log-debug.js">yui-log-debug.js</a></li>


			                                <li class=""><a href="yui-log-min.js.html" title="yui-log-min.js">yui-log-min.js</a></li>


			                                <li class=""><a href="yui-log.js.html" title="yui-log.js">yui-log.js</a></li>


			                                <li class=""><a href="yui-min.js.html" title="yui-min.js">yui-min.js</a></li>


			                                <li class=""><a href="yui-rls-debug.js.html" title="yui-rls-debug.js">yui-rls-debug.js</a></li>


			                                <li class=""><a href="yui-rls-min.js.html" title="yui-rls-min.js">yui-rls-min.js</a></li>


			                                <li class=""><a href="yui-rls.js.html" title="yui-rls.js">yui-rls.js</a></li>


			                                <li class=""><a href="yui-throttle-debug.js.html" title="yui-throttle-debug.js">yui-throttle-debug.js</a></li>


			                                <li class=""><a href="yui-throttle-min.js.html" title="yui-throttle-min.js">yui-throttle-min.js</a></li>


			                                <li class=""><a href="yui-throttle.js.html" title="yui-throttle.js">yui-throttle.js</a></li>


			                                <li class=""><a href="yui.js.html" title="yui.js">yui.js</a></li>
			                        </ul>
								</div>
							</div>
						</div>
				</div>
				<div class="aui-column aui-w75 aui-column-last">
					<div class="aui-column-content aui-column-content-last">


							<div id="srcout">
								<style>
									#doc3 .classopts { display:none; }
								</style>
								<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">Copyright (c) 2010, Yahoo! Inc. All rights reserved.</span>
<span class="cm">Code licensed under the BSD License:</span>
<span class="cm">http://developer.yahoo.com/yui/license.html</span>
<span class="cm">version: 3.4.0</span>
<span class="cm">build: nightly</span>
<span class="cm">*/</span>

<span class="cm">/**</span>
<span class="cm"> * The YUI module contains the components required for building the YUI seed</span>
<span class="cm"> * file.  This includes the script loading mechanism, a simple queue, and</span>
<span class="cm"> * the core utilities for the library.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-base</span>
<span class="cm"> */</span>

<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">YUI</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">YUI</span><span class="p">.</span><span class="nx">_YUI</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * The YUI global namespace object.  If YUI is already defined, the</span>
<span class="cm"> * existing YUI object will not be overwritten so that defined</span>
<span class="cm"> * namespaces are preserved.  It is the constructor for the object</span>
<span class="cm"> * the end user interacts with.  As indicated below, each instance</span>
<span class="cm"> * has full custom event support, but only if the event system</span>
<span class="cm"> * is available.  This is a self-instantiable factory function.  You</span>
<span class="cm"> * can invoke it directly like this:</span>
<span class="cm"> *</span>
<span class="cm"> * YUI().use(&#39;*&#39;, function(Y) {</span>
<span class="cm"> *   // ready</span>
<span class="cm"> * });</span>
<span class="cm"> *</span>
<span class="cm"> * But it also works like this:</span>
<span class="cm"> *</span>
<span class="cm"> * var Y = YUI();</span>
<span class="cm"> *</span>
<span class="cm"> * @class YUI</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @global</span>
<span class="cm"> * @uses EventTarget</span>
<span class="cm"> * @param o* {object} 0..n optional configuration objects.  these values</span>
<span class="cm"> * are store in Y.config.  See config for the list of supported</span>
<span class="cm"> * properties.</span>
<span class="cm"> */</span>
    <span class="cm">/*global YUI*/</span>
    <span class="cm">/*global YUI_config*/</span>
    <span class="kd">var</span> <span class="nx">YUI</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">instanceOf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">hasOwnProperty</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">o</span> <span class="k">instanceof</span> <span class="nx">type</span><span class="p">));</span>
            <span class="p">},</span>
            <span class="nx">gconf</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">YUI_config</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">YUI_config</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">YUI</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nx">Y</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YUI</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// set up the core environment</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">_init</span><span class="p">();</span>

            <span class="c1">// YUI.GlobalConfig is a master configuration that might span</span>
            <span class="c1">// multiple contexts in a non-browser environment.  It is applied</span>
            <span class="c1">// first to all instances in all contexts.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">GlobalConfig</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">applyConfig</span><span class="p">(</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">GlobalConfig</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// YUI_Config is a page-level config.  It is applied to all</span>
            <span class="c1">// instances created on the page.  This is applied after</span>
            <span class="c1">// YUI.GlobalConfig, and before the instance level configuration</span>
            <span class="c1">// objects.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">gconf</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">applyConfig</span><span class="p">(</span><span class="nx">gconf</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// bind the specified additional modules for this instance</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">_setup</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Each instance can accept one or more configuration objects.</span>
            <span class="c1">// These are applied after YUI.GlobalConfig and YUI_Config,</span>
            <span class="c1">// overriding values set in those config files if there is a &#39;</span>
            <span class="c1">// matching property.</span>
            <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">applyConfig</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="nx">Y</span><span class="p">.</span><span class="nx">_setup</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span> <span class="o">=</span> <span class="nx">instanceOf</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
    <span class="p">};</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span>
        <span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;3.4.0&#39;</span><span class="p">,</span>
        <span class="nx">PERIOD</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="nx">BASE</span> <span class="o">=</span> <span class="s1">&#39;http://yui.yahooapis.com/&#39;</span><span class="p">,</span>
        <span class="nx">DOC_LABEL</span> <span class="o">=</span> <span class="s1">&#39;yui3-js-enabled&#39;</span><span class="p">,</span>
        <span class="nx">NOOP</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span>
        <span class="nx">SLICE</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">,</span>
        <span class="nx">APPLY_TO_AUTH</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;io.xdrReady&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>   <span class="c1">// the functions applyTo</span>
                          <span class="s1">&#39;io.xdrResponse&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>   <span class="c1">// can call. this should</span>
                          <span class="s1">&#39;SWF.eventHandler&#39;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="c1">// be done at build time</span>
        <span class="nx">hasWin</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">),</span>
        <span class="nx">win</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hasWin</span><span class="p">)</span> <span class="o">?</span> <span class="nb">window</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hasWin</span><span class="p">)</span> <span class="o">?</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">docEl</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
        <span class="nx">docClass</span> <span class="o">=</span> <span class="nx">docEl</span> <span class="o">&amp;&amp;</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">className</span><span class="p">,</span>
        <span class="nx">instances</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">time</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">(),</span>
        <span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">capture</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">capture</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">capture</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// this can throw an uncaught exception in FF</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="nx">el</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">capture</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">handleLoad</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">windowLoaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">DOMReady</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">hasWin</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">remove</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">handleLoad</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">getLoader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">loader</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_loader</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">loader</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">//loader._config(Y.config);</span>
                <span class="nx">loader</span><span class="p">.</span><span class="nx">ignoreRegistered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="nx">loader</span><span class="p">.</span><span class="nx">onEnd</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="nx">loader</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="nx">loader</span><span class="p">.</span><span class="nx">required</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="nx">loader</span><span class="p">.</span><span class="nx">loadType</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Loader</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">);</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_loader</span> <span class="o">=</span> <span class="nx">loader</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">loader</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">clobber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">ALREADY_DONE</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">success</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>

<span class="c1">//  Stamp the documentElement (HTML) with a class of &quot;yui-loaded&quot; to</span>
<span class="c1">//  enable styles that need to key off of JS being enabled.</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">docEl</span> <span class="o">&amp;&amp;</span> <span class="nx">docClass</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">DOC_LABEL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">docClass</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">docClass</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">docClass</span> <span class="o">+=</span> <span class="nx">DOC_LABEL</span><span class="p">;</span>
    <span class="nx">docEl</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">docClass</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">VERSION</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;3.3.0&#39;</span><span class="p">;</span> <span class="c1">// dev time hack for cdn test</span>
<span class="p">}</span>

<span class="nx">proto</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Applies a new configuration object to the YUI instance config.</span>
<span class="cm">     * This will merge new group/module definitions, and will also</span>
<span class="cm">     * update the loader cache if necessary.  Updating Y.config directly</span>
<span class="cm">     * will not update the cache.</span>
<span class="cm">     * @method applyConfig</span>
<span class="cm">     * @param {object} the configuration object.</span>
<span class="cm">     * @since 3.2.0</span>
<span class="cm">     */</span>
    <span class="nx">applyConfig</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span> <span class="o">||</span> <span class="nx">NOOP</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">attr</span><span class="p">,</span>
            <span class="nx">name</span><span class="p">,</span>
            <span class="c1">// detail,</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">,</span>
            <span class="nx">mods</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">modules</span><span class="p">,</span>
            <span class="nx">groups</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">groups</span><span class="p">,</span>
            <span class="nx">rls</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">rls</span><span class="p">,</span>
            <span class="nx">loader</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_loader</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">attr</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">mods</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;modules&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">clobber</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span> <span class="nx">attr</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">groups</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;groups&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">clobber</span><span class="p">(</span><span class="nx">groups</span><span class="p">,</span> <span class="nx">attr</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">rls</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;rls&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">clobber</span><span class="p">(</span><span class="nx">rls</span><span class="p">,</span> <span class="nx">attr</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;win&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">config</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">contentWindow</span> <span class="o">||</span> <span class="nx">attr</span><span class="p">;</span>
                    <span class="nx">config</span><span class="p">.</span><span class="nx">doc</span> <span class="o">=</span> <span class="nx">config</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nb">document</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;_yuid&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// preserve the guid</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">config</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">attr</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">loader</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">_config</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_config</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">applyConfig</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Initialize this YUI instance</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">filter</span><span class="p">,</span>
            <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">G_ENV</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
            <span class="nx">Env</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
            <span class="nx">prop</span><span class="p">;</span>

        <span class="cm">/**</span>
<span class="cm">         * The version number of the YUI instance.</span>
<span class="cm">         * @property version</span>
<span class="cm">         * @type string</span>
<span class="cm">         */</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="nx">VERSION</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Env</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">mods</span><span class="o">:</span> <span class="p">{},</span> <span class="c1">// flat module map</span>
                <span class="nx">versions</span><span class="o">:</span> <span class="p">{},</span> <span class="c1">// version module map</span>
                <span class="nx">base</span><span class="o">:</span> <span class="nx">BASE</span><span class="p">,</span>
                <span class="nx">cdn</span><span class="o">:</span> <span class="nx">BASE</span> <span class="o">+</span> <span class="nx">VERSION</span> <span class="o">+</span> <span class="s1">&#39;/build/&#39;</span><span class="p">,</span>
                <span class="c1">// bootstrapped: false,</span>
                <span class="nx">_idx</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">_used</span><span class="o">:</span> <span class="p">{},</span>
                <span class="nx">_attached</span><span class="o">:</span> <span class="p">{},</span>
                <span class="nx">_missed</span><span class="o">:</span> <span class="p">[],</span>
                <span class="nx">_yidx</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">_uidx</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">_guidp</span><span class="o">:</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span>
                <span class="nx">_loaded</span><span class="o">:</span> <span class="p">{},</span>
                <span class="c1">// serviced: {},</span>
                <span class="c1">// Regex in English:</span>
                <span class="c1">// I&#39;ll start at the \b(simpleyui).</span>
                <span class="c1">// 1. Look in the test string for &quot;simpleyui&quot; or &quot;yui&quot; or</span>
                <span class="c1">//    &quot;yui-base&quot; or &quot;yui-rls&quot; or &quot;yui-foobar&quot; that comes after a word break.  That is, it</span>
                <span class="c1">//    can&#39;t match &quot;foyui&quot; or &quot;i_heart_simpleyui&quot;. This can be anywhere in the string.</span>
                <span class="c1">// 2. After #1 must come a forward slash followed by the string matched in #1, so</span>
                <span class="c1">//    &quot;yui-base/yui-base&quot; or &quot;simpleyui/simpleyui&quot; or &quot;yui-pants/yui-pants&quot;.</span>
                <span class="c1">// 3. The second occurence of the #1 token can optionally be followed by &quot;-debug&quot; or &quot;-min&quot;,</span>
                <span class="c1">//    so &quot;yui/yui-min&quot;, &quot;yui/yui-debug&quot;, &quot;yui-base/yui-base-debug&quot;. NOT &quot;yui/yui-tshirt&quot;.</span>
                <span class="c1">// 4. This is followed by &quot;.js&quot;, so &quot;yui/yui.js&quot;, &quot;simpleyui/simpleyui-min.js&quot;</span>
                <span class="c1">// 0. Going back to the beginning, now. If all that stuff in 1-4 comes after a &quot;?&quot; in the string,</span>
                <span class="c1">//    then capture the junk between the LAST &quot;&amp;&quot; and the string in 1-4.  So</span>
                <span class="c1">//    &quot;blah?foo/yui/yui.js&quot; will capture &quot;foo/&quot; and &quot;blah?some/thing.js&amp;3.3.0/build/yui-rls/yui-rls.js&quot;</span>
                <span class="c1">//    will capture &quot;3.3.0/build/&quot;</span>
                <span class="c1">//</span>
                <span class="c1">// Regex Exploded:</span>
                <span class="c1">// (?:\?             Find a ?</span>
                <span class="c1">//   (?:[^&amp;]*&amp;)      followed by 0..n characters followed by an &amp;</span>
                <span class="c1">//   *               in fact, find as many sets of characters followed by a &amp; as you can</span>
                <span class="c1">//   ([^&amp;]*)         capture the stuff after the last &amp; in \1</span>
                <span class="c1">// )?                but it&#39;s ok if all this ?junk&amp;more_junk stuff isn&#39;t even there</span>
                <span class="c1">// \b(simpleyui|     after a word break find either the string &quot;simpleyui&quot; or</span>
                <span class="c1">//    yui(?:-\w+)?   the string &quot;yui&quot; optionally followed by a -, then more characters</span>
                <span class="c1">// )                 and store the simpleyui or yui-* string in \2</span>
                <span class="c1">// \/\2              then comes a / followed by the simpleyui or yui-* string in \2</span>
                <span class="c1">// (?:-(min|debug))? optionally followed by &quot;-min&quot; or &quot;-debug&quot;</span>
                <span class="c1">// .js               and ending in &quot;.js&quot;</span>
                <span class="nx">_BASE_RE</span><span class="o">:</span> <span class="sr">/(?:\?(?:[^&amp;]*&amp;)*([^&amp;]*))?\b(simpleyui|yui(?:-\w+)?)\/\2(?:-(min|debug))?\.js/</span><span class="p">,</span>

                <span class="nx">parseBasePath</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pattern</span><span class="p">),</span>
                        <span class="nx">path</span><span class="p">,</span> <span class="nx">filter</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">path</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">leftContext</span> <span class="o">||</span> <span class="nx">src</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">src</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>

                        <span class="c1">// this is to set up the path to the loader.  The file</span>
                        <span class="c1">// filter for loader should match the yui include.</span>
                        <span class="nx">filter</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

                        <span class="c1">// extract correct path for mixed combo urls</span>
                        <span class="c1">// http://yuilibrary.com/projects/yui3/ticket/2528423</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nx">path</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                        <span class="p">}</span>
                        <span class="nx">path</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="nx">filter</span><span class="o">:</span> <span class="nx">filter</span><span class="p">,</span>
                            <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="nx">getBase</span><span class="o">:</span> <span class="nx">G_ENV</span> <span class="o">&amp;&amp;</span> <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">getBase</span> <span class="o">||</span>
                        <span class="kd">function</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="p">[],</span>
                                <span class="nx">path</span> <span class="o">=</span> <span class="nx">Env</span><span class="p">.</span><span class="nx">cdn</span><span class="p">,</span> <span class="nx">parsed</span><span class="p">,</span>
                                <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">src</span><span class="p">;</span>

                            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">src</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">src</span><span class="p">;</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nx">parsed</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">parseBasePath</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">);</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">parsed</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="nx">filter</span> <span class="o">=</span> <span class="nx">parsed</span><span class="p">.</span><span class="nx">filter</span><span class="p">;</span>
                                        <span class="nx">path</span> <span class="o">=</span> <span class="nx">parsed</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span>
                                        <span class="k">break</span><span class="p">;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">}</span>

                            <span class="c1">// use CDN default</span>
                            <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
                        <span class="p">}</span>

            <span class="p">};</span>

            <span class="nx">Env</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">;</span>

            <span class="nx">Env</span><span class="p">.</span><span class="nx">_loaded</span><span class="p">[</span><span class="nx">VERSION</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">G_ENV</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span> <span class="o">!==</span> <span class="nx">YUI</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Env</span><span class="p">.</span><span class="nx">_yidx</span> <span class="o">=</span> <span class="o">++</span><span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_yidx</span><span class="p">;</span>
                <span class="nx">Env</span><span class="p">.</span><span class="nx">_guidp</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;yui_&#39;</span> <span class="o">+</span> <span class="nx">VERSION</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>
                             <span class="nx">Env</span><span class="p">.</span><span class="nx">_yidx</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">time</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">_YUI</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">G_ENV</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">_YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">;</span>
                <span class="nx">Env</span><span class="p">.</span><span class="nx">_yidx</span> <span class="o">+=</span> <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_yidx</span><span class="p">;</span>
                <span class="nx">Env</span><span class="p">.</span><span class="nx">_uidx</span> <span class="o">+=</span> <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_uidx</span><span class="p">;</span>

                <span class="k">for</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">G_ENV</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">Env</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">Env</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">G_ENV</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">delete</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">_YUI</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">Y</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">Y</span><span class="p">);</span>
            <span class="nx">instances</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">;</span>

        <span class="p">}</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">;</span>

        <span class="c1">// configuration defaults</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span> <span class="o">||</span> <span class="p">{</span>
            <span class="nx">win</span><span class="o">:</span> <span class="nx">win</span><span class="p">,</span>
            <span class="nx">doc</span><span class="o">:</span> <span class="nx">doc</span><span class="p">,</span>
            <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">useBrowserConsole</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">throwFail</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">bootstrap</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">cacheUse</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">fetchCSS</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">use_rls</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">};</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">lang</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">lang</span> <span class="o">||</span> <span class="s1">&#39;en-US&#39;</span><span class="p">;</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">base</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">getBase</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_BASE_RE</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">filter</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;mindebug&#39;</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">filter</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nx">filter</span> <span class="o">=</span> <span class="s1">&#39;min&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">filter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">filter</span> <span class="o">:</span> <span class="nx">filter</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">loaderPath</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">loaderPath</span> <span class="o">||</span> <span class="s1">&#39;loader/loader&#39;</span> <span class="o">+</span> <span class="nx">filter</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">;</span>

    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Finishes the instance setup. Attaches whatever modules were defined</span>
<span class="cm">     * when the yui modules was registered.</span>
<span class="cm">     * @method _setup</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">core</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">mods</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">mods</span><span class="p">,</span>
            <span class="nx">extras</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">core</span> <span class="o">||</span> <span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;intl-base&#39;</span><span class="p">,</span><span class="s1">&#39;yui-log&#39;</span><span class="p">,</span><span class="s1">&#39;yui-later&#39;</span><span class="p">,</span><span class="s1">&#39;loader-base&#39;</span><span class="p">,</span> <span class="s1">&#39;loader-rollup&#39;</span><span class="p">,</span> <span class="s1">&#39;loader-yui3&#39;</span><span class="p">];</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">extras</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mods</span><span class="p">[</span><span class="nx">extras</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
                <span class="nx">core</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">extras</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">([</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]);</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">core</span><span class="p">);</span>

        <span class="c1">// Y.log(Y.id + &#39; initialized&#39;, &#39;info&#39;, &#39;yui&#39;);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Executes a method on a YUI instance with</span>
<span class="cm">     * the specified id if the specified method is whitelisted.</span>
<span class="cm">     * @method applyTo</span>
<span class="cm">     * @param id {string} the YUI instance id.</span>
<span class="cm">     * @param method {string} the name of the method to exectute.</span>
<span class="cm">     * Ex: &#39;Object.keys&#39;.</span>
<span class="cm">     * @param args {Array} the arguments to apply to the method.</span>
<span class="cm">     * @return {object} the return value from the applied method or null.</span>
<span class="cm">     */</span>
    <span class="nx">applyTo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">method</span> <span class="k">in</span> <span class="nx">APPLY_TO_AUTH</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: applyTo not allowed&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">instances</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="nx">nest</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">nest</span> <span class="o">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nest</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="nx">nest</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;applyTo not found: &#39;</span> <span class="o">+</span> <span class="nx">method</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Registers a module with the YUI global.  The easiest way to create a</span>
<span class="cm">     * first-class YUI module is to use the YUI component build tool.</span>
<span class="cm">     *</span>
<span class="cm">     * http://yuilibrary.com/projects/builder</span>
<span class="cm">     *</span>
<span class="cm">     * The build system will produce the YUI.add wrapper for you module, along</span>
<span class="cm">     * with any configuration info required for the module.</span>
<span class="cm">     * @method add</span>
<span class="cm">     * @param name {string} module name.</span>
<span class="cm">     * @param fn {Function} entry point into the module that</span>
<span class="cm">     * is used to bind module to the YUI instance.</span>
<span class="cm">     * @param version {string} version string.</span>
<span class="cm">     * @param details {object} optional config data:</span>
<span class="cm">     * requires: features that must be present before this module can be</span>
<span class="cm">     * attached.</span>
<span class="cm">     * optional: optional features that should be present if loadOptional</span>
<span class="cm">     * is defined.  Note: modules are not often loaded this way in YUI 3,</span>
<span class="cm">     * but this field is still useful to inform the user that certain</span>
<span class="cm">     * features in the component will require additional dependencies.</span>
<span class="cm">     * use: features that are included within this module which need to</span>
<span class="cm">     * be attached automatically when this module is attached.  This</span>
<span class="cm">     * supports the YUI 3 rollup system -- a module with submodules</span>
<span class="cm">     * defined will need to have the submodules listed in the &#39;use&#39;</span>
<span class="cm">     * config.  The YUI component build tool does this for you.</span>
<span class="cm">     * @return {YUI} the YUI instance.</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">version</span><span class="p">,</span> <span class="nx">details</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">details</span> <span class="o">=</span> <span class="nx">details</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
            <span class="nx">mod</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
                <span class="nx">fn</span><span class="o">:</span> <span class="nx">fn</span><span class="p">,</span>
                <span class="nx">version</span><span class="o">:</span> <span class="nx">version</span><span class="p">,</span>
                <span class="nx">details</span><span class="o">:</span> <span class="nx">details</span>
            <span class="p">},</span>
            <span class="nx">loader</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">versions</span> <span class="o">=</span> <span class="nx">env</span><span class="p">.</span><span class="nx">versions</span><span class="p">;</span>

        <span class="nx">env</span><span class="p">.</span><span class="nx">mods</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">;</span>
        <span class="nx">versions</span><span class="p">[</span><span class="nx">version</span><span class="p">]</span> <span class="o">=</span> <span class="nx">versions</span><span class="p">[</span><span class="nx">version</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">versions</span><span class="p">[</span><span class="nx">version</span><span class="p">][</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">instances</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">instances</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">loader</span> <span class="o">=</span> <span class="nx">instances</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_loader</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">loader</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loader</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">loader</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="nx">details</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Executes the function associated with each required</span>
<span class="cm">     * module, binding the module to the YUI instance.</span>
<span class="cm">     * @method _attach</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_attach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">moot</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">mod</span><span class="p">,</span> <span class="nx">details</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">use</span><span class="p">,</span> <span class="nx">after</span><span class="p">,</span>
            <span class="nx">mods</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">mods</span><span class="p">,</span>
            <span class="nx">aliases</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">aliases</span><span class="p">,</span>
            <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span>
            <span class="nx">done</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_attached</span><span class="p">,</span>
            <span class="nx">len</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">loader</span><span class="p">;</span>

        <span class="c1">//console.info(&#39;attaching: &#39; + r, &#39;info&#39;, &#39;yui&#39;);</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">done</span><span class="p">[</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
                <span class="nx">name</span> <span class="o">=</span> <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">mod</span> <span class="o">=</span> <span class="nx">mods</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">aliases</span> <span class="o">&amp;&amp;</span> <span class="nx">aliases</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">aliases</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mod</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">loader</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_loader</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">loader</span> <span class="o">&amp;&amp;</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">mod</span> <span class="o">=</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">use</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">moot</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">// Y.log(&#39;no js def for: &#39; + name, &#39;info&#39;, &#39;yui&#39;);</span>

                    <span class="c1">//if (!loader || !loader.moduleInfo[name]) {</span>
                    <span class="c1">//if ((!loader || !loader.moduleInfo[name]) &amp;&amp; !moot) {</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">moot</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;skin-&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_missed</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                            <span class="nx">Y</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">&#39;NOT loaded: &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">done</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="c1">//Don&#39;t like this, but in case a mod was asked for once, then we fetch it</span>
                    <span class="c1">//We need to remove it from the missed list</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_missed</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_missed</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">===</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">Y</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; (was reported as missing earlier)&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                            <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_missed</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="nx">details</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">details</span><span class="p">;</span>
                    <span class="nx">req</span> <span class="o">=</span> <span class="nx">details</span><span class="p">.</span><span class="nx">requires</span><span class="p">;</span>
                    <span class="nx">use</span> <span class="o">=</span> <span class="nx">details</span><span class="p">.</span><span class="nx">use</span><span class="p">;</span>
                    <span class="nx">after</span> <span class="o">=</span> <span class="nx">details</span><span class="p">.</span><span class="nx">after</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">done</span><span class="p">[</span><span class="nx">req</span><span class="p">[</span><span class="nx">j</span><span class="p">]])</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                                <span class="p">}</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">after</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">after</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">done</span><span class="p">[</span><span class="nx">after</span><span class="p">[</span><span class="nx">j</span><span class="p">]])</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">after</span><span class="p">,</span> <span class="kc">true</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                                <span class="p">}</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">mod</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">Y</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Attach error: &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">use</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">use</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">done</span><span class="p">[</span><span class="nx">use</span><span class="p">[</span><span class="nx">j</span><span class="p">]])</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">use</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                                <span class="p">}</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>



                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Attaches one or more modules to the YUI instance.  When this</span>
<span class="cm">     * is executed, the requirements are analyzed, and one of</span>
<span class="cm">     * several things can happen:</span>
<span class="cm">     *</span>
<span class="cm">     * - All requirements are available on the page --  The modules</span>
<span class="cm">     *   are attached to the instance.  If supplied, the use callback</span>
<span class="cm">     *   is executed synchronously.</span>
<span class="cm">     *</span>
<span class="cm">     * - Modules are missing, the Get utility is not available OR</span>
<span class="cm">     *   the &#39;bootstrap&#39; config is false -- A warning is issued about</span>
<span class="cm">     *   the missing modules and all available modules are attached.</span>
<span class="cm">     *</span>
<span class="cm">     * - Modules are missing, the Loader is not available but the Get</span>
<span class="cm">     *   utility is and boostrap is not false -- The loader is bootstrapped</span>
<span class="cm">     *   before doing the following....</span>
<span class="cm">     *</span>
<span class="cm">     * - Modules are missing and the Loader is available -- The loader</span>
<span class="cm">     *   expands the dependency tree and fetches missing modules.  When</span>
<span class="cm">     *   the loader is finshed the callback supplied to use is executed</span>
<span class="cm">     *   asynchronously.</span>
<span class="cm">     *</span>
<span class="cm">     * @param modules* {string} 1-n modules to bind (uses arguments array).</span>
<span class="cm">     * @param *callback {function} callback function executed when</span>
<span class="cm">     * the instance has the required functionality.  If included, it</span>
<span class="cm">     * must be the last parameter.</span>
<span class="cm">     * &lt;code&gt;</span>
<span class="cm">     * // loads and attaches dd and its dependencies</span>
<span class="cm">     * YUI().use(&#39;dd&#39;, function(Y) &amp;#123;&amp;#125);</span>
<span class="cm">     * // loads and attaches dd and node as well as all of their dependencies</span>
<span class="cm">     * YUI().use([&#39;dd&#39;, &#39;node&#39;], function(Y) &amp;#123;&amp;#125);</span>
<span class="cm">     * // attaches all modules that are available on the page</span>
<span class="cm">     * YUI().use(&#39;*&#39;, function(Y) &amp;#123;&amp;#125);</span>
<span class="cm">     * // intrinsic YUI gallery support (since 3.1.0)</span>
<span class="cm">     * YUI().use(&#39;gallery-yql&#39;, function(Y) &amp;#123;&amp;#125);</span>
<span class="cm">     * // intrinsic YUI 2in3 support (since 3.1.0)</span>
<span class="cm">     * YUI().use(&#39;yui2-datatable&#39;, function(Y) &amp;#123;&amp;#125);.</span>
<span class="cm">     * &lt;/code&gt;</span>
<span class="cm">     *</span>
<span class="cm">     * @return {YUI} the YUI instance.</span>
<span class="cm">     */</span>
    <span class="nx">use</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">SLICE</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">name</span><span class="p">,</span>
            <span class="nx">Env</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
            <span class="nx">provisioned</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="c1">// The last argument supplied to use can be a load complete callback</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">callback</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">cacheUse</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">((</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_attached</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">provisioned</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">provisioned</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;already provisioned: &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">ALREADY_DONE</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">cacheUse</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">((</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_attached</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">provisioned</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">provisioned</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;already provisioned: &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">ALREADY_DONE</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_loading</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">_useQueue</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">_useQueue</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Queue</span><span class="p">();</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">_useQueue</span><span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">_use</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_notify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">loadErrorFn</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">loadErrorFn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;use callback error&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_use</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_attach</span><span class="p">([</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">loader</span><span class="p">,</span> <span class="nx">handleBoot</span><span class="p">,</span> <span class="nx">handleRLS</span><span class="p">,</span>
            <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">G_ENV</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
            <span class="nx">mods</span> <span class="o">=</span> <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">mods</span><span class="p">,</span>
            <span class="nx">Env</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
            <span class="nx">used</span> <span class="o">=</span> <span class="nx">Env</span><span class="p">.</span><span class="nx">_used</span><span class="p">,</span>
            <span class="nx">queue</span> <span class="o">=</span> <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_loaderQueue</span><span class="p">,</span>
            <span class="nx">firstArg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">YArray</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">,</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">,</span>
            <span class="nx">boot</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">bootstrap</span><span class="p">,</span>
            <span class="nx">missing</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">fetchCSS</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">fetchCSS</span><span class="p">,</span>
            <span class="nx">process</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">names</span><span class="p">,</span> <span class="nx">skip</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nx">YArray</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">names</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>

                    <span class="c1">// add this module to full list of things to attach</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">skip</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="c1">// only attach a module once</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">used</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">mods</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">use</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">used</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="nx">req</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">details</span><span class="p">.</span><span class="nx">requires</span><span class="p">;</span>
                        <span class="nx">use</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">details</span><span class="p">.</span><span class="nx">use</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// CSS files don&#39;t register themselves, see if it has</span>
                        <span class="c1">// been loaded</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_loaded</span><span class="p">[</span><span class="nx">VERSION</span><span class="p">][</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nx">missing</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">used</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// probably css</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">// make sure requirements are attached</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">process</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="c1">// make sure we grab the submodule dependencies too</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">use</span> <span class="o">&amp;&amp;</span> <span class="nx">use</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">process</span><span class="p">(</span><span class="nx">use</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">},</span>

            <span class="nx">handleLoader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fromLoader</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">fromLoader</span> <span class="o">||</span> <span class="p">{</span>
                        <span class="nx">success</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                        <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;not dynamic&#39;</span>
                    <span class="p">},</span>
                    <span class="nx">redo</span><span class="p">,</span> <span class="nx">origMissing</span><span class="p">,</span>
                    <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nx">data</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>


                <span class="nx">Y</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">origMissing</span> <span class="o">=</span> <span class="nx">missing</span><span class="p">;</span>
                    <span class="nx">missing</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
                    <span class="nx">redo</span> <span class="o">=</span> <span class="nx">missing</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">redo</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">missing</span><span class="p">.</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">()</span> <span class="o">==</span>
                                <span class="nx">origMissing</span><span class="p">.</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">())</span> <span class="p">{</span>
                            <span class="nx">redo</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">redo</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">_use</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Nested use callback: &#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">Y</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Y.log(&#39;attaching from loader: &#39; + data, &#39;info&#39;, &#39;yui&#39;);</span>
                        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">Y</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_useQueue</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">_useQueue</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_loading</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">_use</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">_useQueue</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>
                <span class="p">}</span>

            <span class="p">};</span>

<span class="c1">// Y.log(Y.id + &#39;: use called: &#39; + a + &#39; :: &#39; + callback, &#39;info&#39;, &#39;yui&#39;);</span>

        <span class="c1">// YUI().use(&#39;*&#39;); // bind everything available</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">firstArg</span> <span class="o">===</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">mods</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">handleLoader</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Y.log(&#39;before loader requirements: &#39; + args, &#39;info&#39;, &#39;yui&#39;);</span>

        <span class="c1">// use loader to expand dependencies and sort the</span>
        <span class="c1">// requirements if it is available.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">boot</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Loader</span> <span class="o">&amp;&amp;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">loader</span> <span class="o">=</span> <span class="nx">getLoader</span><span class="p">(</span><span class="nx">Y</span><span class="p">);</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">ignoreRegistered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">calculate</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">(</span><span class="nx">fetchCSS</span><span class="p">)</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="s1">&#39;js&#39;</span><span class="p">);</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">sorted</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// process each requirement and any additional requirements</span>
        <span class="c1">// the module metadata specifies</span>
        <span class="nx">process</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>

        <span class="nx">len</span> <span class="o">=</span> <span class="nx">missing</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">missing</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">missing</span><span class="p">));</span>
            <span class="nx">len</span> <span class="o">=</span> <span class="nx">missing</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Modules missing: &#39;</span> <span class="o">+</span> <span class="nx">missing</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">missing</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// dynamic load</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">boot</span> <span class="o">&amp;&amp;</span> <span class="nx">len</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Loader</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// Y.log(&#39;Using loader to fetch missing deps: &#39; + missing, &#39;info&#39;, &#39;yui&#39;);</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Using Loader&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">loader</span> <span class="o">=</span> <span class="nx">getLoader</span><span class="p">(</span><span class="nx">Y</span><span class="p">);</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">onEnd</span> <span class="o">=</span> <span class="nx">handleLoader</span><span class="p">;</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">;</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">ignoreRegistered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
            <span class="nx">loader</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">(</span><span class="nx">fetchCSS</span><span class="p">)</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="s1">&#39;js&#39;</span><span class="p">);</span>
            <span class="c1">// loader.partial(missing, (fetchCSS) ? null : &#39;js&#39;);</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">use_rls</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_queue</span> <span class="o">=</span> <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_queue</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Queue</span><span class="p">();</span>

            <span class="c1">// server side loader service</span>
            <span class="nx">handleRLS</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">argz</span><span class="p">)</span> <span class="p">{</span>

                <span class="kd">var</span> <span class="nx">rls_end</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">handleLoader</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
                    <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_in_progress</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_queue</span><span class="p">.</span><span class="nx">size</span><span class="p">())</span> <span class="p">{</span>
                        <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_queue</span><span class="p">.</span><span class="nx">next</span><span class="p">()();</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nx">rls_url</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">_rls</span><span class="p">(</span><span class="nx">argz</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">rls_url</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetching RLS url&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;rls&#39;</span><span class="p">);</span>
                    <span class="nx">instance</span><span class="p">.</span><span class="nx">rls_oncomplete</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">rls_end</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
                    <span class="p">});</span>
                    <span class="nx">instance</span><span class="p">.</span><span class="nx">Get</span><span class="p">.</span><span class="nx">script</span><span class="p">(</span><span class="nx">rls_url</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">data</span><span class="o">:</span> <span class="nx">argz</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">rls_end</span><span class="p">({</span>
                        <span class="nx">data</span><span class="o">:</span> <span class="nx">argz</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_queue</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;executing queued rls request&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;rls&#39;</span><span class="p">);</span>
                <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_in_progress</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>                
                <span class="nx">Y</span><span class="p">.</span><span class="nx">rls_locals</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">handleRLS</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_in_progress</span> <span class="o">&amp;&amp;</span> <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_queue</span><span class="p">.</span><span class="nx">size</span><span class="p">())</span> <span class="p">{</span>
                <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_rls_queue</span><span class="p">.</span><span class="nx">next</span><span class="p">()();</span>
            <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">boot</span> <span class="o">&amp;&amp;</span> <span class="nx">len</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Env</span><span class="p">.</span><span class="nx">bootstrapped</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">Y</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="nx">handleBoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="nx">queue</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="nx">Env</span><span class="p">.</span><span class="nx">bootstrapped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">([</span><span class="s1">&#39;loader&#39;</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">_use</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_bootstrapping</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Waiting for loader&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                <span class="nx">queue</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">handleBoot</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">G_ENV</span><span class="p">.</span><span class="nx">_bootstrapping</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Fetching loader: &#39;</span> <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">base</span> <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">loaderPath</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span><span class="p">.</span><span class="nx">script</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">base</span> <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">loaderPath</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">onEnd</span><span class="o">:</span> <span class="nx">handleBoot</span>
                <span class="p">});</span>
            <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Attaching available dependencies: &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;yui&#39;</span><span class="p">);</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">handleLoader</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
    <span class="p">},</span>


    <span class="cm">/**</span>
<span class="cm">     * Returns the namespace specified and creates it if it doesn&#39;t exist</span>
<span class="cm">     * &lt;pre&gt;</span>
<span class="cm">     * YUI.namespace(&quot;property.package&quot;);</span>
<span class="cm">     * YUI.namespace(&quot;YAHOO.property.package&quot;);</span>
<span class="cm">     * &lt;/pre&gt;</span>
<span class="cm">     * Either of the above would create YUI.property, then</span>
<span class="cm">     * YUI.property.package (YAHOO is scrubbed out, this is</span>
<span class="cm">     * to remain compatible with YUI2)</span>
<span class="cm">     *</span>
<span class="cm">     * Be careful when naming packages. Reserved words may work in some browsers</span>
<span class="cm">     * and not others. For instance, the following will fail in Safari:</span>
<span class="cm">     * &lt;pre&gt;</span>
<span class="cm">     * YUI.namespace(&quot;really.long.nested.namespace&quot;);</span>
<span class="cm">     * &lt;/pre&gt;</span>
<span class="cm">     * This fails because &quot;long&quot; is a future reserved word in ECMAScript</span>
<span class="cm">     *</span>
<span class="cm">     * @method namespace</span>
<span class="cm">     * @param  {string*} arguments 1-n namespaces to create.</span>
<span class="cm">     * @return {object}  A reference to the last namespace object created.</span>
<span class="cm">     */</span>
    <span class="nx">namespace</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span> <span class="nx">o</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">arg</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// d = (&#39;&#39; + a[i]).split(&#39;.&#39;);</span>
            <span class="nx">arg</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">arg</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">PERIOD</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">d</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">PERIOD</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;YAHOO&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">[</span><span class="nx">d</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">d</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">||</span> <span class="p">{};</span>
                    <span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">d</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">o</span><span class="p">[</span><span class="nx">arg</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">arg</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="c1">// this is replaced if the log module is included</span>
    <span class="nx">log</span><span class="o">:</span> <span class="nx">NOOP</span><span class="p">,</span>
    <span class="nx">message</span><span class="o">:</span> <span class="nx">NOOP</span><span class="p">,</span>
    <span class="c1">// this is replaced if the dump module is included</span>
    <span class="nx">dump</span><span class="o">:</span> <span class="nx">NOOP</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Report an error.  The reporting mechanism is controled by</span>
<span class="cm">     * the &#39;throwFail&#39; configuration attribute.  If throwFail is</span>
<span class="cm">     * not specified, the message is written to the Logger, otherwise</span>
<span class="cm">     * a JS error is thrown</span>
<span class="cm">     * @method error</span>
<span class="cm">     * @param msg {string} the error message.</span>
<span class="cm">     * @param e {Error|string} Optional JS error that was caught, or an error string.</span>
<span class="cm">     * @param data Optional additional info</span>
<span class="cm">     * and throwFail is specified, this error will be re-thrown.</span>
<span class="cm">     * @return {YUI} this YUI instance.</span>
<span class="cm">     */</span>
    <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">ret</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">errorFn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">errorFn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">throwFail</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">ret</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="p">(</span><span class="nx">e</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">);</span> <span class="c1">// don&#39;t scrub this one</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Generate an id that is unique among all YUI instances</span>
<span class="cm">     * @method guid</span>
<span class="cm">     * @param pre {string} optional guid prefix.</span>
<span class="cm">     * @return {string} the guid.</span>
<span class="cm">     */</span>
    <span class="nx">guid</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pre</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_guidp</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_uidx</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">pre</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">pre</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span> <span class="o">:</span> <span class="nx">id</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns a guid associated with an object.  If the object</span>
<span class="cm">     * does not have one, a new one is created unless readOnly</span>
<span class="cm">     * is specified.</span>
<span class="cm">     * @method stamp</span>
<span class="cm">     * @param o The object to stamp.</span>
<span class="cm">     * @param readOnly {boolean} if true, a valid guid will only</span>
<span class="cm">     * be returned if the object has one assigned to it.</span>
<span class="cm">     * @return {string} The object&#39;s guid or null.</span>
<span class="cm">     */</span>
    <span class="nx">stamp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">readOnly</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">uid</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// IE generates its own unique ID for dom nodes</span>
        <span class="c1">// The uniqueID property of a document node returns a new ID</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">uniqueID</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">uniqueID</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">o</span> <span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">_yuid</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uid</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">guid</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">readOnly</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">_yuid</span> <span class="o">=</span> <span class="nx">uid</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">uid</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">uid</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Destroys the YUI instance</span>
<span class="cm">     * @method destroy</span>
<span class="cm">     * @since 3.3.0</span>
<span class="cm">     */</span>
    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">Y</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_unload</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">delete</span> <span class="nx">instances</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
        <span class="k">delete</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * instanceof check for objects that works around</span>
<span class="cm">     * memory leak in IE when the item tested is</span>
<span class="cm">     * window/document</span>
<span class="cm">     * @method instanceOf</span>
<span class="cm">     * @since 3.3.0</span>
<span class="cm">     */</span>
<span class="p">};</span>



    <span class="nx">YUI</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">;</span>

    <span class="c1">// inheritance utilities are not available yet</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">proto</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">proto</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">YUI</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// set up the environment</span>
    <span class="nx">YUI</span><span class="p">.</span><span class="nx">_init</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">hasWin</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// add a window load event at load time so we can capture</span>
        <span class="c1">// the case where it fires before dynamic loading is</span>
        <span class="c1">// complete.</span>
        <span class="nx">add</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">handleLoad</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">handleLoad</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="nx">add</span><span class="p">;</span>
    <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="nx">remove</span><span class="p">;</span>

    <span class="cm">/*global exports*/</span>
    <span class="c1">// Support the CommonJS method for exporting our single global</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">exports</span><span class="p">.</span><span class="nx">YUI</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}());</span>


<span class="cm">/**</span>
<span class="cm"> * The config object contains all of the configuration options for</span>
<span class="cm"> * the YUI instance.  This object is supplied by the implementer</span>
<span class="cm"> * when instantiating a YUI instance.  Some properties have default</span>
<span class="cm"> * values if they are not supplied by the implementer.  This should</span>
<span class="cm"> * not be updated directly because some values are cached.  Use</span>
<span class="cm"> * applyConfig() to update the config object on a YUI instance that</span>
<span class="cm"> * has already been configured.</span>
<span class="cm"> *</span>
<span class="cm"> * @class config</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Allows the YUI seed file to fetch the loader component and library</span>
<span class="cm"> * metadata to dynamically load additional dependencies.</span>
<span class="cm"> *</span>
<span class="cm"> * @property bootstrap</span>
<span class="cm"> * @type boolean</span>
<span class="cm"> * @default true</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Log to the browser console if debug is on and the browser has a</span>
<span class="cm"> * supported console.</span>
<span class="cm"> *</span>
<span class="cm"> * @property useBrowserConsole</span>
<span class="cm"> * @type boolean</span>
<span class="cm"> * @default true</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A hash of log sources that should be logged.  If specified, only</span>
<span class="cm"> * log messages from these sources will be logged.</span>
<span class="cm"> *</span>
<span class="cm"> * @property logInclude</span>
<span class="cm"> * @type object</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A hash of log sources that should be not be logged.  If specified,</span>
<span class="cm"> * all sources are logged if not on this list.</span>
<span class="cm"> *</span>
<span class="cm"> * @property logExclude</span>
<span class="cm"> * @type object</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Set to true if the yui seed file was dynamically loaded in</span>
<span class="cm"> * order to bootstrap components relying on the window load event</span>
<span class="cm"> * and the &#39;domready&#39; custom event.</span>
<span class="cm"> *</span>
<span class="cm"> * @property injected</span>
<span class="cm"> * @type boolean</span>
<span class="cm"> * @default false</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * If throwFail is set, Y.error will generate or re-throw a JS Error.</span>
<span class="cm"> * Otherwise the failure is logged.</span>
<span class="cm"> *</span>
<span class="cm"> * @property throwFail</span>
<span class="cm"> * @type boolean</span>
<span class="cm"> * @default true</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The window/frame that this instance should operate in.</span>
<span class="cm"> *</span>
<span class="cm"> * @property win</span>
<span class="cm"> * @type Window</span>
<span class="cm"> * @default the window hosting YUI</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The document associated with the &#39;win&#39; configuration.</span>
<span class="cm"> *</span>
<span class="cm"> * @property doc</span>
<span class="cm"> * @type Document</span>
<span class="cm"> * @default the document hosting YUI</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A list of modules that defines the YUI core (overrides the default).</span>
<span class="cm"> *</span>
<span class="cm"> * @property core</span>
<span class="cm"> * @type string[]</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A list of languages in order of preference. This list is matched against</span>
<span class="cm"> * the list of available languages in modules that the YUI instance uses to</span>
<span class="cm"> * determine the best possible localization of language sensitive modules.</span>
<span class="cm"> * Languages are represented using BCP 47 language tags, such as &quot;en-GB&quot; for</span>
<span class="cm"> * English as used in the United Kingdom, or &quot;zh-Hans-CN&quot; for simplified</span>
<span class="cm"> * Chinese as used in China. The list can be provided as a comma-separated</span>
<span class="cm"> * list or as an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @property lang</span>
<span class="cm"> * @type string|string[]</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The default date format</span>
<span class="cm"> * @property dateFormat</span>
<span class="cm"> * @type string</span>
<span class="cm"> * @deprecated use configuration in DataType.Date.format() instead.</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The default locale</span>
<span class="cm"> * @property locale</span>
<span class="cm"> * @type string</span>
<span class="cm"> * @deprecated use config.lang instead.</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The default interval when polling in milliseconds.</span>
<span class="cm"> * @property pollInterval</span>
<span class="cm"> * @type int</span>
<span class="cm"> * @default 20</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The number of dynamic nodes to insert by default before</span>
<span class="cm"> * automatically removing them.  This applies to script nodes</span>
<span class="cm"> * because remove the node will not make the evaluated script</span>
<span class="cm"> * unavailable.  Dynamic CSS is not auto purged, because removing</span>
<span class="cm"> * a linked style sheet will also remove the style definitions.</span>
<span class="cm"> * @property purgethreshold</span>
<span class="cm"> * @type int</span>
<span class="cm"> * @default 20</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The default interval when polling in milliseconds.</span>
<span class="cm"> * @property windowResizeDelay</span>
<span class="cm"> * @type int</span>
<span class="cm"> * @default 40</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Base directory for dynamic loading</span>
<span class="cm"> * @property base</span>
<span class="cm"> * @type string</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * The secure base dir (not implemented)</span>
<span class="cm"> * For dynamic loading.</span>
<span class="cm"> * @property secureBase</span>
<span class="cm"> * @type string</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The YUI combo service base dir. Ex: http://yui.yahooapis.com/combo?</span>
<span class="cm"> * For dynamic loading.</span>
<span class="cm"> * @property comboBase</span>
<span class="cm"> * @type string</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The root path to prepend to module path for the combo service.</span>
<span class="cm"> * Ex: 3.0.0b1/build/</span>
<span class="cm"> * For dynamic loading.</span>
<span class="cm"> * @property root</span>
<span class="cm"> * @type string</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A filter to apply to result urls.  This filter will modify the default</span>
<span class="cm"> * path for all modules.  The default path for the YUI library is the</span>
<span class="cm"> * minified version of the files (e.g., event-min.js).  The filter property</span>
<span class="cm"> * can be a predefined filter or a custom filter.  The valid predefined</span>
<span class="cm"> * filters are:</span>
<span class="cm"> * &lt;dl&gt;</span>
<span class="cm"> *  &lt;dt&gt;DEBUG&lt;/dt&gt;</span>
<span class="cm"> *  &lt;dd&gt;Selects the debug versions of the library (e.g., event-debug.js).</span>
<span class="cm"> *      This option will automatically include the Logger widget&lt;/dd&gt;</span>
<span class="cm"> *  &lt;dt&gt;RAW&lt;/dt&gt;</span>
<span class="cm"> *  &lt;dd&gt;Selects the non-minified version of the library (e.g., event.js).&lt;/dd&gt;</span>
<span class="cm"> * &lt;/dl&gt;</span>
<span class="cm"> * You can also define a custom filter, which must be an object literal</span>
<span class="cm"> * containing a search expression and a replace string:</span>
<span class="cm"> * &lt;pre&gt;</span>
<span class="cm"> *  myFilter: &amp;#123;</span>
<span class="cm"> *      &#39;searchExp&#39;: &quot;-min\\.js&quot;,</span>
<span class="cm"> *      &#39;replaceStr&#39;: &quot;-debug.js&quot;</span>
<span class="cm"> *  &amp;#125;</span>
<span class="cm"> * &lt;/pre&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * For dynamic loading.</span>
<span class="cm"> *</span>
<span class="cm"> * @property filter</span>
<span class="cm"> * @type string|object</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The &#39;skin&#39; config let&#39;s you configure application level skin</span>
<span class="cm"> * customizations.  It contains the following attributes which</span>
<span class="cm"> * can be specified to override the defaults:</span>
<span class="cm"> *</span>
<span class="cm"> *      // The default skin, which is automatically applied if not</span>
<span class="cm"> *      // overriden by a component-specific skin definition.</span>
<span class="cm"> *      // Change this in to apply a different skin globally</span>
<span class="cm"> *      defaultSkin: &#39;sam&#39;,</span>
<span class="cm"> *</span>
<span class="cm"> *      // This is combined with the loader base property to get</span>
<span class="cm"> *      // the default root directory for a skin.</span>
<span class="cm"> *      base: &#39;assets/skins/&#39;,</span>
<span class="cm"> *</span>
<span class="cm"> *      // Any component-specific overrides can be specified here,</span>
<span class="cm"> *      // making it possible to load different skins for different</span>
<span class="cm"> *      // components.  It is possible to load more than one skin</span>
<span class="cm"> *      // for a given component as well.</span>
<span class="cm"> *      overrides: {</span>
<span class="cm"> *          slider: [&#39;capsule&#39;, &#39;round&#39;]</span>
<span class="cm"> *      }</span>
<span class="cm"> *</span>
<span class="cm"> * For dynamic loading.</span>
<span class="cm"> *</span>
<span class="cm"> *  @property skin</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Hash of per-component filter specification.  If specified for a given</span>
<span class="cm"> * component, this overrides the filter config.</span>
<span class="cm"> *</span>
<span class="cm"> * For dynamic loading.</span>
<span class="cm"> *</span>
<span class="cm"> * @property filters</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Use the YUI combo service to reduce the number of http connections</span>
<span class="cm"> * required to load your dependencies.  Turning this off will</span>
<span class="cm"> * disable combo handling for YUI and all module groups configured</span>
<span class="cm"> * with a combo service.</span>
<span class="cm"> *</span>
<span class="cm"> * For dynamic loading.</span>
<span class="cm"> *</span>
<span class="cm"> * @property combine</span>
<span class="cm"> * @type boolean</span>
<span class="cm"> * @default true if &#39;base&#39; is not supplied, false if it is.</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A list of modules that should never be dynamically loaded</span>
<span class="cm"> *</span>
<span class="cm"> * @property ignore</span>
<span class="cm"> * @type string[]</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A list of modules that should always be loaded when required, even if already</span>
<span class="cm"> * present on the page.</span>
<span class="cm"> *</span>
<span class="cm"> * @property force</span>
<span class="cm"> * @type string[]</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Node or id for a node that should be used as the insertion point for new</span>
<span class="cm"> * nodes.  For dynamic loading.</span>
<span class="cm"> *</span>
<span class="cm"> * @property insertBefore</span>
<span class="cm"> * @type string</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Object literal containing attributes to add to dynamically loaded script</span>
<span class="cm"> * nodes.</span>
<span class="cm"> * @property jsAttributes</span>
<span class="cm"> * @type string</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Object literal containing attributes to add to dynamically loaded link</span>
<span class="cm"> * nodes.</span>
<span class="cm"> * @property cssAttributes</span>
<span class="cm"> * @type string</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Number of milliseconds before a timeout occurs when dynamically</span>
<span class="cm"> * loading nodes. If not set, there is no timeout.</span>
<span class="cm"> * @property timeout</span>
<span class="cm"> * @type int</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Callback for the &#39;CSSComplete&#39; event.  When dynamically loading YUI</span>
<span class="cm"> * components with CSS, this property fires when the CSS is finished</span>
<span class="cm"> * loading but script loading is still ongoing.  This provides an</span>
<span class="cm"> * opportunity to enhance the presentation of a loading page a little</span>
<span class="cm"> * bit before the entire loading process is done.</span>
<span class="cm"> *</span>
<span class="cm"> * @property onCSS</span>
<span class="cm"> * @type function</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A hash of module definitions to add to the list of YUI components.</span>
<span class="cm"> * These components can then be dynamically loaded side by side with</span>
<span class="cm"> * YUI via the use() method. This is a hash, the key is the module</span>
<span class="cm"> * name, and the value is an object literal specifying the metdata</span>
<span class="cm"> * for the module.  * See Loader.addModule for the supported module</span>
<span class="cm"> * metadata fields.  Also @see groups, which provides a way to</span>
<span class="cm"> * configure the base and combo spec for a set of modules.</span>
<span class="cm"> * &lt;code&gt;</span>
<span class="cm"> * modules: {</span>
<span class="cm"> * &amp;nbsp; mymod1: {</span>
<span class="cm"> * &amp;nbsp;   requires: [&#39;node&#39;],</span>
<span class="cm"> * &amp;nbsp;   fullpath: &#39;http://myserver.mydomain.com/mymod1/mymod1.js&#39;</span>
<span class="cm"> * &amp;nbsp; },</span>
<span class="cm"> * &amp;nbsp; mymod2: {</span>
<span class="cm"> * &amp;nbsp;   requires: [&#39;mymod1&#39;],</span>
<span class="cm"> * &amp;nbsp;   fullpath: &#39;http://myserver.mydomain.com/mymod2/mymod2.js&#39;</span>
<span class="cm"> * &amp;nbsp; }</span>
<span class="cm"> * }</span>
<span class="cm"> * &lt;/code&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @property modules</span>
<span class="cm"> * @type object</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A hash of module group definitions.  It for each group you</span>
<span class="cm"> * can specify a list of modules and the base path and</span>
<span class="cm"> * combo spec to use when dynamically loading the modules.  @see</span>
<span class="cm"> * @see modules for the details about the modules part of the</span>
<span class="cm"> * group definition.</span>
<span class="cm"> * &lt;code&gt;</span>
<span class="cm"> * &amp;nbsp; groups: {</span>
<span class="cm"> * &amp;nbsp;     yui2: {</span>
<span class="cm"> * &amp;nbsp;         // specify whether or not this group has a combo service</span>
<span class="cm"> * &amp;nbsp;         combine: true,</span>
<span class="cm"> * &amp;nbsp;</span>
<span class="cm"> * &amp;nbsp;         // the base path for non-combo paths</span>
<span class="cm"> * &amp;nbsp;         base: &#39;http://yui.yahooapis.com/2.8.0r4/build/&#39;,</span>
<span class="cm"> * &amp;nbsp;</span>
<span class="cm"> * &amp;nbsp;         // the path to the combo service</span>
<span class="cm"> * &amp;nbsp;         comboBase: &#39;http://yui.yahooapis.com/combo?&#39;,</span>
<span class="cm"> * &amp;nbsp;</span>
<span class="cm"> * &amp;nbsp;         // a fragment to prepend to the path attribute when</span>
<span class="cm"> * &amp;nbsp;         // when building combo urls</span>
<span class="cm"> * &amp;nbsp;         root: &#39;2.8.0r4/build/&#39;,</span>
<span class="cm"> * &amp;nbsp;</span>
<span class="cm"> * &amp;nbsp;         // the module definitions</span>
<span class="cm"> * &amp;nbsp;         modules:  {</span>
<span class="cm"> * &amp;nbsp;             yui2_yde: {</span>
<span class="cm"> * &amp;nbsp;                 path: &quot;yahoo-dom-event/yahoo-dom-event.js&quot;</span>
<span class="cm"> * &amp;nbsp;             },</span>
<span class="cm"> * &amp;nbsp;             yui2_anim: {</span>
<span class="cm"> * &amp;nbsp;                 path: &quot;animation/animation.js&quot;,</span>
<span class="cm"> * &amp;nbsp;                 requires: [&#39;yui2_yde&#39;]</span>
<span class="cm"> * &amp;nbsp;             }</span>
<span class="cm"> * &amp;nbsp;         }</span>
<span class="cm"> * &amp;nbsp;     }</span>
<span class="cm"> * &amp;nbsp; }</span>
<span class="cm"> * &lt;/code&gt;</span>
<span class="cm"> * @property modules</span>
<span class="cm"> * @type object</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The loader &#39;path&#39; attribute to the loader itself.  This is combined</span>
<span class="cm"> * with the &#39;base&#39; attribute to dynamically load the loader component</span>
<span class="cm"> * when boostrapping with the get utility alone.</span>
<span class="cm"> *</span>
<span class="cm"> * @property loaderPath</span>
<span class="cm"> * @type string</span>
<span class="cm"> * @default loader/loader-min.js</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Specifies whether or not YUI().use(...) will attempt to load CSS</span>
<span class="cm"> * resources at all.  Any truthy value will cause CSS dependencies</span>
<span class="cm"> * to load when fetching script.  The special value &#39;force&#39; will</span>
<span class="cm"> * cause CSS dependencies to be loaded even if no script is needed.</span>
<span class="cm"> *</span>
<span class="cm"> * @property fetchCSS</span>
<span class="cm"> * @type boolean|string</span>
<span class="cm"> * @default true</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The default gallery version to build gallery module urls</span>
<span class="cm"> * @property gallery</span>
<span class="cm"> * @type string</span>
<span class="cm"> * @since 3.1.0</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The default YUI 2 version to build yui2 module urls.  This is for</span>
<span class="cm"> * intrinsic YUI 2 support via the 2in3 project.  Also @see the &#39;2in3&#39;</span>
<span class="cm"> * config for pulling different revisions of the wrapped YUI 2</span>
<span class="cm"> * modules.</span>
<span class="cm"> * @since 3.1.0</span>
<span class="cm"> * @property yui2</span>
<span class="cm"> * @type string</span>
<span class="cm"> * @default 2.8.1</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The 2in3 project is a deployment of the various versions of YUI 2</span>
<span class="cm"> * deployed as first-class YUI 3 modules.  Eventually, the wrapper</span>
<span class="cm"> * for the modules will change (but the underlying YUI 2 code will</span>
<span class="cm"> * be the same), and you can select a particular version of</span>
<span class="cm"> * the wrapper modules via this config.</span>
<span class="cm"> * @since 3.1.0</span>
<span class="cm"> * @property 2in3</span>
<span class="cm"> * @type string</span>
<span class="cm"> * @default 1</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Alternative console log function for use in environments without</span>
<span class="cm"> * a supported native console.  The function is executed in the</span>
<span class="cm"> * YUI instance context.</span>
<span class="cm"> * @since 3.1.0</span>
<span class="cm"> * @property logFn</span>
<span class="cm"> * @type Function</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A callback to execute when Y.error is called.  It receives the</span>
<span class="cm"> * error message and an javascript error object if Y.error was</span>
<span class="cm"> * executed because a javascript error was caught.  The function</span>
<span class="cm"> * is executed in the YUI instance context.</span>
<span class="cm"> *</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> * @property errorFn</span>
<span class="cm"> * @type Function</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A callback to execute when the loader fails to load one or</span>
<span class="cm"> * more resource.  This could be because of a script load</span>
<span class="cm"> * failure.  It can also fail if a javascript module fails</span>
<span class="cm"> * to register itself, but only when the &#39;requireRegistration&#39;</span>
<span class="cm"> * is true.  If this function is defined, the use() callback will</span>
<span class="cm"> * only be called when the loader succeeds, otherwise it always</span>
<span class="cm"> * executes unless there was a javascript error when attaching</span>
<span class="cm"> * a module.</span>
<span class="cm"> *</span>
<span class="cm"> * @since 3.3.0</span>
<span class="cm"> * @property loadErrorFn</span>
<span class="cm"> * @type Function</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * When set to true, the YUI loader will expect that all modules</span>
<span class="cm"> * it is responsible for loading will be first-class YUI modules</span>
<span class="cm"> * that register themselves with the YUI global.  If this is</span>
<span class="cm"> * set to true, loader will fail if the module registration fails</span>
<span class="cm"> * to happen after the script is loaded.</span>
<span class="cm"> *</span>
<span class="cm"> * @since 3.3.0</span>
<span class="cm"> * @property requireRegistration</span>
<span class="cm"> * @type boolean</span>
<span class="cm"> * @default false</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Cache serviced use() requests.</span>
<span class="cm"> * @since 3.3.0</span>
<span class="cm"> * @property cacheUse</span>
<span class="cm"> * @type boolean</span>
<span class="cm"> * @default true</span>
<span class="cm"> * @deprecated no longer used</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The parameter defaults for the remote loader service.</span>
<span class="cm"> * Requires the rls submodule.  The properties that are</span>
<span class="cm"> * supported:</span>
<span class="cm"> * &lt;pre&gt;</span>
<span class="cm"> * m: comma separated list of module requirements.  This</span>
<span class="cm"> *    must be the param name even for custom implemetations.</span>
<span class="cm"> * v: the version of YUI to load.  Defaults to the version</span>
<span class="cm"> *    of YUI that is being used.</span>
<span class="cm"> * gv: the version of the gallery to load (@see the gallery config)</span>
<span class="cm"> * env: comma separated list of modules already on the page.</span>
<span class="cm"> *      this must be the param name even for custom implemetations.</span>
<span class="cm"> * lang: the languages supported on the page (@see the lang config)</span>
<span class="cm"> * &#39;2in3v&#39;:  the version of the 2in3 wrapper to use (@see the 2in3 config).</span>
<span class="cm"> * &#39;2v&#39;: the version of yui2 to use in the yui 2in3 wrappers</span>
<span class="cm"> *       (@see the yui2 config)</span>
<span class="cm"> * filt: a filter def to apply to the urls (@see the filter config).</span>
<span class="cm"> * filts: a list of custom filters to apply per module</span>
<span class="cm"> *        (@see the filters config).</span>
<span class="cm"> * tests: this is a map of conditional module test function id keys</span>
<span class="cm"> * with the values of 1 if the test passes, 0 if not.  This must be</span>
<span class="cm"> * the name of the querystring param in custom templates.</span>
<span class="cm"> *&lt;/pre&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> * @property rls</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The base path to the remote loader service</span>
<span class="cm"> *</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> * @property rls_base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The template to use for building the querystring portion</span>
<span class="cm"> * of the remote loader service url.  The default is determined</span>
<span class="cm"> * by the rls config -- each property that has a value will be</span>
<span class="cm"> * represented.</span>
<span class="cm"> *</span>
<span class="cm"> * ex: m={m}&amp;v={v}&amp;env={env}&amp;lang={lang}&amp;filt={filt}&amp;tests={tests}</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> * @property rls_tmpl</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Configure the instance to use a remote loader service instead of</span>
<span class="cm"> * the client loader.</span>
<span class="cm"> *</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> * @property use_rls</span>
<span class="cm"> */</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;yui-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/*</span>
<span class="cm"> * YUI stub</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-base</span>
<span class="cm"> */</span>
<span class="cm">/**</span>
<span class="cm"> * The YUI module contains the components required for building the YUI</span>
<span class="cm"> * seed file.  This includes the script loading mechanism, a simple queue,</span>
<span class="cm"> * and the core utilities for the library.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Provides core language utilites and extensions used throughout YUI.</span>
<span class="cm"> *</span>
<span class="cm"> * @class Lang</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">L</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span> <span class="o">||</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span> <span class="o">=</span> <span class="p">{}),</span>

<span class="nx">STRING_PROTO</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
<span class="nx">TOSTRING</span>     <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">,</span>

<span class="nx">TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;undefined&#39;</span>        <span class="o">:</span> <span class="s1">&#39;undefined&#39;</span><span class="p">,</span>
    <span class="s1">&#39;number&#39;</span>           <span class="o">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
    <span class="s1">&#39;boolean&#39;</span>          <span class="o">:</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;string&#39;</span>           <span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
    <span class="s1">&#39;[object Function]&#39;</span><span class="o">:</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span>
    <span class="s1">&#39;[object RegExp]&#39;</span>  <span class="o">:</span> <span class="s1">&#39;regexp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;[object Array]&#39;</span>   <span class="o">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
    <span class="s1">&#39;[object Date]&#39;</span>    <span class="o">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
    <span class="s1">&#39;[object Error]&#39;</span>   <span class="o">:</span> <span class="s1">&#39;error&#39;</span>
<span class="p">},</span>

<span class="nx">SUBREGEX</span>  <span class="o">=</span> <span class="sr">/\{\s*([^|}]+?)\s*(?:\|([^}]*))?\s*\}/g</span><span class="p">,</span>
<span class="nx">TRIMREGEX</span> <span class="o">=</span> <span class="sr">/^\s+|\s+$/g</span><span class="p">,</span>

<span class="c1">// If either MooTools or Prototype is on the page, then there&#39;s a chance that we</span>
<span class="c1">// can&#39;t trust &quot;native&quot; language features to actually be native. When this is</span>
<span class="c1">// the case, we take the safe route and fall back to our own non-native</span>
<span class="c1">// implementation.</span>
<span class="nx">win</span>           <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
<span class="nx">unsafeNatives</span> <span class="o">=</span> <span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nx">MooTools</span> <span class="o">||</span> <span class="nx">win</span><span class="p">.</span><span class="nx">Prototype</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the provided item is an array.</span>
<span class="cm"> *</span>
<span class="cm"> * Returns `false` for array-like collections such as the function `arguments`</span>
<span class="cm"> * collection or `HTMLElement` collections. Use `Y.Array.test()` if you want to</span>
<span class="cm"> * test for an array-like collection.</span>
<span class="cm"> *</span>
<span class="cm"> * @method isArray</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is an array.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isArray</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">unsafeNatives</span> <span class="o">&amp;&amp;</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">)</span> <span class="o">||</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;array&#39;</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the provided item is a boolean.</span>
<span class="cm"> * @method isBoolean</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is a boolean.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isBoolean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s1">&#39;boolean&#39;</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Determines whether or not the provided item is a function.</span>
<span class="cm"> * Note: Internet Explorer thinks certain functions are objects:</span>
<span class="cm"> * &lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;pre&gt;</span>
<span class="cm"> * var obj = document.createElement(&quot;object&quot;);</span>
<span class="cm"> * Y.Lang.isFunction(obj.getAttribute) // reports false in IE</span>
<span class="cm"> * &amp;nbsp;</span>
<span class="cm"> * var input = document.createElement(&quot;input&quot;); // append to body</span>
<span class="cm"> * Y.Lang.isFunction(input.focus) // reports false in IE</span>
<span class="cm"> * &lt;/pre&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * You will have to implement additional tests if these functions</span>
<span class="cm"> * matter to you.</span>
<span class="cm"> * &lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @method isFunction</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is a function.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the supplied item is a date instance.</span>
<span class="cm"> * @method isDate</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is a date.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isDate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;date&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;Invalid Date&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the provided item is null.</span>
<span class="cm"> * @method isNull</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is null.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isNull</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">o</span> <span class="o">===</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the provided item is a legal number.</span>
<span class="cm"> * @method isNumber</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is a number.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isNumber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">isFinite</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the provided item is of type object</span>
<span class="cm"> * or function. Note that arrays are also objects, so</span>
<span class="cm"> * &lt;code&gt;Y.Lang.isObject([]) === true&lt;/code&gt;.</span>
<span class="cm"> * @method isObject</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @param failfn {boolean} fail if the input is a function.</span>
<span class="cm"> * @return {boolean} true if o is an object.</span>
<span class="cm"> * @see isPlainObject</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">failfn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">o</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">t</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="o">||</span>
        <span class="p">(</span><span class="o">!</span><span class="nx">failfn</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">t</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">||</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">o</span><span class="p">)))))</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns `true` if _obj_ is a plain object (that is, an object created using</span>
<span class="cm"> * `{}` or `new Object()`).</span>
<span class="cm"> *</span>
<span class="cm"> * Unlike `isObject`, this method returns `false` for arrays and functions.</span>
<span class="cm"> *</span>
<span class="cm"> * @method isPlainObject</span>
<span class="cm"> * @param {any} obj The object to test.</span>
<span class="cm"> * @return {Boolean} `true` if _obj_ is a plain object, `false` otherwise.</span>
<span class="cm"> * @static</span>
<span class="cm"> * @see isObject</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isPlainObject</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">TOSTRING</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;[object Object]&#39;</span>
            <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">)</span> <span class="c1">// not an HTML element or document</span>
            <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">alert</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nb">document</span><span class="p">));</span>  <span class="c1">// not a window</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the provided item is a string.</span>
<span class="cm"> * @method isString</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is a string.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the provided item is undefined.</span>
<span class="cm"> * @method isUndefined</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object to test.</span>
<span class="cm"> * @return {boolean} true if o is undefined.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isUndefined</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a string without any leading or trailing whitespace.  If</span>
<span class="cm"> * the input is not a string, the input will be returned untouched.</span>
<span class="cm"> * @method trim</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param s {string} the string to trim.</span>
<span class="cm"> * @return {string} the trimmed string.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">trim</span> <span class="o">=</span> <span class="nx">STRING_PROTO</span><span class="p">.</span><span class="nx">trim</span> <span class="o">?</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span> <span class="o">&amp;&amp;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">trim</span> <span class="o">?</span> <span class="nx">s</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">:</span> <span class="nx">s</span><span class="p">;</span>
<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">TRIMREGEX</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a string without any leading whitespace.</span>
<span class="cm"> * @method trimLeft</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param s {string} the string to trim.</span>
<span class="cm"> * @return {string} the trimmed string.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">trimLeft</span> <span class="o">=</span> <span class="nx">STRING_PROTO</span><span class="p">.</span><span class="nx">trimLeft</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">trimLeft</span><span class="p">();</span>
<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a string without any trailing whitespace.</span>
<span class="cm"> * @method trimRight</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param s {string} the string to trim.</span>
<span class="cm"> * @return {string} the trimmed string.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">trimRight</span> <span class="o">=</span> <span class="nx">STRING_PROTO</span><span class="p">.</span><span class="nx">trimRight</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">trimRight</span><span class="p">();</span>
<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * A convenience method for detecting a legitimate non-null value.</span>
<span class="cm"> * Returns false for null/undefined/NaN, true for other values,</span>
<span class="cm"> * including 0/false/&#39;&#39;</span>
<span class="cm"> * @method isValue</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The item to test.</span>
<span class="cm"> * @return {boolean} true if it is not null/undefined/NaN || false.</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">isValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;number&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">isFinite</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>

        <span class="k">case</span> <span class="s1">&#39;null&#39;</span><span class="o">:</span> <span class="c1">// fallthru</span>
        <span class="k">case</span> <span class="s1">&#39;undefined&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">default</span><span class="o">:</span>
            <span class="k">return</span> <span class="o">!!</span><span class="nx">t</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Returns a string representing the type of the item passed in.</span>
<span class="cm"> * &lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Known issues:</span>
<span class="cm"> * &lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;ul&gt;</span>
<span class="cm"> *   &lt;li&gt;</span>
<span class="cm"> *     &lt;code&gt;typeof HTMLElementCollection&lt;/code&gt; returns function in Safari, but</span>
<span class="cm"> *     &lt;code&gt;Y.type()&lt;/code&gt; reports object, which could be a good thing --</span>
<span class="cm"> *     but it actually caused the logic in &lt;code&gt;Y.Lang.isObject&lt;/code&gt; to fail.</span>
<span class="cm"> *   &lt;/li&gt;</span>
<span class="cm"> * &lt;/ul&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @method type</span>
<span class="cm"> * @param o the item to test.</span>
<span class="cm"> * @return {string} the detected type.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">TYPES</span><span class="p">[</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">]</span> <span class="o">||</span> <span class="nx">TYPES</span><span class="p">[</span><span class="nx">TOSTRING</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">o</span><span class="p">)]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">o</span> <span class="o">?</span> <span class="s1">&#39;object&#39;</span> <span class="o">:</span> <span class="s1">&#39;null&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Lightweight version of &lt;code&gt;Y.substitute&lt;/code&gt;. Uses the same template</span>
<span class="cm"> * structure as &lt;code&gt;Y.substitute&lt;/code&gt;, but doesn&#39;t support recursion,</span>
<span class="cm"> * auto-object coersion, or formats.</span>
<span class="cm"> * @method sub</span>
<span class="cm"> * @param {string} s String to be modified.</span>
<span class="cm"> * @param {object} o Object containing replacement values.</span>
<span class="cm"> * @return {string} the substitute result.</span>
<span class="cm"> * @static</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span> <span class="o">?</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">SUBREGEX</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="o">?</span> <span class="nx">match</span> <span class="o">:</span> <span class="nx">o</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">})</span> <span class="o">:</span> <span class="nx">s</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns the current time in milliseconds.</span>
<span class="cm"> *</span>
<span class="cm"> * @method now</span>
<span class="cm"> * @return {int} Current time in milliseconds.</span>
<span class="cm"> * @since 3.3.0</span>
<span class="cm"> */</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span> <span class="o">||</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * The YUI module contains the components required for building the YUI seed</span>
<span class="cm"> * file.  This includes the script loading mechanism, a simple queue, and the</span>
<span class="cm"> * core utilities for the library.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-base</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">Lang</span>   <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">,</span>
    <span class="nx">Native</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>

    <span class="nx">hasOwn</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Adds utilities to the YUI instance for working with arrays. Additional array</span>
<span class="cm"> * helpers can be found in the `collection` module.</span>
<span class="cm"> *</span>
<span class="cm"> * @class Array</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * `Y.Array(thing)` returns an array created from _thing_. Depending on</span>
<span class="cm"> * _thing_&#39;s type, one of the following will happen:</span>
<span class="cm"> *</span>
<span class="cm"> *   * Arrays are returned unmodified unless a non-zero _startIndex_ is</span>
<span class="cm"> *     specified.</span>
<span class="cm"> *   * Array-like collections (see `Array.test()`) are converted to arrays.</span>
<span class="cm"> *   * For everything else, a new array is created with _thing_ as the sole</span>
<span class="cm"> *     item.</span>
<span class="cm"> *</span>
<span class="cm"> * Note: elements that are also collections, such as `&lt;form&gt;` and `&lt;select&gt;`</span>
<span class="cm"> * elements, are not automatically converted to arrays. To force a conversion,</span>
<span class="cm"> * pass `true` as the value of the _force_ parameter.</span>
<span class="cm"> *</span>
<span class="cm"> * @method ()</span>
<span class="cm"> * @param {mixed} thing The thing to arrayify.</span>
<span class="cm"> * @param {int} [startIndex=0] If non-zero and _thing_ is an array or array-like</span>
<span class="cm"> *   collection, a subset of items starting at the specified index will be</span>
<span class="cm"> *   returned.</span>
<span class="cm"> * @param {boolean} [force=false] If `true`, _thing_ will be treated as an</span>
<span class="cm"> *   array-like collection no matter what.</span>
<span class="cm"> * @return {Array}</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">thing</span><span class="p">,</span> <span class="nx">startIndex</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">result</span><span class="p">;</span>

    <span class="nx">startIndex</span> <span class="o">||</span> <span class="p">(</span><span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">force</span> <span class="o">||</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">thing</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// IE throws when trying to slice HTMLElement collections.</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Native</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thing</span><span class="p">,</span> <span class="nx">startIndex</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">thing</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">startIndex</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">startIndex</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">thing</span><span class="p">[</span><span class="nx">startIndex</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">[</span><span class="nx">thing</span><span class="p">];</span>
<span class="p">}</span>

<span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Evaluates _obj_ to determine if it&#39;s an array, an array-like collection, or</span>
<span class="cm"> * something else. This is useful when working with the function `arguments`</span>
<span class="cm"> * collection and `HTMLElement` collections.</span>
<span class="cm"> *</span>
<span class="cm"> * Note: This implementation doesn&#39;t consider elements that are also</span>
<span class="cm"> * collections, such as `&lt;form&gt;` and `&lt;select&gt;`, to be array-like.</span>
<span class="cm"> *</span>
<span class="cm"> * @method test</span>
<span class="cm"> * @param {object} obj Object to test.</span>
<span class="cm"> * @return {int} A number indicating the results of the test:</span>
<span class="cm"> *   * 0: Neither an array nor an array-like collection.</span>
<span class="cm"> *   * 1: Real array.</span>
<span class="cm"> *   * 2: Array-like collection.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">YArray</span><span class="p">.</span><span class="nx">test</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// indexed, but no tagName (element) or alert (window),</span>
            <span class="c1">// or functions without apply/call (Safari</span>
            <span class="c1">// HTMLElementCollection bug).</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;length&#39;</span> <span class="k">in</span> <span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">alert</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">apply</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Dedupes an array of strings, returning an array that&#39;s guaranteed to contain</span>
<span class="cm"> * only one copy of a given string.</span>
<span class="cm"> *</span>
<span class="cm"> * This method differs from `Y.Array.unique` in that it&#39;s optimized for use only</span>
<span class="cm"> * with strings, whereas `unique` may be used with other types (but is slower).</span>
<span class="cm"> * Using `dedupe` with non-string values may result in unexpected behavior.</span>
<span class="cm"> *</span>
<span class="cm"> * @method dedupe</span>
<span class="cm"> * @param {String[]} array Array of strings to dedupe.</span>
<span class="cm"> * @return {Array} Deduped copy of _array_.</span>
<span class="cm"> * @static</span>
<span class="cm"> * @since 3.4.0</span>
<span class="cm"> */</span>
<span class="nx">YArray</span><span class="p">.</span><span class="nx">dedupe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span>    <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">results</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">item</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">hash</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Executes the supplied function on each item in the array. This method wraps</span>
<span class="cm"> * the native ES5 `Array.forEach()` method if available.</span>
<span class="cm"> *</span>
<span class="cm"> * @method each</span>
<span class="cm"> * @param {Array} array Array to iterate.</span>
<span class="cm"> * @param {Function} fn Function to execute on each item in the array.</span>
<span class="cm"> *   @param {mixed} fn.item Current array item.</span>
<span class="cm"> *   @param {Number} fn.index Current array index.</span>
<span class="cm"> *   @param {Array} fn.array Array being iterated.</span>
<span class="cm"> * @param {Object} [thisObj] `this` object to use when calling _fn_.</span>
<span class="cm"> * @return {YUI} The YUI instance.</span>
<span class="cm"> * @chainable</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">YArray</span><span class="p">.</span><span class="nx">each</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">=</span> <span class="nx">Native</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Native</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">array</span> <span class="o">||</span> <span class="p">[],</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="p">(</span><span class="nx">array</span> <span class="o">&amp;&amp;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisObj</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">,</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">array</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Alias for `each`.</span>
<span class="cm"> *</span>
<span class="cm"> * @method forEach</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Returns an object using the first array as keys and the second as values. If</span>
<span class="cm"> * the second array is not provided, or if it doesn&#39;t contain the same number of</span>
<span class="cm"> * values as the first array, then `true` will be used in place of the missing</span>
<span class="cm"> * values.</span>
<span class="cm"> *</span>
<span class="cm"> * @example</span>
<span class="cm"> *</span>
<span class="cm"> *     Y.Array.hash([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;foo&#39;, &#39;bar&#39;]);</span>
<span class="cm"> *     // =&gt; {a: &#39;foo&#39;, b: &#39;bar&#39;, c: true}</span>
<span class="cm"> *</span>
<span class="cm"> * @method hash</span>
<span class="cm"> * @param {Array} keys Array to use as keys.</span>
<span class="cm"> * @param {Array} [values] Array to use as values.</span>
<span class="cm"> * @return {Object}</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keys</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">vlen</span> <span class="o">=</span> <span class="p">(</span><span class="nx">values</span> <span class="o">&amp;&amp;</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">hash</span><span class="p">[</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">vlen</span> <span class="o">&gt;</span> <span class="nx">i</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span> <span class="o">?</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">hash</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns the index of the first item in the array that&#39;s equal (using a strict</span>
<span class="cm"> * equality check) to the specified _value_, or `-1` if the value isn&#39;t found.</span>
<span class="cm"> *</span>
<span class="cm"> * This method wraps the native ES5 `Array.indexOf()` method if available.</span>
<span class="cm"> *</span>
<span class="cm"> * @method indexOf</span>
<span class="cm"> * @param {Array} array Array to search.</span>
<span class="cm"> * @param {any} value Value to search for.</span>
<span class="cm"> * @return {Number} Index of the item strictly equal to _value_, or `-1` if not</span>
<span class="cm"> *   found.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">YArray</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">=</span> <span class="nx">Native</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// TODO: support fromIndex</span>
    <span class="k">return</span> <span class="nx">Native</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Numeric sort convenience function.</span>
<span class="cm"> *</span>
<span class="cm"> * The native `Array.prototype.sort()` function converts values to strings and</span>
<span class="cm"> * sorts them in lexicographic order, which is unsuitable for sorting numeric</span>
<span class="cm"> * values. Provide `Y.Array.numericSort` as a custom sort function when you want</span>
<span class="cm"> * to sort values in numeric order.</span>
<span class="cm"> *</span>
<span class="cm"> * @example</span>
<span class="cm"> *</span>
<span class="cm"> *     [42, 23, 8, 16, 4, 15].sort(Y.Array.numericSort);</span>
<span class="cm"> *     // =&gt; [4, 8, 15, 16, 23, 42]</span>
<span class="cm"> *</span>
<span class="cm"> * @method numericSort</span>
<span class="cm"> * @param {Number} a First value to compare.</span>
<span class="cm"> * @param {Number} b Second value to compare.</span>
<span class="cm"> * @return {Number} Difference between _a_ and _b_.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">YArray</span><span class="p">.</span><span class="nx">numericSort</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Executes the supplied function on each item in the array. Returning a truthy</span>
<span class="cm"> * value from the function will stop the processing of remaining items.</span>
<span class="cm"> *</span>
<span class="cm"> * @method some</span>
<span class="cm"> * @param {Array} array Array to iterate.</span>
<span class="cm"> * @param {Function} fn Function to execute on each item.</span>
<span class="cm"> *   @param {mixed} fn.value Current array item.</span>
<span class="cm"> *   @param {Number} fn.index Current array index.</span>
<span class="cm"> *   @param {Array} fn.array Array being iterated.</span>
<span class="cm"> * @param {Object} [thisObj] `this` object to use when calling _fn_.</span>
<span class="cm"> * @return {Boolean} `true` if the function returns a truthy value on any of the</span>
<span class="cm"> *   items in the array; `false` otherwise.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">YArray</span><span class="p">.</span><span class="nx">some</span> <span class="o">=</span> <span class="nx">Native</span><span class="p">.</span><span class="nx">some</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Native</span><span class="p">.</span><span class="nx">some</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span><span class="p">);</span>
<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">array</span> <span class="o">&amp;&amp;</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisObj</span><span class="p">,</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">array</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * The YUI module contains the components required for building the YUI</span>
<span class="cm"> * seed file.  This includes the script loading mechanism, a simple queue,</span>
<span class="cm"> * and the core utilities for the library.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * A simple FIFO queue.  Items are added to the Queue with add(1..n items) and</span>
<span class="cm"> * removed using next().</span>
<span class="cm"> *</span>
<span class="cm"> * @class Queue</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param {MIXED} item* 0..n items to seed the queue.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">Queue</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_init</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">Queue</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Initialize the queue</span>
<span class="cm">     *</span>
<span class="cm">     * @method _init</span>
<span class="cm">     * @protected</span>
<span class="cm">     */</span>
    <span class="nx">_init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="cm">/**</span>
<span class="cm">         * The collection of enqueued items</span>
<span class="cm">         *</span>
<span class="cm">         * @property _q</span>
<span class="cm">         * @type Array</span>
<span class="cm">         * @protected</span>
<span class="cm">         */</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_q</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the next item in the queue. FIFO support</span>
<span class="cm">     *</span>
<span class="cm">     * @method next</span>
<span class="cm">     * @return {MIXED} the next item in the queue.</span>
<span class="cm">     */</span>
    <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_q</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the last in the queue. LIFO support.</span>
<span class="cm">     *</span>
<span class="cm">     * @method last</span>
<span class="cm">     * @return {MIXED} the last item in the queue.</span>
<span class="cm">     */</span>
    <span class="nx">last</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_q</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Add 0..n items to the end of the queue.</span>
<span class="cm">     *</span>
<span class="cm">     * @method add</span>
<span class="cm">     * @param {MIXED} item* 0..n items.</span>
<span class="cm">     * @return {object} this queue.</span>
<span class="cm">     */</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_q</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_q</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the current number of queued items.</span>
<span class="cm">     *</span>
<span class="cm">     * @method size</span>
<span class="cm">     * @return {Number} The size.</span>
<span class="cm">     */</span>
    <span class="nx">size</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_q</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Queue</span> <span class="o">=</span> <span class="nx">Queue</span><span class="p">;</span>

<span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_loaderQueue</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">_loaderQueue</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Queue</span><span class="p">();</span>

<span class="cm">/**</span>
<span class="cm">The YUI module contains the components required for building the YUI seed file.</span>
<span class="cm">This includes the script loading mechanism, a simple queue, and the core</span>
<span class="cm">utilities for the library.</span>

<span class="cm">@module yui</span>
<span class="cm">@submodule yui-base</span>
<span class="cm">**/</span>

<span class="kd">var</span> <span class="nx">CACHED_DELIMITER</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span><span class="p">,</span>

    <span class="nx">hasOwn</span>   <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">,</span>
    <span class="nx">isObject</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">Returns a wrapper for a function which caches the return value of that function,</span>
<span class="cm">keyed off of the combined string representation of the argument values provided</span>
<span class="cm">when the wrapper is called.</span>

<span class="cm">Calling this function again with the same arguments will return the cached value</span>
<span class="cm">rather than executing the wrapped function.</span>

<span class="cm">Note that since the cache is keyed off of the string representation of arguments</span>
<span class="cm">passed to the wrapper function, arguments that aren&#39;t strings and don&#39;t provide</span>
<span class="cm">a meaningful `toString()` method may result in unexpected caching behavior. For</span>
<span class="cm">example, the objects `{}` and `{foo: &#39;bar&#39;}` would both be converted to the</span>
<span class="cm">string `[object Object]` when used as a cache key.</span>

<span class="cm">@method cached</span>
<span class="cm">@param {Function} source The function to memoize.</span>
<span class="cm">@param {Object} [cache={}] Object in which to store cached values. You may seed</span>
<span class="cm">  this object with pre-existing cached values if desired.</span>
<span class="cm">@param {any} [refetch] If supplied, this value is compared with the cached value</span>
<span class="cm">  using a `==` comparison. If the values are equal, the wrapped function is</span>
<span class="cm">  executed again even though a cached value exists.</span>
<span class="cm">@return {Function} Wrapped function.</span>
<span class="cm">@for YUI</span>
<span class="cm">**/</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">cached</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">cache</span><span class="p">,</span> <span class="nx">refetch</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">cache</span> <span class="o">||</span> <span class="p">(</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{});</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span>
                <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">join</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="nx">CACHED_DELIMITER</span><span class="p">)</span> <span class="o">:</span>
                <span class="nx">arg</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">cache</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">refetch</span> <span class="o">&amp;&amp;</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">==</span> <span class="nx">refetch</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">Returns a new object containing all of the properties of all the supplied</span>
<span class="cm">objects. The properties from later objects will overwrite those in earlier</span>
<span class="cm">objects.</span>

<span class="cm">Passing in a single object will create a shallow copy of it. For a deep copy,</span>
<span class="cm">use `clone()`.</span>

<span class="cm">@method merge</span>
<span class="cm">@param {Object} objects* One or more objects to merge.</span>
<span class="cm">@return {Object} A new merged object.</span>
<span class="cm">**/</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span>   <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span>
        <span class="nx">i</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">len</span>    <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">Mixes _supplier_&#39;s properties into _receiver_. Properties will not be</span>
<span class="cm">overwritten or merged unless the _overwrite_ or _merge_ parameters are `true`,</span>
<span class="cm">respectively.</span>

<span class="cm">In the default mode (0), only properties the supplier owns are copied (prototype</span>
<span class="cm">properties are not copied). The following copying modes are available:</span>

<span class="cm">  * `0`: _Default_. Object to object.</span>
<span class="cm">  * `1`: Prototype to prototype.</span>
<span class="cm">  * `2`: Prototype to prototype and object to object.</span>
<span class="cm">  * `3`: Prototype to object.</span>
<span class="cm">  * `4`: Object to prototype.</span>

<span class="cm">@method mix</span>
<span class="cm">@param {Function|Object} receiver The object or function to receive the mixed</span>
<span class="cm">  properties.</span>
<span class="cm">@param {Function|Object} supplier The object or function supplying the</span>
<span class="cm">  properties to be mixed.</span>
<span class="cm">@param {Boolean} [overwrite=false] If `true`, properties that already exist</span>
<span class="cm">  on the receiver will be overwritten with properties from the supplier.</span>
<span class="cm">@param {String[]} [whitelist] An array of property names to copy. If</span>
<span class="cm">  specified, only the whitelisted properties will be copied, and all others</span>
<span class="cm">  will be ignored.</span>
<span class="cm">@param {Int} [mode=0] Mix mode to use. See above for available modes.</span>
<span class="cm">@param {Boolean} [merge=false] If `true`, objects and arrays that already</span>
<span class="cm">  exist on the receiver will have the corresponding object/array from the</span>
<span class="cm">  supplier merged into them, rather than being skipped or overwritten. When</span>
<span class="cm">  both _overwrite_ and _merge_ are `true`, _merge_ takes precedence.</span>
<span class="cm">@return {Function|Object|YUI} The receiver, or the YUI instance if the</span>
<span class="cm">  specified receiver is falsy.</span>
<span class="cm">**/</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">receiver</span><span class="p">,</span> <span class="nx">supplier</span><span class="p">,</span> <span class="nx">overwrite</span><span class="p">,</span> <span class="nx">whitelist</span><span class="p">,</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">merge</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">alwaysOverwrite</span><span class="p">,</span> <span class="nx">exists</span><span class="p">,</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">to</span><span class="p">;</span>

    <span class="c1">// If no supplier is given, we return the receiver. If no receiver is given,</span>
    <span class="c1">// we return Y. Returning Y doesn&#39;t make much sense to me, but it&#39;s</span>
    <span class="c1">// grandfathered in for backcompat reasons.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">receiver</span> <span class="o">||</span> <span class="o">!</span><span class="nx">supplier</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">receiver</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// In mode 2 (prototype to prototype and object to object), we recurse</span>
        <span class="c1">// once to do the proto to proto mix. The object to object mix will be</span>
        <span class="c1">// handled later on.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">receiver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">supplier</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">overwrite</span><span class="p">,</span>
                    <span class="nx">whitelist</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">merge</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Depending on which mode is specified, we may be copying from or to</span>
        <span class="c1">// the prototypes of the supplier and receiver.</span>
        <span class="nx">from</span> <span class="o">=</span> <span class="nx">mode</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">mode</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">?</span> <span class="nx">supplier</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">:</span> <span class="nx">supplier</span><span class="p">;</span>
        <span class="nx">to</span>   <span class="o">=</span> <span class="nx">mode</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">mode</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">?</span> <span class="nx">receiver</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">:</span> <span class="nx">receiver</span><span class="p">;</span>

        <span class="c1">// If either the supplier or receiver doesn&#39;t actually have a</span>
        <span class="c1">// prototype property, then we could end up with an undefined `from`</span>
        <span class="c1">// or `to`. If that happens, we abort and return the receiver.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">from</span> <span class="o">||</span> <span class="o">!</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">receiver</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">from</span> <span class="o">=</span> <span class="nx">supplier</span><span class="p">;</span>
        <span class="nx">to</span>   <span class="o">=</span> <span class="nx">receiver</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// If `overwrite` is truthy and `merge` is falsy, then we can skip a call</span>
    <span class="c1">// to `hasOwnProperty` on each iteration and save some time.</span>
    <span class="nx">alwaysOverwrite</span> <span class="o">=</span> <span class="nx">overwrite</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">merge</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">whitelist</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">whitelist</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">key</span> <span class="o">=</span> <span class="nx">whitelist</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="c1">// We call `Object.prototype.hasOwnProperty` instead of calling</span>
            <span class="c1">// `hasOwnProperty` on the object itself, since the object&#39;s</span>
            <span class="c1">// `hasOwnProperty` method may have been overridden or removed.</span>
            <span class="c1">// Also, some native objects don&#39;t implement a `hasOwnProperty`</span>
            <span class="c1">// method.</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">exists</span> <span class="o">=</span> <span class="nx">alwaysOverwrite</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">merge</span> <span class="o">&amp;&amp;</span> <span class="nx">exists</span> <span class="o">&amp;&amp;</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">to</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="kc">true</span><span class="p">)</span>
                    <span class="o">&amp;&amp;</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">from</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="kc">true</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// If we&#39;re in merge mode, and the key is present on both</span>
                <span class="c1">// objects, and the value on both objects is either an object or</span>
                <span class="c1">// an array (but not a function), then we recurse to merge the</span>
                <span class="c1">// `from` value into the `to` value instead of overwriting it.</span>
                <span class="c1">//</span>
                <span class="c1">// Note: It&#39;s intentional that the whitelist isn&#39;t passed to the</span>
                <span class="c1">// recursive call here. This is legacy behavior that lots of</span>
                <span class="c1">// code still depends on.</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">to</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">from</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">overwrite</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">merge</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">overwrite</span> <span class="o">||</span> <span class="o">!</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// We&#39;re not in merge mode, so we&#39;ll only copy the `from` value</span>
                <span class="c1">// to the `to` value if we&#39;re in overwrite mode or if the</span>
                <span class="c1">// current key doesn&#39;t exist on the `to` object.</span>
                <span class="nx">to</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">from</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">from</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// The code duplication here is for runtime performance reasons.</span>
            <span class="c1">// Combining whitelist and non-whitelist operations into a single</span>
            <span class="c1">// loop or breaking the shared logic out into a function both result</span>
            <span class="c1">// in worse performance, and Y.mix is critical enough that the byte</span>
            <span class="c1">// tradeoff is worth it.</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">exists</span> <span class="o">=</span> <span class="nx">alwaysOverwrite</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">merge</span> <span class="o">&amp;&amp;</span> <span class="nx">exists</span> <span class="o">&amp;&amp;</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">to</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="kc">true</span><span class="p">)</span>
                    <span class="o">&amp;&amp;</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">from</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="kc">true</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">to</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">from</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">overwrite</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">merge</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">overwrite</span> <span class="o">||</span> <span class="o">!</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">to</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">from</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// If this is an IE browser with the JScript enumeration bug, force</span>
        <span class="c1">// enumeration of the buggy properties by making a recursive call with</span>
        <span class="c1">// the buggy properties as the whitelist.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">_hasEnumBug</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">overwrite</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">_forceEnum</span><span class="p">,</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">merge</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">receiver</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * The YUI module contains the components required for building the YUI</span>
<span class="cm"> * seed file.  This includes the script loading mechanism, a simple queue,</span>
<span class="cm"> * and the core utilities for the library.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Adds utilities to the YUI instance for working with objects.</span>
<span class="cm"> *</span>
<span class="cm"> * @class Object</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">hasOwn</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">,</span>

<span class="c1">// If either MooTools or Prototype is on the page, then there&#39;s a chance that we</span>
<span class="c1">// can&#39;t trust &quot;native&quot; language features to actually be native. When this is</span>
<span class="c1">// the case, we take the safe route and fall back to our own non-native</span>
<span class="c1">// implementations.</span>
<span class="nx">win</span>           <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
<span class="nx">unsafeNatives</span> <span class="o">=</span> <span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nx">MooTools</span> <span class="o">||</span> <span class="nx">win</span><span class="p">.</span><span class="nx">Prototype</span><span class="p">),</span>

<span class="nx">UNDEFINED</span><span class="p">,</span> <span class="c1">// &lt;-- Note the comma. We&#39;re still declaring vars.</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a new object that uses _obj_ as its prototype. This method wraps the</span>
<span class="cm"> * native ES5 `Object.create()` method if available, but doesn&#39;t currently</span>
<span class="cm"> * pass through `Object.create()`&#39;s second argument (properties) in order to</span>
<span class="cm"> * ensure compatibility with older browsers.</span>
<span class="cm"> *</span>
<span class="cm"> * @method ()</span>
<span class="cm"> * @param {Object} obj Prototype object.</span>
<span class="cm"> * @return {Object} New object using _obj_ as its prototype.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">unsafeNatives</span> <span class="o">&amp;&amp;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">)</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We currently wrap the native Object.create instead of simply aliasing it</span>
    <span class="c1">// to ensure consistency with our fallback shim, which currently doesn&#39;t</span>
    <span class="c1">// support Object.create()&#39;s second argument (properties). Once we have a</span>
    <span class="c1">// safe fallback for the properties arg, we can stop wrapping</span>
    <span class="c1">// Object.create().</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="p">}</span> <span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Reusable constructor function for the Object.create() shim.</span>
    <span class="kd">function</span> <span class="nx">F</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// The actual shim.</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">F</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">F</span><span class="p">();</span>
    <span class="p">};</span>
<span class="p">}()),</span>

<span class="cm">/**</span>
<span class="cm"> * Property names that IE doesn&#39;t enumerate in for..in loops, even when they</span>
<span class="cm"> * should be enumerable. When `_hasEnumBug` is `true`, it&#39;s necessary to</span>
<span class="cm"> * manually enumerate these properties.</span>
<span class="cm"> *</span>
<span class="cm"> * @property _forceEnum</span>
<span class="cm"> * @type String[]</span>
<span class="cm"> * @protected</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">forceEnum</span> <span class="o">=</span> <span class="nx">O</span><span class="p">.</span><span class="nx">_forceEnum</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;hasOwnProperty&#39;</span><span class="p">,</span>
    <span class="s1">&#39;isPrototypeOf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;propertyIsEnumerable&#39;</span><span class="p">,</span>
    <span class="s1">&#39;toString&#39;</span><span class="p">,</span>
    <span class="s1">&#39;toLocaleString&#39;</span><span class="p">,</span>
    <span class="s1">&#39;valueOf&#39;</span>
<span class="p">],</span>

<span class="cm">/**</span>
<span class="cm"> * `true` if this browser has the JScript enumeration bug that prevents</span>
<span class="cm"> * enumeration of the properties named in the `_forceEnum` array, `false`</span>
<span class="cm"> * otherwise.</span>
<span class="cm"> *</span>
<span class="cm"> * See:</span>
<span class="cm"> *   - &lt;https://developer.mozilla.org/en/ECMAScript_DontEnum_attribute#JScript_DontEnum_Bug&gt;</span>
<span class="cm"> *   - &lt;http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @property _hasEnumBug</span>
<span class="cm"> * @type {Boolean}</span>
<span class="cm"> * @protected</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">hasEnumBug</span> <span class="o">=</span> <span class="nx">O</span><span class="p">.</span><span class="nx">_hasEnumBug</span> <span class="o">=</span> <span class="o">!</span><span class="p">{</span><span class="nx">valueOf</span><span class="o">:</span> <span class="mi">0</span><span class="p">}.</span><span class="nx">propertyIsEnumerable</span><span class="p">(</span><span class="s1">&#39;valueOf&#39;</span><span class="p">),</span>

<span class="cm">/**</span>
<span class="cm"> * Returns `true` if _key_ exists on _obj_, `false` if _key_ doesn&#39;t exist or</span>
<span class="cm"> * exists only on _obj_&#39;s prototype. This is essentially a safer version of</span>
<span class="cm"> * `obj.hasOwnProperty()`.</span>
<span class="cm"> *</span>
<span class="cm"> * @method owns</span>
<span class="cm"> * @param {Object} obj Object to test.</span>
<span class="cm"> * @param {String} key Property name to look for.</span>
<span class="cm"> * @return {Boolean} `true` if _key_ exists on _obj_, `false` otherwise.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">owns</span> <span class="o">=</span> <span class="nx">O</span><span class="p">.</span><span class="nx">owns</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!!</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="p">};</span> <span class="c1">// &lt;-- End of var declarations.</span>

<span class="cm">/**</span>
<span class="cm"> * Alias for `owns()`.</span>
<span class="cm"> *</span>
<span class="cm"> * @method hasKey</span>
<span class="cm"> * @param {Object} obj Object to test.</span>
<span class="cm"> * @param {String} key Property name to look for.</span>
<span class="cm"> * @return {Boolean} `true` if _key_ exists on _obj_, `false` otherwise.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">hasKey</span> <span class="o">=</span> <span class="nx">owns</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Returns an array containing the object&#39;s enumerable keys. Does not include</span>
<span class="cm"> * prototype keys or non-enumerable keys.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that keys are returned in enumeration order (that is, in the same order</span>
<span class="cm"> * that they would be enumerated by a `for-in` loop), which may not be the same</span>
<span class="cm"> * as the order in which they were defined.</span>
<span class="cm"> *</span>
<span class="cm"> * This method is an alias for the native ES5 `Object.keys()` method if</span>
<span class="cm"> * available.</span>
<span class="cm"> *</span>
<span class="cm"> * @example</span>
<span class="cm"> *</span>
<span class="cm"> *     Y.Object.keys({a: &#39;foo&#39;, b: &#39;bar&#39;, c: &#39;baz&#39;});</span>
<span class="cm"> *     // =&gt; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="cm"> *</span>
<span class="cm"> * @method keys</span>
<span class="cm"> * @param {Object} obj An object.</span>
<span class="cm"> * @return {String[]} Array of keys.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">unsafeNatives</span> <span class="o">&amp;&amp;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">)</span> <span class="o">||</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Object.keys called on a non-object&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">owns</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">hasEnumBug</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">forceEnum</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">key</span> <span class="o">=</span> <span class="nx">forceEnum</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">owns</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">keys</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns an array containing the values of the object&#39;s enumerable keys.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that values are returned in enumeration order (that is, in the same</span>
<span class="cm"> * order that they would be enumerated by a `for-in` loop), which may not be the</span>
<span class="cm"> * same as the order in which they were defined.</span>
<span class="cm"> *</span>
<span class="cm"> * @example</span>
<span class="cm"> *</span>
<span class="cm"> *     Y.Object.values({a: &#39;foo&#39;, b: &#39;bar&#39;, c: &#39;baz&#39;});</span>
<span class="cm"> *     // =&gt; [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;]</span>
<span class="cm"> *</span>
<span class="cm"> * @method values</span>
<span class="cm"> * @param {Object} obj An object.</span>
<span class="cm"> * @return {Array} Array of values.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keys</span>   <span class="o">=</span> <span class="nx">O</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">),</span>
        <span class="nx">i</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">len</span>    <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">values</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">values</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">values</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns the number of enumerable keys owned by an object.</span>
<span class="cm"> *</span>
<span class="cm"> * @method size</span>
<span class="cm"> * @param {Object} obj An object.</span>
<span class="cm"> * @return {Number} The object&#39;s size.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">O</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns `true` if the object owns an enumerable property with the specified</span>
<span class="cm"> * value.</span>
<span class="cm"> *</span>
<span class="cm"> * @method hasValue</span>
<span class="cm"> * @param {Object} obj An object.</span>
<span class="cm"> * @param {any} value The value to search for.</span>
<span class="cm"> * @return {Boolean} `true` if _obj_ contains _value_, `false` otherwise.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">hasValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">O</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">obj</span><span class="p">),</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Executes a function on each enumerable property in _obj_. The function</span>
<span class="cm"> * receives the value, the key, and the object itself as parameters (in that</span>
<span class="cm"> * order).</span>
<span class="cm"> *</span>
<span class="cm"> * By default, only properties owned by _obj_ are enumerated. To include</span>
<span class="cm"> * prototype properties, set the _proto_ parameter to `true`.</span>
<span class="cm"> *</span>
<span class="cm"> * @method each</span>
<span class="cm"> * @param {Object} obj Object to enumerate.</span>
<span class="cm"> * @param {Function} fn Function to execute on each enumerable property.</span>
<span class="cm"> *   @param {mixed} fn.value Value of the current property.</span>
<span class="cm"> *   @param {String} fn.key Key of the current property.</span>
<span class="cm"> *   @param {Object} fn.obj Object being enumerated.</span>
<span class="cm"> * @param {Object} [thisObj] `this` object to use when calling _fn_.</span>
<span class="cm"> * @param {Boolean} [proto=false] Include prototype properties.</span>
<span class="cm"> * @return {YUI} the YUI instance.</span>
<span class="cm"> * @chainable</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span><span class="p">,</span> <span class="nx">proto</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">proto</span> <span class="o">||</span> <span class="nx">owns</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisObj</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Executes a function on each enumerable property in _obj_, but halts if the</span>
<span class="cm"> * function returns a truthy value. The function receives the value, the key,</span>
<span class="cm"> * and the object itself as paramters (in that order).</span>
<span class="cm"> *</span>
<span class="cm"> * By default, only properties owned by _obj_ are enumerated. To include</span>
<span class="cm"> * prototype properties, set the _proto_ parameter to `true`.</span>
<span class="cm"> *</span>
<span class="cm"> * @method some</span>
<span class="cm"> * @param {Object} obj Object to enumerate.</span>
<span class="cm"> * @param {Function} fn Function to execute on each enumerable property.</span>
<span class="cm"> *   @param {mixed} fn.value Value of the current property.</span>
<span class="cm"> *   @param {String} fn.key Key of the current property.</span>
<span class="cm"> *   @param {Object} fn.obj Object being enumerated.</span>
<span class="cm"> * @param {Object} [thisObj] `this` object to use when calling _fn_.</span>
<span class="cm"> * @param {Boolean} [proto=false] Include prototype properties.</span>
<span class="cm"> * @return {Boolean} `true` if any execution of _fn_ returns a truthy value,</span>
<span class="cm"> *   `false` otherwise.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">some</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">thisObj</span><span class="p">,</span> <span class="nx">proto</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">proto</span> <span class="o">||</span> <span class="nx">owns</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisObj</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Retrieves the sub value at the provided path,</span>
<span class="cm"> * from the value object provided.</span>
<span class="cm"> *</span>
<span class="cm"> * @method getValue</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o The object from which to extract the property value.</span>
<span class="cm"> * @param path {Array} A path array, specifying the object traversal path</span>
<span class="cm"> * from which to obtain the sub value.</span>
<span class="cm"> * @return {Any} The value stored in the path, undefined if not found,</span>
<span class="cm"> * undefined if the source is not an object.  Returns the source object</span>
<span class="cm"> * if an empty path is provided.</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">getValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">UNDEFINED</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">p</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">o</span> <span class="o">!==</span> <span class="nx">UNDEFINED</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Sets the sub-attribute value at the provided path on the</span>
<span class="cm"> * value object.  Returns the modified value object, or</span>
<span class="cm"> * undefined if the path is invalid.</span>
<span class="cm"> *</span>
<span class="cm"> * @method setValue</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param o             The object on which to set the sub value.</span>
<span class="cm"> * @param path {Array}  A path array, specifying the object traversal path</span>
<span class="cm"> *                      at which to set the sub value.</span>
<span class="cm"> * @param val {Any}     The new value for the sub-attribute.</span>
<span class="cm"> * @return {Object}     The modified object, with the new sub value set, or</span>
<span class="cm"> *                      undefined, if the path was invalid.</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">setValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">p</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span>
        <span class="nx">leafIdx</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">ref</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">leafIdx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">ref</span> <span class="o">!==</span> <span class="nx">UNDEFINED</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">leafIdx</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ref</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">[</span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ref</span> <span class="o">!==</span> <span class="nx">UNDEFINED</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ref</span><span class="p">[</span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">UNDEFINED</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns `true` if the object has no enumerable properties of its own.</span>
<span class="cm"> *</span>
<span class="cm"> * @method isEmpty</span>
<span class="cm"> * @param {Object} obj An object.</span>
<span class="cm"> * @return {Boolean} `true` if the object is empty.</span>
<span class="cm"> * @static</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> */</span>
<span class="nx">O</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">O</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * The YUI module contains the components required for building the YUI seed</span>
<span class="cm"> * file.  This includes the script loading mechanism, a simple queue, and the</span>
<span class="cm"> * core utilities for the library.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * YUI user agent detection.</span>
<span class="cm"> * Do not fork for a browser if it can be avoided.  Use feature detection when</span>
<span class="cm"> * you can.  Use the user agent as a last resort.  For all fields listed</span>
<span class="cm"> * as @type float, UA stores a version number for the browser engine,</span>
<span class="cm"> * 0 otherwise.  This value may or may not map to the version number of</span>
<span class="cm"> * the browser using the engine.  The value is presented as a float so</span>
<span class="cm"> * that it can easily be used for boolean evaluation as well as for</span>
<span class="cm"> * looking for a particular range of versions.  Because of this,</span>
<span class="cm"> * some of the granularity of the version info may be lost.  The fields that</span>
<span class="cm"> * are @type string default to null.  The API docs list the values that</span>
<span class="cm"> * these fields can have.</span>
<span class="cm"> * @class UA</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="cm">/**</span>
<span class="cm">* Static method for parsing the UA string. Defaults to assigning it&#39;s value to Y.UA</span>
<span class="cm">* @static</span>
<span class="cm">* @method Env.parseUA</span>
<span class="cm">* @param {String} subUA Parse this UA string instead of navigator.userAgent</span>
<span class="cm">* @returns {Object} The Y.UA object</span>
<span class="cm">*/</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">parseUA</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subUA</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">numberify</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">c</span><span class="o">++</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">;</span>
            <span class="p">}));</span>
        <span class="p">},</span>

        <span class="nx">win</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>

        <span class="nx">nav</span> <span class="o">=</span> <span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="nx">win</span><span class="p">.</span><span class="nx">navigator</span><span class="p">,</span>

        <span class="nx">o</span> <span class="o">=</span> <span class="p">{</span>

        <span class="cm">/**</span>
<span class="cm">         * Internet Explorer version number or 0.  Example: 6</span>
<span class="cm">         * @property ie</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">ie</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Opera version number or 0.  Example: 9.2</span>
<span class="cm">         * @property opera</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">opera</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Gecko engine revision number.  Will evaluate to 1 if Gecko</span>
<span class="cm">         * is detected but the revision could not be found. Other browsers</span>
<span class="cm">         * will be 0.  Example: 1.8</span>
<span class="cm">         * &lt;pre&gt;</span>
<span class="cm">         * Firefox 1.0.0.4: 1.7.8   &lt;-- Reports 1.7</span>
<span class="cm">         * Firefox 1.5.0.9: 1.8.0.9 &lt;-- 1.8</span>
<span class="cm">         * Firefox 2.0.0.3: 1.8.1.3 &lt;-- 1.81</span>
<span class="cm">         * Firefox 3.0   &lt;-- 1.9</span>
<span class="cm">         * Firefox 3.5   &lt;-- 1.91</span>
<span class="cm">         * &lt;/pre&gt;</span>
<span class="cm">         * @property gecko</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">gecko</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * AppleWebKit version.  KHTML browsers that are not WebKit browsers</span>
<span class="cm">         * will evaluate to 1, other browsers 0.  Example: 418.9</span>
<span class="cm">         * &lt;pre&gt;</span>
<span class="cm">         * Safari 1.3.2 (312.6): 312.8.1 &lt;-- Reports 312.8 -- currently the</span>
<span class="cm">         *                                   latest available for Mac OSX 10.3.</span>
<span class="cm">         * Safari 2.0.2:         416     &lt;-- hasOwnProperty introduced</span>
<span class="cm">         * Safari 2.0.4:         418     &lt;-- preventDefault fixed</span>
<span class="cm">         * Safari 2.0.4 (419.3): 418.9.1 &lt;-- One version of Safari may run</span>
<span class="cm">         *                                   different versions of webkit</span>
<span class="cm">         * Safari 2.0.4 (419.3): 419     &lt;-- Tiger installations that have been</span>
<span class="cm">         *                                   updated, but not updated</span>
<span class="cm">         *                                   to the latest patch.</span>
<span class="cm">         * Webkit 212 nightly:   522+    &lt;-- Safari 3.0 precursor (with native</span>
<span class="cm">         * SVG and many major issues fixed).</span>
<span class="cm">         * Safari 3.0.4 (523.12) 523.12  &lt;-- First Tiger release - automatic</span>
<span class="cm">         * update from 2.x via the 10.4.11 OS patch.</span>
<span class="cm">         * Webkit nightly 1/2008:525+    &lt;-- Supports DOMContentLoaded event.</span>
<span class="cm">         *                                   yahoo.com user agent hack removed.</span>
<span class="cm">         * &lt;/pre&gt;</span>
<span class="cm">         * http://en.wikipedia.org/wiki/Safari_version_history</span>
<span class="cm">         * @property webkit</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">webkit</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Safari will be detected as webkit, but this property will also</span>
<span class="cm">         * be populated with the Safari version number</span>
<span class="cm">         * @property safari</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">safari</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Chrome will be detected as webkit, but this property will also</span>
<span class="cm">         * be populated with the Chrome version number</span>
<span class="cm">         * @property chrome</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">chrome</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * The mobile property will be set to a string containing any relevant</span>
<span class="cm">         * user agent information when a modern mobile browser is detected.</span>
<span class="cm">         * Currently limited to Safari on the iPhone/iPod Touch, Nokia N-series</span>
<span class="cm">         * devices with the WebKit-based browser, and Opera Mini.</span>
<span class="cm">         * @property mobile</span>
<span class="cm">         * @type string</span>
<span class="cm">         * @default null</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">mobile</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Adobe AIR version number or 0.  Only populated if webkit is detected.</span>
<span class="cm">         * Example: 1.0</span>
<span class="cm">         * @property air</span>
<span class="cm">         * @type float</span>
<span class="cm">         */</span>
        <span class="nx">air</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/**</span>
<span class="cm">         * Detects Apple iPad&#39;s OS version</span>
<span class="cm">         * @property ipad</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">ipad</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/**</span>
<span class="cm">         * Detects Apple iPhone&#39;s OS version</span>
<span class="cm">         * @property iphone</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">iphone</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/**</span>
<span class="cm">         * Detects Apples iPod&#39;s OS version</span>
<span class="cm">         * @property ipod</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">ipod</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/**</span>
<span class="cm">         * General truthy check for iPad, iPhone or iPod</span>
<span class="cm">         * @property ios</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @default null</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">ios</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="cm">/**</span>
<span class="cm">         * Detects Googles Android OS version</span>
<span class="cm">         * @property android</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">android</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/**</span>
<span class="cm">         * Detects Palms WebOS version</span>
<span class="cm">         * @property webos</span>
<span class="cm">         * @type float</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">webos</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Google Caja version number or 0.</span>
<span class="cm">         * @property caja</span>
<span class="cm">         * @type float</span>
<span class="cm">         */</span>
        <span class="nx">caja</span><span class="o">:</span> <span class="nx">nav</span> <span class="o">&amp;&amp;</span> <span class="nx">nav</span><span class="p">.</span><span class="nx">cajaVersion</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Set to true if the page appears to be in SSL</span>
<span class="cm">         * @property secure</span>
<span class="cm">         * @type boolean</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">secure</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * The operating system.  Currently only detecting windows or macintosh</span>
<span class="cm">         * @property os</span>
<span class="cm">         * @type string</span>
<span class="cm">         * @default null</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">os</span><span class="o">:</span> <span class="kc">null</span>

    <span class="p">},</span>

    <span class="nx">ua</span> <span class="o">=</span> <span class="nx">subUA</span> <span class="o">||</span> <span class="nx">nav</span> <span class="o">&amp;&amp;</span> <span class="nx">nav</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">,</span>

    <span class="nx">loc</span> <span class="o">=</span> <span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="nx">win</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>

    <span class="nx">href</span> <span class="o">=</span> <span class="nx">loc</span> <span class="o">&amp;&amp;</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>

    <span class="nx">m</span><span class="p">;</span>

    <span class="nx">o</span><span class="p">.</span><span class="nx">secure</span> <span class="o">=</span> <span class="nx">href</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">href</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">((</span><span class="sr">/windows|win32/i</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">os</span> <span class="o">=</span> <span class="s1">&#39;windows&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="sr">/macintosh/i</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">os</span> <span class="o">=</span> <span class="s1">&#39;macintosh&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="sr">/rhino/i</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">os</span> <span class="o">=</span> <span class="s1">&#39;rhino&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Modern KHTML browsers should qualify as Safari X-Grade</span>
        <span class="k">if</span> <span class="p">((</span><span class="sr">/KHTML/</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">webkit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// Modern WebKit browsers are at least X-Grade</span>
        <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/AppleWebKit\/([^\s]*)/</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">webkit</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">safari</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">webkit</span><span class="p">;</span>

            <span class="c1">// Mobile browser check</span>
            <span class="k">if</span> <span class="p">(</span><span class="sr">/ Mobile\//</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">mobile</span> <span class="o">=</span> <span class="s1">&#39;Apple&#39;</span><span class="p">;</span> <span class="c1">// iPhone or iPod Touch</span>

                <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/OS ([^\s]*)/</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">));</span>
                <span class="p">}</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">ios</span> <span class="o">=</span> <span class="nx">m</span><span class="p">;</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">ipad</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">ipod</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">iphone</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/iPad|iPod|iPhone/</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">[</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">ios</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/NokiaN[^\/]*|webOS\/\d\.\d/</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Nokia N-series, webOS, ex: NokiaN95</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">mobile</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="sr">/webOS/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">mobile</span> <span class="o">=</span> <span class="s1">&#39;WebOS&#39;</span><span class="p">;</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/webOS\/([^\s]*);/</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">o</span><span class="p">.</span><span class="nx">webos</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="sr">/ Android/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="sr">/Mobile/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">o</span><span class="p">.</span><span class="nx">mobile</span> <span class="o">=</span> <span class="s1">&#39;Android&#39;</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Android ([^\s]*);/</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">o</span><span class="p">.</span><span class="nx">android</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                    <span class="p">}</span>

                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Chrome\/([^\s]*)/</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">chrome</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// Chrome</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">safari</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//Reset safari back to 0</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/AdobeAIR\/([^\s]*)/</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">air</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// Adobe AIR 1.0 or better</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">webkit</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// not webkit</span>
<span class="c1">// @todo check Opera/8.01 (J2ME/MIDP; Opera Mini/2.0.4509/1316; fi; U; ssr)</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Opera[\s\/]([^\s]*)/</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">opera</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Version\/([^\s]*)/</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">opera</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// opera 10+</span>
                <span class="p">}</span>

                <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Opera Mini[^;]*/</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">mobile</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// ex: Opera Mini/2.0.4509/1316</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// not opera or webkit</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/MSIE\s([^;]*)/</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">ie</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// not opera, webkit, or ie</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Gecko\/([^\s]*)/</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">o</span><span class="p">.</span><span class="nx">gecko</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Gecko detected, look for revision</span>
                        <span class="nx">m</span> <span class="o">=</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/rv:([^\s\)]*)/</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nx">o</span><span class="p">.</span><span class="nx">gecko</span> <span class="o">=</span> <span class="nx">numberify</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">UA</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
<span class="p">};</span>


<span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">UA</span> <span class="o">||</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">parseUA</span><span class="p">();</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">aliases</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;anim&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;anim-base&quot;</span><span class="p">,</span><span class="s2">&quot;anim-color&quot;</span><span class="p">,</span><span class="s2">&quot;anim-curve&quot;</span><span class="p">,</span><span class="s2">&quot;anim-easing&quot;</span><span class="p">,</span><span class="s2">&quot;anim-node-plugin&quot;</span><span class="p">,</span><span class="s2">&quot;anim-scroll&quot;</span><span class="p">,</span><span class="s2">&quot;anim-xy&quot;</span><span class="p">],</span>
    <span class="s2">&quot;app&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;controller&quot;</span><span class="p">,</span><span class="s2">&quot;model&quot;</span><span class="p">,</span><span class="s2">&quot;model-list&quot;</span><span class="p">,</span><span class="s2">&quot;view&quot;</span><span class="p">],</span>
    <span class="s2">&quot;attribute&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;attribute-base&quot;</span><span class="p">,</span><span class="s2">&quot;attribute-complex&quot;</span><span class="p">],</span>
    <span class="s2">&quot;autocomplete&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;autocomplete-base&quot;</span><span class="p">,</span><span class="s2">&quot;autocomplete-sources&quot;</span><span class="p">,</span><span class="s2">&quot;autocomplete-list&quot;</span><span class="p">,</span><span class="s2">&quot;autocomplete-plugin&quot;</span><span class="p">],</span>
    <span class="s2">&quot;base&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;base-base&quot;</span><span class="p">,</span><span class="s2">&quot;base-pluginhost&quot;</span><span class="p">,</span><span class="s2">&quot;base-build&quot;</span><span class="p">],</span>
    <span class="s2">&quot;cache&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;cache-base&quot;</span><span class="p">,</span><span class="s2">&quot;cache-offline&quot;</span><span class="p">,</span><span class="s2">&quot;cache-plugin&quot;</span><span class="p">],</span>
    <span class="s2">&quot;collection&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;array-extras&quot;</span><span class="p">,</span><span class="s2">&quot;arraylist&quot;</span><span class="p">,</span><span class="s2">&quot;arraylist-add&quot;</span><span class="p">,</span><span class="s2">&quot;arraylist-filter&quot;</span><span class="p">,</span><span class="s2">&quot;array-invoke&quot;</span><span class="p">],</span>
    <span class="s2">&quot;dataschema&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;dataschema-base&quot;</span><span class="p">,</span><span class="s2">&quot;dataschema-json&quot;</span><span class="p">,</span><span class="s2">&quot;dataschema-xml&quot;</span><span class="p">,</span><span class="s2">&quot;dataschema-array&quot;</span><span class="p">,</span><span class="s2">&quot;dataschema-text&quot;</span><span class="p">],</span>
    <span class="s2">&quot;datasource&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-io&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-get&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-function&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-cache&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-jsonschema&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-xmlschema&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-arrayschema&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-textschema&quot;</span><span class="p">,</span><span class="s2">&quot;datasource-polling&quot;</span><span class="p">],</span>
    <span class="s2">&quot;datatable&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;datatable-base&quot;</span><span class="p">,</span><span class="s2">&quot;datatable-datasource&quot;</span><span class="p">,</span><span class="s2">&quot;datatable-sort&quot;</span><span class="p">,</span><span class="s2">&quot;datatable-scroll&quot;</span><span class="p">],</span>
    <span class="s2">&quot;datatype&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;datatype-number&quot;</span><span class="p">,</span><span class="s2">&quot;datatype-date&quot;</span><span class="p">,</span><span class="s2">&quot;datatype-xml&quot;</span><span class="p">],</span>
    <span class="s2">&quot;datatype-number&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;datatype-number-parse&quot;</span><span class="p">,</span><span class="s2">&quot;datatype-number-format&quot;</span><span class="p">],</span>
    <span class="s2">&quot;datatype-xml&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;datatype-xml-parse&quot;</span><span class="p">,</span><span class="s2">&quot;datatype-xml-format&quot;</span><span class="p">],</span>
    <span class="s2">&quot;dd&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;dd-ddm-base&quot;</span><span class="p">,</span><span class="s2">&quot;dd-ddm&quot;</span><span class="p">,</span><span class="s2">&quot;dd-ddm-drop&quot;</span><span class="p">,</span><span class="s2">&quot;dd-drag&quot;</span><span class="p">,</span><span class="s2">&quot;dd-proxy&quot;</span><span class="p">,</span><span class="s2">&quot;dd-constrain&quot;</span><span class="p">,</span><span class="s2">&quot;dd-drop&quot;</span><span class="p">,</span><span class="s2">&quot;dd-scroll&quot;</span><span class="p">,</span><span class="s2">&quot;dd-delegate&quot;</span><span class="p">],</span>
    <span class="s2">&quot;dom&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;dom-core&quot;</span><span class="p">,</span><span class="s2">&quot;dom-base&quot;</span><span class="p">,</span><span class="s2">&quot;dom-attrs&quot;</span><span class="p">,</span><span class="s2">&quot;dom-create&quot;</span><span class="p">,</span><span class="s2">&quot;dom-class&quot;</span><span class="p">,</span><span class="s2">&quot;dom-size&quot;</span><span class="p">,</span><span class="s2">&quot;dom-screen&quot;</span><span class="p">,</span><span class="s2">&quot;dom-style&quot;</span><span class="p">,</span><span class="s2">&quot;selector-native&quot;</span><span class="p">,</span><span class="s2">&quot;selector&quot;</span><span class="p">],</span>
    <span class="s2">&quot;editor&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;frame&quot;</span><span class="p">,</span><span class="s2">&quot;selection&quot;</span><span class="p">,</span><span class="s2">&quot;exec-command&quot;</span><span class="p">,</span><span class="s2">&quot;editor-base&quot;</span><span class="p">,</span><span class="s2">&quot;editor-para&quot;</span><span class="p">,</span><span class="s2">&quot;editor-br&quot;</span><span class="p">,</span><span class="s2">&quot;editor-bidi&quot;</span><span class="p">,</span><span class="s2">&quot;editor-tab&quot;</span><span class="p">,</span><span class="s2">&quot;createlink-base&quot;</span><span class="p">],</span>
    <span class="s2">&quot;event&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;event-base&quot;</span><span class="p">,</span><span class="s2">&quot;event-delegate&quot;</span><span class="p">,</span><span class="s2">&quot;event-synthetic&quot;</span><span class="p">,</span><span class="s2">&quot;event-mousewheel&quot;</span><span class="p">,</span><span class="s2">&quot;event-mouseenter&quot;</span><span class="p">,</span><span class="s2">&quot;event-key&quot;</span><span class="p">,</span><span class="s2">&quot;event-focus&quot;</span><span class="p">,</span><span class="s2">&quot;event-resize&quot;</span><span class="p">,</span><span class="s2">&quot;event-hover&quot;</span><span class="p">],</span>
    <span class="s2">&quot;event-custom&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;event-custom-base&quot;</span><span class="p">,</span><span class="s2">&quot;event-custom-complex&quot;</span><span class="p">],</span>
    <span class="s2">&quot;event-gestures&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;event-flick&quot;</span><span class="p">,</span><span class="s2">&quot;event-move&quot;</span><span class="p">],</span>
    <span class="s2">&quot;highlight&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;highlight-base&quot;</span><span class="p">,</span><span class="s2">&quot;highlight-accentfold&quot;</span><span class="p">],</span>
    <span class="s2">&quot;history&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;history-base&quot;</span><span class="p">,</span><span class="s2">&quot;history-hash&quot;</span><span class="p">,</span><span class="s2">&quot;history-hash-ie&quot;</span><span class="p">,</span><span class="s2">&quot;history-html5&quot;</span><span class="p">],</span>
    <span class="s2">&quot;io&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;io-base&quot;</span><span class="p">,</span><span class="s2">&quot;io-xdr&quot;</span><span class="p">,</span><span class="s2">&quot;io-form&quot;</span><span class="p">,</span><span class="s2">&quot;io-upload-iframe&quot;</span><span class="p">,</span><span class="s2">&quot;io-queue&quot;</span><span class="p">],</span>
    <span class="s2">&quot;json&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;json-parse&quot;</span><span class="p">,</span><span class="s2">&quot;json-stringify&quot;</span><span class="p">],</span>
    <span class="s2">&quot;loader&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;loader-base&quot;</span><span class="p">,</span><span class="s2">&quot;loader-rollup&quot;</span><span class="p">,</span><span class="s2">&quot;loader-yui3&quot;</span><span class="p">],</span>
    <span class="s2">&quot;node&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;node-base&quot;</span><span class="p">,</span><span class="s2">&quot;node-event-delegate&quot;</span><span class="p">,</span><span class="s2">&quot;node-pluginhost&quot;</span><span class="p">,</span><span class="s2">&quot;node-screen&quot;</span><span class="p">,</span><span class="s2">&quot;node-style&quot;</span><span class="p">],</span>
    <span class="s2">&quot;pluginhost&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;pluginhost-base&quot;</span><span class="p">,</span><span class="s2">&quot;pluginhost-config&quot;</span><span class="p">],</span>
    <span class="s2">&quot;querystring&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;querystring-parse&quot;</span><span class="p">,</span><span class="s2">&quot;querystring-stringify&quot;</span><span class="p">],</span>
    <span class="s2">&quot;recordset&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;recordset-base&quot;</span><span class="p">,</span><span class="s2">&quot;recordset-sort&quot;</span><span class="p">,</span><span class="s2">&quot;recordset-filter&quot;</span><span class="p">,</span><span class="s2">&quot;recordset-indexer&quot;</span><span class="p">],</span>
    <span class="s2">&quot;resize&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;resize-base&quot;</span><span class="p">,</span><span class="s2">&quot;resize-proxy&quot;</span><span class="p">,</span><span class="s2">&quot;resize-constrain&quot;</span><span class="p">],</span>
    <span class="s2">&quot;slider&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;slider-base&quot;</span><span class="p">,</span><span class="s2">&quot;slider-value-range&quot;</span><span class="p">,</span><span class="s2">&quot;clickable-rail&quot;</span><span class="p">,</span><span class="s2">&quot;range-slider&quot;</span><span class="p">],</span>
    <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;text-accentfold&quot;</span><span class="p">,</span><span class="s2">&quot;text-wordbreak&quot;</span><span class="p">],</span>
    <span class="s2">&quot;transition&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;transition-native&quot;</span><span class="p">,</span><span class="s2">&quot;transition-timer&quot;</span><span class="p">],</span>
    <span class="s2">&quot;widget&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;widget-base&quot;</span><span class="p">,</span><span class="s2">&quot;widget-htmlparser&quot;</span><span class="p">,</span><span class="s2">&quot;widget-uievents&quot;</span><span class="p">,</span><span class="s2">&quot;widget-skin&quot;</span><span class="p">],</span>
    <span class="s2">&quot;yui&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;yui-base&quot;</span><span class="p">,</span><span class="s2">&quot;get&quot;</span><span class="p">,</span><span class="s2">&quot;features&quot;</span><span class="p">,</span><span class="s2">&quot;intl-base&quot;</span><span class="p">,</span><span class="s2">&quot;yui-log&quot;</span><span class="p">,</span><span class="s2">&quot;yui-later&quot;</span><span class="p">,</span><span class="s2">&quot;loader-base&quot;</span><span class="p">,</span><span class="s2">&quot;loader-rollup&quot;</span><span class="p">,</span><span class="s2">&quot;loader-yui3&quot;</span><span class="p">],</span>
    <span class="s2">&quot;yui-rls&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;yui-base&quot;</span><span class="p">,</span><span class="s2">&quot;get&quot;</span><span class="p">,</span><span class="s2">&quot;features&quot;</span><span class="p">,</span><span class="s2">&quot;intl-base&quot;</span><span class="p">,</span><span class="s2">&quot;rls&quot;</span><span class="p">,</span><span class="s2">&quot;yui-log&quot;</span><span class="p">,</span><span class="s2">&quot;yui-later&quot;</span><span class="p">]</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">);</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Provides a mechanism to fetch remote resources and</span>
<span class="cm"> * insert them into a document.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule get</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Fetches and inserts one or more script or link nodes into the document</span>
<span class="cm"> * @class Get</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">ua</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">,</span>
    <span class="nx">L</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">,</span>
    <span class="nx">TYPE_JS</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">,</span>
    <span class="nx">TYPE_CSS</span> <span class="o">=</span> <span class="s1">&#39;text/css&#39;</span><span class="p">,</span>
    <span class="nx">STYLESHEET</span> <span class="o">=</span> <span class="s1">&#39;stylesheet&#39;</span><span class="p">,</span>
    <span class="nx">SCRIPT</span> <span class="o">=</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span>
    <span class="nx">AUTOPURGE</span> <span class="o">=</span> <span class="s1">&#39;autopurge&#39;</span><span class="p">,</span>
    <span class="nx">UTF8</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="nx">LINK</span> <span class="o">=</span> <span class="s1">&#39;link&#39;</span><span class="p">,</span>
    <span class="nx">ASYNC</span> <span class="o">=</span> <span class="s1">&#39;async&#39;</span><span class="p">,</span>
    <span class="nx">ALL</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

    <span class="c1">// FireFox does not support the onload event for link nodes, so</span>
    <span class="c1">// there is no way to make the css requests synchronous. This means</span>
    <span class="c1">// that the css rules in multiple files could be applied out of order</span>
    <span class="c1">// in this browser if a later request returns before an earlier one.</span>

    <span class="c1">// Safari too.</span>

    <span class="nx">ONLOAD_SUPPORTED</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">script</span><span class="o">:</span> <span class="nx">ALL</span><span class="p">,</span>
        <span class="nx">css</span><span class="o">:</span> <span class="o">!</span><span class="p">(</span><span class="nx">ua</span><span class="p">.</span><span class="nx">webkit</span> <span class="o">||</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">gecko</span><span class="p">)</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * hash of queues to manage multiple requests</span>
<span class="cm">     * @property queues</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">queues</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="cm">/**</span>
<span class="cm">     * queue index used to generate transaction ids</span>
<span class="cm">     * @property qidx</span>
<span class="cm">     * @type int</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">qidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * interal property used to prevent multiple simultaneous purge</span>
<span class="cm">     * processes</span>
<span class="cm">     * @property purging</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">purging</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Clear timeout state </span>
<span class="cm">     * </span>
<span class="cm">     * @method _clearTimeout</span>
<span class="cm">     * @param {Object} q Queue data</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_clearTimeout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">q</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">timer</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">timer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
            <span class="nx">q</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Generates an HTML element, this is not appended to a document</span>
<span class="cm">     * @method _node</span>
<span class="cm">     * @param {string} type the type of element.</span>
<span class="cm">     * @param {Object} attr the fixed set of attribute for the type.</span>
<span class="cm">     * @param {Object} custAttrs optional Any custom attributes provided by the user.</span>
<span class="cm">     * @param {Window} win optional window to create the element in.</span>
<span class="cm">     * @return {HTMLElement} the generated node.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_node</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">custAttrs</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">win</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">document</span><span class="p">,</span>
            <span class="nx">n</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">type</span><span class="p">),</span>
            <span class="nx">i</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">custAttrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">custAttrs</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">n</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">attr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Generates a link node</span>
<span class="cm">     * @method _linkNode</span>
<span class="cm">     * @param {string} url the url for the css file.</span>
<span class="cm">     * @param {Window} win optional window to create the node in.</span>
<span class="cm">     * @param {object} attributes optional attributes collection to apply to the</span>
<span class="cm">     * new node.</span>
<span class="cm">     * @return {HTMLElement} the generated node.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_linkNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">win</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_node</span><span class="p">(</span><span class="nx">LINK</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">guid</span><span class="p">(),</span>
                        <span class="nx">type</span><span class="o">:</span> <span class="nx">TYPE_CSS</span><span class="p">,</span>
                        <span class="nx">rel</span><span class="o">:</span> <span class="nx">STYLESHEET</span><span class="p">,</span>
                        <span class="nx">href</span><span class="o">:</span> <span class="nx">url</span>
                    <span class="p">},</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">win</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Generates a script node</span>
<span class="cm">     * @method _scriptNode</span>
<span class="cm">     * @param {string} url the url for the script file.</span>
<span class="cm">     * @param {Window} win optional window to create the node in.</span>
<span class="cm">     * @param {object} attributes optional attributes collection to apply to the</span>
<span class="cm">     * new node.</span>
<span class="cm">     * @return {HTMLElement} the generated node.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_scriptNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">win</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_node</span><span class="p">(</span><span class="nx">SCRIPT</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">guid</span><span class="p">(),</span>
                        <span class="nx">type</span><span class="o">:</span> <span class="nx">TYPE_JS</span><span class="p">,</span>
                        <span class="nx">src</span><span class="o">:</span> <span class="nx">url</span>
                    <span class="p">},</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">win</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the data payload for callback functions.</span>
<span class="cm">     * @method _returnData</span>
<span class="cm">     * @param {object} q the queue.</span>
<span class="cm">     * @param {string} msg the result message.</span>
<span class="cm">     * @param {string} result the status message from the request.</span>
<span class="cm">     * @return {object} the state data from the request.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_returnData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">tId</span><span class="o">:</span> <span class="nx">q</span><span class="p">.</span><span class="nx">tId</span><span class="p">,</span>
            <span class="nx">win</span><span class="o">:</span> <span class="nx">q</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">q</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
            <span class="nx">nodes</span><span class="o">:</span> <span class="nx">q</span><span class="p">.</span><span class="nx">nodes</span><span class="p">,</span>
            <span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">,</span>
            <span class="nx">statusText</span><span class="o">:</span> <span class="nx">result</span><span class="p">,</span>

            <span class="nx">purge</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">_purge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tId</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * The transaction is finished</span>
<span class="cm">     * @method _end</span>
<span class="cm">     * @param {string} id the id of the request.</span>
<span class="cm">     * @param {string} msg the result message.</span>
<span class="cm">     * @param {string} result the status message from the request.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_end</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">onEnd</span> <span class="o">=</span> <span class="nx">q</span> <span class="o">&amp;&amp;</span> <span class="nx">q</span><span class="p">.</span><span class="nx">onEnd</span><span class="p">;</span>

        <span class="nx">q</span><span class="p">.</span><span class="nx">finished</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">onEnd</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">onEnd</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">_returnData</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">result</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * The request failed, execute fail handler with whatever</span>
<span class="cm">     * was accomplished.  There isn&#39;t a failure case at the</span>
<span class="cm">     * moment unless you count aborted transactions</span>
<span class="cm">     * @method _fail</span>
<span class="cm">     * @param {string} id the id of the request</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_fail</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;get failure: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">onFailure</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">onFailure</span><span class="p">;</span>

        <span class="nx">_clearTimeout</span><span class="p">(</span><span class="nx">q</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">onFailure</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">onFailure</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">_returnData</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span> <span class="nx">msg</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nx">_end</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="s1">&#39;failure&#39;</span><span class="p">);</span>
    <span class="p">},</span>


    <span class="cm">/**</span>
<span class="cm">     * Abort the transaction</span>
<span class="cm">     * </span>
<span class="cm">     * @method _abort</span>
<span class="cm">     * @param {Object} id</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_abort</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_fail</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;transaction &#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; was aborted&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * The request is complete, so executing the requester&#39;s callback</span>
<span class="cm">     * @method _complete</span>
<span class="cm">     * @param {string} id the id of the request.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_complete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Finishing transaction &quot;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">onSuccess</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">onSuccess</span><span class="p">;</span>

        <span class="nx">_clearTimeout</span><span class="p">(</span><span class="nx">q</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_abort</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">onSuccess</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">onSuccess</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">_returnData</span><span class="p">(</span><span class="nx">q</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="c1">// 3.3.0 had undefined msg for this path.</span>
            <span class="nx">_end</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="s1">&#39;OK&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Get node reference, from string</span>
<span class="cm">     * </span>
<span class="cm">     * @method _getNodeRef</span>
<span class="cm">     * @param {String|HTMLElement} nId The node id to find. If an HTMLElement is passed in, it will be returned.</span>
<span class="cm">     * @param {String} tId Queue id, used to determine document for queue</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_getNodeRef</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nId</span><span class="p">,</span> <span class="nx">tId</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">tId</span><span class="p">],</span>
            <span class="nx">n</span> <span class="o">=</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">nId</span><span class="p">))</span> <span class="o">?</span> <span class="nx">q</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">nId</span><span class="p">)</span> <span class="o">:</span> <span class="nx">nId</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_fail</span><span class="p">(</span><span class="nx">tId</span><span class="p">,</span> <span class="s1">&#39;target node not found: &#39;</span> <span class="o">+</span> <span class="nx">nId</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes the nodes for the specified queue</span>
<span class="cm">     * @method _purge</span>
<span class="cm">     * @param {string} tId the transaction id.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_purge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tId</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">nodes</span><span class="p">,</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">sibling</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">insertBefore</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
            <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">tId</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">nodes</span><span class="p">;</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

            <span class="c1">// TODO: Why is node.parentNode undefined? Which forces us to do this...</span>
            <span class="cm">/*</span>
<span class="cm">            doc = q.win.document;</span>
<span class="cm">            parent = doc.getElementsByTagName(&#39;head&#39;)[0];</span>
<span class="cm">            insertBefore = q.insertBefore || doc.getElementsByTagName(&#39;base&#39;)[0];</span>

<span class="cm">            if (insertBefore) {</span>
<span class="cm">                sibling = _getNodeRef(insertBefore, tId);</span>
<span class="cm">                if (sibling) {</span>
<span class="cm">                    parent = sibling.parentNode;</span>
<span class="cm">                }</span>
<span class="cm">            }</span>
<span class="cm">            */</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">parent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">clearAttributes</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">clearAttributes</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// This destroys parentNode ref, so we hold onto it above first.</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">attr</span> <span class="k">in</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span> <span class="p">{</span>
                            <span class="k">delete</span> <span class="nx">node</span><span class="p">[</span><span class="nx">attr</span><span class="p">];</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="nx">parent</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">q</span><span class="p">.</span><span class="nx">nodes</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Progress callback</span>
<span class="cm">     * </span>
<span class="cm">     * @method _progress</span>
<span class="cm">     * @param {string} id The id of the request.</span>
<span class="cm">     * @param {string} The url which just completed.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_progress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">onProgress</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">onProgress</span><span class="p">,</span>
            <span class="nx">o</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">onProgress</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span> <span class="o">=</span> <span class="nx">_returnData</span><span class="p">(</span><span class="nx">q</span><span class="p">);</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
            <span class="nx">onProgress</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Timeout detected</span>
<span class="cm">     * @method _timeout</span>
<span class="cm">     * @param {string} id the id of the request.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_timeout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Timeout &#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">onTimeout</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">onTimeout</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">onTimeout</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">onTimeout</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">_returnData</span><span class="p">(</span><span class="nx">q</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nx">_end</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="s1">&#39;timeout&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * onload callback</span>
<span class="cm">     * @method _loaded</span>
<span class="cm">     * @param {string} id the id of the request.</span>
<span class="cm">     * @return {string} the result.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_loaded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">sync</span> <span class="o">=</span> <span class="o">!</span><span class="nx">q</span><span class="p">.</span><span class="nx">async</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_clearTimeout</span><span class="p">(</span><span class="nx">q</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">_progress</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>

        <span class="c1">// TODO: Cleaning up flow to have a consistent end point</span>

        <span class="c1">// !q.finished check is for the async case,</span>
        <span class="c1">// where scripts may still be loading when we&#39;ve </span>
        <span class="c1">// already aborted. Ideally there should be a single path</span>
        <span class="c1">// for this.</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">q</span><span class="p">.</span><span class="nx">finished</span><span class="p">)</span> <span class="p">{</span> 
            <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_abort</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="o">--</span><span class="nx">q</span><span class="p">.</span><span class="nx">remaining</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_complete</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_next</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Detects when a node has been loaded.  In the case of</span>
<span class="cm">     * script nodes, this does not guarantee that contained</span>
<span class="cm">     * script is ready to use.</span>
<span class="cm">     * @method _trackLoad</span>
<span class="cm">     * @param {string} type the type of node to track.</span>
<span class="cm">     * @param {HTMLElement} n the node to track.</span>
<span class="cm">     * @param {string} id the id of the request.</span>
<span class="cm">     * @param {string} url the url that is being loaded.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_trackLoad</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// TODO: Can we massage this to use ONLOAD_SUPPORTED[type]?</span>

        <span class="c1">// IE supports the readystatechange event for script and css nodes</span>
        <span class="c1">// Opera only for script nodes.  Opera support onload for script</span>
        <span class="c1">// nodes, but this doesn&#39;t fire when there is a load failure.</span>
        <span class="c1">// The onreadystatechange appears to be a better way to respond</span>
        <span class="c1">// to both success and failure.</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ua</span><span class="p">.</span><span class="nx">ie</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">n</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;loaded&#39;</span> <span class="o">===</span> <span class="nx">rs</span> <span class="o">||</span> <span class="s1">&#39;complete&#39;</span> <span class="o">===</span> <span class="nx">rs</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Y.log(id + &quot; onreadstatechange &quot; + url, &quot;info&quot;, &quot;get&quot;);</span>
                    <span class="nx">n</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="nx">_loaded</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ua</span><span class="p">.</span><span class="nx">webkit</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// webkit prior to 3.x is no longer supported</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">SCRIPT</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Safari 3.x supports the load event for script nodes (DOM2)</span>
                <span class="nx">n</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">_loaded</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
                <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

            <span class="c1">// FireFox and Opera support onload (but not DOM2 in FF) handlers for</span>
            <span class="c1">// script nodes. Opera, but not FF, supports the onload event for link nodes.</span>

            <span class="nx">n</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="c1">// Y.log(id + &quot; onload &quot; + url, &quot;info&quot;, &quot;get&quot;);</span>
                <span class="nx">_loaded</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="nx">n</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_fail</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">e</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">);</span>
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_insertInDoc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Add it to the head or insert it before &#39;insertBefore&#39;.  </span>
        <span class="c1">// Work around IE bug if there is a base tag.</span>
        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">,</span>
            <span class="nx">insertBefore</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="o">||</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">sibling</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">insertBefore</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sibling</span> <span class="o">=</span> <span class="nx">_getNodeRef</span><span class="p">(</span><span class="nx">insertBefore</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">sibling</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;inserting before: &#39;</span> <span class="o">+</span> <span class="nx">insertBefore</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">);</span>
                <span class="nx">sibling</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">sibling</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// 3.3.0 assumed head is always around.</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Loads the next item for a given request</span>
<span class="cm">     * @method _next</span>
<span class="cm">     * @param {string} id the id of the request.</span>
<span class="cm">     * @return {string} the result.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_next</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Assigning out here for readability</span>
        <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span>
            <span class="nx">win</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
            <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span>
            <span class="nx">node</span><span class="p">,</span>
            <span class="nx">url</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">url</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;attempting to load &#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">);</span>

            <span class="c1">// !q.timer ensures that this only happens once for async</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">timeout</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">q</span><span class="p">.</span><span class="nx">timer</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">q</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">_timeout</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
                <span class="p">},</span> <span class="nx">timeout</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">SCRIPT</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="nx">_scriptNode</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">win</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="nx">_linkNode</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">win</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// add the node to the queue so we can return it in the callback </span>
            <span class="nx">q</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>

            <span class="nx">_trackLoad</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
            <span class="nx">_insertInDoc</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">win</span><span class="p">);</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ONLOAD_SUPPORTED</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">_loaded</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">async</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// For sync, the _next call is chained in _loaded </span>
                <span class="nx">_next</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes processed queues and corresponding nodes</span>
<span class="cm">     * @method _autoPurge</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_autoPurge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">purging</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">purging</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">q</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">queues</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">queues</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">autopurge</span> <span class="o">&amp;&amp;</span> <span class="nx">q</span><span class="p">.</span><span class="nx">finished</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_purge</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">tId</span><span class="p">);</span>
                    <span class="k">delete</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">purging</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Saves the state for the request and begins loading</span>
<span class="cm">     * the requested urls</span>
<span class="cm">     * @method queue</span>
<span class="cm">     * @param {string} type the type of node to insert.</span>
<span class="cm">     * @param {string} url the url to load.</span>
<span class="cm">     * @param {object} opts the hash of options for this request.</span>
<span class="cm">     * @return {object} transaction object.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_queue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">opts</span> <span class="o">=</span> <span class="nx">opts</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">qidx</span><span class="o">++</span><span class="p">),</span>
            <span class="nx">thresh</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">purgethreshold</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span><span class="p">.</span><span class="nx">PURGE_THRESH</span><span class="p">,</span> 
            <span class="nx">q</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">qidx</span> <span class="o">%</span> <span class="nx">thresh</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_autoPurge</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Merge to protect opts (grandfathered in).</span>
        <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">opts</span><span class="p">);</span>

        <span class="c1">// Avoid mix, merge overhead. Known set of props.</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">tId</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">nodes</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="nx">q</span><span class="p">.</span><span class="nx">win</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">win</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">;</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">context</span> <span class="o">||</span> <span class="nx">q</span><span class="p">;</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">autopurge</span> <span class="o">=</span> <span class="p">(</span><span class="nx">AUTOPURGE</span> <span class="k">in</span> <span class="nx">q</span><span class="p">)</span> <span class="o">?</span> <span class="nx">q</span><span class="p">.</span><span class="nx">autopurge</span> <span class="o">:</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">SCRIPT</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">q</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">charset</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">charset</span> <span class="o">||</span> <span class="nx">q</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">charset</span> <span class="o">||</span> <span class="nx">UTF8</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ASYNC</span> <span class="k">in</span> <span class="nx">q</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">===</span> <span class="nx">SCRIPT</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">q</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">async</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">q</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">))</span> <span class="o">?</span> <span class="p">[</span><span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">]</span> <span class="o">:</span> <span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>

        <span class="c1">// TODO: Do we really need to account for this developer error? </span>
        <span class="c1">// If the url is undefined, this is probably a trailing comma problem in IE.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;skipping empty url&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">q</span><span class="p">.</span><span class="nx">remaining</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

        <span class="nx">_next</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">tId</span><span class="o">:</span> <span class="nx">id</span>
        <span class="p">};</span>
    <span class="p">};</span>


<span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * The number of request required before an automatic purge.</span>
<span class="cm">     * Can be configured via the &#39;purgethreshold&#39; config</span>
<span class="cm">     * property PURGE_THRESH</span>
<span class="cm">     * @static</span>
<span class="cm">     * @type int</span>
<span class="cm">     * @default 20</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">PURGE_THRESH</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Abort a transaction</span>
<span class="cm">     * @method abort</span>
<span class="cm">     * @static</span>
<span class="cm">     * @param {string|object} o Either the tId or the object returned from</span>
<span class="cm">     * script() or css().</span>
<span class="cm">     */</span>
    <span class="nx">abort</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span> <span class="o">?</span> <span class="nx">o</span> <span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">tId</span><span class="p">,</span>
            <span class="nx">q</span> <span class="o">=</span> <span class="nx">queues</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Aborting &#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">);</span>
            <span class="nx">q</span><span class="p">.</span><span class="nx">aborted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Fetches and inserts one or more script nodes into the head</span>
<span class="cm">     * of the current document or the document in a specified window.</span>
<span class="cm">     *</span>
<span class="cm">     * @method script</span>
<span class="cm">     * @static</span>
<span class="cm">     * @param {string|string[]} url the url or urls to the script(s).</span>
<span class="cm">     * @param {object} opts Options:</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     * &lt;dt&gt;onSuccess&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * callback to execute when the script(s) are finished loading</span>
<span class="cm">     * The callback receives an object back with the following</span>
<span class="cm">     * data:</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     * &lt;dt&gt;win&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the window the script(s) were inserted into&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;data&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the data object passed in when the request was made&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;nodes&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;An array containing references to the nodes that were</span>
<span class="cm">     * inserted&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;purge&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;A function that, when executed, will remove the nodes</span>
<span class="cm">     * that were inserted&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;onTimeout&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * callback to execute when a timeout occurs.</span>
<span class="cm">     * The callback receives an object back with the following</span>
<span class="cm">     * data:</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     * &lt;dt&gt;win&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the window the script(s) were inserted into&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;data&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the data object passed in when the request was made&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;nodes&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;An array containing references to the nodes that were</span>
<span class="cm">     * inserted&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;purge&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;A function that, when executed, will remove the nodes</span>
<span class="cm">     * that were inserted&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;onEnd&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;a function that executes when the transaction finishes,</span>
<span class="cm">     * regardless of the exit path&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;onFailure&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * callback to execute when the script load operation fails</span>
<span class="cm">     * The callback receives an object back with the following</span>
<span class="cm">     * data:</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     * &lt;dt&gt;win&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the window the script(s) were inserted into&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;data&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the data object passed in when the request was made&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;nodes&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;An array containing references to the nodes that were</span>
<span class="cm">     * inserted successfully&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;purge&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;A function that, when executed, will remove any nodes</span>
<span class="cm">     * that were inserted&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;onProgress&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;callback to execute when each individual file is done loading </span>
<span class="cm">     * (useful when passing in an array of js files). Receives the same</span>
<span class="cm">     * payload as onSuccess, with the addition of a &lt;code&gt;url&lt;/code&gt; </span>
<span class="cm">     * property, which identifies the file which was loaded.&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;async&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * &lt;p&gt;When passing in an array of JS files, setting this flag to true </span>
<span class="cm">     * will insert them into the document in parallel, as opposed to the </span>
<span class="cm">     * default behavior, which is to chain load them serially. It will also</span>
<span class="cm">     * set the async attribute on the script node to true.&lt;/p&gt; </span>
<span class="cm">     * &lt;p&gt;Setting async:true</span>
<span class="cm">     * will lead to optimal file download performance allowing the browser to</span>
<span class="cm">     * download multiple scripts in parallel, and execute them as soon as they</span>
<span class="cm">     * are available.&lt;/p&gt;  </span>
<span class="cm">     * &lt;p&gt;Note that async:true does not guarantee execution order of the </span>
<span class="cm">     * scripts being downloaded. They are executed in whichever order they </span>
<span class="cm">     * are received.&lt;/p&gt;</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;context&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the execution context for the callbacks&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;win&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;a window other than the one the utility occupies&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;autopurge&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * setting to true will let the utilities cleanup routine purge</span>
<span class="cm">     * the script once loaded</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;purgethreshold&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * The number of transaction before autopurge should be initiated</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;data&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * data that is supplied to the callback when the script(s) are</span>
<span class="cm">     * loaded.</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;insertBefore&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;node or node id that will become the new node&#39;s nextSibling.</span>
<span class="cm">     * If this is not specified, nodes will be inserted before a base</span>
<span class="cm">     * tag should it exist.  Otherwise, the nodes will be appended to the</span>
<span class="cm">     * end of the document head.&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * &lt;dt&gt;charset&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Node charset, default utf-8 (deprecated, use the attributes</span>
<span class="cm">     * config)&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;attributes&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;An object literal containing additional attributes to add to</span>
<span class="cm">     * the link tags&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;timeout&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Number of milliseconds to wait before aborting and firing</span>
<span class="cm">     * the timeout event&lt;/dd&gt;</span>
<span class="cm">     * &lt;pre&gt;</span>
<span class="cm">     * &amp;nbsp; Y.Get.script(</span>
<span class="cm">     * &amp;nbsp; [&quot;http://yui.yahooapis.com/2.5.2/build/yahoo/yahoo-min.js&quot;,</span>
<span class="cm">     * &amp;nbsp;  &quot;http://yui.yahooapis.com/2.5.2/build/event/event-min.js&quot;],</span>
<span class="cm">     * &amp;nbsp; &amp;#123;</span>
<span class="cm">     * &amp;nbsp;   onSuccess: function(o) &amp;#123;</span>
<span class="cm">     * &amp;nbsp;     this.log(&quot;won&#39;t cause error because Y is the context&quot;);</span>
<span class="cm">     * &amp;nbsp;     Y.log(o.data); // foo</span>
<span class="cm">     * &amp;nbsp;     Y.log(o.nodes.length === 2) // true</span>
<span class="cm">     * &amp;nbsp;     // o.purge(); // optionally remove the script nodes</span>
<span class="cm">     * &amp;nbsp;                   // immediately</span>
<span class="cm">     * &amp;nbsp;   &amp;#125;,</span>
<span class="cm">     * &amp;nbsp;   onFailure: function(o) &amp;#123;</span>
<span class="cm">     * &amp;nbsp;     Y.log(&quot;transaction failed&quot;);</span>
<span class="cm">     * &amp;nbsp;   &amp;#125;,</span>
<span class="cm">     * &amp;nbsp;   onTimeout: function(o) &amp;#123;</span>
<span class="cm">     * &amp;nbsp;     Y.log(&quot;transaction timed out&quot;);</span>
<span class="cm">     * &amp;nbsp;   &amp;#125;,</span>
<span class="cm">     * &amp;nbsp;   data: &quot;foo&quot;,</span>
<span class="cm">     * &amp;nbsp;   timeout: 10000, // 10 second timeout</span>
<span class="cm">     * &amp;nbsp;   context: Y, // make the YUI instance</span>
<span class="cm">     * &amp;nbsp;   // win: otherframe // target another window/frame</span>
<span class="cm">     * &amp;nbsp;   autopurge: true // allow the utility to choose when to</span>
<span class="cm">     * &amp;nbsp;                   // remove the nodes</span>
<span class="cm">     * &amp;nbsp;   purgetheshold: 1 // purge previous transaction before</span>
<span class="cm">     * &amp;nbsp;                    // next transaction</span>
<span class="cm">     * &amp;nbsp; &amp;#125;);.</span>
<span class="cm">     * &lt;/pre&gt;</span>
<span class="cm">     * @return {tId: string} an object containing info about the</span>
<span class="cm">     * transaction.</span>
<span class="cm">     */</span>
    <span class="nx">script</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_queue</span><span class="p">(</span><span class="nx">SCRIPT</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Fetches and inserts one or more css link nodes into the</span>
<span class="cm">     * head of the current document or the document in a specified</span>
<span class="cm">     * window.</span>
<span class="cm">     * @method css</span>
<span class="cm">     * @static</span>
<span class="cm">     * @param {string} url the url or urls to the css file(s).</span>
<span class="cm">     * @param {object} opts Options:</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     * &lt;dt&gt;onSuccess&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * callback to execute when the css file(s) are finished loading</span>
<span class="cm">     * The callback receives an object back with the following</span>
<span class="cm">     * data:</span>
<span class="cm">     * &lt;dl&gt;win&lt;/dl&gt;</span>
<span class="cm">     * &lt;dd&gt;the window the link nodes(s) were inserted into&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;data&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the data object passed in when the request was made&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;nodes&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;An array containing references to the nodes that were</span>
<span class="cm">     * inserted&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;purge&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;A function that, when executed, will remove the nodes</span>
<span class="cm">     * that were inserted&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;onProgress&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;callback to execute when each individual file is done loading (useful when passing in an array of css files). Receives the same</span>
<span class="cm">     * payload as onSuccess, with the addition of a &lt;code&gt;url&lt;/code&gt; property, which identifies the file which was loaded. Currently only useful for non Webkit/Gecko browsers,</span>
<span class="cm">     * where onload for css is detected accurately.&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;async&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;When passing in an array of css files, setting this flag to true will insert them</span>
<span class="cm">     * into the document in parallel, as oppposed to the default behavior, which is to chain load them (where possible). </span>
<span class="cm">     * This flag is more useful for scripts currently, since for css Get only chains if not Webkit/Gecko.&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;context&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;the execution context for the callbacks&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;win&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;a window other than the one the utility occupies&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;data&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;</span>
<span class="cm">     * data that is supplied to the callbacks when the nodes(s) are</span>
<span class="cm">     * loaded.</span>
<span class="cm">     * &lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;insertBefore&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;node or node id that will become the new node&#39;s nextSibling&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;charset&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Node charset, default utf-8 (deprecated, use the attributes</span>
<span class="cm">     * config)&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;attributes&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;An object literal containing additional attributes to add to</span>
<span class="cm">     * the link tags&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * &lt;pre&gt;</span>
<span class="cm">     * Y.Get.css(&quot;http://localhost/css/menu.css&quot;);</span>
<span class="cm">     * &lt;/pre&gt;</span>
<span class="cm">     * &lt;pre&gt;</span>
<span class="cm">     * &amp;nbsp; Y.Get.css(</span>
<span class="cm">     * &amp;nbsp; [&quot;http://localhost/css/menu.css&quot;,</span>
<span class="cm">     * &amp;nbsp;  &quot;http://localhost/css/logger.css&quot;], &amp;#123;</span>
<span class="cm">     * &amp;nbsp;   insertBefore: &#39;custom-styles&#39; // nodes will be inserted</span>
<span class="cm">     * &amp;nbsp;                                 // before the specified node</span>
<span class="cm">     * &amp;nbsp; &amp;#125;);.</span>
<span class="cm">     * &lt;/pre&gt;</span>
<span class="cm">     * @return {tId: string} an object containing info about the</span>
<span class="cm">     * transaction.</span>
<span class="cm">     */</span>
    <span class="nx">css</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_queue</span><span class="p">(</span><span class="s1">&#39;css&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">feature_tests</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;Features&#39;</span><span class="p">),</span> <span class="p">{</span>

    <span class="nx">tests</span><span class="o">:</span> <span class="nx">feature_tests</span><span class="p">,</span>

    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cat</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">feature_tests</span><span class="p">[</span><span class="nx">cat</span><span class="p">]</span> <span class="o">=</span> <span class="nx">feature_tests</span><span class="p">[</span><span class="nx">cat</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">feature_tests</span><span class="p">[</span><span class="nx">cat</span><span class="p">][</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">all</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cat</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cat_o</span> <span class="o">=</span> <span class="nx">feature_tests</span><span class="p">[</span><span class="nx">cat</span><span class="p">],</span>
            <span class="c1">// results = {};</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cat_o</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">cat_o</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">cat</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">));</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">?</span> <span class="nx">result</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cat</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span> <span class="o">||</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">ua</span><span class="p">,</span> <span class="nx">test</span><span class="p">,</span>
            <span class="nx">cat_o</span> <span class="o">=</span> <span class="nx">feature_tests</span><span class="p">[</span><span class="nx">cat</span><span class="p">],</span>
            <span class="nx">feature</span> <span class="o">=</span> <span class="nx">cat_o</span> <span class="o">&amp;&amp;</span> <span class="nx">cat_o</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">feature</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Feature test &#39;</span> <span class="o">+</span> <span class="nx">cat</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; not found&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

            <span class="nx">result</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span> <span class="p">{</span>

                <span class="nx">ua</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">ua</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">result</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">[</span><span class="nx">ua</span><span class="p">]);</span>
                <span class="p">}</span>

                <span class="nx">test</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">test</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">test</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="o">!</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span> <span class="nx">result</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">result</span> <span class="o">=</span> <span class="nx">test</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nx">feature</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Y.Features.add(&quot;load&quot;, &quot;1&quot;, {});</span>
<span class="c1">// Y.Features.test(&quot;load&quot;, &quot;1&quot;);</span>
<span class="c1">// caps=1:1;2:0;3:1;</span>

<span class="cm">/* This file is auto-generated by src/loader/meta_join.py */</span>
<span class="kd">var</span> <span class="nx">add</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">add</span><span class="p">;</span>
<span class="c1">// ie-base-test.js</span>
<span class="nx">add</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;event-base-ie&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">imp</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">implementation</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">imp</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">imp</span><span class="p">.</span><span class="nx">hasFeature</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0&#39;</span><span class="p">)));</span>
<span class="p">},</span> 
    <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;node-base&quot;</span>
<span class="p">});</span>
<span class="c1">// ie-style-test.js</span>
<span class="nx">add</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;dom-style-ie&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">testFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span>
        <span class="nx">addFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">add</span><span class="p">,</span>
        <span class="nx">WINDOW</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
        <span class="nx">DOCUMENT</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span>
        <span class="nx">DOCUMENT_ELEMENT</span> <span class="o">=</span> <span class="s1">&#39;documentElement&#39;</span><span class="p">,</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;computedStyle&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">WINDOW</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;getComputedStyle&#39;</span> <span class="k">in</span> <span class="nx">WINDOW</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">DOCUMENT</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;opacity&#39;</span> <span class="k">in</span> <span class="nx">DOCUMENT</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">].</span><span class="nx">style</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">ret</span> <span class="o">=</span>  <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;computedStyle&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">},</span> 
    <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;dom-style&quot;</span>
<span class="p">});</span>
<span class="c1">// 0</span>
<span class="nx">add</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;widget-base-ie&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;widget-base&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;ua&quot;</span><span class="o">:</span> <span class="s2">&quot;ie&quot;</span>
<span class="p">});</span>
<span class="c1">// autocomplete-list-keys-sniff.js</span>
<span class="nx">add</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;autocomplete-list-keys&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only add keyboard support to autocomplete-list if this doesn&#39;t appear to</span>
    <span class="c1">// be an iOS or Android-based mobile device.</span>
    <span class="c1">//</span>
    <span class="c1">// There&#39;s currently no feasible way to actually detect whether a device has</span>
    <span class="c1">// a hardware keyboard, so this sniff will have to do. It can easily be</span>
    <span class="c1">// overridden by manually loading the autocomplete-list-keys module.</span>
    <span class="c1">//</span>
    <span class="c1">// Worth noting: even though iOS supports bluetooth keyboards, Mobile Safari</span>
    <span class="c1">// doesn&#39;t fire the keyboard events used by AutoCompleteList, so there&#39;s</span>
    <span class="c1">// no point loading the -keys module even when a bluetooth keyboard may be</span>
    <span class="c1">// available.</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ios</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">android</span><span class="p">);</span>
<span class="p">},</span> 
    <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;autocomplete-list&quot;</span>
<span class="p">});</span>
<span class="c1">// dd-gestures-test.js</span>
<span class="nx">add</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;dd-gestures&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="s1">&#39;ontouchstart&#39;</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">chrome</span><span class="p">));</span>
<span class="p">},</span> 
    <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;dd-drag&quot;</span>
<span class="p">});</span>
<span class="c1">// selector-test.js</span>
<span class="nx">add</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;selector-css2&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">DOCUMENT</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">DOCUMENT</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="s1">&#39;querySelectorAll&#39;</span> <span class="k">in</span> <span class="nx">DOCUMENT</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">},</span> 
    <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;selector&quot;</span>
<span class="p">});</span>
<span class="c1">// history-hash-ie-test.js</span>
<span class="nx">add</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;history-hash-ie&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">docMode</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentMode</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;onhashchange&#39;</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">)</span> <span class="o">||</span>
            <span class="o">!</span><span class="nx">docMode</span> <span class="o">||</span> <span class="nx">docMode</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">},</span> 
    <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;history-hash&quot;</span>
<span class="p">});</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;intl-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * The Intl utility provides a central location for managing sets of</span>
<span class="cm"> * localized resources (strings and formatting patterns).</span>
<span class="cm"> *</span>
<span class="cm"> * @class Intl</span>
<span class="cm"> * @uses EventTarget</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">SPLIT_REGEX</span> <span class="o">=</span> <span class="sr">/[, ]/</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;Intl&#39;</span><span class="p">),</span> <span class="p">{</span>

 <span class="cm">/**</span>
<span class="cm">    * Returns the language among those available that</span>
<span class="cm">    * best matches the preferred language list, using the Lookup</span>
<span class="cm">    * algorithm of BCP 47.</span>
<span class="cm">    * If none of the available languages meets the user&#39;s preferences,</span>
<span class="cm">    * then &quot;&quot; is returned.</span>
<span class="cm">    * Extended language ranges are not supported.</span>
<span class="cm">    *</span>
<span class="cm">    * @method lookupBestLang</span>
<span class="cm">    * @param {String[] | String} preferredLanguages The list of preferred</span>
<span class="cm">    * languages in descending preference order, represented as BCP 47</span>
<span class="cm">    * language tags. A string array or a comma-separated list.</span>
<span class="cm">    * @param {String[]} availableLanguages The list of languages</span>
<span class="cm">    * that the application supports, represented as BCP 47 language</span>
<span class="cm">    * tags.</span>
<span class="cm">    *</span>
<span class="cm">    * @return {String} The available language that best matches the</span>
<span class="cm">    * preferred language list, or &quot;&quot;.</span>
<span class="cm">    * @since 3.1.0</span>
<span class="cm">    */</span>
    <span class="nx">lookupBestLang</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">preferredLanguages</span><span class="p">,</span> <span class="nx">availableLanguages</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">index</span><span class="p">;</span>

        <span class="c1">// check whether the list of available languages contains language;</span>
        <span class="c1">// if so return it</span>
        <span class="kd">function</span> <span class="nx">scan</span><span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">availableLanguages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span>
                            <span class="nx">availableLanguages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">availableLanguages</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">preferredLanguages</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">preferredLanguages</span> <span class="o">=</span> <span class="nx">preferredLanguages</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">SPLIT_REGEX</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">preferredLanguages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">language</span> <span class="o">=</span> <span class="nx">preferredLanguages</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">language</span> <span class="o">||</span> <span class="nx">language</span> <span class="o">===</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// check the fallback sequence for one language</span>
            <span class="k">while</span> <span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">result</span> <span class="o">=</span> <span class="nx">scan</span><span class="p">(</span><span class="nx">language</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">index</span> <span class="o">=</span> <span class="nx">language</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">language</span> <span class="o">=</span> <span class="nx">language</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
                        <span class="c1">// one-character subtags get cut along with the</span>
                        <span class="c1">// following subtag</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">language</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">index</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">language</span> <span class="o">=</span> <span class="nx">language</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// nothing available for this language</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;yui-log&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Provides console log capability and exposes a custom event for</span>
<span class="cm"> * console implementations.</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-log</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">INSTANCE</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">,</span>
    <span class="nx">LOGEVENT</span> <span class="o">=</span> <span class="s1">&#39;yui:log&#39;</span><span class="p">,</span>
    <span class="nx">UNDEFINED</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">,</span>
    <span class="nx">LEVELS</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">debug</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="nx">info</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="nx">warn</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="nx">error</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * If the &#39;debug&#39; config is true, a &#39;yui:log&#39; event will be</span>
<span class="cm"> * dispatched, which the Console widget and anything else</span>
<span class="cm"> * can consume.  If the &#39;useBrowserConsole&#39; config is true, it will</span>
<span class="cm"> * write to the browser console if available.  YUI-specific log</span>
<span class="cm"> * messages will only be present in the -debug versions of the</span>
<span class="cm"> * JS files.  The build system is supposed to remove log statements</span>
<span class="cm"> * from the raw and minified versions of the files.</span>
<span class="cm"> *</span>
<span class="cm"> * @method log</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> * @param  {String}  msg  The message to log.</span>
<span class="cm"> * @param  {String}  cat  The log category for the message.  Default</span>
<span class="cm"> *                        categories are &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;, time&quot;.</span>
<span class="cm"> *                        Custom categories can be used as well. (opt).</span>
<span class="cm"> * @param  {String}  src  The source of the the message (opt).</span>
<span class="cm"> * @param  {boolean} silent If true, the log event won&#39;t fire.</span>
<span class="cm"> * @return {YUI}      YUI instance.</span>
<span class="cm"> */</span>
<span class="nx">INSTANCE</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">cat</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">silent</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bail</span><span class="p">,</span> <span class="nx">excl</span><span class="p">,</span> <span class="nx">incl</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span>
        <span class="nx">Y</span> <span class="o">=</span> <span class="nx">INSTANCE</span><span class="p">,</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">,</span>
        <span class="nx">publisher</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span> <span class="o">:</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">globalEvents</span><span class="p">;</span>
    <span class="c1">// suppress log message if the config is off or the event stack</span>
    <span class="c1">// or the event call stack contains a consumer of the yui:log event</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// apply source filters</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">excl</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">logExclude</span><span class="p">;</span>
            <span class="nx">incl</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">logInclude</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">incl</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">src</span> <span class="k">in</span> <span class="nx">incl</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">bail</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">incl</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">src</span> <span class="k">in</span> <span class="nx">incl</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">bail</span> <span class="o">=</span> <span class="o">!</span><span class="nx">incl</span><span class="p">[</span><span class="nx">src</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">excl</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">src</span> <span class="k">in</span> <span class="nx">excl</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">bail</span> <span class="o">=</span> <span class="nx">excl</span><span class="p">[</span><span class="nx">src</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">bail</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">useBrowserConsole</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="o">?</span> <span class="nx">src</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">msg</span> <span class="o">:</span> <span class="nx">msg</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">logFn</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">c</span><span class="p">.</span><span class="nx">logFn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">cat</span><span class="p">,</span> <span class="nx">src</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">!=</span> <span class="nx">UNDEFINED</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cat</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">[</span><span class="nx">cat</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">cat</span> <span class="k">in</span> <span class="nx">LEVELS</span><span class="p">))</span> <span class="o">?</span> <span class="nx">cat</span> <span class="o">:</span> <span class="s1">&#39;log&#39;</span><span class="p">;</span>
                    <span class="nx">console</span><span class="p">[</span><span class="nx">f</span><span class="p">](</span><span class="nx">m</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">opera</span> <span class="o">!=</span> <span class="nx">UNDEFINED</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">opera</span><span class="p">.</span><span class="nx">postError</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">publisher</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">silent</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">publisher</span> <span class="o">==</span> <span class="nx">Y</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">publisher</span><span class="p">.</span><span class="nx">getEvent</span><span class="p">(</span><span class="nx">LOGEVENT</span><span class="p">)))</span> <span class="p">{</span>
                    <span class="nx">publisher</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">LOGEVENT</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">broadcast</span><span class="o">:</span> <span class="mi">2</span>
                    <span class="p">});</span>
                <span class="p">}</span>

                <span class="nx">publisher</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">LOGEVENT</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">,</span>
                    <span class="nx">cat</span><span class="o">:</span> <span class="nx">cat</span><span class="p">,</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="nx">src</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">Y</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Write a system message.  This message will be preserved in the</span>
<span class="cm"> * minified and raw versions of the YUI files, unlike log statements.</span>
<span class="cm"> * @method message</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> * @param  {String}  msg  The message to log.</span>
<span class="cm"> * @param  {String}  cat  The log category for the message.  Default</span>
<span class="cm"> *                        categories are &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;, time&quot;.</span>
<span class="cm"> *                        Custom categories can be used as well. (opt).</span>
<span class="cm"> * @param  {String}  src  The source of the the message (opt).</span>
<span class="cm"> * @param  {boolean} silent If true, the log event won&#39;t fire.</span>
<span class="cm"> * @return {YUI}      YUI instance.</span>
<span class="cm"> */</span>
<span class="nx">INSTANCE</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">INSTANCE</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">INSTANCE</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;yui-later&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Provides a setTimeout/setInterval wrapper</span>
<span class="cm"> * @module yui</span>
<span class="cm"> * @submodule yui-later</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">NO_ARGS</span> <span class="o">=</span> <span class="p">[];</span>

<span class="cm">/**</span>
<span class="cm"> * Executes the supplied function in the context of the supplied</span>
<span class="cm"> * object &#39;when&#39; milliseconds later.  Executes the function a</span>
<span class="cm"> * single time unless periodic is set to true.</span>
<span class="cm"> * @method later</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> * @param when {int} the number of milliseconds to wait until the fn</span>
<span class="cm"> * is executed.</span>
<span class="cm"> * @param o the context object.</span>
<span class="cm"> * @param fn {Function|String} the function to execute or the name of</span>
<span class="cm"> * the method in the &#39;o&#39; object to execute.</span>
<span class="cm"> * @param data [Array] data that is provided to the function.  This</span>
<span class="cm"> * accepts either a single item or an array.  If an array is provided,</span>
<span class="cm"> * the function is executed with one parameter for each array item.</span>
<span class="cm"> * If you need to pass a single array parameter, it needs to be wrapped</span>
<span class="cm"> * in an array [myarray].</span>
<span class="cm"> *</span>
<span class="cm"> * Note: native methods in IE may not have the call and apply methods.</span>
<span class="cm"> * In this case, it will work, but you are limited to four arguments.</span>
<span class="cm"> *</span>
<span class="cm"> * @param periodic {boolean} if true, executes continuously at supplied</span>
<span class="cm"> * interval until canceled.</span>
<span class="cm"> * @return {object} a timer object. Call the cancel() method on this</span>
<span class="cm"> * object to stop the timer.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">later</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">when</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">periodic</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">when</span> <span class="o">=</span> <span class="nx">when</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">:</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cancelled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">method</span> <span class="o">=</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">fn</span><span class="p">))</span> <span class="o">?</span> <span class="nx">o</span><span class="p">[</span><span class="nx">fn</span><span class="p">]</span> <span class="o">:</span> <span class="nx">fn</span><span class="p">,</span>
        <span class="nx">wrapper</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// IE 8- may execute a setInterval callback one last time</span>
            <span class="c1">// after clearInterval was called, so in order to preserve</span>
            <span class="c1">// the cancel() === no more runny-run, we have to jump through</span>
            <span class="c1">// an extra hoop.</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cancelled</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">method</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">data</span> <span class="o">||</span> <span class="nx">NO_ARGS</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">periodic</span><span class="p">)</span> <span class="o">?</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">when</span><span class="p">)</span> <span class="o">:</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">when</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
        <span class="nx">interval</span><span class="o">:</span> <span class="nx">periodic</span><span class="p">,</span>
        <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">cancelled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">later</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">later</span><span class="p">;</span>



<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;loader-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * The YUI loader core</span>
<span class="cm"> * @module loader</span>
<span class="cm"> * @submodule loader-base</span>
<span class="cm"> */</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">version</span><span class="p">])</span> <span class="p">{</span>

    <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">VERSION</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">version</span><span class="p">,</span>
            <span class="nx">BUILD</span> <span class="o">=</span> <span class="s1">&#39;/build/&#39;</span><span class="p">,</span>
            <span class="nx">ROOT</span> <span class="o">=</span> <span class="nx">VERSION</span> <span class="o">+</span> <span class="nx">BUILD</span><span class="p">,</span>
            <span class="nx">CDN_BASE</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span>
            <span class="nx">GALLERY_VERSION</span> <span class="o">=</span> <span class="s1">&#39;gallery-2011.06.08-20-04&#39;</span><span class="p">,</span>
            <span class="nx">TNT</span> <span class="o">=</span> <span class="s1">&#39;2in3&#39;</span><span class="p">,</span>
            <span class="nx">TNT_VERSION</span> <span class="o">=</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span>
            <span class="nx">YUI2_VERSION</span> <span class="o">=</span> <span class="s1">&#39;2.9.0&#39;</span><span class="p">,</span>
            <span class="nx">COMBO_BASE</span> <span class="o">=</span> <span class="nx">CDN_BASE</span> <span class="o">+</span> <span class="s1">&#39;combo?&#39;</span><span class="p">,</span>
            <span class="nx">META</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">version</span><span class="o">:</span> <span class="nx">VERSION</span><span class="p">,</span>
                              <span class="nx">root</span><span class="o">:</span> <span class="nx">ROOT</span><span class="p">,</span>
                              <span class="nx">base</span><span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span>
                              <span class="nx">comboBase</span><span class="o">:</span> <span class="nx">COMBO_BASE</span><span class="p">,</span>
                              <span class="nx">skin</span><span class="o">:</span> <span class="p">{</span> <span class="nx">defaultSkin</span><span class="o">:</span> <span class="s1">&#39;sam&#39;</span><span class="p">,</span>
                                           <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;assets/skins/&#39;</span><span class="p">,</span>
                                           <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;skin.css&#39;</span><span class="p">,</span>
                                           <span class="nx">after</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;cssreset&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;cssfonts&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;cssgrids&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;cssbase&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;cssreset-context&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;cssfonts-context&#39;</span><span class="p">]},</span>
                              <span class="nx">groups</span><span class="o">:</span> <span class="p">{},</span>
                              <span class="nx">patterns</span><span class="o">:</span> <span class="p">{}</span> <span class="p">},</span>
            <span class="nx">groups</span> <span class="o">=</span> <span class="nx">META</span><span class="p">.</span><span class="nx">groups</span><span class="p">,</span>
            <span class="nx">yui2Update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tnt</span><span class="p">,</span> <span class="nx">yui2</span><span class="p">)</span> <span class="p">{</span>
                                  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">TNT</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
                                            <span class="p">(</span><span class="nx">tnt</span> <span class="o">||</span> <span class="nx">TNT_VERSION</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>
                                            <span class="p">(</span><span class="nx">yui2</span> <span class="o">||</span> <span class="nx">YUI2_VERSION</span><span class="p">)</span> <span class="o">+</span> <span class="nx">BUILD</span><span class="p">;</span>
                                  <span class="nx">groups</span><span class="p">.</span><span class="nx">yui2</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">CDN_BASE</span> <span class="o">+</span> <span class="nx">root</span><span class="p">;</span>
                                  <span class="nx">groups</span><span class="p">.</span><span class="nx">yui2</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span>
                              <span class="p">},</span>
            <span class="nx">galleryUpdate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
                                  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="p">(</span><span class="nx">tag</span> <span class="o">||</span> <span class="nx">GALLERY_VERSION</span><span class="p">)</span> <span class="o">+</span> <span class="nx">BUILD</span><span class="p">;</span>
                                  <span class="nx">groups</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">CDN_BASE</span> <span class="o">+</span> <span class="nx">root</span><span class="p">;</span>
                                  <span class="nx">groups</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span>
                              <span class="p">};</span>

        <span class="nx">groups</span><span class="p">[</span><span class="nx">VERSION</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="nx">groups</span><span class="p">.</span><span class="nx">gallery</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">ext</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">combine</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">comboBase</span><span class="o">:</span> <span class="nx">COMBO_BASE</span><span class="p">,</span>
            <span class="nx">update</span><span class="o">:</span> <span class="nx">galleryUpdate</span><span class="p">,</span>
            <span class="nx">patterns</span><span class="o">:</span> <span class="p">{</span> <span class="s1">&#39;gallery-&#39;</span><span class="o">:</span> <span class="p">{</span> <span class="p">},</span>
                        <span class="s1">&#39;gallerycss-&#39;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;css&#39;</span> <span class="p">}</span> <span class="p">}</span>
        <span class="p">};</span>

        <span class="nx">groups</span><span class="p">.</span><span class="nx">yui2</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">combine</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">ext</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">comboBase</span><span class="o">:</span> <span class="nx">COMBO_BASE</span><span class="p">,</span>
            <span class="nx">update</span><span class="o">:</span> <span class="nx">yui2Update</span><span class="p">,</span>
            <span class="nx">patterns</span><span class="o">:</span> <span class="p">{</span>
                <span class="s1">&#39;yui2-&#39;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">configFn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">me</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="sr">/-skin|reset|fonts|grids|base/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">me</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;css&#39;</span><span class="p">;</span>
                            <span class="nx">me</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\.js/</span><span class="p">,</span> <span class="s1">&#39;.css&#39;</span><span class="p">);</span>
                            <span class="c1">// this makes skins in builds earlier than</span>
                            <span class="c1">// 2.6.0 work as long as combine is false</span>
                            <span class="nx">me</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/yui2-skin/</span><span class="p">,</span>
                                             <span class="s1">&#39;/assets/skins/sam/yui2-skin&#39;</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="nx">galleryUpdate</span><span class="p">();</span>
        <span class="nx">yui2Update</span><span class="p">();</span>

        <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">[</span><span class="nx">VERSION</span><span class="p">]</span> <span class="o">=</span> <span class="nx">META</span><span class="p">;</span>
    <span class="p">}());</span>
<span class="p">}</span>


<span class="cm">/**</span>
<span class="cm"> * Loader dynamically loads script and css files.  It includes the dependency</span>
<span class="cm"> * info for the version of the library in use, and will automatically pull in</span>
<span class="cm"> * dependencies for the modules requested.  It supports rollup files and will</span>
<span class="cm"> * automatically use these when appropriate in order to minimize the number of</span>
<span class="cm"> * http connections required to load all of the dependencies.  It can load the</span>
<span class="cm"> * files from the Yahoo! CDN, and it can utilize the combo service provided on</span>
<span class="cm"> * this network to reduce the number of http connections required to download</span>
<span class="cm"> * YUI files.</span>
<span class="cm"> *</span>
<span class="cm"> * @module loader</span>
<span class="cm"> * @submodule loader-base</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">NOT_FOUND</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">NO_REQUIREMENTS</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">MAX_URL_LENGTH</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2048</span> <span class="o">:</span> <span class="mi">8192</span><span class="p">,</span>
    <span class="nx">GLOBAL_ENV</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
    <span class="nx">GLOBAL_LOADED</span> <span class="o">=</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_loaded</span><span class="p">,</span>
    <span class="nx">CSS</span> <span class="o">=</span> <span class="s1">&#39;css&#39;</span><span class="p">,</span>
    <span class="nx">JS</span> <span class="o">=</span> <span class="s1">&#39;js&#39;</span><span class="p">,</span>
    <span class="nx">INTL</span> <span class="o">=</span> <span class="s1">&#39;intl&#39;</span><span class="p">,</span>
    <span class="nx">VERSION</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">version</span><span class="p">,</span>
    <span class="nx">ROOT_LANG</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">YObject</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">,</span>
    <span class="nx">oeach</span> <span class="o">=</span> <span class="nx">YObject</span><span class="p">.</span><span class="nx">each</span><span class="p">,</span>
    <span class="nx">YArray</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">,</span>
    <span class="nx">_queue</span> <span class="o">=</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_loaderQueue</span><span class="p">,</span>
    <span class="nx">META</span> <span class="o">=</span> <span class="nx">GLOBAL_ENV</span><span class="p">[</span><span class="nx">VERSION</span><span class="p">],</span>
    <span class="nx">SKIN_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;skin-&#39;</span><span class="p">,</span>
    <span class="nx">L</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">,</span>
    <span class="nx">ON_PAGE</span> <span class="o">=</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">mods</span><span class="p">,</span>
    <span class="nx">modulekey</span><span class="p">,</span>
    <span class="nx">cache</span><span class="p">,</span>
    <span class="nx">_path</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">nomin</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">dir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">file</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nomin</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">path</span> <span class="o">+=</span> <span class="s1">&#39;-min&#39;</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nx">path</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">type</span> <span class="o">||</span> <span class="nx">CSS</span><span class="p">);</span>

                        <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
                    <span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * The component metadata is stored in Y.Env.meta.</span>
<span class="cm"> * Part of the loader module.</span>
<span class="cm"> * @property Env.meta</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="nx">META</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Loader dynamically loads script and css files.  It includes the dependency</span>
<span class="cm"> * info for the version of the library in use, and will automatically pull in</span>
<span class="cm"> * dependencies for the modules requested.  It supports rollup files and will</span>
<span class="cm"> * automatically use these when appropriate in order to minimize the number of</span>
<span class="cm"> * http connections required to load all of the dependencies.  It can load the</span>
<span class="cm"> * files from the Yahoo! CDN, and it can utilize the combo service provided on</span>
<span class="cm"> * this network to reduce the number of http connections required to download</span>
<span class="cm"> * YUI files.</span>
<span class="cm"> *</span>
<span class="cm"> * While the loader can be instantiated by the end user, it normally is not.</span>
<span class="cm"> * @see YUI.use for the normal use case.  The use function automatically will</span>
<span class="cm"> * pull in missing dependencies.</span>
<span class="cm"> *</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @class Loader</span>
<span class="cm"> * @param {object} o an optional set of configuration options.  Valid options:</span>
<span class="cm"> * &lt;ul&gt;</span>
<span class="cm"> *  &lt;li&gt;base:</span>
<span class="cm"> *  The base dir&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;comboBase:</span>
<span class="cm"> *  The YUI combo service base dir. Ex: http://yui.yahooapis.com/combo?&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;root:</span>
<span class="cm"> *  The root path to prepend to module names for the combo service.</span>
<span class="cm"> *  Ex: 2.5.2/build/&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;filter:.</span>
<span class="cm"> *</span>
<span class="cm"> * A filter to apply to result urls.  This filter will modify the default</span>
<span class="cm"> * path for all modules.  The default path for the YUI library is the</span>
<span class="cm"> * minified version of the files (e.g., event-min.js).  The filter property</span>
<span class="cm"> * can be a predefined filter or a custom filter.  The valid predefined</span>
<span class="cm"> * filters are:</span>
<span class="cm"> * &lt;dl&gt;</span>
<span class="cm"> *  &lt;dt&gt;DEBUG&lt;/dt&gt;</span>
<span class="cm"> *  &lt;dd&gt;Selects the debug versions of the library (e.g., event-debug.js).</span>
<span class="cm"> *      This option will automatically include the Logger widget&lt;/dd&gt;</span>
<span class="cm"> *  &lt;dt&gt;RAW&lt;/dt&gt;</span>
<span class="cm"> *  &lt;dd&gt;Selects the non-minified version of the library (e.g., event.js).</span>
<span class="cm"> *  &lt;/dd&gt;</span>
<span class="cm"> * &lt;/dl&gt;</span>
<span class="cm"> * You can also define a custom filter, which must be an object literal</span>
<span class="cm"> * containing a search expression and a replace string:</span>
<span class="cm"> * &lt;pre&gt;</span>
<span class="cm"> *  myFilter: &amp;#123;</span>
<span class="cm"> *      &#39;searchExp&#39;: &quot;-min\\.js&quot;,</span>
<span class="cm"> *      &#39;replaceStr&#39;: &quot;-debug.js&quot;</span>
<span class="cm"> *  &amp;#125;</span>
<span class="cm"> * &lt;/pre&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  &lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;filters: per-component filter specification.  If specified</span>
<span class="cm"> *  for a given component, this overrides the filter config&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;combine:</span>
<span class="cm"> *  Use the YUI combo service to reduce the number of http connections</span>
<span class="cm"> *  required to load your dependencies&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;ignore:</span>
<span class="cm"> *  A list of modules that should never be dynamically loaded&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;force:</span>
<span class="cm"> *  A list of modules that should always be loaded when required, even if</span>
<span class="cm"> *  already present on the page&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;insertBefore:</span>
<span class="cm"> *  Node or id for a node that should be used as the insertion point for</span>
<span class="cm"> *  new nodes&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;charset:</span>
<span class="cm"> *  charset for dynamic nodes (deprecated, use jsAttributes or cssAttributes)</span>
<span class="cm"> *  &lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;jsAttributes: object literal containing attributes to add to script</span>
<span class="cm"> *  nodes&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;cssAttributes: object literal containing attributes to add to link</span>
<span class="cm"> *  nodes&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;timeout:</span>
<span class="cm"> *  The number of milliseconds before a timeout occurs when dynamically</span>
<span class="cm"> *  loading nodes.  If not set, there is no timeout&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;context:</span>
<span class="cm"> *  execution context for all callbacks&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;onSuccess:</span>
<span class="cm"> *  callback for the &#39;success&#39; event&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;onFailure: callback for the &#39;failure&#39; event&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;onCSS: callback for the &#39;CSSComplete&#39; event.  When loading YUI</span>
<span class="cm"> *  components with CSS the CSS is loaded first, then the script.  This</span>
<span class="cm"> *  provides a moment you can tie into to improve</span>
<span class="cm"> *  the presentation of the page while the script is loading.&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;onTimeout:</span>
<span class="cm"> *  callback for the &#39;timeout&#39; event&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;onProgress:</span>
<span class="cm"> *  callback executed each time a script or css file is loaded&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;modules:</span>
<span class="cm"> *  A list of module definitions.  See Loader.addModule for the supported</span>
<span class="cm"> *  module metadata&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;groups:</span>
<span class="cm"> *  A list of group definitions.  Each group can contain specific definitions</span>
<span class="cm"> *  for base, comboBase, combine, and accepts a list of modules.  See above</span>
<span class="cm"> *  for the description of these properties.&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;2in3: the version of the YUI 2 in 3 wrapper to use.  The intrinsic</span>
<span class="cm"> *  support for YUI 2 modules in YUI 3 relies on versions of the YUI 2</span>
<span class="cm"> *  components inside YUI 3 module wrappers.  These wrappers</span>
<span class="cm"> *  change over time to accomodate the issues that arise from running YUI 2</span>
<span class="cm"> *  in a YUI 3 sandbox.&lt;/li&gt;</span>
<span class="cm"> *  &lt;li&gt;yui2: when using the 2in3 project, you can select the version of</span>
<span class="cm"> *  YUI 2 to use.  Valid values *  are 2.2.2, 2.3.1, 2.4.1, 2.5.2, 2.6.0,</span>
<span class="cm"> *  2.7.0, 2.8.0, and 2.8.1 [default] -- plus all versions of YUI 2</span>
<span class="cm"> *  going forward.&lt;/li&gt;</span>
<span class="cm"> * &lt;/ul&gt;</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Loader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="nx">META</span><span class="p">.</span><span class="nx">modules</span><span class="p">,</span>
        <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="nx">modulekey</span> <span class="o">=</span> <span class="nx">META</span><span class="p">.</span><span class="nx">md5</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Internal callback to handle multiple internal insert() calls</span>
<span class="cm">     * so that css is inserted prior to js</span>
<span class="cm">     * @property _internalCallback</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="c1">// self._internalCallback = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Callback that will be executed when the loader is finished</span>
<span class="cm">     * with an insert</span>
<span class="cm">     * @method onSuccess</span>
<span class="cm">     * @type function</span>
<span class="cm">     */</span>
    <span class="c1">// self.onSuccess = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Callback that will be executed if there is a failure</span>
<span class="cm">     * @method onFailure</span>
<span class="cm">     * @type function</span>
<span class="cm">     */</span>
    <span class="c1">// self.onFailure = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Callback for the &#39;CSSComplete&#39; event.  When loading YUI components</span>
<span class="cm">     * with CSS the CSS is loaded first, then the script.  This provides</span>
<span class="cm">     * a moment you can tie into to improve the presentation of the page</span>
<span class="cm">     * while the script is loading.</span>
<span class="cm">     * @method onCSS</span>
<span class="cm">     * @type function</span>
<span class="cm">     */</span>
    <span class="c1">// self.onCSS = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Callback executed each time a script or css file is loaded</span>
<span class="cm">     * @method onProgress</span>
<span class="cm">     * @type function</span>
<span class="cm">     */</span>
    <span class="c1">// self.onProgress = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Callback that will be executed if a timeout occurs</span>
<span class="cm">     * @method onTimeout</span>
<span class="cm">     * @type function</span>
<span class="cm">     */</span>
    <span class="c1">// self.onTimeout = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * The execution context for all callbacks</span>
<span class="cm">     * @property context</span>
<span class="cm">     * @default {YUI} the YUI instance</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Data that is passed to all callbacks</span>
<span class="cm">     * @property data</span>
<span class="cm">     */</span>
    <span class="c1">// self.data = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Node reference or id where new nodes should be inserted before</span>
<span class="cm">     * @property insertBefore</span>
<span class="cm">     * @type string|HTMLElement</span>
<span class="cm">     */</span>
    <span class="c1">// self.insertBefore = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * The charset attribute for inserted nodes</span>
<span class="cm">     * @property charset</span>
<span class="cm">     * @type string</span>
<span class="cm">     * @deprecated , use cssAttributes or jsAttributes.</span>
<span class="cm">     */</span>
    <span class="c1">// self.charset = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * An object literal containing attributes to add to link nodes</span>
<span class="cm">     * @property cssAttributes</span>
<span class="cm">     * @type object</span>
<span class="cm">     */</span>
    <span class="c1">// self.cssAttributes = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * An object literal containing attributes to add to script nodes</span>
<span class="cm">     * @property jsAttributes</span>
<span class="cm">     * @type object</span>
<span class="cm">     */</span>
    <span class="c1">// self.jsAttributes = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * The base directory.</span>
<span class="cm">     * @property base</span>
<span class="cm">     * @type string</span>
<span class="cm">     * @default http://yui.yahooapis.com/[YUI VERSION]/build/</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">base</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">base</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Base path for the combo service</span>
<span class="cm">     * @property comboBase</span>
<span class="cm">     * @type string</span>
<span class="cm">     * @default http://yui.yahooapis.com/combo?</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">comboBase</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">comboBase</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Base path for language packs.</span>
<span class="cm">     */</span>
    <span class="c1">// self.langBase = Y.Env.meta.langBase;</span>
    <span class="c1">// self.lang = &quot;&quot;;</span>

    <span class="cm">/**</span>
<span class="cm">     * If configured, the loader will attempt to use the combo</span>
<span class="cm">     * service for YUI resources and configured external resources.</span>
<span class="cm">     * @property combine</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default true if a base dir isn&#39;t in the config</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">combine</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">base</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">comboBase</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Max url length for combo urls.  The default is 2048 for</span>
<span class="cm">     * internet explorer, and 8192 otherwise.  This is the URL</span>
<span class="cm">     * limit for the Yahoo! hosted combo servers.  If consuming</span>
<span class="cm">     * a different combo service that has a different URL limit</span>
<span class="cm">     * it is possible to override this default by supplying</span>
<span class="cm">     * the maxURLLength config option.  The config option will</span>
<span class="cm">     * only take effect if lower than the default.</span>
<span class="cm">     *</span>
<span class="cm">     * Browsers:</span>
<span class="cm">     *    IE: 2048</span>
<span class="cm">     *    Other A-Grade Browsers: Higher that what is typically supported</span>
<span class="cm">     *    &#39;capable&#39; mobile browsers:</span>
<span class="cm">     *</span>
<span class="cm">     * Servers:</span>
<span class="cm">     *    Apache: 8192</span>
<span class="cm">     *</span>
<span class="cm">     * @property maxURLLength</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">maxURLLength</span> <span class="o">=</span> <span class="nx">MAX_URL_LENGTH</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Ignore modules registered on the YUI global</span>
<span class="cm">     * @property ignoreRegistered</span>
<span class="cm">     * @default false</span>
<span class="cm">     */</span>
    <span class="c1">// self.ignoreRegistered = false;</span>

    <span class="cm">/**</span>
<span class="cm">     * Root path to prepend to module path for the combo</span>
<span class="cm">     * service</span>
<span class="cm">     * @property root</span>
<span class="cm">     * @type string</span>
<span class="cm">     * @default [YUI VERSION]/build/</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Timeout value in milliseconds.  If set, self value will be used by</span>
<span class="cm">     * the get utility.  the timeout event will fire if</span>
<span class="cm">     * a timeout occurs.</span>
<span class="cm">     * @property timeout</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * A list of modules that should not be loaded, even if</span>
<span class="cm">     * they turn up in the dependency tree</span>
<span class="cm">     * @property ignore</span>
<span class="cm">     * @type string[]</span>
<span class="cm">     */</span>
    <span class="c1">// self.ignore = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * A list of modules that should always be loaded, even</span>
<span class="cm">     * if they have already been inserted into the page.</span>
<span class="cm">     * @property force</span>
<span class="cm">     * @type string[]</span>
<span class="cm">     */</span>
    <span class="c1">// self.force = null;</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">forceMap</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * Should we allow rollups</span>
<span class="cm">     * @property allowRollup</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default false</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">allowRollup</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * A filter to apply to result urls.  This filter will modify the default</span>
<span class="cm">     * path for all modules.  The default path for the YUI library is the</span>
<span class="cm">     * minified version of the files (e.g., event-min.js).  The filter property</span>
<span class="cm">     * can be a predefined filter or a custom filter.  The valid predefined</span>
<span class="cm">     * filters are:</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     *  &lt;dt&gt;DEBUG&lt;/dt&gt;</span>
<span class="cm">     *  &lt;dd&gt;Selects the debug versions of the library (e.g., event-debug.js).</span>
<span class="cm">     *      This option will automatically include the Logger widget&lt;/dd&gt;</span>
<span class="cm">     *  &lt;dt&gt;RAW&lt;/dt&gt;</span>
<span class="cm">     *  &lt;dd&gt;Selects the non-minified version of the library (e.g., event.js).</span>
<span class="cm">     *  &lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * You can also define a custom filter, which must be an object literal</span>
<span class="cm">     * containing a search expression and a replace string:</span>
<span class="cm">     * &lt;pre&gt;</span>
<span class="cm">     *  myFilter: &amp;#123;</span>
<span class="cm">     *      &#39;searchExp&#39;: &quot;-min\\.js&quot;,</span>
<span class="cm">     *      &#39;replaceStr&#39;: &quot;-debug.js&quot;</span>
<span class="cm">     *  &amp;#125;</span>
<span class="cm">     * &lt;/pre&gt;</span>
<span class="cm">     * @property filter</span>
<span class="cm">     * @type string| {searchExp: string, replaceStr: string}</span>
<span class="cm">     */</span>
    <span class="c1">// self.filter = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * per-component filter specification.  If specified for a given</span>
<span class="cm">     * component, this overrides the filter config.</span>
<span class="cm">     * @property filters</span>
<span class="cm">     * @type object</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">filters</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * The list of requested modules</span>
<span class="cm">     * @property required</span>
<span class="cm">     * @type {string: boolean}</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">required</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * If a module name is predefined when requested, it is checked againsts</span>
<span class="cm">     * the patterns provided in this property.  If there is a match, the</span>
<span class="cm">     * module is added with the default configuration.</span>
<span class="cm">     *</span>
<span class="cm">     * At the moment only supporting module prefixes, but anticipate</span>
<span class="cm">     * supporting at least regular expressions.</span>
<span class="cm">     * @property patterns</span>
<span class="cm">     * @type Object</span>
<span class="cm">     */</span>
    <span class="c1">// self.patterns = Y.merge(Y.Env.meta.patterns);</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">patterns</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * The library metadata</span>
<span class="cm">     * @property moduleInfo</span>
<span class="cm">     */</span>
    <span class="c1">// self.moduleInfo = Y.merge(Y.Env.meta.moduleInfo);</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">moduleInfo</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">groups</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">groups</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Provides the information used to skin the skinnable components.</span>
<span class="cm">     * The following skin definition would result in &#39;skin1&#39; and &#39;skin2&#39;</span>
<span class="cm">     * being loaded for calendar (if calendar was requested), and</span>
<span class="cm">     * &#39;sam&#39; for all other skinnable components:</span>
<span class="cm">     *</span>
<span class="cm">     *   &lt;code&gt;</span>
<span class="cm">     *   skin: {</span>
<span class="cm">     *</span>
<span class="cm">     *      // The default skin, which is automatically applied if not</span>
<span class="cm">     *      // overriden by a component-specific skin definition.</span>
<span class="cm">     *      // Change this in to apply a different skin globally</span>
<span class="cm">     *      defaultSkin: &#39;sam&#39;,</span>
<span class="cm">     *</span>
<span class="cm">     *      // This is combined with the loader base property to get</span>
<span class="cm">     *      // the default root directory for a skin. ex:</span>
<span class="cm">     *      // http://yui.yahooapis.com/2.3.0/build/assets/skins/sam/</span>
<span class="cm">     *      base: &#39;assets/skins/&#39;,</span>
<span class="cm">     *</span>
<span class="cm">     *      // Any component-specific overrides can be specified here,</span>
<span class="cm">     *      // making it possible to load different skins for different</span>
<span class="cm">     *      // components.  It is possible to load more than one skin</span>
<span class="cm">     *      // for a given component as well.</span>
<span class="cm">     *      overrides: {</span>
<span class="cm">     *          calendar: [&#39;skin1&#39;, &#39;skin2&#39;]</span>
<span class="cm">     *      }</span>
<span class="cm">     *   }</span>
<span class="cm">     *   &lt;/code&gt;</span>
<span class="cm">     *   @property skin</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">skin</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">skin</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * Map of conditional modules</span>
<span class="cm">     * @since 3.2.0</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">conditions</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="c1">// map of modules with a hash of modules that meet the requirement</span>
    <span class="c1">// self.provides = {};</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">_internal</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>


    <span class="nx">cache</span> <span class="o">=</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_renderedMods</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oeach</span><span class="p">(</span><span class="nx">cache</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">modCache</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//self.moduleInfo[k] = Y.merge(v);</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="nx">cache</span> <span class="o">=</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_conditions</span><span class="p">;</span>

        <span class="nx">oeach</span><span class="p">(</span><span class="nx">cache</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">condCache</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//self.conditions[k] = Y.merge(v);</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">conditions</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
        <span class="p">});</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">oeach</span><span class="p">(</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addModule</span><span class="p">,</span> <span class="nx">self</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_renderedMods</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//GLOBAL_ENV._renderedMods = Y.merge(self.moduleInfo);</span>
        <span class="c1">//GLOBAL_ENV._conditions = Y.merge(self.conditions);</span>
        <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_renderedMods</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">;</span>
        <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_conditions</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">conditions</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">_inspectPage</span><span class="p">();</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">_internal</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">_config</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">testresults</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">tests</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">testresults</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">tests</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * List of rollup files found in the library metadata</span>
<span class="cm">     * @property rollups</span>
<span class="cm">     */</span>
    <span class="c1">// self.rollups = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Whether or not to load optional dependencies for</span>
<span class="cm">     * the requested modules</span>
<span class="cm">     * @property loadOptional</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default false</span>
<span class="cm">     */</span>
    <span class="c1">// self.loadOptional = false;</span>

    <span class="cm">/**</span>
<span class="cm">     * All of the derived dependencies in sorted order, which</span>
<span class="cm">     * will be populated when either calculate() or insert()</span>
<span class="cm">     * is called</span>
<span class="cm">     * @property sorted</span>
<span class="cm">     * @type string[]</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">sorted</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="cm">/**</span>
<span class="cm">     * Set when beginning to compute the dependency tree.</span>
<span class="cm">     * Composed of what YUI reports to be loaded combined</span>
<span class="cm">     * with what has been loaded by any instance on the page</span>
<span class="cm">     * with the version number specified in the metadata.</span>
<span class="cm">     * @property loaded</span>
<span class="cm">     * @type {string: boolean}</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">=</span> <span class="nx">GLOBAL_LOADED</span><span class="p">[</span><span class="nx">VERSION</span><span class="p">];</span>

    <span class="cm">/*</span>
<span class="cm">     * A list of modules to attach to the YUI instance when complete.</span>
<span class="cm">     * If not supplied, the sorted list of dependencies are applied.</span>
<span class="cm">     * @property attaching</span>
<span class="cm">     */</span>
    <span class="c1">// self.attaching = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Flag to indicate the dependency tree needs to be recomputed</span>
<span class="cm">     * if insert is called again.</span>
<span class="cm">     * @property dirty</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default true</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">dirty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * List of modules inserted by the utility</span>
<span class="cm">     * @property inserted</span>
<span class="cm">     * @type {string: boolean}</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">inserted</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * List of skipped modules during insert() because the module</span>
<span class="cm">     * was not defined</span>
<span class="cm">     * @property skipped</span>
<span class="cm">     */</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">skipped</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="c1">// Y.on(&#39;yui:load&#39;, self.loadNext, self);</span>

    <span class="nx">self</span><span class="p">.</span><span class="nx">tested</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/*</span>
<span class="cm">     * Cached sorted calculate results</span>
<span class="cm">     * @property results</span>
<span class="cm">     * @since 3.2.0</span>
<span class="cm">     */</span>
    <span class="c1">//self.results = {};</span>

<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Loader</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">FILTER_DEFS</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">RAW</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;searchExp&#39;</span><span class="o">:</span> <span class="s1">&#39;-min\\.js&#39;</span><span class="p">,</span>
            <span class="s1">&#39;replaceStr&#39;</span><span class="o">:</span> <span class="s1">&#39;.js&#39;</span>
        <span class="p">},</span>
        <span class="nx">DEBUG</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;searchExp&#39;</span><span class="o">:</span> <span class="s1">&#39;-min\\.js&#39;</span><span class="p">,</span>
            <span class="s1">&#39;replaceStr&#39;</span><span class="o">:</span> <span class="s1">&#39;-debug.js&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>

   <span class="nx">_inspectPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
       <span class="nx">oeach</span><span class="p">(</span><span class="nx">ON_PAGE</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">details</span><span class="p">)</span> <span class="p">{</span>
               <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span>
                   <span class="nx">req</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">details</span><span class="p">.</span><span class="nx">requires</span><span class="p">,</span>
                   <span class="nx">mr</span> <span class="o">=</span> <span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">requires</span><span class="p">;</span>
               <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span><span class="p">.</span><span class="nx">_inspected</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span> <span class="o">&amp;&amp;</span> <span class="nx">mr</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                       <span class="c1">// console.log(&#39;deleting &#39; + m.name);</span>
                       <span class="c1">// m.requres = YObject.keys(Y.merge(YArray.hash(req), YArray.hash(mr)));</span>
                       <span class="k">delete</span> <span class="nx">m</span><span class="p">.</span><span class="nx">expanded</span><span class="p">;</span>
                       <span class="c1">// delete m.expanded_map;</span>
                   <span class="p">}</span>
               <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                   <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">details</span><span class="p">,</span> <span class="nx">k</span><span class="p">);</span>
               <span class="p">}</span>
               <span class="nx">m</span><span class="p">.</span><span class="nx">_inspected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
           <span class="p">}</span>
       <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
   <span class="p">},</span>

<span class="c1">// returns true if b is not loaded, and is required</span>
<span class="c1">// directly or by means of modules it supersedes.</span>
   <span class="nx">_requires</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mod1</span><span class="p">,</span> <span class="nx">mod2</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">rm</span><span class="p">,</span> <span class="nx">after_map</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span>
            <span class="nx">info</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">,</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod1</span><span class="p">],</span>
            <span class="nx">other</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod2</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span> <span class="o">||</span> <span class="o">!</span><span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">rm</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">expanded_map</span><span class="p">;</span>
        <span class="nx">after_map</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">after_map</span><span class="p">;</span>

        <span class="c1">// check if this module should be sorted after the other</span>
        <span class="c1">// do this first to short circut circular deps</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">after_map</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">mod2</span> <span class="k">in</span> <span class="nx">after_map</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">after_map</span> <span class="o">=</span> <span class="nx">other</span><span class="p">.</span><span class="nx">after_map</span><span class="p">;</span>

        <span class="c1">// and vis-versa</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">after_map</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">mod1</span> <span class="k">in</span> <span class="nx">after_map</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// check if this module requires one the other supersedes</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod2</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod2</span><span class="p">].</span><span class="nx">supersedes</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_requires</span><span class="p">(</span><span class="nx">mod1</span><span class="p">,</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">s</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod1</span><span class="p">].</span><span class="nx">supersedes</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_requires</span><span class="p">(</span><span class="nx">mod2</span><span class="p">,</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// check if this module requires the other directly</span>
        <span class="c1">// if (r &amp;&amp; YArray.indexOf(r, mod2) &gt; -1) {</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">rm</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">mod2</span> <span class="k">in</span> <span class="nx">rm</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// external css files should be sorted below yui css</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">ext</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">CSS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">other</span><span class="p">.</span><span class="nx">ext</span> <span class="o">&amp;&amp;</span> <span class="nx">other</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">CSS</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_config</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">group</span><span class="p">,</span> <span class="nx">groupName</span><span class="p">,</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="c1">// apply config values</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">val</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;require&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;skin&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">skin</span><span class="p">,</span> <span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="kc">true</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;groups&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="p">{</span>
                                <span class="c1">// Y.log(&#39;group: &#39; + j);</span>
                                <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">j</span><span class="p">;</span>
                                <span class="nx">group</span> <span class="o">=</span> <span class="nx">val</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                                <span class="nx">self</span><span class="p">.</span><span class="nx">addGroup</span><span class="p">(</span><span class="nx">group</span><span class="p">,</span> <span class="nx">groupName</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;modules&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// add a hash of module definitions</span>
                        <span class="nx">oeach</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">addModule</span><span class="p">,</span> <span class="nx">self</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;gallery&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">gallery</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;yui2&#39;</span> <span class="o">||</span> <span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;2in3&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">yui2</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="s1">&#39;2in3&#39;</span><span class="p">],</span> <span class="nx">o</span><span class="p">.</span><span class="nx">yui2</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="s1">&#39;maxURLLength&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">MAX_URL_LENGTH</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// fix filter</span>
        <span class="nx">f</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">filter</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">f</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">filterName</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">FILTER_DEFS</span><span class="p">[</span><span class="nx">f</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">f</span> <span class="o">==</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;yui-log&#39;</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">lang</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;intl-base&#39;</span><span class="p">,</span> <span class="s1">&#39;intl&#39;</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the skin module name for the specified skin name.  If a</span>
<span class="cm">     * module name is supplied, the returned skin module name is</span>
<span class="cm">     * specific to the module passed in.</span>
<span class="cm">     * @method formatSkin</span>
<span class="cm">     * @param {string} skin the name of the skin.</span>
<span class="cm">     * @param {string} mod optional: the name of a module to skin.</span>
<span class="cm">     * @return {string} the full skin module name.</span>
<span class="cm">     */</span>
    <span class="nx">formatSkin</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">skin</span><span class="p">,</span> <span class="nx">mod</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">SKIN_PREFIX</span> <span class="o">+</span> <span class="nx">skin</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">mod</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Adds the skin def to the module info</span>
<span class="cm">     * @method _addSkin</span>
<span class="cm">     * @param {string} skin the name of the skin.</span>
<span class="cm">     * @param {string} mod the name of the module.</span>
<span class="cm">     * @param {string} parent parent module if this is a skin of a</span>
<span class="cm">     * submodule or plugin.</span>
<span class="cm">     * @return {string} the module name for the skin.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_addSkin</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">skin</span><span class="p">,</span> <span class="nx">mod</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">mdef</span><span class="p">,</span> <span class="nx">pkg</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span>
            <span class="nx">info</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">,</span>
            <span class="nx">sinf</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">skin</span><span class="p">,</span>
            <span class="nx">ext</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod</span><span class="p">].</span><span class="nx">ext</span><span class="p">;</span>

        <span class="c1">// Add a module definition for the module-specific skin css</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">formatSkin</span><span class="p">(</span><span class="nx">skin</span><span class="p">,</span> <span class="nx">mod</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">info</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">mdef</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">mod</span><span class="p">];</span>
                <span class="nx">pkg</span> <span class="o">=</span> <span class="nx">mdef</span><span class="p">.</span><span class="nx">pkg</span> <span class="o">||</span> <span class="nx">mod</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addModule</span><span class="p">({</span>
                    <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
                    <span class="nx">group</span><span class="o">:</span> <span class="nx">mdef</span><span class="p">.</span><span class="nx">group</span><span class="p">,</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;css&#39;</span><span class="p">,</span>
                    <span class="nx">after</span><span class="o">:</span> <span class="nx">sinf</span><span class="p">.</span><span class="nx">after</span><span class="p">,</span>
                    <span class="nx">path</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span> <span class="o">||</span> <span class="nx">pkg</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">sinf</span><span class="p">.</span><span class="nx">base</span> <span class="o">+</span> <span class="nx">skin</span> <span class="o">+</span>
                          <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">mod</span> <span class="o">+</span> <span class="s1">&#39;.css&#39;</span><span class="p">,</span>
                    <span class="nx">ext</span><span class="o">:</span> <span class="nx">ext</span>
                <span class="p">},</span> <span class="nx">name</span><span class="p">);</span>

                <span class="c1">// Y.log(&#39;adding skin &#39; + name + &#39;, &#39;</span>
                <span class="c1">// + parent + &#39;, &#39; + pkg + &#39;, &#39; + info[name].path);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Add a new module group</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     *   &lt;dt&gt;name:&lt;/dt&gt;      &lt;dd&gt;required, the group name&lt;/dd&gt;</span>
<span class="cm">     *   &lt;dt&gt;base:&lt;/dt&gt;      &lt;dd&gt;The base dir for this module group&lt;/dd&gt;</span>
<span class="cm">     *   &lt;dt&gt;root:&lt;/dt&gt;      &lt;dd&gt;The root path to add to each combo</span>
<span class="cm">     *   resource path&lt;/dd&gt;</span>
<span class="cm">     *   &lt;dt&gt;combine:&lt;/dt&gt;   &lt;dd&gt;combo handle&lt;/dd&gt;</span>
<span class="cm">     *   &lt;dt&gt;comboBase:&lt;/dt&gt; &lt;dd&gt;combo service base path&lt;/dd&gt;</span>
<span class="cm">     *   &lt;dt&gt;modules:&lt;/dt&gt;   &lt;dd&gt;the group of modules&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * @method addGroup</span>
<span class="cm">     * @param {object} o An object containing the module data.</span>
<span class="cm">     * @param {string} name the group name.</span>
<span class="cm">     */</span>
    <span class="nx">addGroup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">mods</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">modules</span><span class="p">,</span>
            <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">||</span> <span class="nx">o</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="nx">o</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">patterns</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">oeach</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">patterns</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">v</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">patterns</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">mods</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">oeach</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">v</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">);</span>
            <span class="p">},</span> <span class="nx">self</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Add a new module to the component metadata.</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     *     &lt;dt&gt;name:&lt;/dt&gt;       &lt;dd&gt;required, the component name&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;type:&lt;/dt&gt;       &lt;dd&gt;required, the component type (js or css)</span>
<span class="cm">     *     &lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;path:&lt;/dt&gt;       &lt;dd&gt;required, the path to the script from</span>
<span class="cm">     *     &quot;base&quot;&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;requires:&lt;/dt&gt;   &lt;dd&gt;array of modules required by this</span>
<span class="cm">     *     component&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;optional:&lt;/dt&gt;   &lt;dd&gt;array of optional modules for this</span>
<span class="cm">     *     component&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;supersedes:&lt;/dt&gt; &lt;dd&gt;array of the modules this component</span>
<span class="cm">     *     replaces&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;after:&lt;/dt&gt;      &lt;dd&gt;array of modules the components which, if</span>
<span class="cm">     *     present, should be sorted above this one&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;after_map:&lt;/dt&gt;  &lt;dd&gt;faster alternative to &#39;after&#39; -- supply</span>
<span class="cm">     *     a hash instead of an array&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;rollup:&lt;/dt&gt;     &lt;dd&gt;the number of superseded modules required</span>
<span class="cm">     *     for automatic rollup&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;fullpath:&lt;/dt&gt;   &lt;dd&gt;If fullpath is specified, this is used</span>
<span class="cm">     *     instead of the configured base + path&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;skinnable:&lt;/dt&gt;  &lt;dd&gt;flag to determine if skin assets should</span>
<span class="cm">     *     automatically be pulled in&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;submodules:&lt;/dt&gt; &lt;dd&gt;a hash of submodules&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;group:&lt;/dt&gt;      &lt;dd&gt;The group the module belongs to -- this</span>
<span class="cm">     *     is set automatically when it is added as part of a group</span>
<span class="cm">     *     configuration.&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;lang:&lt;/dt&gt;</span>
<span class="cm">     *       &lt;dd&gt;array of BCP 47 language tags of languages for which this</span>
<span class="cm">     *           module has localized resource bundles,</span>
<span class="cm">     *           e.g., [&quot;en-GB&quot;,&quot;zh-Hans-CN&quot;]&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;condition:&lt;/dt&gt;</span>
<span class="cm">     *       &lt;dd&gt;Specifies that the module should be loaded automatically if</span>
<span class="cm">     *           a condition is met.  This is an object with up to three fields:</span>
<span class="cm">     *           [trigger] - the name of a module that can trigger the auto-load</span>
<span class="cm">     *           [test] - a function that returns true when the module is to be</span>
<span class="cm">     *           loaded.</span>
<span class="cm">     *           [when] - specifies the load order of the conditional module</span>
<span class="cm">     *           with regard to the position of the trigger module.</span>
<span class="cm">     *           This should be one of three values: &#39;before&#39;, &#39;after&#39;, or</span>
<span class="cm">     *           &#39;instead&#39;.  The default is &#39;after&#39;.</span>
<span class="cm">     *       &lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;testresults:&lt;/dt&gt;&lt;dd&gt;a hash of test results from Y.Features.all()&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * @method addModule</span>
<span class="cm">     * @param {object} o An object containing the module data.</span>
<span class="cm">     * @param {string} name the module name (optional), required if not</span>
<span class="cm">     * in the module data.</span>
<span class="cm">     * @return {object} the module definition or null if</span>
<span class="cm">     * the object passed in did not provide all required attributes.</span>
<span class="cm">     */</span>
    <span class="nx">addModule</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">||</span> <span class="nx">o</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>

        <span class="nx">o</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span> <span class="o">||</span> <span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">JS</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">path</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">fullpath</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">_path</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">o</span><span class="p">.</span><span class="nx">supersedes</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">supersedes</span> <span class="o">||</span> <span class="nx">o</span><span class="p">.</span><span class="nx">use</span><span class="p">;</span>

        <span class="nx">o</span><span class="p">.</span><span class="nx">ext</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ext&#39;</span> <span class="k">in</span> <span class="nx">o</span><span class="p">)</span> <span class="o">?</span> <span class="nx">o</span><span class="p">.</span><span class="nx">ext</span> <span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_internal</span><span class="p">)</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">o</span><span class="p">.</span><span class="nx">requires</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterRequires</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">requires</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>

        <span class="c1">// Handle submodule logic</span>
        <span class="kd">var</span> <span class="nx">subs</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">submodules</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">sup</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">smod</span><span class="p">,</span> <span class="nx">plugins</span><span class="p">,</span> <span class="nx">plug</span><span class="p">,</span>
            <span class="nx">j</span><span class="p">,</span> <span class="nx">langs</span><span class="p">,</span> <span class="nx">packName</span><span class="p">,</span> <span class="nx">supName</span><span class="p">,</span> <span class="nx">flatSup</span><span class="p">,</span> <span class="nx">flatLang</span><span class="p">,</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span>
            <span class="nx">overrides</span><span class="p">,</span> <span class="nx">skinname</span><span class="p">,</span> <span class="nx">when</span><span class="p">,</span>
            <span class="nx">conditions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">conditions</span><span class="p">,</span> <span class="nx">trigger</span><span class="p">;</span>
            <span class="c1">// , existing = this.moduleInfo[name], newr;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">langPack</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">lang</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">langs</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">lang</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">langs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">lang</span> <span class="o">=</span> <span class="nx">langs</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                <span class="nx">packName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLangPackName</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                <span class="nx">smod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">packName</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">smod</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">smod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addLangPack</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">packName</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">subs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sup</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">supersedes</span> <span class="o">||</span> <span class="p">[];</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">subs</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">subs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">s</span> <span class="o">=</span> <span class="nx">subs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

                    <span class="nx">s</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">path</span> <span class="o">||</span> <span class="nx">_path</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
                    <span class="nx">s</span><span class="p">.</span><span class="nx">pkg</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
                    <span class="nx">s</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">group</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">sup</span> <span class="o">=</span> <span class="nx">sup</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="nx">smod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
                    <span class="nx">sup</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">smod</span><span class="p">.</span><span class="nx">skinnable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">o</span><span class="p">.</span><span class="nx">skinnable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="nx">overrides</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">skin</span><span class="p">.</span><span class="nx">overrides</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">overrides</span> <span class="o">&amp;&amp;</span> <span class="nx">overrides</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
                            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">overrides</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">skinname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addSkin</span><span class="p">(</span><span class="nx">overrides</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">],</span>
                                         <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                                <span class="nx">sup</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">skinname</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="nx">skinname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addSkin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">skin</span><span class="p">.</span><span class="nx">defaultSkin</span><span class="p">,</span>
                                        <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                        <span class="nx">sup</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">skinname</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="c1">// looks like we are expected to work out the metadata</span>
                    <span class="c1">// for the parent module language packs from what is</span>
                    <span class="c1">// specified in the child modules.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">lang</span> <span class="o">&amp;&amp;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>

                        <span class="nx">langs</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">lang</span><span class="p">);</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">langs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">lang</span> <span class="o">=</span> <span class="nx">langs</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                            <span class="nx">packName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLangPackName</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                            <span class="nx">supName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLangPackName</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
                            <span class="nx">smod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">packName</span><span class="p">];</span>

                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">smod</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">smod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addLangPack</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">packName</span><span class="p">);</span>
                            <span class="p">}</span>

                            <span class="nx">flatSup</span> <span class="o">=</span> <span class="nx">flatSup</span> <span class="o">||</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">smod</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">);</span>

                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">supName</span> <span class="k">in</span> <span class="nx">flatSup</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">smod</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">supName</span><span class="p">);</span>
                            <span class="p">}</span>

                            <span class="nx">o</span><span class="p">.</span><span class="nx">lang</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">lang</span> <span class="o">||</span> <span class="p">[];</span>

                            <span class="nx">flatLang</span> <span class="o">=</span> <span class="nx">flatLang</span> <span class="o">||</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">lang</span><span class="p">);</span>

                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">lang</span> <span class="k">in</span> <span class="nx">flatLang</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">o</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">lang</span><span class="p">);</span>
                            <span class="p">}</span>

<span class="c1">// Y.log(&#39;pack &#39; + packName + &#39; should supersede &#39; + supName);</span>
<span class="c1">// Add rollup file, need to add to supersedes list too</span>

                            <span class="c1">// default packages</span>
                            <span class="nx">packName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLangPackName</span><span class="p">(</span><span class="nx">ROOT_LANG</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                            <span class="nx">supName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLangPackName</span><span class="p">(</span><span class="nx">ROOT_LANG</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>

                            <span class="nx">smod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">packName</span><span class="p">];</span>

                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">smod</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">smod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addLangPack</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">packName</span><span class="p">);</span>
                            <span class="p">}</span>

                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">supName</span> <span class="k">in</span> <span class="nx">flatSup</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">smod</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">supName</span><span class="p">);</span>
                            <span class="p">}</span>

<span class="c1">// Y.log(&#39;pack &#39; + packName + &#39; should supersede &#39; + supName);</span>
<span class="c1">// Add rollup file, need to add to supersedes list too</span>

                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="nx">l</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="c1">//o.supersedes = YObject.keys(YArray.hash(sup));</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">supersedes</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">dedupe</span><span class="p">(</span><span class="nx">sup</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowRollup</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">rollup</span> <span class="o">=</span> <span class="p">(</span><span class="nx">l</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">?</span> <span class="nx">l</span> <span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">plugins</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">plugins</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">plugins</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">plugins</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">plug</span> <span class="o">=</span> <span class="nx">plugins</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="nx">plug</span><span class="p">.</span><span class="nx">pkg</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
                    <span class="nx">plug</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">plug</span><span class="p">.</span><span class="nx">path</span> <span class="o">||</span> <span class="nx">_path</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
                    <span class="nx">plug</span><span class="p">.</span><span class="nx">requires</span> <span class="o">=</span> <span class="nx">plug</span><span class="p">.</span><span class="nx">requires</span> <span class="o">||</span> <span class="p">[];</span>
                    <span class="nx">plug</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">group</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="nx">plug</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">skinnable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_addSkin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">skin</span><span class="p">.</span><span class="nx">defaultSkin</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                    <span class="p">}</span>

                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">trigger</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">condition</span><span class="p">.</span><span class="nx">trigger</span><span class="p">;</span>
            <span class="nx">when</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">condition</span><span class="p">.</span><span class="nx">when</span><span class="p">;</span>
            <span class="nx">conditions</span><span class="p">[</span><span class="nx">trigger</span><span class="p">]</span> <span class="o">=</span> <span class="nx">conditions</span><span class="p">[</span><span class="nx">trigger</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
            <span class="nx">conditions</span><span class="p">[</span><span class="nx">trigger</span><span class="p">][</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">condition</span><span class="p">;</span>
            <span class="c1">// the &#39;when&#39; attribute can be &#39;before&#39;, &#39;after&#39;, or &#39;instead&#39;</span>
            <span class="c1">// the default is after.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">when</span> <span class="o">&amp;&amp;</span> <span class="nx">when</span> <span class="o">!=</span> <span class="s1">&#39;after&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">when</span> <span class="o">==</span> <span class="s1">&#39;instead&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// replace the trigger</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">supersedes</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">supersedes</span> <span class="o">||</span> <span class="p">[];</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">trigger</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// before the trigger</span>
                    <span class="c1">// the trigger requires the conditional mod,</span>
                    <span class="c1">// so it should appear before the conditional</span>
                    <span class="c1">// mod if we do not intersede.</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// after the trigger</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">after</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">after</span> <span class="o">||</span> <span class="p">[];</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">after</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">trigger</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">after</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">after_map</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">after</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// this.dirty = true;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">configFn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">configFn</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                <span class="nx">o</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Add a requirement for one or more module</span>
<span class="cm">     * @method require</span>
<span class="cm">     * @param {string[] | string*} what the modules to load.</span>
<span class="cm">     */</span>
    <span class="nx">require</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">what</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">what</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="o">:</span> <span class="nx">what</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">dirty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">required</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">required</span><span class="p">,</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">filterRequires</span><span class="p">(</span><span class="nx">a</span><span class="p">)));</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_explodeRollups</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="cm">/**</span>
<span class="cm">    * Grab all the items that were asked for, check to see if the Loader</span>
<span class="cm">    * meta-data contains a &quot;use&quot; array. If it doesm remove the asked item and replace it with </span>
<span class="cm">    * the content of the &quot;use&quot;.</span>
<span class="cm">    * This will make asking for: &quot;dd&quot;</span>
<span class="cm">    * Actually ask for: &quot;dd-ddm-base,dd-ddm,dd-ddm-drop,dd-drag,dd-proxy,dd-constrain,dd-drop,dd-scroll,dd-drop-plugin&quot;</span>
<span class="cm">    * @private</span>
<span class="cm">    * @method _explodeRollups</span>
<span class="cm">    */</span>
    <span class="nx">_explodeRollups</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">required</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">allowRollup</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">oeach</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">use</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">//delete r[name];</span>
                    <span class="nx">YArray</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">use</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">m</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">use</span><span class="p">)</span> <span class="p">{</span>
                            <span class="c1">//delete r[v];</span>
                            <span class="nx">YArray</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">use</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">r</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                            <span class="p">});</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">r</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">required</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">},</span>
    <span class="nx">filterRequires</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">r</span> <span class="o">=</span> <span class="p">[</span><span class="nx">r</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">mod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span> <span class="o">&amp;&amp;</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">use</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">o</span> <span class="o">&lt;</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">use</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">o</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">c</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">use</span><span class="p">[</span><span class="nx">o</span><span class="p">]);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">c</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="cm">/**</span>
<span class="cm">     * Returns an object containing properties for all modules required</span>
<span class="cm">     * in order to load the requested module</span>
<span class="cm">     * @method getRequires</span>
<span class="cm">     * @param {object}  mod The module definition from moduleInfo.</span>
<span class="cm">     * @return {array} the expanded requirement list.</span>
<span class="cm">     */</span>
    <span class="nx">getRequires</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mod</span> <span class="o">||</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">_parsed</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Y.log(&#39;returning no reqs for &#39; + mod.name);</span>
            <span class="k">return</span> <span class="nx">NO_REQUIREMENTS</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">add</span><span class="p">,</span> <span class="nx">packName</span><span class="p">,</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">testresults</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">testresults</span><span class="p">,</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">cond</span><span class="p">,</span> <span class="nx">go</span><span class="p">,</span>
            <span class="nx">adddef</span> <span class="o">=</span> <span class="nx">ON_PAGE</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">ON_PAGE</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">details</span><span class="p">,</span>
            <span class="nx">d</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">m1</span><span class="p">,</span>
            <span class="nx">r</span><span class="p">,</span> <span class="nx">old_mod</span><span class="p">,</span>
            <span class="nx">o</span><span class="p">,</span> <span class="nx">skinmod</span><span class="p">,</span> <span class="nx">skindef</span><span class="p">,</span>
            <span class="nx">intl</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">lang</span> <span class="o">||</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">intl</span><span class="p">,</span>
            <span class="nx">info</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">,</span>
            <span class="nx">ftests</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">load</span><span class="p">,</span>
            <span class="nx">hash</span><span class="p">;</span>

        <span class="c1">// console.log(name);</span>

        <span class="c1">// pattern match leaves module stub that needs to be filled out</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">temp</span> <span class="o">&amp;&amp;</span> <span class="nx">adddef</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">old_mod</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">;</span>
            <span class="nx">mod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="nx">adddef</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
            <span class="nx">mod</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">old_mod</span><span class="p">.</span><span class="nx">group</span><span class="p">;</span>
            <span class="nx">mod</span><span class="p">.</span><span class="nx">pkg</span> <span class="o">=</span> <span class="nx">old_mod</span><span class="p">.</span><span class="nx">pkg</span><span class="p">;</span>
            <span class="k">delete</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">expanded</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// console.log(&#39;cache: &#39; + mod.langCache + &#39; == &#39; + this.lang);</span>

        <span class="c1">// if (mod.expanded &amp;&amp; (!mod.langCache || mod.langCache == this.lang)) {</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">expanded</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">lang</span> <span class="o">||</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">langCache</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">lang</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">//Y.log(&#39;Already expanded &#39; + name + &#39;, &#39; + mod.expanded);</span>
            <span class="k">return</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">expanded</span><span class="p">;</span>
        <span class="p">}</span>
        

        <span class="nx">d</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">hash</span> <span class="o">=</span> <span class="p">{};</span>
        
        <span class="nx">r</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterRequires</span><span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">requires</span><span class="p">);</span>
        <span class="nx">o</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">optional</span><span class="p">;</span>

        <span class="c1">// Y.log(&quot;getRequires: &quot; + name + &quot; (dirty:&quot; + this.dirty +</span>
        <span class="c1">// &quot;, expanded:&quot; + mod.expanded + &quot;)&quot;);</span>

        <span class="nx">mod</span><span class="p">.</span><span class="nx">_parsed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">mod</span><span class="p">.</span><span class="nx">langCache</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">lang</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//Y.log(name + &#39; requiring &#39; + r[i], &#39;info&#39;, &#39;loader&#39;);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hash</span><span class="p">[</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
                <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="nx">hash</span><span class="p">[</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">add</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRequires</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
                    <span class="nx">intl</span> <span class="o">=</span> <span class="nx">intl</span> <span class="o">||</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">expanded_map</span> <span class="o">&amp;&amp;</span>
                        <span class="p">(</span><span class="nx">INTL</span> <span class="k">in</span> <span class="nx">m</span><span class="p">.</span><span class="nx">expanded_map</span><span class="p">));</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">add</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">add</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// get the requirements from superseded modules, if any</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hash</span><span class="p">[</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
                    <span class="c1">// if this module has submodules, the requirements list is</span>
                    <span class="c1">// expanded to include the submodules.  This is so we can</span>
                    <span class="c1">// prevent dups when a submodule is already loaded and the</span>
                    <span class="c1">// parent is requested.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">submodules</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                    <span class="p">}</span>

                    <span class="nx">hash</span><span class="p">[</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">add</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRequires</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
                        <span class="nx">intl</span> <span class="o">=</span> <span class="nx">intl</span> <span class="o">||</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">expanded_map</span> <span class="o">&amp;&amp;</span>
                            <span class="p">(</span><span class="nx">INTL</span> <span class="k">in</span> <span class="nx">m</span><span class="p">.</span><span class="nx">expanded_map</span><span class="p">));</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">add</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">add</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadOptional</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hash</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
                    <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                    <span class="nx">hash</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">add</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRequires</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
                        <span class="nx">intl</span> <span class="o">=</span> <span class="nx">intl</span> <span class="o">||</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">expanded_map</span> <span class="o">&amp;&amp;</span>
                            <span class="p">(</span><span class="nx">INTL</span> <span class="k">in</span> <span class="nx">m</span><span class="p">.</span><span class="nx">expanded_map</span><span class="p">));</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">add</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">add</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">cond</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">conditions</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">cond</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">testresults</span> <span class="o">&amp;&amp;</span> <span class="nx">ftests</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">oeach</span><span class="p">(</span><span class="nx">testresults</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">condmod</span> <span class="o">=</span> <span class="nx">ftests</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">name</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hash</span><span class="p">[</span><span class="nx">condmod</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">ftests</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">trigger</span> <span class="o">==</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">&amp;&amp;</span> <span class="nx">ftests</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nx">hash</span><span class="p">[</span><span class="nx">condmod</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                            <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">condmod</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">oeach</span><span class="p">(</span><span class="nx">cond</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">def</span><span class="p">,</span> <span class="nx">condmod</span><span class="p">)</span> <span class="p">{</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hash</span><span class="p">[</span><span class="nx">condmod</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">go</span> <span class="o">=</span> <span class="nx">def</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">def</span><span class="p">.</span><span class="nx">ua</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">[</span><span class="nx">def</span><span class="p">.</span><span class="nx">ua</span><span class="p">])</span> <span class="o">||</span>
                                     <span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nx">test</span> <span class="o">&amp;&amp;</span> <span class="nx">def</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">r</span><span class="p">)));</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">go</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">hash</span><span class="p">[</span><span class="nx">condmod</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                            <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">condmod</span><span class="p">);</span>
                            <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">condmod</span><span class="p">);</span>
                            <span class="c1">// Y.log(&#39;conditional&#39;, m);</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">add</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRequires</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
                                <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">add</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">add</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Create skin modules</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">skinnable</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">skindef</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">skin</span><span class="p">.</span><span class="nx">overrides</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">skindef</span> <span class="o">&amp;&amp;</span> <span class="nx">skindef</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">skindef</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">skinmod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addSkin</span><span class="p">(</span><span class="nx">skindef</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">i</span><span class="p">],</span> <span class="nx">name</span><span class="p">);</span>
                    <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">skinmod</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">skinmod</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addSkin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">skin</span><span class="p">.</span><span class="nx">defaultSkin</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">skinmod</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">mod</span><span class="p">.</span><span class="nx">_parsed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">intl</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">lang</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">mod</span><span class="p">.</span><span class="nx">langPack</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Intl</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">lang</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Intl</span><span class="p">.</span><span class="nx">lookupBestLang</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lang</span> <span class="o">||</span> <span class="nx">ROOT_LANG</span><span class="p">,</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">lang</span><span class="p">);</span>
<span class="c1">// Y.log(&#39;Best lang: &#39; + lang + &#39;, this.lang: &#39; +</span>
<span class="c1">// this.lang + &#39;, mod.lang: &#39; + mod.lang);</span>
                <span class="nx">packName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLangPackName</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">packName</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">d</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">packName</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">d</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">INTL</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">mod</span><span class="p">.</span><span class="nx">expanded_map</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>

        <span class="nx">mod</span><span class="p">.</span><span class="nx">expanded</span> <span class="o">=</span> <span class="nx">YObject</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">expanded_map</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">expanded</span><span class="p">;</span>
    <span class="p">},</span>


    <span class="cm">/**</span>
<span class="cm">     * Returns a hash of module names the supplied module satisfies.</span>
<span class="cm">     * @method getProvides</span>
<span class="cm">     * @param {string} name The name of the module.</span>
<span class="cm">     * @return {object} what this module provides.</span>
<span class="cm">     */</span>
    <span class="nx">getProvides</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">name</span><span class="p">),</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">s</span><span class="p">;</span>
            <span class="c1">// supmap = this.provides;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">NOT_FOUND</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">m</span><span class="p">.</span><span class="nx">provides</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">YArray</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProvides</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">o</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">m</span><span class="p">.</span><span class="nx">provides</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>

        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">provides</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Calculates the dependency tree, the result is stored in the sorted</span>
<span class="cm">     * property.</span>
<span class="cm">     * @method calculate</span>
<span class="cm">     * @param {object} o optional options object.</span>
<span class="cm">     * @param {string} type optional argument to prune modules.</span>
<span class="cm">     */</span>
    <span class="nx">calculate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">dirty</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_config</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_init</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_setup</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">_explode</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowRollup</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_rollup</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_explodeRollups</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_reduce</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_sort</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_addLangPack</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">packName</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="nx">packPath</span><span class="p">,</span>
            <span class="nx">existing</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">packName</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">existing</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">packPath</span> <span class="o">=</span> <span class="nx">_path</span><span class="p">((</span><span class="nx">m</span><span class="p">.</span><span class="nx">pkg</span> <span class="o">||</span> <span class="nx">name</span><span class="p">),</span> <span class="nx">packName</span><span class="p">,</span> <span class="nx">JS</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">addModule</span><span class="p">({</span> <span class="nx">path</span><span class="o">:</span> <span class="nx">packPath</span><span class="p">,</span>
                             <span class="nx">intl</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                             <span class="nx">langPack</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                             <span class="nx">ext</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">ext</span><span class="p">,</span>
                             <span class="nx">group</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">group</span><span class="p">,</span>
                             <span class="nx">supersedes</span><span class="o">:</span> <span class="p">[]</span> <span class="p">},</span> <span class="nx">packName</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">lang</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">lang</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">lang</span> <span class="o">||</span> <span class="p">{};</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">lang</span><span class="p">[</span><span class="nx">lang</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">lang</span><span class="p">[</span><span class="nx">lang</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">lang</span><span class="p">[</span><span class="nx">lang</span><span class="p">][</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">packName</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Investigates the current YUI configuration on the page.  By default,</span>
<span class="cm">     * modules already detected will not be loaded again unless a force</span>
<span class="cm">     * option is encountered.  Called by calculate()</span>
<span class="cm">     * @method _setup</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
            <span class="nx">packName</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>

                    <span class="c1">// remove dups</span>
                    <span class="c1">//m.requires = YObject.keys(YArray.hash(m.requires));</span>
                    <span class="nx">m</span><span class="p">.</span><span class="nx">requires</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">dedupe</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">requires</span><span class="p">);</span>

                    <span class="c1">// Create lang pack modules</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">lang</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Setup root package if the module has lang defined,</span>
                        <span class="c1">// it needs to provide a root language pack</span>
                        <span class="nx">packName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLangPackName</span><span class="p">(</span><span class="nx">ROOT_LANG</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_addLangPack</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">packName</span><span class="p">);</span>
                    <span class="p">}</span>

                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>


        <span class="c1">//l = Y.merge(this.inserted);</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="c1">// available modules</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">ignoreRegistered</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">mods</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// add the ignore list to the list of loaded packages</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ignore</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ignore</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="c1">// expand the list to include superseded modules</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProvides</span><span class="p">(</span><span class="nx">j</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// remove modules on the force list from the loaded list</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">in</span> <span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="nx">l</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="p">,</span> <span class="nx">l</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_init</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Builds a module name for a language pack</span>
<span class="cm">     * @method getLangPackName</span>
<span class="cm">     * @param {string} lang the language code.</span>
<span class="cm">     * @param {string} mname the module to build it for.</span>
<span class="cm">     * @return {string} the language pack module name.</span>
<span class="cm">     */</span>
    <span class="nx">getLangPackName</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">mname</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;lang/&#39;</span> <span class="o">+</span> <span class="nx">mname</span> <span class="o">+</span> <span class="p">((</span><span class="nx">lang</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">lang</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="cm">/**</span>
<span class="cm">     * Inspects the required modules list looking for additional</span>
<span class="cm">     * dependencies.  Expands the required list to include all</span>
<span class="cm">     * required modules.  Called by calculate()</span>
<span class="cm">     * @method _explode</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_explode</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">required</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">reqs</span><span class="p">,</span> <span class="nx">done</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="c1">// the setup phase is over, all modules have been created</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">dirty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">_explodeRollups</span><span class="p">();</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">required</span><span class="p">;</span>
        
        <span class="nx">oeach</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">done</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">done</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">expound</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">expound</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">expound</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">r</span><span class="p">[</span><span class="nx">expound</span><span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">expound</span><span class="p">);</span>
                        <span class="nx">reqs</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getRequires</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">expound</span><span class="p">]);</span>
                        <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">reqs</span><span class="p">));</span>
                    <span class="p">}</span>

                    <span class="nx">reqs</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getRequires</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">YArray</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">reqs</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="c1">// Y.log(&#39;After explode: &#39; + YObject.keys(r));</span>
    <span class="p">},</span>

    <span class="nx">getModule</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mname</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//TODO: Remove name check - it&#39;s a quick hack to fix pattern WIP</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mname</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">found</span><span class="p">,</span> <span class="nx">pname</span><span class="p">,</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">[</span><span class="nx">mname</span><span class="p">],</span>
            <span class="nx">patterns</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">patterns</span><span class="p">;</span>

        <span class="c1">// check the patterns library to see if we should automatically add</span>
        <span class="c1">// the module with defaults</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
           <span class="c1">// Y.log(&#39;testing patterns &#39; + YObject.keys(patterns));</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">pname</span> <span class="k">in</span> <span class="nx">patterns</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">patterns</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">pname</span><span class="p">))</span> <span class="p">{</span>
                    <span class="c1">// Y.log(&#39;testing pattern &#39; + i);</span>
                    <span class="nx">p</span> <span class="o">=</span> <span class="nx">patterns</span><span class="p">[</span><span class="nx">pname</span><span class="p">];</span>

                    <span class="c1">// use the metadata supplied for the pattern</span>
                    <span class="c1">// as the module definition.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">mname</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">pname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">found</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">found</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Y.log(&#39;executing pattern action: &#39; + pname);</span>
                    <span class="nx">p</span><span class="p">.</span><span class="nx">action</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">mname</span><span class="p">,</span> <span class="nx">pname</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Undefined module: &#39;</span> <span class="o">+</span> <span class="nx">mname</span> <span class="o">+</span> <span class="s1">&#39;, matched a pattern: &#39;</span> <span class="o">+</span>
    <span class="nx">pname</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>
                    <span class="c1">// ext true or false?</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">found</span><span class="p">),</span> <span class="nx">mname</span><span class="p">);</span>
                    <span class="nx">m</span><span class="p">.</span><span class="nx">temp</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">m</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="c1">// impl in rollup submodule</span>
    <span class="nx">_rollup</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Remove superceded modules and loaded modules.  Called by</span>
<span class="cm">     * calculate() after we have the mega list of all dependencies</span>
<span class="cm">     * @method _reduce</span>
<span class="cm">     * @return {object} the reduced dependency hash.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_reduce</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">required</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadType</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
                <span class="c1">// remove if already loaded</span>
                <span class="k">if</span> <span class="p">(((</span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">||</span> <span class="nx">ON_PAGE</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
                        <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">forceMap</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">ignoreRegistered</span><span class="p">)</span> <span class="o">||</span>
                        <span class="p">(</span><span class="nx">type</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">type</span> <span class="o">!=</span> <span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="c1">// remove anything this module supersedes</span>
                <span class="nx">s</span> <span class="o">=</span> <span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">supersedes</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="k">in</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">delete</span> <span class="nx">r</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_finish</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loader finishing: &#39;</span> <span class="o">+</span> <span class="nx">msg</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>

        <span class="nx">_queue</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">onEnd</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onEnd</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">onEnd</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">onEnd</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">success</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_continue</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">_onSuccess</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">skipped</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">skipped</span><span class="p">),</span> <span class="nx">fn</span><span class="p">,</span>
            <span class="nx">failed</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">rreg</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">requireRegistration</span><span class="p">,</span>
            <span class="nx">success</span><span class="p">,</span> <span class="nx">msg</span><span class="p">;</span>

        <span class="nx">oeach</span><span class="p">(</span><span class="nx">skipped</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="nx">self</span><span class="p">.</span><span class="nx">inserted</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
        <span class="p">});</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">skipped</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="nx">oeach</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">inserted</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">mod</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mod</span> <span class="o">&amp;&amp;</span> <span class="nx">rreg</span> <span class="o">&amp;&amp;</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">JS</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">mods</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">failed</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">loaded</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getProvides</span><span class="p">(</span><span class="nx">k</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="nx">fn</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">onSuccess</span><span class="p">;</span>
        <span class="nx">msg</span> <span class="o">=</span> <span class="p">(</span><span class="nx">failed</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;notregistered&#39;</span> <span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">;</span>
        <span class="nx">success</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="nx">failed</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">success</span><span class="p">,</span>
                <span class="nx">failed</span><span class="o">:</span> <span class="nx">failed</span><span class="p">,</span>
                <span class="nx">skipped</span><span class="o">:</span> <span class="nx">skipped</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_finish</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">success</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">_onFailure</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;load error: &#39;</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">msg</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onFailure</span><span class="p">,</span> <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;failure: &#39;</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">msg</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="kc">false</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_finish</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_onTimeout</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loader timeout: &#39;</span> <span class="o">+</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onTimeout</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;timeout&#39;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="kc">false</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_finish</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Sorts the dependency tree.  The last step of calculate()</span>
<span class="cm">     * @method _sort</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_sort</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="c1">// create an indexed list</span>
        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">YObject</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">required</span><span class="p">),</span>
            <span class="c1">// loaded = this.loaded,</span>
            <span class="nx">done</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">moved</span><span class="p">,</span> <span class="nx">doneKey</span><span class="p">;</span>

        <span class="c1">// keep going until we make a pass without moving anything</span>
        <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>

            <span class="nx">l</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="nx">moved</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="c1">// start the loop after items that are already sorted</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// check the next module on the list to see if its</span>
                <span class="c1">// dependencies have been met</span>
                <span class="nx">a</span> <span class="o">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>

                <span class="c1">// check everything below current item and move if we</span>
                <span class="c1">// find a requirement for the current item</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">doneKey</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">s</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">done</span><span class="p">[</span><span class="nx">doneKey</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_requires</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">s</span><span class="p">[</span><span class="nx">k</span><span class="p">]))</span> <span class="p">{</span>

                        <span class="c1">// extract the dependency so we can move it up</span>
                        <span class="nx">b</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

                        <span class="c1">// insert the dependency above the item that</span>
                        <span class="c1">// requires it</span>
                        <span class="nx">s</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

                        <span class="c1">// only swap two dependencies once to short circut</span>
                        <span class="c1">// circular dependencies</span>
                        <span class="nx">done</span><span class="p">[</span><span class="nx">doneKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                        <span class="c1">// keep working</span>
                        <span class="nx">moved</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// jump out of loop if we moved something</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">moved</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c1">// this item is sorted, move our pointer and keep going</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">p</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// when we make it here and moved is false, we are</span>
            <span class="c1">// finished sorting</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">moved</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">sorted</span> <span class="o">=</span> <span class="nx">s</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">partial</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">partial</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">sorted</span> <span class="o">=</span> <span class="nx">partial</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_insert</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">skipcalc</span><span class="p">)</span> <span class="p">{</span>

<span class="c1">// Y.log(&#39;private _insert() &#39; + (type || &#39;&#39;) + &#39;, &#39; + Y.id, &quot;info&quot;, &quot;loader&quot;);</span>

        <span class="c1">// restore the state at the time of the request</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_config</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// build the dependency list</span>
        <span class="c1">// don&#39;t include type so we can process CSS and script in</span>
        <span class="c1">// one pass when the type is not specified.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">skipcalc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">calculate</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">loadType</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="c1">// Y.log(&quot;trying to load css first&quot;);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_internalCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

                <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">onCSS</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">sib</span><span class="p">;</span>

                <span class="c1">// IE hack for style overrides that are not being applied</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">n</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">);</span>
                    <span class="nx">p</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
                    <span class="nx">sib</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>
                    <span class="nx">p</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">sib</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">p</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">sib</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">p</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">Y</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">_internalCallback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

                <span class="nx">self</span><span class="p">.</span><span class="nx">_insert</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">JS</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">_insert</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">CSS</span><span class="p">);</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// set a flag to indicate the load has started</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="c1">// flag to indicate we are done with the combo service</span>
        <span class="c1">// and any additional files will need to be loaded</span>
        <span class="c1">// individually</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_combineComplete</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="c1">// start the load</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadNext</span><span class="p">();</span>

    <span class="p">},</span>

    <span class="c1">// Once a loader operation is completely finished, process</span>
    <span class="c1">// any additional queued items.</span>
    <span class="nx">_continue</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">running</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_queue</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_queue</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">_queue</span><span class="p">.</span><span class="nx">next</span><span class="p">()();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * inserts the requested modules and their dependencies.</span>
<span class="cm">     * &lt;code&gt;type&lt;/code&gt; can be &quot;js&quot; or &quot;css&quot;.  Both script and</span>
<span class="cm">     * css are inserted if type is not provided.</span>
<span class="cm">     * @method insert</span>
<span class="cm">     * @param {object} o optional options object.</span>
<span class="cm">     * @param {string} type the type of dependency to insert.</span>
<span class="cm">     */</span>
    <span class="nx">insert</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">skipsort</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Y.log(&#39;public insert() &#39; + (type || &#39;&#39;) + &#39;, &#39; +</span>
        <span class="c1">//  Y.Object.keys(this.required), &quot;info&quot;, &quot;loader&quot;);</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">copy</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">delete</span> <span class="nx">copy</span><span class="p">.</span><span class="nx">require</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">copy</span><span class="p">.</span><span class="nx">dirty</span><span class="p">;</span>
        <span class="nx">_queue</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">_insert</span><span class="p">(</span><span class="nx">copy</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">skipsort</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_continue</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Executed every time a module is loaded, and if we are in a load</span>
<span class="cm">     * cycle, we attempt to load the next script.  Public so that it</span>
<span class="cm">     * is possible to call this if using a method other than</span>
<span class="cm">     * Y.register to determine when scripts are fully loaded</span>
<span class="cm">     * @method loadNext</span>
<span class="cm">     * @param {string} mname optional the name of the module that has</span>
<span class="cm">     * been loaded (which is usually why it is time to load the next</span>
<span class="cm">     * one).</span>
<span class="cm">     */</span>
    <span class="nx">loadNext</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mname</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// It is possible that this function is executed due to something</span>
        <span class="c1">// else one the page loading a YUI module.  Only react when we</span>
        <span class="c1">// are actively loading something</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_loading</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">group</span><span class="p">,</span> <span class="nx">groupName</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">frag</span><span class="p">,</span>
            <span class="nx">comboSource</span><span class="p">,</span> <span class="nx">comboSources</span><span class="p">,</span> <span class="nx">mods</span><span class="p">,</span> <span class="nx">combining</span><span class="p">,</span> <span class="nx">urls</span><span class="p">,</span> <span class="nx">comboBase</span><span class="p">,</span>
            <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">loadType</span><span class="p">,</span>
            <span class="nx">handleSuccess</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">loadNext</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">handleCombo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">_combineComplete</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">combining</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">inserted</span><span class="p">[</span><span class="nx">combining</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nx">handleSuccess</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
            <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">combine</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">_combineComplete</span><span class="p">[</span><span class="nx">type</span><span class="p">]))</span> <span class="p">{</span>

            <span class="nx">combining</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="nx">self</span><span class="p">.</span><span class="nx">_combining</span> <span class="o">=</span> <span class="nx">combining</span><span class="p">;</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">sorted</span><span class="p">;</span>
            <span class="nx">len</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

            <span class="c1">// the default combo base</span>
            <span class="nx">comboBase</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">comboBase</span><span class="p">;</span>

            <span class="nx">url</span> <span class="o">=</span> <span class="nx">comboBase</span><span class="p">;</span>
            <span class="nx">urls</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="nx">comboSources</span> <span class="o">=</span> <span class="p">{};</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">comboSource</span> <span class="o">=</span> <span class="nx">comboBase</span><span class="p">;</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="nx">groupName</span> <span class="o">=</span> <span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">group</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">groupName</span><span class="p">)</span> <span class="p">{</span>

                    <span class="nx">group</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">groupName</span><span class="p">];</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">group</span><span class="p">.</span><span class="nx">combine</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">m</span><span class="p">.</span><span class="nx">combine</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">m</span><span class="p">.</span><span class="nx">combine</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">comboBase</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">comboSource</span> <span class="o">=</span> <span class="nx">group</span><span class="p">.</span><span class="nx">comboBase</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;root&quot;</span> <span class="k">in</span> <span class="nx">group</span> <span class="o">&amp;&amp;</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isValue</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">root</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">m</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nx">group</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span>
                    <span class="p">}</span>

                <span class="p">}</span>

                <span class="nx">comboSources</span><span class="p">[</span><span class="nx">comboSource</span><span class="p">]</span> <span class="o">=</span> <span class="nx">comboSources</span><span class="p">[</span><span class="nx">comboSource</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span>
                <span class="nx">comboSources</span><span class="p">[</span><span class="nx">comboSource</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">comboSources</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">comboSources</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">url</span> <span class="o">=</span> <span class="nx">j</span><span class="p">;</span>
                    <span class="nx">mods</span> <span class="o">=</span> <span class="nx">comboSources</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                    <span class="nx">len</span> <span class="o">=</span> <span class="nx">mods</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

                    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// m = self.getModule(s[i]);</span>
                        <span class="nx">m</span> <span class="o">=</span> <span class="nx">mods</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

                        <span class="c1">// Do not try to combine non-yui JS unless combo def</span>
                        <span class="c1">// is found</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">type</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">combine</span> <span class="o">||</span> <span class="o">!</span><span class="nx">m</span><span class="p">.</span><span class="nx">ext</span><span class="p">))</span> <span class="p">{</span>

                            <span class="nx">frag</span> <span class="o">=</span> <span class="p">((</span><span class="nx">L</span><span class="p">.</span><span class="nx">isValue</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">root</span><span class="p">))</span> <span class="o">?</span> <span class="nx">m</span><span class="p">.</span><span class="nx">root</span> <span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">root</span><span class="p">)</span> <span class="o">+</span> <span class="nx">m</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span>

                            <span class="k">if</span> <span class="p">((</span><span class="nx">url</span> <span class="o">!==</span> <span class="nx">j</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
                            <span class="p">((</span><span class="nx">frag</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">url</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">maxURLLength</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">urls</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_filter</span><span class="p">(</span><span class="nx">url</span><span class="p">));</span>
                                <span class="nx">url</span> <span class="o">=</span> <span class="nx">j</span><span class="p">;</span>
                            <span class="p">}</span>

                            <span class="nx">url</span> <span class="o">+=</span> <span class="nx">frag</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">;</span>
                            <span class="p">}</span>

                            <span class="nx">combining</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                        <span class="p">}</span>

                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">combining</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">url</span> <span class="o">!=</span> <span class="nx">j</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">urls</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_filter</span><span class="p">(</span><span class="nx">url</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">combining</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Attempting to use combo: &#39;</span> <span class="o">+</span> <span class="nx">combining</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>

                <span class="c1">// if (m.type === CSS) {</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">CSS</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">fn</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span><span class="p">.</span><span class="nx">css</span><span class="p">;</span>
                    <span class="nx">attr</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">cssAttributes</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">fn</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span><span class="p">.</span><span class="nx">script</span><span class="p">;</span>
                    <span class="nx">attr</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">jsAttributes</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nx">fn</span><span class="p">(</span><span class="nx">urls</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">data</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_loading</span><span class="p">,</span>
                    <span class="nx">onSuccess</span><span class="o">:</span> <span class="nx">handleCombo</span><span class="p">,</span>
                    <span class="nx">onFailure</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_onFailure</span><span class="p">,</span>
                    <span class="nx">onTimeout</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_onTimeout</span><span class="p">,</span>
                    <span class="nx">insertBefore</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">,</span>
                    <span class="nx">charset</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">charset</span><span class="p">,</span>
                    <span class="nx">attributes</span><span class="o">:</span> <span class="nx">attr</span><span class="p">,</span>
                    <span class="nx">timeout</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span>
                    <span class="nx">autopurge</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nx">context</span><span class="o">:</span> <span class="nx">self</span>
                <span class="p">});</span>

                <span class="k">return</span><span class="p">;</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">_combineComplete</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">mname</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// if the module that was just loaded isn&#39;t what we were expecting,</span>
            <span class="c1">// continue to wait</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mname</span> <span class="o">!==</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_loading</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

<span class="c1">// Y.log(&quot;loadNext executing, just loaded &quot; + mname + &quot;, &quot; +</span>
<span class="c1">// Y.id, &quot;info&quot;, &quot;loader&quot;);</span>

            <span class="c1">// The global handler that is called when each module is loaded</span>
            <span class="c1">// will pass that module name to this function.  Storing this</span>
            <span class="c1">// data to avoid loading the same module multiple times</span>
            <span class="c1">// centralize this in the callback</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">inserted</span><span class="p">[</span><span class="nx">mname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="c1">// self.loaded[mname] = true;</span>

            <span class="c1">// provided = self.getProvides(mname);</span>
            <span class="c1">// Y.mix(self.loaded, provided);</span>
            <span class="c1">// Y.mix(self.inserted, provided);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">onProgress</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">onProgress</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">name</span><span class="o">:</span> <span class="nx">mname</span><span class="p">,</span>
                        <span class="nx">data</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">data</span>
                    <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">s</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">sorted</span><span class="p">;</span>
        <span class="nx">len</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// this.inserted keeps track of what the loader has loaded.</span>
            <span class="c1">// move on if this item is done.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">in</span> <span class="nx">self</span><span class="p">.</span><span class="nx">inserted</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// Because rollups will cause multiple load notifications</span>
            <span class="c1">// from Y, loadNext may be called multiple times for</span>
            <span class="c1">// the same module when loading a rollup.  We can safely</span>
            <span class="c1">// skip the subsequent requests</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_loading</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;still loading &#39;</span> <span class="o">+</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, waiting&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// log(&quot;inserting &quot; + s[i]);</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">skipped</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
                    <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Undefined module &#39;</span> <span class="o">+</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; skipped&#39;</span><span class="p">;</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>
                    <span class="c1">// self.inserted[s[i]] = true;</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">skipped</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">continue</span><span class="p">;</span>

            <span class="p">}</span>

            <span class="nx">group</span> <span class="o">=</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">group</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">group</span><span class="p">])</span> <span class="o">||</span> <span class="nx">NOT_FOUND</span><span class="p">;</span>

            <span class="c1">// The load type is stored to offer the possibility to load</span>
            <span class="c1">// the css separately from the script.</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="nx">m</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;attempting to load &#39;</span> <span class="o">+</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">CSS</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">fn</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span><span class="p">.</span><span class="nx">css</span><span class="p">;</span>
                    <span class="nx">attr</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">cssAttributes</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">fn</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Get</span><span class="p">.</span><span class="nx">script</span><span class="p">;</span>
                    <span class="nx">attr</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">jsAttributes</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nx">url</span> <span class="o">=</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">fullpath</span><span class="p">)</span> <span class="o">?</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_filter</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">fullpath</span><span class="p">,</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">:</span>
                      <span class="nx">self</span><span class="p">.</span><span class="nx">_url</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">group</span><span class="p">.</span><span class="nx">base</span> <span class="o">||</span> <span class="nx">m</span><span class="p">.</span><span class="nx">base</span><span class="p">);</span>

                <span class="nx">fn</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">data</span><span class="o">:</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
                    <span class="nx">onSuccess</span><span class="o">:</span> <span class="nx">handleSuccess</span><span class="p">,</span>
                    <span class="nx">insertBefore</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">,</span>
                    <span class="nx">charset</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">charset</span><span class="p">,</span>
                    <span class="nx">attributes</span><span class="o">:</span> <span class="nx">attr</span><span class="p">,</span>
                    <span class="nx">onFailure</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_onFailure</span><span class="p">,</span>
                    <span class="nx">onTimeout</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_onTimeout</span><span class="p">,</span>
                    <span class="nx">timeout</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span>
                    <span class="nx">autopurge</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nx">context</span><span class="o">:</span> <span class="nx">self</span>
                <span class="p">});</span>

                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// we are finished</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="nx">fn</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_internalCallback</span><span class="p">;</span>

        <span class="c1">// internal callback for loading css first</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Y.log(&#39;loader internal&#39;);</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">_internalCallback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Y.log(&#39;loader complete&#39;);</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">_onSuccess</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Apply filter defined for this instance to a url/path</span>
<span class="cm">     * method _filter</span>
<span class="cm">     * @param {string} u the string to filter.</span>
<span class="cm">     * @param {string} name the name of the module, if we are processing</span>
<span class="cm">     * a single module as opposed to a combined url.</span>
<span class="cm">     * @return {string} the filtered string.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">,</span>
            <span class="nx">hasFilter</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">filters</span><span class="p">),</span>
            <span class="nx">modFilter</span> <span class="o">=</span> <span class="nx">hasFilter</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">u</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">hasFilter</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">modFilter</span><span class="p">))</span> <span class="o">?</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">FILTER_DEFS</span><span class="p">[</span><span class="nx">modFilter</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()]</span> <span class="o">||</span> <span class="kc">null</span> <span class="o">:</span>
                    <span class="nx">modFilter</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">u</span> <span class="o">=</span> <span class="nx">u</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">searchExp</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">),</span> <span class="nx">f</span><span class="p">.</span><span class="nx">replaceStr</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">u</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Generates the full url for a module</span>
<span class="cm">     * method _url</span>
<span class="cm">     * @param {string} path the path fragment.</span>
<span class="cm">     * @return {string} the full url.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_url</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">base</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_filter</span><span class="p">((</span><span class="nx">base</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">base</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>



<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;loader-rollup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Optional automatic rollup logic for reducing http connections</span>
<span class="cm"> * when not using a combo service.</span>
<span class="cm"> * @module loader</span>
<span class="cm"> * @submodule rollup</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Look for rollup packages to determine if all of the modules a</span>
<span class="cm"> * rollup supersedes are required.  If so, include the rollup to</span>
<span class="cm"> * help reduce the total number of connections required.  Called</span>
<span class="cm"> * by calculate().  This is an optional feature, and requires the</span>
<span class="cm"> * appropriate submodule to function.</span>
<span class="cm"> * @method _rollup</span>
<span class="cm"> * @for Loader</span>
<span class="cm"> * @private</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Loader</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_rollup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">required</span><span class="p">,</span> <span class="nx">roll</span><span class="p">,</span>
        <span class="nx">info</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">moduleInfo</span><span class="p">,</span> <span class="nx">rolled</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">smod</span><span class="p">;</span>

    <span class="c1">// find and cache rollup modules</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dirty</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">rollups</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">rollups</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
                <span class="c1">// if (m &amp;&amp; m.rollup &amp;&amp; m.supersedes) {</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">rollup</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">rollups</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">forceMap</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">force</span><span class="p">)</span> <span class="o">:</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="c1">// make as many passes as needed to pick up rollup rollups</span>
    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="nx">rolled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="c1">// go through the rollup candidates</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">rollups</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rollups</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// there can be only one, unless forced</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">forceMap</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModule</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
                    <span class="nx">s</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">supersedes</span> <span class="o">||</span> <span class="p">[];</span>
                    <span class="nx">roll</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                    <span class="c1">// @TODO remove continue</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span><span class="p">.</span><span class="nx">rollup</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                    <span class="c1">// check the threshold</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">smod</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>

                        <span class="c1">// if the superseded module is loaded, we can&#39;t</span>
                        <span class="c1">// load the rollup unless it has been forced.</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">forceMap</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">]])</span> <span class="p">{</span>
                            <span class="nx">roll</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="c1">// increment the counter if this module is required.</span>
                        <span class="c1">// if we are beyond the rollup threshold, we will</span>
                        <span class="c1">// use the rollup module</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">smod</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">c</span><span class="o">++</span><span class="p">;</span>
                            <span class="c1">// Y.log(&quot;adding to thresh: &quot; + c + &quot;, &quot; + s[j]);</span>
                            <span class="nx">roll</span> <span class="o">=</span> <span class="p">(</span><span class="nx">c</span> <span class="o">&gt;=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">rollup</span><span class="p">);</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">roll</span><span class="p">)</span> <span class="p">{</span>
                                <span class="c1">// Y.log(&quot;over thresh &quot; + c + &quot;, &quot; + s[j]);</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">roll</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Y.log(&quot;adding rollup: &quot; +  i);</span>
                        <span class="c1">// add the rollup</span>
                        <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="nx">rolled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                        <span class="c1">// expand the rollup&#39;s dependencies</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">getRequires</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// if we made it here w/o rolling up something, we are done</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">rolled</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;loader-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;loader-yui3&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/* This file is auto-generated by src/loader/meta_join.py */</span>

<span class="cm">/**</span>
<span class="cm"> * YUI 3 module metadata</span>
<span class="cm"> * @module loader</span>
<span class="cm"> * @submodule yui3</span>
<span class="cm"> */</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">version</span><span class="p">].</span><span class="nx">modules</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">version</span><span class="p">].</span><span class="nx">modules</span> <span class="o">||</span> <span class="p">{</span>
    <span class="s2">&quot;align-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-screen&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-pluginhost&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;anim-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-color&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-curve&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-easing&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-node-plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-scroll&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-xy&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-style&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim-color&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;anim-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim-curve&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;anim-xy&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim-easing&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;anim-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim-node-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-pluginhost&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim-scroll&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;anim-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;anim-xy&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;anim-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-screen&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;app&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;controller&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;model&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;model-list&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;view&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;array-extras&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;array-invoke&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;arraylist&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;arraylist-add&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;arraylist&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;arraylist-filter&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;arraylist&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;arraysort&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;async-queue&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;attribute&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;attribute-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;attribute-complex&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;attribute-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;attribute-complex&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;attribute-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;autocomplete-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;autocomplete-sources&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;autocomplete-list&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;autocomplete-plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;autocomplete-sources&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;escape&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-valuechange&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-filters&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-wordbreak&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-filters-accentfold&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-accentfold&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-wordbreak&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-highlighters&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;highlight-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-highlighters-accentfold&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;highlight-accentfold&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-list&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;autocomplete-sources&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;lang&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;en&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;autocomplete-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-resize&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selector-css3&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;shim-plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-position&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-position-align&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-list-keys&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;autocomplete-list-keys&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only add keyboard support to autocomplete-list if this doesn&#39;t appear to</span>
    <span class="c1">// be an iOS or Android-based mobile device.</span>
    <span class="c1">//</span>
    <span class="c1">// There&#39;s currently no feasible way to actually detect whether a device has</span>
    <span class="c1">// a hardware keyboard, so this sniff will have to do. It can easily be</span>
    <span class="c1">// overridden by manually loading the autocomplete-list-keys module.</span>
    <span class="c1">//</span>
    <span class="c1">// Worth noting: even though iOS supports bluetooth keyboards, Mobile Safari</span>
    <span class="c1">// doesn&#39;t fire the keyboard events used by AutoCompleteList, so there&#39;s</span>
    <span class="c1">// no point loading the -keys module even when a bluetooth keyboard may be</span>
    <span class="c1">// available.</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ios</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">android</span><span class="p">);</span>
<span class="p">},</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;autocomplete-list&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;autocomplete-list&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-build&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;autocomplete-list&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-pluginhost&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;autocomplete-sources&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;io-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;json-parse&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;jsonp&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yql&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;autocomplete-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-pluginhost&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-build&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;base-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;attribute-complex&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;attribute-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;base-build&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;base-pluginhost&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;pluginhost&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cache&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cache-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cache-offline&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cache-plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cache-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cache-offline&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cache-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;json&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cache-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cache-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;charts&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatype&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-custom&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-mouseenter&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-position&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-stack&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;classnamemanager&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;clickable-rail&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;slider-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;collection&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;arraylist&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;arraylist-add&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;arraylist-filter&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;array-invoke&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;compat&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dump&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;console&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;lang&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;en&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-log&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;console-filters&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;console&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;controller&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;querystring-parse&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;history&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cookie&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;createlink-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;editor-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssbase&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cssreset&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssfonts&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssgrids&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssreset-context&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssfonts-context&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssgrids-context&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssbase-context&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cssreset&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssfonts&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssgrids&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssreset-context&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssfonts-context&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssgrids-context&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssfonts&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssfonts-context&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssgrids&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cssreset&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cssfonts&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssgrids-context-deprecated&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cssreset-context&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cssfonts-context&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssgrids-deprecated&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cssreset&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;cssfonts&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssreset&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;cssreset-context&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;css&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dataschema&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dataschema-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-json&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-xml&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-array&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-text&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dataschema-array&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dataschema-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dataschema-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dataschema-json&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dataschema-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;json&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dataschema-text&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dataschema-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dataschema-xml&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dataschema-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-io&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-get&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-function&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-cache&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-jsonschema&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-xmlschema&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-arrayschema&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-textschema&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-polling&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-arrayschema&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-array&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-cache&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cache-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-function&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-get&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;get&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-io&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;io-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-jsonschema&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-json&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-local&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-polling&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-textschema&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-text&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datasource-xmlschema&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datasource-local&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dataschema-xml&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatable&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatable-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatable-datasource&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatable-sort&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatable-scroll&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatable-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;recordset-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-mouseenter&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatable-datasource&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatable-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datasource-local&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatable-scroll&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatable-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;stylesheet&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatable-sort&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;lang&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;en&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatable-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;recordset-sort&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatype&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatype-number&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatype-date&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatype-xml&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatype-date&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;lang&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;ar&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ar-JO&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ca&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ca-ES&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;da&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;da-DK&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;de&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;de-AT&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;de-DE&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;el&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;el-GR&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-AU&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-CA&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-GB&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-IE&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-IN&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-JO&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-MY&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-NZ&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-PH&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-SG&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;en-US&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-AR&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-BO&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-CL&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-CO&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-EC&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-ES&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-MX&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-PE&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-PY&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-US&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-UY&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es-VE&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;fi&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;fi-FI&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;fr&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;fr-BE&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;fr-CA&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;fr-FR&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;hi&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;hi-IN&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;id&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;id-ID&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;it&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;it-IT&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ja&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ja-JP&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ko&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ko-KR&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ms&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ms-MY&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;nb&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;nb-NO&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;nl&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;nl-BE&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;nl-NL&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;pl&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;pl-PL&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;pt&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;pt-BR&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ro&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ro-RO&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ru&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ru-RU&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;sv&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;sv-SE&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;th&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;th-TH&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;tr&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;tr-TR&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;vi&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;vi-VN&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;zh-Hans&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;zh-Hans-CN&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;zh-Hant&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;zh-Hant-HK&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;zh-Hant-TW&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;supersedes&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatype-date-format&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;use2&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatype-date-parse&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatype-date-format&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatype-date-format&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;datatype-date-parse&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;datatype-number&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatype-number-parse&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatype-number-format&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatype-number-format&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;datatype-number-parse&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;datatype-xml&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;datatype-xml-parse&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatype-xml-format&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;datatype-xml-format&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;datatype-xml-parse&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;dd&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-ddm-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-ddm&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-ddm-drop&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-drag&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-proxy&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-constrain&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-drop&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-scroll&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-delegate&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-constrain&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drag&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-ddm&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-ddm-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-resize&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-ddm-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yui-throttle&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;classnamemanager&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-ddm-drop&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-ddm&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-delegate&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drag&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-drop-plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-mouseenter&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-drag&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-ddm-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-drop&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drag&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-ddm-drop&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-drop-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drop&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-gestures&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;dd-gestures&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="s1">&#39;ontouchstart&#39;</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">chrome</span><span class="p">));</span>
<span class="p">},</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;dd-drag&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drag&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-synthetic&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-gestures&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-constrain&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-proxy&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drag&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-proxy&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drag&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dd-scroll&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-drag&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dial&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;lang&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;en&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;es&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-drag&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-mouseenter&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-move&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;transition&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;intl&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-attrs&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-create&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-class&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-size&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-screen&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-style&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selector-native&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selector&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-attrs&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-attrs&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-create&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-class&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-size&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-class&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-core&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;oop&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;features&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-create&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-deprecated&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-screen&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dom-style&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-size&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-style&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dom-style-ie&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;dom-style-ie&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">testFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span>
        <span class="nx">addFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">add</span><span class="p">,</span>
        <span class="nx">WINDOW</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
        <span class="nx">DOCUMENT</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span>
        <span class="nx">DOCUMENT_ELEMENT</span> <span class="o">=</span> <span class="s1">&#39;documentElement&#39;</span><span class="p">,</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;computedStyle&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">WINDOW</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;getComputedStyle&#39;</span> <span class="k">in</span> <span class="nx">WINDOW</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">DOCUMENT</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;opacity&#39;</span> <span class="k">in</span> <span class="nx">DOCUMENT</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">].</span><span class="nx">style</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">ret</span> <span class="o">=</span>  <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;computedStyle&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">},</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;dom-style&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-style&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;dump&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;editor&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;frame&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selection&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;exec-command&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;editor-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;editor-para&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;editor-br&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;editor-bidi&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;editor-tab&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;createlink-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;editor-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;frame&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;exec-command&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selection&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;editor-bidi&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;editor-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;editor-br&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;editor-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;editor-lists&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;editor-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;editor-para&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;editor-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;editor-tab&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;editor-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;escape&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;event&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-delegate&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-synthetic&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-mousewheel&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-mouseenter&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-key&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-focus&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-resize&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-hover&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-base-ie&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-base&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;event-base-ie&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">imp</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">implementation</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">imp</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">imp</span><span class="p">.</span><span class="nx">hasFeature</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0&#39;</span><span class="p">)));</span>
<span class="p">},</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;node-base&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-custom&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-custom-complex&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-custom-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;oop&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-custom-complex&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-delegate&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-flick&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-touch&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-synthetic&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-focus&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-synthetic&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-gestures&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-flick&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-move&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-hover&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-mouseenter&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-key&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-synthetic&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-mouseenter&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-synthetic&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-mousewheel&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-move&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-touch&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-synthetic&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-resize&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-simulate&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-synthetic&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-custom-complex&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-touch&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;event-valuechange&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-focus&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-synthetic&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;exec-command&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;frame&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;features&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;frame&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selector-css3&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yui-throttle&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;get&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;highlight&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;highlight-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;highlight-accentfold&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;highlight-accentfold&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;highlight-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-accentfold&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;highlight-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;escape&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-wordbreak&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;history&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;history-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;history-hash&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;history-hash-ie&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;history-html5&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;history-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom-complex&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;history-hash&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;after&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;history-html5&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-synthetic&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;history-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yui-later&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;history-hash-ie&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;history-hash-ie&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">docMode</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentMode</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;onhashchange&#39;</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">)</span> <span class="o">||</span>
            <span class="o">!</span><span class="nx">docMode</span> <span class="o">||</span> <span class="nx">docMode</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">},</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;history-hash&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;history-hash&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;history-html5&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;json&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;history-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;imageloader&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-style&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-screen&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;intl&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;intl-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-custom&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;intl-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;io&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;io-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;io-xdr&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;io-form&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;io-upload-iframe&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;io-queue&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;io-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;querystring-stringify-simple&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;io-form&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;io-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;io-queue&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;io-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;queue-promote&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;io-upload-iframe&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;io-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;io-xdr&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;io-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;datatype-xml&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;json&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;json-parse&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;json-stringify&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;json-parse&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;json-stringify&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;jsonp&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;get&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;oop&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;jsonp-url&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;jsonp&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;loader&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;loader-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;loader-rollup&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;loader-yui3&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;loader-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;get&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;loader-rollup&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;loader-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;loader-yui3&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;loader-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;model&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;escape&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;json-parse&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;model-list&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;array-invoke&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;arraylist&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;json-parse&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;model&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-event-delegate&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-pluginhost&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-screen&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-style&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selector-css2&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-deprecated&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-event-delegate&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-delegate&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-event-simulate&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-simulate&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-flick&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;classnamemanager&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;transition&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-flick&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-focusmanager&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-event-simulate&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-key&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-focus&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-load&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;io-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-menunav&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;classnamemanager&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-focusmanager&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-pluginhost&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;pluginhost&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-screen&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-screen&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;node-style&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-style&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;oop&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;overlay&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-stdmod&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-position&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-position-align&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-stack&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-position-constrain&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;pluginattr&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;pluginhost&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;pluginhost-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;pluginhost-config&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;pluginhost-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;pluginhost-config&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;pluginhost-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;profiler&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;querystring&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;querystring-parse&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;querystring-stringify&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;querystring-parse&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;array-extras&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;querystring-parse-simple&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;querystring-stringify&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;querystring-stringify-simple&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;queue-promote&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;range-slider&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;slider-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;slider-value-range&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;clickable-rail&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;recordset&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;recordset-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;recordset-sort&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;recordset-filter&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;recordset-indexer&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;recordset-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;arraylist&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;recordset-filter&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;recordset-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;recordset-indexer&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;recordset-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;recordset-sort&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;arraysort&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;recordset-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;resize&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;resize-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;resize-proxy&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;resize-constrain&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;resize-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;oop&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-drag&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-delegate&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-drop&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;resize-constrain&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;resize-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;resize-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;resize-constrain&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;resize-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;resize-proxy&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;resize-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;rls&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;get&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;features&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;scrollview&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;scrollview-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;scrollview-scrollbars&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;scrollview-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-gestures&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;transition&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;scrollview-base-ie&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;scrollview-base-ie&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;scrollview-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ua&quot;</span><span class="o">:</span> <span class="s2">&quot;ie&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;scrollview-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;scrollview-paginator&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;scrollview-scrollbars&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;classnamemanager&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;transition&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;selection&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;selector-native&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;selector-css2&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;selector-css2&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">DOCUMENT</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">DOCUMENT</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="s1">&#39;querySelectorAll&#39;</span> <span class="k">in</span> <span class="nx">DOCUMENT</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">},</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;selector&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;selector-native&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;selector-css3&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;selector-native&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;selector-css2&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;selector-native&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dom-core&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;shim-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-style&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-pluginhost&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;slider&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;slider-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;slider-value-range&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;clickable-rail&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;range-slider&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;slider-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-constrain&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;slider-value-range&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;slider-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;sortable&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-delegate&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-drop-plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dd-proxy&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;sortable-scroll&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dd-scroll&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;sortable&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;stylesheet&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;substitute&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;optional&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;dump&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;swf&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;swfdetect&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;swfdetect&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;tabview&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-parent&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-child&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;tabview-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-pluginhost&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-focusmanager&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;tabview-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-event-delegate&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;classnamemanager&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;skin-sam-tabview&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;tabview-plugin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;tabview-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-simulate&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-custom&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;substitute&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;json-stringify&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;text-accentfold&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-wordbreak&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;text-accentfold&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-data-accentfold&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;text-data-accentfold&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;text-data-wordbreak&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;text-wordbreak&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;array-extras&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;text-data-wordbreak&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;transition&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;transition-native&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;transition-timer&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;transition-native&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;node-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;transition-timer&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;transition-native&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-style&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;uploader&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;event-custom&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;swf&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;view&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-event-delegate&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-htmlparser&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-uievents&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget-skin&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-anim&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;anim-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-base&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;event-focus&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-pluginhost&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-style&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;classnamemanager&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-base-ie&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;condition&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;widget-base-ie&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;trigger&quot;</span><span class="o">:</span> <span class="s2">&quot;widget-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;ua&quot;</span><span class="o">:</span> <span class="s2">&quot;ie&quot;</span>
        <span class="p">},</span> 
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-child&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-htmlparser&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-locale&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-modality&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;plugin&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;gallery-outside-events&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;base-build&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-parent&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;arraylist&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-position&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-screen&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-position-align&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-position&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-position-constrain&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-position&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-skin&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-stack&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span>
        <span class="p">],</span> 
        <span class="s2">&quot;skinnable&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-stdmod&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;base-build&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;widget&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;widget-uievents&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;widget-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;node-event-delegate&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;yql&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;jsonp&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;jsonp-url&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;yui&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;get&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;features&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;intl-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yui-log&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yui-later&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;loader-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;loader-rollup&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;loader-yui3&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;yui-base&quot;</span><span class="o">:</span> <span class="p">{},</span> 
    <span class="s2">&quot;yui-later&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;yui-log&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;yui-rls&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;get&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;features&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;intl-base&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;rls&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yui-log&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;yui-later&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span> 
    <span class="s2">&quot;yui-throttle&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;requires&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;yui-base&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">version</span><span class="p">].</span><span class="nx">md5</span> <span class="o">=</span> <span class="s1">&#39;8deea7d26f0f85ddcacf3aa4da9bfed6&#39;</span><span class="p">;</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;loader-base&#39;</span><span class="p">]});</span>


<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;yui&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">){},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">use</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">,</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;intl-base&#39;</span><span class="p">,</span><span class="s1">&#39;yui-log&#39;</span><span class="p">,</span><span class="s1">&#39;yui-later&#39;</span><span class="p">,</span><span class="s1">&#39;loader-base&#39;</span><span class="p">,</span> <span class="s1">&#39;loader-rollup&#39;</span><span class="p">,</span> <span class="s1">&#39;loader-yui3&#39;</span> <span class="p">]});</span>

<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;oop&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm">Supplies object inheritance and manipulation utilities.</span>

<span class="cm">This adds additional functionaity to what is provided in `yui-base`, and the</span>
<span class="cm">methods are applied directly to the YUI instance. This module is required for</span>
<span class="cm">most YUI components.</span>

<span class="cm">@module oop</span>
<span class="cm">**/</span>

<span class="cm">/**</span>
<span class="cm">These methods are added to the YUI instance by the `oop` module.</span>

<span class="cm">@class YUI~oop</span>
<span class="cm">**/</span>

<span class="kd">var</span> <span class="nx">L</span>            <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">,</span>
    <span class="nx">A</span>            <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">,</span>
    <span class="nx">OP</span>           <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nx">CLONE_MARKER</span> <span class="o">=</span> <span class="s1">&#39;_~yuim~_&#39;</span><span class="p">,</span>

    <span class="nx">hasOwn</span>   <span class="o">=</span> <span class="nx">OP</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">,</span>
    <span class="nx">toString</span> <span class="o">=</span> <span class="nx">OP</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">[</span><span class="nx">action</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span> <span class="o">!==</span> <span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">o</span><span class="p">[</span><span class="nx">action</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="k">return</span> <span class="nx">A</span><span class="p">[</span><span class="nx">action</span><span class="p">](</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="k">return</span> <span class="nx">A</span><span class="p">[</span><span class="nx">action</span><span class="p">](</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">[</span><span class="nx">action</span><span class="p">](</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">proto</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    Augments the _receiver_ with prototype properties from the _supplier_. The</span>
<span class="cm">    receiver may be a constructor function or an object. The supplier must be a</span>
<span class="cm">    constructor function.</span>

<span class="cm">    If the _receiver_ is an object, then the _supplier_ constructor will be called</span>
<span class="cm">    immediately after _receiver_ is augmented, with _receiver_ as the `this` object.</span>

<span class="cm">    If the _receiver_ is a constructor function, then all prototype methods of</span>
<span class="cm">    _supplier_ that are copied to _receiver_ will be sequestered, and the</span>
<span class="cm">    _supplier_ constructor will not be called immediately. The first time any</span>
<span class="cm">    sequestered method is called on the _receiver_&#39;s prototype, all sequestered</span>
<span class="cm">    methods will be immediately copied to the _receiver_&#39;s prototype, the</span>
<span class="cm">    _supplier_&#39;s constructor will be executed, and finally the newly unsequestered</span>
<span class="cm">    method that was called will be executed.</span>

<span class="cm">    This sequestering logic sounds like a bunch of complicated voodoo, but it makes</span>
<span class="cm">    it cheap to perform frequent augmentation by ensuring that suppliers&#39;</span>
<span class="cm">    constructors are only called if a supplied method is actually used. If none of</span>
<span class="cm">    the supplied methods is ever used, then there&#39;s no need to take the performance</span>
<span class="cm">    hit of calling the _supplier_&#39;s constructor.</span>

<span class="cm">    @method augment</span>
<span class="cm">    @param {Function|Object} receiver Object or function to be augmented.</span>
<span class="cm">    @param {Function} supplier Function that supplies the prototype properties with</span>
<span class="cm">      which to augment the _receiver_.</span>
<span class="cm">    @param {Boolean} [overwrite=false] If `true`, properties already on the receiver</span>
<span class="cm">      will be overwritten if found on the supplier&#39;s prototype.</span>
<span class="cm">    @param {String[]} [whitelist] An array of property names. If specified,</span>
<span class="cm">      only the whitelisted prototype properties will be applied to the receiver, and</span>
<span class="cm">      all others will be ignored.</span>
<span class="cm">    @param {Array|any} [args] Argument or array of arguments to pass to the</span>
<span class="cm">      supplier&#39;s constructor when initializing.</span>
<span class="cm">    @return {Function} Augmented object.</span>
<span class="cm">    **/</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">augment</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">receiver</span><span class="p">,</span> <span class="nx">supplier</span><span class="p">,</span> <span class="nx">overwrite</span><span class="p">,</span> <span class="nx">whitelist</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">rProto</span>    <span class="o">=</span> <span class="nx">receiver</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
            <span class="nx">sequester</span> <span class="o">=</span> <span class="nx">rProto</span> <span class="o">&amp;&amp;</span> <span class="nx">supplier</span><span class="p">,</span>
            <span class="nx">sProto</span>    <span class="o">=</span> <span class="nx">supplier</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
            <span class="nx">to</span>        <span class="o">=</span> <span class="nx">rProto</span> <span class="o">||</span> <span class="nx">receiver</span><span class="p">,</span>

            <span class="nx">copy</span><span class="p">,</span>
            <span class="nx">newPrototype</span><span class="p">,</span>
            <span class="nx">replacements</span><span class="p">,</span>
            <span class="nx">sequestered</span><span class="p">,</span>
            <span class="nx">unsequester</span><span class="p">;</span>

        <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">sequester</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">newPrototype</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">replacements</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">sequestered</span>  <span class="o">=</span> <span class="p">{};</span>

            <span class="nx">copy</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">overwrite</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">rProto</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;[object Function]&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">sequestered</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>

                        <span class="nx">newPrototype</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">replacements</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="nx">unsequester</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
                        <span class="p">};</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">newPrototype</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="nx">unsequester</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">fnArgs</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Unsequester all sequestered functions.</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">sequestered</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">hasOwn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">sequestered</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
                            <span class="o">&amp;&amp;</span> <span class="nx">instance</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">replacements</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>

                        <span class="nx">instance</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sequestered</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// Execute the supplier constructor.</span>
                <span class="nx">supplier</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>

                <span class="c1">// Finally, execute the original sequestered function.</span>
                <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">fnArgs</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">whitelist</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">whitelist</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">sProto</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">copy</span><span class="p">(</span><span class="nx">sProto</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span> <span class="nx">name</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">sProto</span><span class="p">,</span> <span class="nx">copy</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">newPrototype</span> <span class="o">||</span> <span class="nx">sProto</span><span class="p">,</span> <span class="nx">overwrite</span><span class="p">,</span> <span class="nx">whitelist</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sequester</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">supplier</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">receiver</span><span class="p">;</span>
    <span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Applies object properties from the supplier to the receiver.  If</span>
<span class="cm"> * the target has the property, and the property is an object, the target</span>
<span class="cm"> * object will be augmented with the supplier&#39;s value.  If the property</span>
<span class="cm"> * is an array, the suppliers value will be appended to the target.</span>
<span class="cm"> * @method aggregate</span>
<span class="cm"> * @param {function} r  the object to receive the augmentation.</span>
<span class="cm"> * @param {function} s  the object that supplies the properties to augment.</span>
<span class="cm"> * @param {boolean} ov if true, properties already on the receiver</span>
<span class="cm"> * will be overwritten if found on the supplier.</span>
<span class="cm"> * @param {string[]} wl a whitelist.  If supplied, only properties in</span>
<span class="cm"> * this list will be applied to the receiver.</span>
<span class="cm"> * @return {object} the extended object.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">aggregate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">ov</span><span class="p">,</span> <span class="nx">wl</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">ov</span><span class="p">,</span> <span class="nx">wl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Utility to set up the prototype, constructor and superclass properties to</span>
<span class="cm"> * support an inheritance strategy that can chain constructors and methods.</span>
<span class="cm"> * Static members will not be inherited.</span>
<span class="cm"> *</span>
<span class="cm"> * @method extend</span>
<span class="cm"> * @param {function} r   the object to modify.</span>
<span class="cm"> * @param {function} s the object to inherit.</span>
<span class="cm"> * @param {object} px prototype properties to add/override.</span>
<span class="cm"> * @param {object} sx static properties to add/override.</span>
<span class="cm"> * @return {object} the extended object.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">px</span><span class="p">,</span> <span class="nx">sx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">s</span> <span class="o">||</span> <span class="o">!</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;extend failed, verify dependencies&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">sp</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">rp</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">(</span><span class="nx">sp</span><span class="p">);</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">rp</span><span class="p">;</span>

    <span class="nx">rp</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">superclass</span> <span class="o">=</span> <span class="nx">sp</span><span class="p">;</span>

    <span class="c1">// assign constructor property</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">!=</span> <span class="nb">Object</span> <span class="o">&amp;&amp;</span> <span class="nx">sp</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nx">OP</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sp</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// add prototype overrides</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">px</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">px</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// add object overrides</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sx</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">sx</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Executes the supplied function for each item in</span>
<span class="cm"> * a collection.  Supports arrays, objects, and</span>
<span class="cm"> * Y.NodeLists</span>
<span class="cm"> * @method each</span>
<span class="cm"> * @param {object} o the object to iterate.</span>
<span class="cm"> * @param {function} f the function to execute.  This function</span>
<span class="cm"> * receives the value, key, and object as parameters.</span>
<span class="cm"> * @param {object} c the execution context for the function.</span>
<span class="cm"> * @param {boolean} proto if true, prototype properties are</span>
<span class="cm"> * iterated on objects.</span>
<span class="cm"> * @return {YUI} the YUI instance.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">proto</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="s1">&#39;each&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Executes the supplied function for each item in</span>
<span class="cm"> * a collection.  The operation stops if the function</span>
<span class="cm"> * returns true. Supports arrays, objects, and</span>
<span class="cm"> * Y.NodeLists.</span>
<span class="cm"> * @method some</span>
<span class="cm"> * @param {object} o the object to iterate.</span>
<span class="cm"> * @param {function} f the function to execute.  This function</span>
<span class="cm"> * receives the value, key, and object as parameters.</span>
<span class="cm"> * @param {object} c the execution context for the function.</span>
<span class="cm"> * @param {boolean} proto if true, prototype properties are</span>
<span class="cm"> * iterated on objects.</span>
<span class="cm"> * @return {boolean} true if the function ever returns true,</span>
<span class="cm"> * false otherwise.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">some</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">proto</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">proto</span><span class="p">,</span> <span class="s1">&#39;some&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Deep obj/array copy.  Function clones are actually</span>
<span class="cm"> * wrappers around the original function.</span>
<span class="cm"> * Array-like objects are treated as arrays.</span>
<span class="cm"> * Primitives are returned untouched.  Optionally, a</span>
<span class="cm"> * function can be provided to handle other data types,</span>
<span class="cm"> * filter keys, validate values, etc.</span>
<span class="cm"> *</span>
<span class="cm"> * @method clone</span>
<span class="cm"> * @param {object} o what to clone.</span>
<span class="cm"> * @param {boolean} safe if true, objects will not have prototype</span>
<span class="cm"> * items from the source.  If false, they will.  In this case, the</span>
<span class="cm"> * original is initially protected, but the clone is not completely</span>
<span class="cm"> * immune from changes to the source object prototype.  Also, cloned</span>
<span class="cm"> * prototype items that are deleted from the clone will result</span>
<span class="cm"> * in the value of the source prototype being exposed.  If operating</span>
<span class="cm"> * on a non-safe clone, items should be nulled out rather than deleted.</span>
<span class="cm"> * @param {function} f optional function to apply to each item in a</span>
<span class="cm"> * collection; it will be executed prior to applying the value to</span>
<span class="cm"> * the new object.  Return false to prevent the copy.</span>
<span class="cm"> * @param {object} c optional execution context for f.</span>
<span class="cm"> * @param {object} owner Owner object passed when clone is iterating</span>
<span class="cm"> * an object.  Used to set up context for cloned functions.</span>
<span class="cm"> * @param {object} cloned hash of previously cloned objects to avoid</span>
<span class="cm"> * multiple clones.</span>
<span class="cm"> * @return {Array|Object} the cloned object.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">clone</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">safe</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">owner</span><span class="p">,</span> <span class="nx">cloned</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// @todo cloning YUI instances doesn&#39;t currently work</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">YUI</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">o2</span><span class="p">,</span> <span class="nx">marked</span> <span class="o">=</span> <span class="nx">cloned</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">stamp</span><span class="p">,</span>
        <span class="nx">yeach</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;date&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
        <span class="k">case</span> <span class="s1">&#39;regexp&#39;</span><span class="o">:</span>
            <span class="c1">// if we do this we need to set the flags too</span>
            <span class="c1">// return new RegExp(o.source);</span>
            <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;function&#39;</span><span class="o">:</span>
            <span class="c1">// o2 = Y.bind(o, owner);</span>
            <span class="c1">// break;</span>
            <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;array&#39;</span><span class="o">:</span>
            <span class="nx">o2</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>

            <span class="c1">// #2528250 only one clone of a given object should be created.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">CLONE_MARKER</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">marked</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">CLONE_MARKER</span><span class="p">]];</span>
            <span class="p">}</span>

            <span class="nx">stamp</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">guid</span><span class="p">();</span>

            <span class="nx">o2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">safe</span><span class="p">)</span> <span class="o">?</span> <span class="p">{}</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>

            <span class="nx">o</span><span class="p">[</span><span class="nx">CLONE_MARKER</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stamp</span><span class="p">;</span>
            <span class="nx">marked</span><span class="p">[</span><span class="nx">stamp</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// #2528250 don&#39;t try to clone element properties</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">yeach</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">((</span><span class="nx">k</span> <span class="o">||</span> <span class="nx">k</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">f</span> <span class="o">||</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">c</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">!==</span> <span class="nx">CLONE_MARKER</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">==</span> <span class="s1">&#39;prototype&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// skip the prototype</span>
                    <span class="c1">// } else if (o[k] === o) {</span>
                    <span class="c1">//     this[k] = this;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span>
                            <span class="nx">Y</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">safe</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">owner</span> <span class="o">||</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">marked</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="nx">o2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cloned</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">marked</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">[</span><span class="nx">CLONE_MARKER</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="nx">v</span><span class="p">[</span><span class="nx">CLONE_MARKER</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">v</span><span class="p">[</span><span class="nx">CLONE_MARKER</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
        <span class="nx">marked</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">o2</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/**</span>
<span class="cm"> * Returns a function that will execute the supplied function in the</span>
<span class="cm"> * supplied object&#39;s context, optionally adding any additional</span>
<span class="cm"> * supplied parameters to the beginning of the arguments collection the</span>
<span class="cm"> * supplied to the function.</span>
<span class="cm"> *</span>
<span class="cm"> * @method bind</span>
<span class="cm"> * @param {Function|String} f the function to bind, or a function name</span>
<span class="cm"> * to execute on the context object.</span>
<span class="cm"> * @param {object} c the execution context.</span>
<span class="cm"> * @param {any} args* 0..n arguments to include before the arguments the</span>
<span class="cm"> * function is executed with.</span>
<span class="cm"> * @return {function} the wrapped function.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xargs</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">?</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">?</span> <span class="nx">c</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">:</span> <span class="nx">f</span><span class="p">,</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="p">(</span><span class="nx">xargs</span><span class="p">)</span> <span class="o">?</span>
                <span class="nx">xargs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">))</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">c</span> <span class="o">||</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a function that will execute the supplied function in the</span>
<span class="cm"> * supplied object&#39;s context, optionally adding any additional</span>
<span class="cm"> * supplied parameters to the end of the arguments the function</span>
<span class="cm"> * is executed with.</span>
<span class="cm"> *</span>
<span class="cm"> * @method rbind</span>
<span class="cm"> * @param {Function|String} f the function to bind, or a function name</span>
<span class="cm"> * to execute on the context object.</span>
<span class="cm"> * @param {object} c the execution context.</span>
<span class="cm"> * @param {any} args* 0..n arguments to append to the end of</span>
<span class="cm"> * arguments collection supplied to the function.</span>
<span class="cm"> * @return {function} the wrapped function.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">rbind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xargs</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">?</span> <span class="nx">c</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">:</span> <span class="nx">f</span><span class="p">,</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="p">(</span><span class="nx">xargs</span><span class="p">)</span> <span class="o">?</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">xargs</span><span class="p">)</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">c</span> <span class="o">||</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-core&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">NODE_TYPE</span> <span class="o">=</span> <span class="s1">&#39;nodeType&#39;</span><span class="p">,</span>
    <span class="nx">OWNER_DOCUMENT</span> <span class="o">=</span> <span class="s1">&#39;ownerDocument&#39;</span><span class="p">,</span>
    <span class="nx">DOCUMENT_ELEMENT</span> <span class="o">=</span> <span class="s1">&#39;documentElement&#39;</span><span class="p">,</span>
    <span class="nx">DEFAULT_VIEW</span> <span class="o">=</span> <span class="s1">&#39;defaultView&#39;</span><span class="p">,</span>
    <span class="nx">PARENT_WINDOW</span> <span class="o">=</span> <span class="s1">&#39;parentWindow&#39;</span><span class="p">,</span>
    <span class="nx">TAG_NAME</span> <span class="o">=</span> <span class="s1">&#39;tagName&#39;</span><span class="p">,</span>
    <span class="nx">PARENT_NODE</span> <span class="o">=</span> <span class="s1">&#39;parentNode&#39;</span><span class="p">,</span>
    <span class="nx">PREVIOUS_SIBLING</span> <span class="o">=</span> <span class="s1">&#39;previousSibling&#39;</span><span class="p">,</span>
    <span class="nx">NEXT_SIBLING</span> <span class="o">=</span> <span class="s1">&#39;nextSibling&#39;</span><span class="p">,</span>
    <span class="nx">CONTAINS</span> <span class="o">=</span> <span class="s1">&#39;contains&#39;</span><span class="p">,</span>
    <span class="nx">COMPARE_DOCUMENT_POSITION</span> <span class="o">=</span> <span class="s1">&#39;compareDocumentPosition&#39;</span><span class="p">,</span>
    <span class="nx">EMPTY_ARRAY</span> <span class="o">=</span> <span class="p">[],</span>

<span class="cm">/** </span>
<span class="cm"> * The DOM utility provides a cross-browser abtraction layer</span>
<span class="cm"> * normalizing DOM tasks, and adds extra helper functionality</span>
<span class="cm"> * for other common tasks. </span>
<span class="cm"> * @module dom</span>
<span class="cm"> * @submodule dom-base</span>
<span class="cm"> * @for DOM</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Provides DOM helper methods.</span>
<span class="cm"> * @class DOM</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
    
<span class="nx">Y_DOM</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Returns the HTMLElement with the given ID (Wrapper for document.getElementById).</span>
<span class="cm">     * @method byId         </span>
<span class="cm">     * @param {String} id the id attribute </span>
<span class="cm">     * @param {Object} doc optional The document to search. Defaults to current document </span>
<span class="cm">     * @return {HTMLElement | null} The HTMLElement with the id, or null if none found. </span>
<span class="cm">     */</span>
    <span class="nx">byId</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle dupe IDs and IE name collision</span>
        <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">allById</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/*</span>
<span class="cm">     * Finds the ancestor of the element.</span>
<span class="cm">     * @method ancestor</span>
<span class="cm">     * @param {HTMLElement} element The html element.</span>
<span class="cm">     * @param {Function} fn optional An optional boolean test to apply.</span>
<span class="cm">     * The optional function is passed the current DOM node being tested as its only argument.</span>
<span class="cm">     * If no function is given, the parentNode is returned.</span>
<span class="cm">     * @param {Boolean} testSelf optional Whether or not to include the element in the scan </span>
<span class="cm">     * @return {HTMLElement | null} The matching DOM node or null if none found. </span>
<span class="cm">     */</span>
    <span class="nx">ancestor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">testSelf</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">testSelf</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">element</span><span class="p">))</span> <span class="o">?</span> <span class="nx">element</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>

        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ret</span> <span class="o">||</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">elementByAxis</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">PARENT_NODE</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/*</span>
<span class="cm">     * Finds the ancestors of the element.</span>
<span class="cm">     * @method ancestors</span>
<span class="cm">     * @param {HTMLElement} element The html element.</span>
<span class="cm">     * @param {Function} fn optional An optional boolean test to apply.</span>
<span class="cm">     * The optional function is passed the current DOM node being tested as its only argument.</span>
<span class="cm">     * If no function is given, all ancestors are returned.</span>
<span class="cm">     * @param {Boolean} testSelf optional Whether or not to include the element in the scan </span>
<span class="cm">     * @return {Array} An array containing all matching DOM nodes.</span>
<span class="cm">     */</span>
    <span class="nx">ancestors</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">testSelf</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ancestor</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">ancestor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">),</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ancestor</span><span class="p">)</span> <span class="o">?</span> <span class="p">[</span><span class="nx">ancestor</span><span class="p">]</span> <span class="o">:</span> <span class="p">[];</span>

        <span class="k">while</span> <span class="p">((</span><span class="nx">ancestor</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">ancestor</span><span class="p">(</span><span class="nx">ancestor</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ancestor</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">ancestor</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Searches the element by the given axis for the first matching element.</span>
<span class="cm">     * @method elementByAxis</span>
<span class="cm">     * @param {HTMLElement} element The html element.</span>
<span class="cm">     * @param {String} axis The axis to search (parentNode, nextSibling, previousSibling).</span>
<span class="cm">     * @param {Function} fn optional An optional boolean test to apply.</span>
<span class="cm">     * @param {Boolean} all optional Whether all node types should be returned, or just element nodes.</span>
<span class="cm">     * The optional function is passed the current HTMLElement being tested as its only argument.</span>
<span class="cm">     * If no function is given, the first element is returned.</span>
<span class="cm">     * @return {HTMLElement | null} The matching element or null if none found.</span>
<span class="cm">     */</span>
    <span class="nx">elementByAxis</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">axis</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">element</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="nx">axis</span><span class="p">]))</span> <span class="p">{</span> <span class="c1">// NOTE: assignment</span>
                <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">all</span> <span class="o">||</span> <span class="nx">element</span><span class="p">[</span><span class="nx">TAG_NAME</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">element</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">element</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Determines whether or not one HTMLElement is or contains another HTMLElement.</span>
<span class="cm">     * @method contains</span>
<span class="cm">     * @param {HTMLElement} element The containing html element.</span>
<span class="cm">     * @param {HTMLElement} needle The html element that may be contained.</span>
<span class="cm">     * @return {Boolean} Whether or not the element is or contains the needle.</span>
<span class="cm">     */</span>
    <span class="nx">contains</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">needle</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">needle</span> <span class="o">||</span> <span class="o">!</span><span class="nx">element</span> <span class="o">||</span> <span class="o">!</span><span class="nx">needle</span><span class="p">[</span><span class="nx">NODE_TYPE</span><span class="p">]</span> <span class="o">||</span> <span class="o">!</span><span class="nx">element</span><span class="p">[</span><span class="nx">NODE_TYPE</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="nx">CONTAINS</span><span class="p">])</span>  <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">opera</span> <span class="o">||</span> <span class="nx">needle</span><span class="p">[</span><span class="nx">NODE_TYPE</span><span class="p">]</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IE &amp; SAF contains fail if needle not an ELEMENT_NODE</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="nx">CONTAINS</span><span class="p">](</span><span class="nx">needle</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_bruteContains</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">needle</span><span class="p">);</span> 
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="nx">COMPARE_DOCUMENT_POSITION</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// gecko</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">element</span> <span class="o">===</span> <span class="nx">needle</span> <span class="o">||</span> <span class="o">!!</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="nx">COMPARE_DOCUMENT_POSITION</span><span class="p">](</span><span class="nx">needle</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">))</span> <span class="p">{</span> 
                <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Determines whether or not the HTMLElement is part of the document.</span>
<span class="cm">     * @method inDoc</span>
<span class="cm">     * @param {HTMLElement} element The containing html element.</span>
<span class="cm">     * @param {HTMLElement} doc optional The document to check.</span>
<span class="cm">     * @return {Boolean} Whether or not the element is attached to the document. </span>
<span class="cm">     */</span>
    <span class="nx">inDoc</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">rootNode</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">element</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">]);</span>

            <span class="nx">rootNode</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">];</span>

            <span class="c1">// contains only works with HTML_ELEMENT</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">rootNode</span> <span class="o">&amp;&amp;</span> <span class="nx">rootNode</span><span class="p">.</span><span class="nx">contains</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">rootNode</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">rootNode</span><span class="p">,</span> <span class="nx">element</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>

    <span class="p">},</span>

   <span class="nx">allById</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">i</span><span class="p">,</span>
            <span class="nx">node</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;[id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// root.all may return HTMLElement or HTMLCollection.</span>
                <span class="c1">// some elements are also HTMLCollection (FORM, SELECT).</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// avoid false positive on name</span>
                        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">nodes</span><span class="p">);</span>
                        <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">EMPTY_ARRAY</span><span class="p">;</span> <span class="c1">// done, no need to filter</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//  prep for filtering</span>
                        <span class="nx">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nx">nodes</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// filter out matches on node.name</span>
                    <span class="c1">// and element.id as reference to element with id === &#39;id&#39;</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">];)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span>  <span class="o">||</span> 
                                <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span>
                                <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="nx">id</span><span class="p">))</span> <span class="p">{</span> 
                            <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">[</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDoc</span><span class="p">(</span><span class="nx">root</span><span class="p">).</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">)];</span>
        <span class="p">}</span>
    
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
   <span class="p">},</span>


    <span class="nx">isWindow</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">alert</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nb">document</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_removeChildNodes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">siblings</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">sibling</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">((</span><span class="nx">sibling</span> <span class="o">=</span> <span class="nx">sibling</span><span class="p">[</span><span class="nx">PREVIOUS_SIBLING</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">sibling</span><span class="p">[</span><span class="nx">TAG_NAME</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">sibling</span><span class="p">)))</span> <span class="p">{</span>
                <span class="nx">nodes</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">sibling</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">sibling</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">((</span><span class="nx">sibling</span> <span class="o">=</span> <span class="nx">sibling</span><span class="p">[</span><span class="nx">NEXT_SIBLING</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">sibling</span><span class="p">[</span><span class="nx">TAG_NAME</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">sibling</span><span class="p">)))</span> <span class="p">{</span>
                <span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sibling</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">nodes</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Brute force version of contains.</span>
<span class="cm">     * Used for browsers without contains support for non-HTMLElement Nodes (textNodes, etc).</span>
<span class="cm">     * @method _bruteContains</span>
<span class="cm">     * @private</span>
<span class="cm">     * @param {HTMLElement} element The containing html element.</span>
<span class="cm">     * @param {HTMLElement} needle The html element that may be contained.</span>
<span class="cm">     * @return {Boolean} Whether or not the element is or contains the needle.</span>
<span class="cm">     */</span>
    <span class="nx">_bruteContains</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">needle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">needle</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">element</span> <span class="o">===</span> <span class="nx">needle</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">needle</span> <span class="o">=</span> <span class="nx">needle</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span>

<span class="c1">// TODO: move to Lang?</span>
    <span class="cm">/**</span>
<span class="cm">     * Memoizes dynamic regular expressions to boost runtime performance. </span>
<span class="cm">     * @method _getRegExp</span>
<span class="cm">     * @private</span>
<span class="cm">     * @param {String} str The string to convert to a regular expression.</span>
<span class="cm">     * @param {String} flags optional An optinal string of flags.</span>
<span class="cm">     * @return {RegExp} An instance of RegExp</span>
<span class="cm">     */</span>
    <span class="nx">_getRegExp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">flags</span> <span class="o">=</span> <span class="nx">flags</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_regexCache</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_regexCache</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_regexCache</span><span class="p">[</span><span class="nx">str</span> <span class="o">+</span> <span class="nx">flags</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_regexCache</span><span class="p">[</span><span class="nx">str</span> <span class="o">+</span> <span class="nx">flags</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">flags</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_regexCache</span><span class="p">[</span><span class="nx">str</span> <span class="o">+</span> <span class="nx">flags</span><span class="p">];</span>
    <span class="p">},</span>

<span class="c1">// TODO: make getDoc/Win true privates?</span>
    <span class="cm">/**</span>
<span class="cm">     * returns the appropriate document.</span>
<span class="cm">     * @method _getDoc</span>
<span class="cm">     * @private</span>
<span class="cm">     * @param {HTMLElement} element optional Target element.</span>
<span class="cm">     * @return {Object} The document for the given element or the default document. </span>
<span class="cm">     */</span>
    <span class="nx">_getDoc</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="nx">NODE_TYPE</span><span class="p">]</span> <span class="o">===</span> <span class="mi">9</span><span class="p">)</span> <span class="o">?</span> <span class="nx">element</span> <span class="o">:</span> <span class="c1">// element === document</span>
                <span class="nx">element</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">]</span> <span class="o">||</span> <span class="c1">// element === DOM node</span>
                <span class="nx">element</span><span class="p">.</span><span class="nb">document</span> <span class="o">||</span> <span class="c1">// element === window</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span> <span class="c1">// default</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">doc</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * returns the appropriate window.</span>
<span class="cm">     * @method _getWin</span>
<span class="cm">     * @private</span>
<span class="cm">     * @param {HTMLElement} element optional Target element.</span>
<span class="cm">     * @return {Object} The window for the given element or the default window. </span>
<span class="cm">     */</span>
    <span class="nx">_getWin</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDoc</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DEFAULT_VIEW</span><span class="p">]</span> <span class="o">||</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">PARENT_WINDOW</span><span class="p">]</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_batch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">arg3</span><span class="p">,</span> <span class="nx">etc</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fn</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fn</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">fn</span><span class="p">]</span> <span class="o">:</span> <span class="nx">fn</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">result</span><span class="p">,</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">node</span><span class="p">,</span>
            <span class="nx">ret</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span> <span class="o">&amp;&amp;</span> <span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">((</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">arg3</span><span class="p">,</span> <span class="nx">etc</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">result</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">=</span> <span class="p">[]);</span>
                    <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ret</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ret</span> <span class="o">:</span> <span class="nx">nodes</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">wrap</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">html</span><span class="p">),</span>
            <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">parent</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span> 
            <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">unwrap</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span>
            <span class="nx">lastChild</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">,</span>
            <span class="nx">next</span> <span class="o">=</span> <span class="nx">node</span><span class="p">,</span>
            <span class="nx">grandparent</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">grandparent</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">grandparent</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">while</span> <span class="p">(</span><span class="nx">node</span> <span class="o">!==</span> <span class="nx">lastChild</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">next</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>
                    <span class="nx">grandparent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">parent</span><span class="p">);</span>
                    <span class="nx">node</span> <span class="o">=</span> <span class="nx">next</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">grandparent</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">lastChild</span><span class="p">,</span> <span class="nx">parent</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">parent</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">generateID</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
            <span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span> 
        <span class="p">}</span>   

        <span class="k">return</span> <span class="nx">id</span><span class="p">;</span> 
    <span class="p">}</span>
<span class="p">};</span>


<span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">;</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;oop&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-attrs&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">documentElement</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
    <span class="nx">Y_DOM</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span>
    <span class="nx">TAG_NAME</span> <span class="o">=</span> <span class="s1">&#39;tagName&#39;</span><span class="p">,</span>
    <span class="nx">OWNER_DOCUMENT</span> <span class="o">=</span> <span class="s1">&#39;ownerDocument&#39;</span><span class="p">,</span>
    <span class="nx">EMPTY_STRING</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">addFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">add</span><span class="p">,</span>
    <span class="nx">testFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">test</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">,</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Returns the text content of the HTMLElement. </span>
<span class="cm">     * @method getText         </span>
<span class="cm">     * @param {HTMLElement} element The html element. </span>
<span class="cm">     * @return {String} The text content of the element (includes text of any descending elements).</span>
<span class="cm">     */</span>
    <span class="nx">getText</span><span class="o">:</span> <span class="p">(</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">ret</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">||</span> <span class="nx">element</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">;</span> <span class="c1">// might be a textNode</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">ret</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Sets the text content of the HTMLElement. </span>
<span class="cm">     * @method setText         </span>
<span class="cm">     * @param {HTMLElement} element The html element. </span>
<span class="cm">     * @param {String} content The content to add. </span>
<span class="cm">     */</span>
    <span class="nx">setText</span><span class="o">:</span> <span class="p">(</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">element</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;innerText&#39;</span> <span class="k">in</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">element</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;nodeValue&#39;</span> <span class="k">in</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">element</span><span class="p">.</span><span class="nx">nodeValue</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">CUSTOM_ATTRIBUTES</span><span class="o">:</span> <span class="p">(</span><span class="o">!</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">hasAttribute</span><span class="p">)</span> <span class="o">?</span> <span class="p">{</span> <span class="c1">// IE &lt; 8</span>
        <span class="s1">&#39;for&#39;</span><span class="o">:</span> <span class="s1">&#39;htmlFor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;className&#39;</span>
    <span class="p">}</span> <span class="o">:</span> <span class="p">{</span> <span class="c1">// w3c</span>
        <span class="s1">&#39;htmlFor&#39;</span><span class="o">:</span> <span class="s1">&#39;for&#39;</span><span class="p">,</span>
        <span class="s1">&#39;className&#39;</span><span class="o">:</span> <span class="s1">&#39;class&#39;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Provides a normalized attribute interface. </span>
<span class="cm">     * @method setAttribute</span>
<span class="cm">     * @param {HTMLElement} el The target element for the attribute.</span>
<span class="cm">     * @param {String} attr The attribute to set.</span>
<span class="cm">     * @param {String} val The value of the attribute.</span>
<span class="cm">     */</span>
    <span class="nx">setAttribute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">ieAttr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">attr</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">CUSTOM_ATTRIBUTES</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">||</span> <span class="nx">attr</span><span class="p">;</span>
            <span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">ieAttr</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;bad input to setAttribute&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;dom&#39;</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">},</span>


    <span class="cm">/**</span>
<span class="cm">     * Provides a normalized attribute interface. </span>
<span class="cm">     * @method getAttibute</span>
<span class="cm">     * @param {HTMLElement} el The target element for the attribute.</span>
<span class="cm">     * @param {String} attr The attribute to get.</span>
<span class="cm">     * @return {String} The current value of the attribute. </span>
<span class="cm">     */</span>
    <span class="nx">getAttribute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">ieAttr</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ieAttr</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ieAttr</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ieAttr</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">attr</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">CUSTOM_ATTRIBUTES</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">||</span> <span class="nx">attr</span><span class="p">;</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">ieAttr</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">// per DOM spec</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;bad input to getAttribute&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;dom&#39;</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">VALUE_SETTERS</span><span class="o">:</span> <span class="p">{},</span>

    <span class="nx">VALUE_GETTERS</span><span class="o">:</span> <span class="p">{},</span>

    <span class="nx">getValue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// TODO: return null?</span>
            <span class="nx">getter</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">[</span><span class="nx">TAG_NAME</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">getter</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">VALUE_GETTERS</span><span class="p">[</span><span class="nx">node</span><span class="p">[</span><span class="nx">TAG_NAME</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">getter</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">getter</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// workaround for IE8 JSON stringify bug</span>
        <span class="c1">// which converts empty string values to null</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">===</span> <span class="nx">EMPTY_STRING</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">EMPTY_STRING</span><span class="p">;</span> <span class="c1">// for real</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ret</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ret</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">setValue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">setter</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">[</span><span class="nx">TAG_NAME</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">setter</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">VALUE_SETTERS</span><span class="p">[</span><span class="nx">node</span><span class="p">[</span><span class="nx">TAG_NAME</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">setter</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">setter</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">creators</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">});</span>

<span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;value-set&#39;</span><span class="p">,</span> <span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;option&gt;1&lt;/option&gt;&lt;option&gt;2&lt;/option&gt;&#39;</span><span class="p">;</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;2&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;value-set&#39;</span><span class="p">,</span> <span class="s1">&#39;select&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">VALUE_SETTERS</span><span class="p">.</span><span class="nx">select</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">),</span> <span class="nx">option</span><span class="p">;</span>
                <span class="nx">option</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">];)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="o">===</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">option</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="c1">//Y_DOM.setAttribute(option, &#39;selected&#39;, &#39;selected&#39;);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">VALUE_GETTERS</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">button</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">value</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">VALUE_SETTERS</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// IE: node.value changes the button text, which should be handled via innerHTML</span>
    <span class="nx">button</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attr</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">].</span><span class="nx">createAttribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">setAttributeNode</span><span class="p">(</span><span class="nx">attr</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">attr</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>


<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">VALUE_GETTERS</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">option</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">specified</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">select</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
            <span class="nx">options</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// TODO: implement multipe select</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">multiple</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;multiple select normalization not implemented&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;DOM&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(</span><span class="nx">options</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-create&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">re_tag</span> <span class="o">=</span> <span class="sr">/&lt;([a-z]+)/i</span><span class="p">,</span>

    <span class="nx">Y_DOM</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span>

    <span class="nx">addFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">add</span><span class="p">,</span>
    <span class="nx">testFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span>

    <span class="nx">creators</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="nx">createFromDIV</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">),</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">div</span><span class="p">.</span><span class="nx">firstChild</span> <span class="o">||</span> <span class="nx">div</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">!==</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">re_tbody</span> <span class="o">=</span> <span class="sr">/(?:\/(?:thead|tfoot|tbody|caption|col|colgroup)&gt;)+\s*&lt;tbody/</span><span class="p">,</span>

    <span class="nx">TABLE_OPEN</span> <span class="o">=</span> <span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">,</span>
    <span class="nx">TABLE_CLOSE</span> <span class="o">=</span> <span class="s1">&#39;&lt;/table&gt;&#39;</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">_fragClones</span><span class="o">:</span> <span class="p">{},</span>

    <span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span> <span class="o">||</span> <span class="s1">&#39;div&#39;</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_fragClones</span><span class="p">[</span><span class="nx">tag</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">frag</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">frag</span> <span class="o">=</span> <span class="nx">frag</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">frag</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_fragClones</span><span class="p">[</span><span class="nx">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">frag</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">frag</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Creates a new dom node using the provided markup string. </span>
<span class="cm">     * @method create</span>
<span class="cm">     * @param {String} html The markup used to create the element</span>
<span class="cm">     * @param {HTMLDocument} doc An optional document context </span>
<span class="cm">     * @return {HTMLElement|DocumentFragment} returns a single HTMLElement </span>
<span class="cm">     * when creating one node, and a documentFragment when creating</span>
<span class="cm">     * multiple nodes.</span>
<span class="cm">     */</span>
    <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">html</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">html</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span> <span class="c1">// match IE which trims whitespace from innerHTML</span>

        <span class="p">}</span>

        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">re_tag</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">html</span><span class="p">),</span>
            <span class="nx">create</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_create</span><span class="p">,</span>
            <span class="nx">custom</span> <span class="o">=</span> <span class="nx">creators</span><span class="p">,</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">creator</span><span class="p">,</span>
            <span class="nx">tag</span><span class="p">,</span> <span class="nx">nodes</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">html</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// not undefined or null</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">creator</span> <span class="o">=</span> <span class="nx">custom</span><span class="p">[</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()];</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">creator</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">create</span> <span class="o">=</span> <span class="nx">creator</span><span class="p">;</span> 
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">tag</span> <span class="o">=</span> <span class="nx">creator</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">create</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">tag</span><span class="p">).</span><span class="nx">childNodes</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// return single node, breaking parentNode ref from &quot;fragment&quot;</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span> <span class="o">===</span> <span class="s1">&#39;yui3-big-dummy&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// using dummy node to preserve some attributes (e.g. OPTION not selected)</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ret</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nextSibling</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> 
                     <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_nl2frag</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// return multiple nodes as a fragment</span>
                 <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_nl2frag</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_nl2frag</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span> <span class="o">||</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">item</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ownerDocument</span><span class="p">;</span> 
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// convert live list to static array</span>
                <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span> 
            <span class="p">}</span>
        <span class="p">}</span> <span class="c1">// else inline with log for minification</span>
        <span class="k">else</span> <span class="p">{</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unable to convert &#39;</span> <span class="o">+</span> <span class="nx">nodes</span> <span class="o">+</span> <span class="s1">&#39; to fragment&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;dom&#39;</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Inserts content in a node at the given location </span>
<span class="cm">     * @method addHTML</span>
<span class="cm">     * @param {HTMLElement} node The node to insert into</span>
<span class="cm">     * @param {HTMLElement | Array | HTMLCollection} content The content to be inserted </span>
<span class="cm">     * @param {HTMLElement} where Where to insert the content</span>
<span class="cm">     * If no &quot;where&quot; is given, content is appended to the node</span>
<span class="cm">     * Possible values for &quot;where&quot;</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     * &lt;dt&gt;HTMLElement&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;The element to insert before&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;replace&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Replaces the existing HTML&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;before&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Inserts before the existing HTML&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;before&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Inserts content before the node&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;after&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Inserts content after the node&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     */</span>
    <span class="nx">addHTML</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">nodeParent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">item</span><span class="p">,</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">content</span><span class="p">,</span>
            <span class="nx">newNode</span><span class="p">;</span>
            

        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// not null or undefined (maybe 0)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// DOM node, just add it</span>
                <span class="nx">newNode</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">content</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">content</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">newNode</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">content</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// array or collection </span>
                <span class="nx">newNode</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">((</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">content</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">newNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span> <span class="c1">// append to fragment for insertion</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// insert regardless of relationship to node</span>
                <span class="nx">where</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">newNode</span><span class="p">,</span> <span class="nx">where</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">&#39;replace&#39;</span><span class="o">:</span>
                        <span class="k">while</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">node</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">newNode</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// allow empty content to clear node</span>
                            <span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newNode</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;before&#39;</span><span class="o">:</span>
                        <span class="nx">nodeParent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">newNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;after&#39;</span><span class="o">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IE errors if refNode is null</span>
                            <span class="nx">nodeParent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">newNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">nodeParent</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newNode</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newNode</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">newNode</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newNode</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;innerhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;tbody&gt;&lt;/tbody&gt;&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">===</span> <span class="s1">&#39;TBODY&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;innerhtml-div&#39;</span><span class="p">,</span> <span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">createFromDIV</span><span class="p">(</span><span class="s1">&#39;&lt;tr&gt;&lt;/tr&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;tr&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;innerhtml-div&#39;</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">createFromDIV</span><span class="p">(</span><span class="s1">&#39;&lt;script&gt;&lt;/script&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;innerhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// TODO: thead/tfoot with nested tbody</span>
        <span class="c1">// IE adds TBODY when creating TABLE elements (which may share this impl)</span>
    <span class="nx">creators</span><span class="p">.</span><span class="nx">tbody</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">TABLE_OPEN</span> <span class="o">+</span> <span class="nx">html</span> <span class="o">+</span> <span class="nx">TABLE_CLOSE</span><span class="p">,</span> <span class="nx">doc</span><span class="p">),</span>
            <span class="nx">tb</span> <span class="o">=</span> <span class="nx">frag</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">frag</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">tb</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">re_tbody</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">tb</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">tb</span><span class="p">);</span> <span class="c1">// strip extraneous tbody</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">frag</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;innerhtml-div&#39;</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">creators</span><span class="p">.</span><span class="nx">script</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>

        <span class="nx">frag</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">html</span><span class="p">;</span>
        <span class="nx">frag</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">frag</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">frag</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">creators</span><span class="p">.</span><span class="nx">link</span> <span class="o">=</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">script</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;innerhtml-div&#39;</span><span class="p">,</span> <span class="s1">&#39;tr&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">creators</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">option</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;&lt;select&gt;&lt;option class=&quot;yui3-big-dummy&quot; selected&gt;&lt;/option&gt;&#39;</span> <span class="o">+</span> <span class="nx">html</span> <span class="o">+</span> <span class="s1">&#39;&lt;/select&gt;&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">tr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;&lt;tbody&gt;&#39;</span> <span class="o">+</span> <span class="nx">html</span> <span class="o">+</span> <span class="s1">&#39;&lt;/tbody&gt;&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">td</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;&lt;tr&gt;&#39;</span> <span class="o">+</span> <span class="nx">html</span> <span class="o">+</span> <span class="s1">&#39;&lt;/tr&gt;&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
        <span class="p">},</span> 

        <span class="nx">col</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;&lt;colgroup&gt;&#39;</span> <span class="o">+</span> <span class="nx">html</span> <span class="o">+</span> <span class="s1">&#39;&lt;/colgroup&gt;&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
        <span class="p">},</span> 

        <span class="nx">tbody</span><span class="o">:</span> <span class="s1">&#39;table&#39;</span>
    <span class="p">});</span>

    <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">creators</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">legend</span><span class="o">:</span> <span class="s1">&#39;fieldset&#39;</span><span class="p">,</span>
        <span class="nx">th</span><span class="o">:</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">td</span><span class="p">,</span>
        <span class="nx">thead</span><span class="o">:</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">tbody</span><span class="p">,</span>
        <span class="nx">tfoot</span><span class="o">:</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">tbody</span><span class="p">,</span>
        <span class="nx">caption</span><span class="o">:</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">tbody</span><span class="p">,</span>
        <span class="nx">colgroup</span><span class="o">:</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">tbody</span><span class="p">,</span>
        <span class="nx">optgroup</span><span class="o">:</span> <span class="nx">creators</span><span class="p">.</span><span class="nx">option</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">creators</span> <span class="o">=</span> <span class="nx">creators</span><span class="p">;</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-class&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">addClass</span><span class="p">,</span> <span class="nx">hasClass</span><span class="p">,</span> <span class="nx">removeClass</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Determines whether a DOM element has the given className.</span>
<span class="cm">     * @method hasClass</span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {HTMLElement} element The DOM element. </span>
<span class="cm">     * @param {String} className the class name to search for</span>
<span class="cm">     * @return {Boolean} Whether or not the element has the given class. </span>
<span class="cm">     */</span>
    <span class="nx">hasClass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_getRegExp</span><span class="p">(</span><span class="s1">&#39;(?:^|\\s+)&#39;</span> <span class="o">+</span> <span class="nx">className</span> <span class="o">+</span> <span class="s1">&#39;(?:\\s+|$)&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Adds a class name to a given DOM element.</span>
<span class="cm">     * @method addClass         </span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {HTMLElement} element The DOM element. </span>
<span class="cm">     * @param {String} className the class name to add to the class attribute</span>
<span class="cm">     */</span>
    <span class="nx">addClass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// skip if already present </span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">trim</span><span class="p">([</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span><span class="p">,</span> <span class="nx">className</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes a class name from a given element.</span>
<span class="cm">     * @method removeClass         </span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {HTMLElement} element The DOM element. </span>
<span class="cm">     * @param {String} className the class name to remove from the class attribute</span>
<span class="cm">     */</span>
    <span class="nx">removeClass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">&amp;&amp;</span> <span class="nx">hasClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_getRegExp</span><span class="p">(</span><span class="s1">&#39;(?:^|\\s+)&#39;</span> <span class="o">+</span>
                            <span class="nx">className</span> <span class="o">+</span> <span class="s1">&#39;(?:\\s+|$)&#39;</span><span class="p">),</span> <span class="s1">&#39; &#39;</span><span class="p">));</span>

            <span class="k">if</span> <span class="p">(</span> <span class="nx">hasClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// in case of multiple adjacent</span>
                <span class="nx">removeClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>                 
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Replace a class with another class for a given element.</span>
<span class="cm">     * If no oldClassName is present, the newClassName is simply added.</span>
<span class="cm">     * @method replaceClass  </span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {HTMLElement} element The DOM element </span>
<span class="cm">     * @param {String} oldClassName the class name to be replaced</span>
<span class="cm">     * @param {String} newClassName the class name that will be replacing the old class name</span>
<span class="cm">     */</span>
    <span class="nx">replaceClass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">oldC</span><span class="p">,</span> <span class="nx">newC</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//Y.log(&#39;replaceClass replacing &#39; + oldC + &#39; with &#39; + newC, &#39;info&#39;, &#39;Node&#39;);</span>
        <span class="nx">removeClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">oldC</span><span class="p">);</span> <span class="c1">// remove first in case oldC === newC</span>
        <span class="nx">addClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">newC</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * If the className exists on the node it is removed, if it doesn&#39;t exist it is added.</span>
<span class="cm">     * @method toggleClass  </span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {HTMLElement} element The DOM element</span>
<span class="cm">     * @param {String} className the class name to be toggled</span>
<span class="cm">     * @param {Boolean} addClass optional boolean to indicate whether class</span>
<span class="cm">     * should be added or removed regardless of current state</span>
<span class="cm">     */</span>
    <span class="nx">toggleClass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">add</span> <span class="o">=</span> <span class="p">(</span><span class="nx">force</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">force</span> <span class="o">:</span>
                <span class="o">!</span><span class="p">(</span><span class="nx">hasClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">addClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">removeClass</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">className</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">hasClass</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">;</span>
<span class="nx">removeClass</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">;</span>
<span class="nx">addClass</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">addClass</span><span class="p">;</span>



<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-size&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Sets the width of the element to the given size, regardless</span>
<span class="cm">     * of box model, border, padding, etc.</span>
<span class="cm">     * @method setWidth</span>
<span class="cm">     * @param {HTMLElement} element The DOM element. </span>
<span class="cm">     * @param {String|Int} size The pixel height to size to</span>
<span class="cm">     */</span>

    <span class="nx">setWidth</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_setSize</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Sets the height of the element to the given size, regardless</span>
<span class="cm">     * of box model, border, padding, etc.</span>
<span class="cm">     * @method setHeight</span>
<span class="cm">     * @param {HTMLElement} element The DOM element. </span>
<span class="cm">     * @param {String|Int} size The pixel height to size to</span>
<span class="cm">     */</span>

    <span class="nx">setHeight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_setSize</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_setSize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="p">(</span><span class="nx">val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">val</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
        <span class="nx">size</span> <span class="o">=</span> <span class="p">(</span><span class="nx">prop</span> <span class="o">===</span> <span class="s1">&#39;height&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetHeight</span> <span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">size</span> <span class="o">&gt;</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">val</span> <span class="o">-</span> <span class="p">(</span><span class="nx">size</span> <span class="o">-</span> <span class="nx">val</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>




<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-attrs&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-class&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-create&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-size&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-style&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/** </span>
<span class="cm"> * Add style management functionality to DOM.</span>
<span class="cm"> * @module dom</span>
<span class="cm"> * @submodule dom-style</span>
<span class="cm"> * @for DOM</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">DOCUMENT_ELEMENT</span> <span class="o">=</span> <span class="s1">&#39;documentElement&#39;</span><span class="p">,</span>
    <span class="nx">DEFAULT_VIEW</span> <span class="o">=</span> <span class="s1">&#39;defaultView&#39;</span><span class="p">,</span>
    <span class="nx">OWNER_DOCUMENT</span> <span class="o">=</span> <span class="s1">&#39;ownerDocument&#39;</span><span class="p">,</span>
    <span class="nx">STYLE</span> <span class="o">=</span> <span class="s1">&#39;style&#39;</span><span class="p">,</span>
    <span class="nx">FLOAT</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span>
    <span class="nx">CSS_FLOAT</span> <span class="o">=</span> <span class="s1">&#39;cssFloat&#39;</span><span class="p">,</span>
    <span class="nx">STYLE_FLOAT</span> <span class="o">=</span> <span class="s1">&#39;styleFloat&#39;</span><span class="p">,</span>
    <span class="nx">TRANSPARENT</span> <span class="o">=</span> <span class="s1">&#39;transparent&#39;</span><span class="p">,</span>
    <span class="nx">GET_COMPUTED_STYLE</span> <span class="o">=</span> <span class="s1">&#39;getComputedStyle&#39;</span><span class="p">,</span>
    <span class="nx">GET_BOUNDING_CLIENT_RECT</span> <span class="o">=</span> <span class="s1">&#39;getBoundingClientRect&#39;</span><span class="p">,</span>

    <span class="nx">WINDOW</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
    <span class="nx">DOCUMENT</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span>
    <span class="nx">UNDEFINED</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">,</span>

    <span class="nx">Y_DOM</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span>

    <span class="nx">TRANSFORM</span> <span class="o">=</span> <span class="s1">&#39;transform&#39;</span><span class="p">,</span>
    <span class="nx">VENDOR_TRANSFORM</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;WebkitTransform&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MozTransform&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OTransform&#39;</span>
    <span class="p">],</span>

    <span class="nx">re_color</span> <span class="o">=</span> <span class="sr">/color$/i</span><span class="p">,</span>
    <span class="nx">re_unit</span> <span class="o">=</span> <span class="sr">/width|height|top|left|right|bottom|margin|padding/i</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VENDOR_TRANSFORM</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="k">in</span> <span class="nx">DOCUMENT</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">].</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">TRANSFORM</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">DEFAULT_UNIT</span><span class="o">:</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>

    <span class="nx">CUSTOM_STYLES</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">},</span>


    <span class="cm">/**</span>
<span class="cm">     * Sets a style property for a given element.</span>
<span class="cm">     * @method setStyle</span>
<span class="cm">     * @param {HTMLElement} An HTMLElement to apply the style to.</span>
<span class="cm">     * @param {String} att The style property to set. </span>
<span class="cm">     * @param {String|Number} val The value. </span>
<span class="cm">     */</span>
    <span class="nx">setStyle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">style</span> <span class="o">=</span> <span class="nx">style</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">CUSTOM_STYLES</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// normalize unsetting</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nx">re_unit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">att</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// number values may need a unit</span>
                <span class="nx">val</span> <span class="o">+=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">DEFAULT_UNIT</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">att</span> <span class="k">in</span> <span class="nx">CUSTOM_STYLES</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">].</span><span class="nx">set</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">].</span><span class="nx">set</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
                    <span class="k">return</span><span class="p">;</span> <span class="c1">// NOTE: return</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">att</span> <span class="o">=</span> <span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">att</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// unset inline styles</span>
                <span class="nx">att</span> <span class="o">=</span> <span class="s1">&#39;cssText&#39;</span><span class="p">;</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">style</span><span class="p">[</span><span class="nx">att</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span> 
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the current style value for the given property.</span>
<span class="cm">     * @method getStyle</span>
<span class="cm">     * @param {HTMLElement} An HTMLElement to get the style from.</span>
<span class="cm">     * @param {String} att The style property to get. </span>
<span class="cm">     */</span>
    <span class="nx">getStyle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">style</span> <span class="o">=</span> <span class="nx">style</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">CUSTOM_STYLES</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">,</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">att</span> <span class="k">in</span> <span class="nx">CUSTOM_STYLES</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">].</span><span class="nx">get</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span> <span class="c1">// NOTE: return</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">att</span> <span class="o">=</span> <span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">att</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">style</span><span class="p">[</span><span class="nx">att</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// TODO: is empty string sufficient?</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Sets multiple style properties.</span>
<span class="cm">     * @method setStyles</span>
<span class="cm">     * @param {HTMLElement} node An HTMLElement to apply the styles to. </span>
<span class="cm">     * @param {Object} hash An object literal of property:value pairs. </span>
<span class="cm">     */</span>
    <span class="nx">setStyles</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
        <span class="p">},</span> <span class="nx">Y_DOM</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the computed style for the given node.</span>
<span class="cm">     * @method getComputedStyle</span>
<span class="cm">     * @param {HTMLElement} An HTMLElement to get the style from.</span>
<span class="cm">     * @param {String} att The style property to get. </span>
<span class="cm">     * @return {String} The computed value of the style property. </span>
<span class="cm">     */</span>
    <span class="nx">getComputedStyle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">STYLE</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DEFAULT_VIEW</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DEFAULT_VIEW</span><span class="p">][</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DEFAULT_VIEW</span><span class="p">][</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="kc">null</span><span class="p">)[</span><span class="nx">att</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// normalize reserved word float alternatives (&quot;cssFloat&quot; or &quot;styleFloat&quot;)</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">DOCUMENT</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">][</span><span class="nx">STYLE</span><span class="p">][</span><span class="nx">CSS_FLOAT</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">UNDEFINED</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">FLOAT</span><span class="p">]</span> <span class="o">=</span> <span class="nx">CSS_FLOAT</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">DOCUMENT</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">][</span><span class="nx">STYLE</span><span class="p">][</span><span class="nx">STYLE_FLOAT</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">UNDEFINED</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">FLOAT</span><span class="p">]</span> <span class="o">=</span> <span class="nx">STYLE_FLOAT</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// fix opera computedStyle default color unit (convert to rgb)</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">opera</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">][</span><span class="nx">DEFAULT_VIEW</span><span class="p">],</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">view</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="nx">att</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">re_color</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">att</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">toRGB</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">};</span>

<span class="p">}</span>

<span class="c1">// safari converts transparent to rgba(), others use &quot;transparent&quot;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">webkit</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">][</span><span class="nx">DEFAULT_VIEW</span><span class="p">],</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">view</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="nx">att</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;rgba(0, 0, 0, 0)&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">TRANSPARENT</span><span class="p">;</span> 
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">};</span>

<span class="p">}</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_getAttrOffset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">),</span>
        <span class="nx">offsetParent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">,</span>
        <span class="nx">position</span><span class="p">,</span>
        <span class="nx">parentOffset</span><span class="p">,</span>
        <span class="nx">offset</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">position</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">position</span> <span class="o">===</span> <span class="s1">&#39;static&#39;</span> <span class="o">||</span> <span class="nx">position</span> <span class="o">===</span> <span class="s1">&#39;relative&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">offsetParent</span> <span class="o">&amp;&amp;</span> <span class="nx">offsetParent</span><span class="p">[</span><span class="nx">GET_BOUNDING_CLIENT_RECT</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">parentOffset</span> <span class="o">=</span> <span class="nx">offsetParent</span><span class="p">[</span><span class="nx">GET_BOUNDING_CLIENT_RECT</span><span class="p">]()[</span><span class="nx">attr</span><span class="p">];</span>
            <span class="nx">offset</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">GET_BOUNDING_CLIENT_RECT</span><span class="p">]()[</span><span class="nx">attr</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">===</span> <span class="s1">&#39;left&#39;</span> <span class="o">||</span> <span class="nx">attr</span> <span class="o">===</span> <span class="s1">&#39;top&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">offset</span> <span class="o">-</span> <span class="nx">parentOffset</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">parentOffset</span> <span class="o">-</span> <span class="nx">node</span><span class="p">[</span><span class="nx">GET_BOUNDING_CLIENT_RECT</span><span class="p">]()[</span><span class="nx">attr</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_getOffset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pos</span><span class="p">,</span>
        <span class="nx">xy</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pos</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">);</span>
        <span class="nx">xy</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">),</span>
            <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// in case of &#39;auto&#39;</span>
            <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// try inline</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// default to offset value</span>
                <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">===</span> <span class="s1">&#39;relative&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetLeft</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> 

        <span class="k">if</span> <span class="p">(</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// in case of &#39;auto&#39;</span>
            <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// try inline</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// default to offset value</span>
                <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">===</span> <span class="s1">&#39;relative&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetTop</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> 
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">xy</span><span class="p">;</span>

<span class="p">};</span>

<span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">style</span><span class="p">[</span><span class="nx">TRANSFORM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="nx">TRANSFORM</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>


<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">var</span> <span class="nx">PARSE_INT</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">,</span>
    <span class="nx">RE</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">KEYWORDS</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">black</span><span class="o">:</span> <span class="s1">&#39;000&#39;</span><span class="p">,</span>
        <span class="nx">silver</span><span class="o">:</span> <span class="s1">&#39;c0c0c0&#39;</span><span class="p">,</span>
        <span class="nx">gray</span><span class="o">:</span> <span class="s1">&#39;808080&#39;</span><span class="p">,</span>
        <span class="nx">white</span><span class="o">:</span> <span class="s1">&#39;fff&#39;</span><span class="p">,</span>
        <span class="nx">maroon</span><span class="o">:</span> <span class="s1">&#39;800000&#39;</span><span class="p">,</span>
        <span class="nx">red</span><span class="o">:</span> <span class="s1">&#39;f00&#39;</span><span class="p">,</span>
        <span class="nx">purple</span><span class="o">:</span> <span class="s1">&#39;800080&#39;</span><span class="p">,</span>
        <span class="nx">fuchsia</span><span class="o">:</span> <span class="s1">&#39;f0f&#39;</span><span class="p">,</span>
        <span class="nx">green</span><span class="o">:</span> <span class="s1">&#39;008000&#39;</span><span class="p">,</span>
        <span class="nx">lime</span><span class="o">:</span> <span class="s1">&#39;0f0&#39;</span><span class="p">,</span>
        <span class="nx">olive</span><span class="o">:</span> <span class="s1">&#39;808000&#39;</span><span class="p">,</span>
        <span class="nx">yellow</span><span class="o">:</span> <span class="s1">&#39;ff0&#39;</span><span class="p">,</span>
        <span class="nx">navy</span><span class="o">:</span> <span class="s1">&#39;000080&#39;</span><span class="p">,</span>
        <span class="nx">blue</span><span class="o">:</span> <span class="s1">&#39;00f&#39;</span><span class="p">,</span>
        <span class="nx">teal</span><span class="o">:</span> <span class="s1">&#39;008080&#39;</span><span class="p">,</span>
        <span class="nx">aqua</span><span class="o">:</span> <span class="s1">&#39;0ff&#39;</span>
    <span class="p">},</span>

    <span class="nx">re_RGB</span><span class="o">:</span> <span class="sr">/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i</span><span class="p">,</span>
    <span class="nx">re_hex</span><span class="o">:</span> <span class="sr">/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i</span><span class="p">,</span>
    <span class="nx">re_hex3</span><span class="o">:</span> <span class="sr">/([0-9A-F])/gi</span><span class="p">,</span>

    <span class="nx">toRGB</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">re_RGB</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">toHex</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">re_hex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;rgb(&#39;</span> <span class="o">+</span> <span class="p">[</span>
                <span class="nx">PARSE_INT</span><span class="p">(</span><span class="nx">RE</span><span class="p">.</span><span class="nx">$1</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                <span class="nx">PARSE_INT</span><span class="p">(</span><span class="nx">RE</span><span class="p">.</span><span class="nx">$2</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                <span class="nx">PARSE_INT</span><span class="p">(</span><span class="nx">RE</span><span class="p">.</span><span class="nx">$3</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">toHex</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">KEYWORDS</span><span class="p">[</span><span class="nx">val</span><span class="p">]</span> <span class="o">||</span> <span class="nx">val</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">re_RGB</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">Number</span><span class="p">(</span><span class="nx">RE</span><span class="p">.</span><span class="nx">$1</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
                <span class="nb">Number</span><span class="p">(</span><span class="nx">RE</span><span class="p">.</span><span class="nx">$2</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
                <span class="nb">Number</span><span class="p">(</span><span class="nx">RE</span><span class="p">.</span><span class="nx">$3</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
            <span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">val</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">val</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nx">val</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">re_hex3</span><span class="p">,</span> <span class="s1">&#39;$1$1&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">!==</span> <span class="s1">&#39;transparent&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">val</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>



<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-screen&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Adds position and region management functionality to DOM.</span>
<span class="cm"> * @module dom</span>
<span class="cm"> * @submodule dom-screen</span>
<span class="cm"> * @for DOM</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">DOCUMENT_ELEMENT</span> <span class="o">=</span> <span class="s1">&#39;documentElement&#39;</span><span class="p">,</span>
    <span class="nx">COMPAT_MODE</span> <span class="o">=</span> <span class="s1">&#39;compatMode&#39;</span><span class="p">,</span>
    <span class="nx">POSITION</span> <span class="o">=</span> <span class="s1">&#39;position&#39;</span><span class="p">,</span>
    <span class="nx">FIXED</span> <span class="o">=</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
    <span class="nx">RELATIVE</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span><span class="p">,</span>
    <span class="nx">LEFT</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="nx">TOP</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">_BACK_COMPAT</span> <span class="o">=</span> <span class="s1">&#39;BackCompat&#39;</span><span class="p">,</span>
    <span class="nx">MEDIUM</span> <span class="o">=</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span>
    <span class="nx">BORDER_LEFT_WIDTH</span> <span class="o">=</span> <span class="s1">&#39;borderLeftWidth&#39;</span><span class="p">,</span>
    <span class="nx">BORDER_TOP_WIDTH</span> <span class="o">=</span> <span class="s1">&#39;borderTopWidth&#39;</span><span class="p">,</span>
    <span class="nx">GET_BOUNDING_CLIENT_RECT</span> <span class="o">=</span> <span class="s1">&#39;getBoundingClientRect&#39;</span><span class="p">,</span>
    <span class="nx">GET_COMPUTED_STYLE</span> <span class="o">=</span> <span class="s1">&#39;getComputedStyle&#39;</span><span class="p">,</span>

    <span class="nx">Y_DOM</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span>

    <span class="c1">// TODO: how about thead/tbody/tfoot/tr?</span>
    <span class="c1">// TODO: does caption matter?</span>
    <span class="nx">RE_TABLE</span> <span class="o">=</span> <span class="sr">/^t(?:able|d|h)$/i</span><span class="p">,</span>

    <span class="nx">SCROLL_NODE</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">[</span><span class="nx">COMPAT_MODE</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;BackCompat&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">SCROLL_NODE</span> <span class="o">=</span> <span class="nx">DOCUMENT_ELEMENT</span><span class="p">;</span> 
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">SCROLL_NODE</span> <span class="o">=</span> <span class="s1">&#39;body&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">,</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Returns the inner height of the viewport (exludes scrollbar). </span>
<span class="cm">     * @method winHeight</span>
<span class="cm">     * @return {Number} The current height of the viewport.</span>
<span class="cm">     */</span>
    <span class="nx">winHeight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getWinSize</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">height</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;winHeight returning &#39;</span> <span class="o">+</span> <span class="nx">h</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">h</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the inner width of the viewport (exludes scrollbar). </span>
<span class="cm">     * @method winWidth</span>
<span class="cm">     * @return {Number} The current width of the viewport.</span>
<span class="cm">     */</span>
    <span class="nx">winWidth</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getWinSize</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">width</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;winWidth returning &#39;</span> <span class="o">+</span> <span class="nx">w</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">w</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Document height </span>
<span class="cm">     * @method docHeight</span>
<span class="cm">     * @return {Number} The current height of the document.</span>
<span class="cm">     */</span>
    <span class="nx">docHeight</span><span class="o">:</span>  <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDocSize</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">height</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;docHeight returning &#39;</span> <span class="o">+</span> <span class="nx">h</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getWinSize</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">height</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Document width </span>
<span class="cm">     * @method docWidth</span>
<span class="cm">     * @return {Number} The current width of the document.</span>
<span class="cm">     */</span>
    <span class="nx">docWidth</span><span class="o">:</span>  <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDocSize</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">width</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;docWidth returning &#39;</span> <span class="o">+</span> <span class="nx">w</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getWinSize</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">width</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Amount page has been scroll horizontally </span>
<span class="cm">     * @method docScrollX</span>
<span class="cm">     * @return {Number} The current amount the screen is scrolled horizontally.</span>
<span class="cm">     */</span>
    <span class="nx">docScrollX</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDoc</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span> <span class="c1">// perf optimization</span>
        <span class="kd">var</span> <span class="nx">dv</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">,</span>
            <span class="nx">pageOffset</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dv</span><span class="p">)</span> <span class="o">?</span> <span class="nx">dv</span><span class="p">.</span><span class="nx">pageXOffset</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">].</span><span class="nx">scrollLeft</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">,</span> <span class="nx">pageOffset</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Amount page has been scroll vertically </span>
<span class="cm">     * @method docScrollY</span>
<span class="cm">     * @return {Number} The current amount the screen is scrolled vertically.</span>
<span class="cm">     */</span>
    <span class="nx">docScrollY</span><span class="o">:</span>  <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDoc</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span> <span class="c1">// perf optimization</span>
        <span class="kd">var</span> <span class="nx">dv</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">,</span>
            <span class="nx">pageOffset</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dv</span><span class="p">)</span> <span class="o">?</span> <span class="nx">dv</span><span class="p">.</span><span class="nx">pageYOffset</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">].</span><span class="nx">scrollTop</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">,</span> <span class="nx">pageOffset</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Gets the current position of an element based on page coordinates. </span>
<span class="cm">     * Element must be part of the DOM tree to have page coordinates</span>
<span class="cm">     * (display:none or elements not appended return false).</span>
<span class="cm">     * @method getXY</span>
<span class="cm">     * @param element The target element</span>
<span class="cm">     * @return {Array} The XY position of the element</span>

<span class="cm">     TODO: test inDocument/display?</span>
<span class="cm">     */</span>
    <span class="nx">getXY</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">][</span><span class="nx">GET_BOUNDING_CLIENT_RECT</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">xy</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
                    <span class="nx">scrollLeft</span><span class="p">,</span>
                    <span class="nx">scrollTop</span><span class="p">,</span>
                    <span class="nx">box</span><span class="p">,</span>
                    <span class="nx">off1</span><span class="p">,</span> <span class="nx">off2</span><span class="p">,</span>
                    <span class="nx">bLeft</span><span class="p">,</span> <span class="nx">bTop</span><span class="p">,</span>
                    <span class="nx">mode</span><span class="p">,</span>
                    <span class="nx">doc</span><span class="p">,</span>
                    <span class="nx">inDoc</span><span class="p">,</span>
                    <span class="nx">rootNode</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">doc</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">;</span>
                    <span class="nx">rootNode</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">];</span>

                    <span class="c1">// inline inDoc check for perf</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">rootNode</span><span class="p">.</span><span class="nx">contains</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">inDoc</span> <span class="o">=</span> <span class="nx">rootNode</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span> 
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">inDoc</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">rootNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">inDoc</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">scrollLeft</span> <span class="o">=</span> <span class="p">(</span><span class="nx">SCROLL_NODE</span><span class="p">)</span> <span class="o">?</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">SCROLL_NODE</span><span class="p">].</span><span class="nx">scrollLeft</span> <span class="o">:</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">docScrollX</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
                        <span class="nx">scrollTop</span> <span class="o">=</span> <span class="p">(</span><span class="nx">SCROLL_NODE</span><span class="p">)</span> <span class="o">?</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">SCROLL_NODE</span><span class="p">].</span><span class="nx">scrollTop</span> <span class="o">:</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">docScrollY</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
                        <span class="nx">box</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">GET_BOUNDING_CLIENT_RECT</span><span class="p">]();</span>
                        <span class="nx">xy</span> <span class="o">=</span> <span class="p">[</span><span class="nx">box</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">top</span><span class="p">];</span>

                            <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">off1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="nx">off2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="nx">mode</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">COMPAT_MODE</span><span class="p">];</span>
                                <span class="nx">bLeft</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">],</span> <span class="nx">BORDER_LEFT_WIDTH</span><span class="p">);</span>
                                <span class="nx">bTop</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">],</span> <span class="nx">BORDER_TOP_WIDTH</span><span class="p">);</span>

                                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">===</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">!==</span> <span class="nx">_BACK_COMPAT</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="nx">off1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                                        <span class="nx">off2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                                
                                <span class="k">if</span> <span class="p">((</span><span class="nx">mode</span> <span class="o">==</span> <span class="nx">_BACK_COMPAT</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">bLeft</span> <span class="o">!==</span> <span class="nx">MEDIUM</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="nx">off1</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">bLeft</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
                                    <span class="p">}</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">bTop</span> <span class="o">!==</span> <span class="nx">MEDIUM</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="nx">off2</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">bTop</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                                
                                <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">off1</span><span class="p">;</span>
                                <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">off2</span><span class="p">;</span>

                            <span class="p">}</span>

                        <span class="k">if</span> <span class="p">((</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="nx">scrollLeft</span><span class="p">))</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ios</span> <span class="o">||</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ios</span> <span class="o">&gt;=</span> <span class="mf">4.2</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">scrollLeft</span><span class="p">;</span>
                                <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">scrollTop</span><span class="p">;</span>
                            <span class="p">}</span>
                            
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">xy</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getOffset</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>       
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">xy</span><span class="p">;</span>                   
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// manually calculate by crawling up offsetParents</span>
                <span class="c1">//Calculate the Top and Left border sizes (assumes pixels)</span>
                <span class="kd">var</span> <span class="nx">xy</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
                    <span class="nx">doc</span><span class="p">,</span>
                    <span class="nx">parentNode</span><span class="p">,</span>
                    <span class="nx">bCheck</span><span class="p">,</span>
                    <span class="nx">scrollTop</span><span class="p">,</span>
                    <span class="nx">scrollLeft</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">inDoc</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">xy</span> <span class="o">=</span> <span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">offsetLeft</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">];</span>
                        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">;</span>
                        <span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
                        <span class="c1">// TODO: refactor with !! or just falsey</span>
                        <span class="nx">bCheck</span> <span class="o">=</span> <span class="p">((</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">gecko</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">webkit</span> <span class="o">&gt;</span> <span class="mi">519</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">);</span>

                        <span class="c1">// TODO: worth refactoring for TOP/LEFT only?</span>
                        <span class="k">while</span> <span class="p">((</span><span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">offsetLeft</span><span class="p">;</span>
                            <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">bCheck</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">xy</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_calcBorders</span><span class="p">(</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">xy</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="c1">// account for any scrolled ancestors</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">POSITION</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">FIXED</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>

                            <span class="k">while</span> <span class="p">((</span><span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
                                <span class="nx">scrollLeft</span> <span class="o">=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">;</span>

                                <span class="c1">//Firefox does something funky with borders when overflow is not visible.</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">gecko</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">parentNode</span><span class="p">,</span> <span class="s1">&#39;overflow&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;visible&#39;</span><span class="p">))</span> <span class="p">{</span>
                                        <span class="nx">xy</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_calcBorders</span><span class="p">(</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">xy</span><span class="p">);</span>
                                <span class="p">}</span>
                                

                                <span class="k">if</span> <span class="p">(</span><span class="nx">scrollTop</span> <span class="o">||</span> <span class="nx">scrollLeft</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">scrollLeft</span><span class="p">;</span>
                                    <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">scrollTop</span><span class="p">;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                            <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">docScrollX</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
                            <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">docScrollY</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>

                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="c1">//Fix FIXED position -- add scrollbars</span>
                            <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">docScrollX</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
                            <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">docScrollY</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">xy</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getOffset</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="nx">xy</span><span class="p">;</span>                
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}(),</span><span class="c1">// NOTE: Executing for loadtime branching</span>

    <span class="cm">/**</span>
<span class="cm">     * Gets the current X position of an element based on page coordinates. </span>
<span class="cm">     * Element must be part of the DOM tree to have page coordinates</span>
<span class="cm">     * (display:none or elements not appended return false).</span>
<span class="cm">     * @method getX</span>
<span class="cm">     * @param element The target element</span>
<span class="cm">     * @return {Int} The X position of the element</span>
<span class="cm">     */</span>

    <span class="nx">getX</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getXY</span><span class="p">(</span><span class="nx">node</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Gets the current Y position of an element based on page coordinates. </span>
<span class="cm">     * Element must be part of the DOM tree to have page coordinates</span>
<span class="cm">     * (display:none or elements not appended return false).</span>
<span class="cm">     * @method getY</span>
<span class="cm">     * @param element The target element</span>
<span class="cm">     * @return {Int} The Y position of the element</span>
<span class="cm">     */</span>

    <span class="nx">getY</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getXY</span><span class="p">(</span><span class="nx">node</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Set the position of an html element in page coordinates.</span>
<span class="cm">     * The element must be part of the DOM tree to have page coordinates (display:none or elements not appended return false).</span>
<span class="cm">     * @method setXY</span>
<span class="cm">     * @param element The target element</span>
<span class="cm">     * @param {Array} xy Contains X &amp; Y values for new position (coordinates are page-based)</span>
<span class="cm">     * @param {Boolean} noRetry By default we try and set the position a second time if the first fails</span>
<span class="cm">     */</span>
    <span class="nx">setXY</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">xy</span><span class="p">,</span> <span class="nx">noRetry</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">setStyle</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">,</span>
            <span class="nx">pos</span><span class="p">,</span>
            <span class="nx">delta</span><span class="p">,</span>
            <span class="nx">newXY</span><span class="p">,</span>
            <span class="nx">currentXY</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">xy</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pos</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">POSITION</span><span class="p">);</span>

            <span class="nx">delta</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getOffset</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>       
            <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// default to relative</span>
                <span class="nx">pos</span> <span class="o">=</span> <span class="nx">RELATIVE</span><span class="p">;</span>
                <span class="nx">setStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">POSITION</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">currentXY</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getXY</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">setStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">LEFT</span><span class="p">,</span> <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">currentXY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">setStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">TOP</span><span class="p">,</span> <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">currentXY</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">delta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">noRetry</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">newXY</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getXY</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newXY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nx">newXY</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setXY</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">xy</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> 
                <span class="p">}</span>
            <span class="p">}</span>
          
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;setXY setting position to &#39;</span> <span class="o">+</span> <span class="nx">xy</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;setXY failed to set &#39;</span> <span class="o">+</span> <span class="nx">node</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nx">xy</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Set the X position of an html element in page coordinates, regardless of how the element is positioned.</span>
<span class="cm">     * The element(s) must be part of the DOM tree to have page coordinates (display:none or elements not appended return false).</span>
<span class="cm">     * @method setX</span>
<span class="cm">     * @param element The target element</span>
<span class="cm">     * @param {Int} x The X values for new position (coordinates are page-based)</span>
<span class="cm">     */</span>
    <span class="nx">setX</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setXY</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="kc">null</span><span class="p">]);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Set the Y position of an html element in page coordinates, regardless of how the element is positioned.</span>
<span class="cm">     * The element(s) must be part of the DOM tree to have page coordinates (display:none or elements not appended return false).</span>
<span class="cm">     * @method setY</span>
<span class="cm">     * @param element The target element</span>
<span class="cm">     * @param {Int} y The Y values for new position (coordinates are page-based)</span>
<span class="cm">     */</span>
    <span class="nx">setY</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setXY</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">y</span><span class="p">]);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * @method swapXY</span>
<span class="cm">     * @description Swap the xy position with another node</span>
<span class="cm">     * @param {Node} node The node to swap with</span>
<span class="cm">     * @param {Node} otherNode The other node to swap with</span>
<span class="cm">     * @return {Node}</span>
<span class="cm">     */</span>
    <span class="nx">swapXY</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">otherNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xy</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getXY</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setXY</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getXY</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">));</span>
        <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setXY</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">,</span> <span class="nx">xy</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_calcBorders</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">xy2</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="nx">BORDER_TOP_WIDTH</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">](</span><span class="nx">node</span><span class="p">,</span> <span class="nx">BORDER_LEFT_WIDTH</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">gecko</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">RE_TABLE</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">xy2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">l</span><span class="p">;</span>
        <span class="nx">xy2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">t</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">xy2</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_getWinSize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doc</span>  <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDoc</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">defaultView</span> <span class="o">||</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">parentWindow</span><span class="p">,</span>
            <span class="nx">mode</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">COMPAT_MODE</span><span class="p">],</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span>
            <span class="nx">w</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span>
            <span class="nx">root</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">mode</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">opera</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// IE, Gecko</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">!=</span> <span class="s1">&#39;CSS1Compat&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Quirks</span>
                <span class="nx">root</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span> 
            <span class="p">}</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
            <span class="nx">w</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">w</span> <span class="p">};</span>
    <span class="p">},</span>

    <span class="nx">_getDocSize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">_getDoc</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span>
            <span class="nx">root</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">DOCUMENT_ELEMENT</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">[</span><span class="nx">COMPAT_MODE</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;CSS1Compat&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">root</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">root</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">root</span><span class="p">.</span><span class="nx">scrollWidth</span> <span class="p">};</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">var</span> <span class="nx">TOP</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">RIGHT</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
    <span class="nx">BOTTOM</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
    <span class="nx">LEFT</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>

    <span class="nx">getOffsets</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">r2</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">r1</span><span class="p">[</span><span class="nx">TOP</span><span class="p">],</span> <span class="nx">r2</span><span class="p">[</span><span class="nx">TOP</span><span class="p">]),</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">r1</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">],</span> <span class="nx">r2</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]),</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">r1</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">],</span> <span class="nx">r2</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]),</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">r1</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">],</span> <span class="nx">r2</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">]),</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
        
        <span class="nx">ret</span><span class="p">[</span><span class="nx">TOP</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
        <span class="nx">ret</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
        <span class="nx">ret</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">b</span><span class="p">;</span>
        <span class="nx">ret</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">DOM</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">DOM</span><span class="p">,</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Returns an Object literal containing the following about this element: (top, right, bottom, left)</span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @method region</span>
<span class="cm">     * @param {HTMLElement} element The DOM element. </span>
<span class="cm">     * @return {Object} Object literal containing the following about this element: (top, right, bottom, left)</span>
<span class="cm">     */</span>
    <span class="nx">region</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xy</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">getXY</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">xy</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">_getRegion</span><span class="p">(</span>
                <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="c1">// top</span>
                <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">,</span> <span class="c1">// right</span>
                <span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">,</span> <span class="c1">// bottom</span>
                <span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">// left</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Find the intersect information for the passes nodes.</span>
<span class="cm">     * @method intersect</span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {HTMLElement} element The first element </span>
<span class="cm">     * @param {HTMLElement | Object} element2 The element or region to check the interect with</span>
<span class="cm">     * @param {Object} altRegion An object literal containing the region for the first element if we already have the data (for performance i.e. DragDrop)</span>
<span class="cm">     * @return {Object} Object literal containing the following intersection data: (top, right, bottom, left, area, yoff, xoff, inRegion)</span>
<span class="cm">     */</span>
    <span class="nx">intersect</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">altRegion</span> <span class="o">||</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">region</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">region</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">n</span> <span class="o">=</span> <span class="nx">node2</span><span class="p">,</span>
            <span class="nx">off</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">region</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">region</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">node2</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">region</span> <span class="o">=</span> <span class="nx">node2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="nx">off</span> <span class="o">=</span> <span class="nx">getOffsets</span><span class="p">(</span><span class="nx">region</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">top</span><span class="o">:</span> <span class="nx">off</span><span class="p">[</span><span class="nx">TOP</span><span class="p">],</span>
            <span class="nx">right</span><span class="o">:</span> <span class="nx">off</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">],</span>
            <span class="nx">bottom</span><span class="o">:</span> <span class="nx">off</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">],</span>
            <span class="nx">left</span><span class="o">:</span> <span class="nx">off</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">],</span>
            <span class="nx">area</span><span class="o">:</span> <span class="p">((</span><span class="nx">off</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span> <span class="o">-</span> <span class="nx">off</span><span class="p">[</span><span class="nx">TOP</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="nx">off</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span> <span class="o">-</span> <span class="nx">off</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">])),</span>
            <span class="nx">yoff</span><span class="o">:</span> <span class="p">((</span><span class="nx">off</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span> <span class="o">-</span> <span class="nx">off</span><span class="p">[</span><span class="nx">TOP</span><span class="p">])),</span>
            <span class="nx">xoff</span><span class="o">:</span> <span class="p">(</span><span class="nx">off</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span> <span class="o">-</span> <span class="nx">off</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">]),</span>
            <span class="nx">inRegion</span><span class="o">:</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">inRegion</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">)</span>
        <span class="p">};</span>
        
    <span class="p">},</span>
    <span class="cm">/**</span>
<span class="cm">     * Check if any part of this node is in the passed region</span>
<span class="cm">     * @method inRegion</span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {Object} node2 The node to get the region from or an Object literal of the region</span>
<span class="cm">     * $param {Boolean} all Should all of the node be inside the region</span>
<span class="cm">     * @param {Object} altRegion An object literal containing the region for this node if we already have the data (for performance i.e. DragDrop)</span>
<span class="cm">     * @return {Boolean} True if in region, false if not.</span>
<span class="cm">     */</span>
    <span class="nx">inRegion</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">region</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">altRegion</span> <span class="o">||</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">region</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">n</span> <span class="o">=</span> <span class="nx">node2</span><span class="p">,</span>
            <span class="nx">off</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">region</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">region</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">node2</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">region</span> <span class="o">=</span> <span class="nx">node2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nx">r</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">]</span>   <span class="o">&gt;=</span> <span class="nx">region</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">]</span>   <span class="o">&amp;&amp;</span>
                <span class="nx">r</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span>  <span class="o">&lt;=</span> <span class="nx">region</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span>  <span class="o">&amp;&amp;</span> 
                <span class="nx">r</span><span class="p">[</span><span class="nx">TOP</span><span class="p">]</span>    <span class="o">&gt;=</span> <span class="nx">region</span><span class="p">[</span><span class="nx">TOP</span><span class="p">]</span>    <span class="o">&amp;&amp;</span> 
                <span class="nx">r</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">region</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span>  <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">off</span> <span class="o">=</span> <span class="nx">getOffsets</span><span class="p">(</span><span class="nx">region</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">off</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">off</span><span class="p">[</span><span class="nx">TOP</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">off</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">off</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Check if any part of this element is in the viewport</span>
<span class="cm">     * @method inViewportRegion</span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @param {HTMLElement} element The DOM element. </span>
<span class="cm">     * @param {Boolean} all Should all of the node be inside the region</span>
<span class="cm">     * @param {Object} altRegion An object literal containing the region for this node if we already have the data (for performance i.e. DragDrop)</span>
<span class="cm">     * @return {Boolean} True if in region, false if not.</span>
<span class="cm">     */</span>
    <span class="nx">inViewportRegion</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">inRegion</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">viewportRegion</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">);</span>
            
    <span class="p">},</span>

    <span class="nx">_getRegion</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">region</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="nx">region</span><span class="p">[</span><span class="nx">TOP</span><span class="p">]</span> <span class="o">=</span> <span class="nx">region</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
        <span class="nx">region</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">]</span> <span class="o">=</span> <span class="nx">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span>
        <span class="nx">region</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">b</span><span class="p">;</span>
        <span class="nx">region</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
        <span class="nx">region</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">region</span><span class="p">[</span><span class="nx">RIGHT</span><span class="p">]</span> <span class="o">-</span> <span class="nx">region</span><span class="p">[</span><span class="nx">LEFT</span><span class="p">];</span>
        <span class="nx">region</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">region</span><span class="p">[</span><span class="nx">BOTTOM</span><span class="p">]</span> <span class="o">-</span> <span class="nx">region</span><span class="p">[</span><span class="nx">TOP</span><span class="p">];</span>

        <span class="k">return</span> <span class="nx">region</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns an Object literal containing the following about the visible region of viewport: (top, right, bottom, left)</span>
<span class="cm">     * @method viewportRegion</span>
<span class="cm">     * @for DOM</span>
<span class="cm">     * @return {Object} Object literal containing the following about the visible region of the viewport: (top, right, bottom, left)</span>
<span class="cm">     */</span>
    <span class="nx">viewportRegion</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">scrollX</span><span class="p">,</span>
            <span class="nx">scrollY</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">scrollX</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">docScrollX</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="nx">scrollY</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">docScrollY</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>

            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">_getRegion</span><span class="p">(</span><span class="nx">scrollY</span><span class="p">,</span> <span class="c1">// top</span>
                <span class="nx">DOM</span><span class="p">.</span><span class="nx">winWidth</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">+</span> <span class="nx">scrollX</span><span class="p">,</span> <span class="c1">// right</span>
                <span class="nx">scrollY</span> <span class="o">+</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">winHeight</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="c1">// bottom</span>
                <span class="nx">scrollX</span><span class="p">);</span> <span class="c1">// left</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-style&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;selector-native&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/**</span>
<span class="cm"> * The selector-native module provides support for native querySelector</span>
<span class="cm"> * @module dom</span>
<span class="cm"> * @submodule selector-native</span>
<span class="cm"> * @for Selector</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Provides support for using CSS selectors to query the DOM </span>
<span class="cm"> * @class Selector </span>
<span class="cm"> * @static</span>
<span class="cm"> * @for Selector</span>
<span class="cm"> */</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;Selector&#39;</span><span class="p">);</span> <span class="c1">// allow native module to standalone</span>

<span class="kd">var</span> <span class="nx">COMPARE_DOCUMENT_POSITION</span> <span class="o">=</span> <span class="s1">&#39;compareDocumentPosition&#39;</span><span class="p">,</span>
    <span class="nx">OWNER_DOCUMENT</span> <span class="o">=</span> <span class="s1">&#39;ownerDocument&#39;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">Selector</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">_foundCache</span><span class="o">:</span> <span class="p">[],</span>

    <span class="nx">useNative</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

    <span class="nx">_compare</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;sourceIndex&#39;</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">)</span> <span class="o">?</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">nodeA</span><span class="p">,</span> <span class="nx">nodeB</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">nodeA</span><span class="p">.</span><span class="nx">sourceIndex</span><span class="p">,</span>
                <span class="nx">b</span> <span class="o">=</span> <span class="nx">nodeB</span><span class="p">.</span><span class="nx">sourceIndex</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

        <span class="p">}</span> <span class="o">:</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">[</span><span class="nx">COMPARE_DOCUMENT_POSITION</span><span class="p">]</span> <span class="o">?</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">nodeA</span><span class="p">,</span> <span class="nx">nodeB</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">nodeA</span><span class="p">[</span><span class="nx">COMPARE_DOCUMENT_POSITION</span><span class="p">](</span><span class="nx">nodeB</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="o">:</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">nodeA</span><span class="p">,</span> <span class="nx">nodeB</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">rangeA</span><span class="p">,</span> <span class="nx">rangeB</span><span class="p">,</span> <span class="nx">compare</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">nodeA</span> <span class="o">&amp;&amp;</span> <span class="nx">nodeB</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">rangeA</span> <span class="o">=</span> <span class="nx">nodeA</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">].</span><span class="nx">createRange</span><span class="p">();</span>
                <span class="nx">rangeA</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="nx">nodeA</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="nx">rangeB</span> <span class="o">=</span> <span class="nx">nodeB</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">].</span><span class="nx">createRange</span><span class="p">();</span>
                <span class="nx">rangeB</span><span class="p">.</span><span class="nx">setStart</span><span class="p">(</span><span class="nx">nodeB</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="nx">compare</span> <span class="o">=</span> <span class="nx">rangeA</span><span class="p">.</span><span class="nx">compareBoundaryPoints</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">rangeB</span><span class="p">);</span> <span class="c1">// 1 === Range.START_TO_END</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">compare</span><span class="p">;</span>
        
    <span class="p">}),</span>

    <span class="nx">_sort</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">sort</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">nodes</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_compare</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">nodes</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_deDupe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">node</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]);)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">_found</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">[</span><span class="nx">ret</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">_found</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]);)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">_found</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s1">&#39;_found&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Retrieves a set of nodes based on a given CSS selector. </span>
<span class="cm">     * @method query</span>
<span class="cm">     *</span>
<span class="cm">     * @param {string} selector The CSS Selector to test the node against.</span>
<span class="cm">     * @param {HTMLElement} root optional An HTMLElement to start the query from. Defaults to Y.config.doc</span>
<span class="cm">     * @param {Boolean} firstOnly optional Whether or not to return only the first match.</span>
<span class="cm">     * @return {Array} An array of nodes that match the given selector.</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">query</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">firstOnly</span><span class="p">,</span> <span class="nx">skipNative</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">useNative</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">useNative</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">querySelector</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">skipNative</span><span class="p">),</span>
            <span class="nx">queries</span> <span class="o">=</span> <span class="p">[[</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">root</span><span class="p">]],</span>
            <span class="nx">query</span><span class="p">,</span>
            <span class="nx">result</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">,</span>
            <span class="nx">fn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">useNative</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_nativeQuery</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_bruteQuery</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span> <span class="o">&amp;&amp;</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// split group into seperate queries</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">skipNative</span> <span class="o">&amp;&amp;</span> <span class="c1">// already done if skipping</span>
                    <span class="p">(</span><span class="o">!</span><span class="nx">useNative</span> <span class="o">||</span> <span class="nx">root</span><span class="p">.</span><span class="nx">tagName</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// split native when element scoping is needed</span>
                <span class="nx">queries</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">.</span><span class="nx">_splitQueries</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="nx">query</span> <span class="o">=</span> <span class="nx">queries</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]);)</span> <span class="p">{</span>
                <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">query</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">query</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">firstOnly</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">firstOnly</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// coerce DOM Collection to Array</span>
                    <span class="nx">result</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ret</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// remove dupes and sort by doc order </span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">.</span><span class="nx">_sort</span><span class="p">(</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_deDupe</span><span class="p">(</span><span class="nx">ret</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;query: &#39;</span> <span class="o">+</span> <span class="nx">selector</span> <span class="o">+</span> <span class="s1">&#39; returning: &#39;</span> <span class="o">+</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Selector&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">firstOnly</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="kc">null</span><span class="p">)</span> <span class="o">:</span> <span class="nx">ret</span><span class="p">;</span>

    <span class="p">},</span>

    <span class="c1">// allows element scoped queries to begin with combinator</span>
    <span class="c1">// e.g. query(&#39;&gt; p&#39;, document.body) === query(&#39;body &gt; p&#39;)</span>
    <span class="nx">_splitQueries</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">groups</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
            <span class="nx">queries</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// enforce for element scoping</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">guid</span><span class="p">();</span>
                <span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;[id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot;] &#39;</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">groups</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">selector</span> <span class="o">=</span>  <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">groups</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">queries</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">node</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">queries</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_nativeQuery</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">one</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">webkit</span> <span class="o">&amp;&amp;</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;:checked&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">pseudos</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">pseudos</span><span class="p">.</span><span class="nx">checked</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// webkit (chrome, safari) fails to find &quot;selected&quot;</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">one</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// redo with skipNative true to try brute query</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">//Y.log(&#39;trying native query with: &#39; + selector, &#39;info&#39;, &#39;selector-native&#39;);</span>
            <span class="k">return</span> <span class="nx">root</span><span class="p">[</span><span class="s1">&#39;querySelector&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">one</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;All&#39;</span><span class="p">)](</span><span class="nx">selector</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// fallback to brute if available</span>
            <span class="c1">//Y.log(&#39;native query error; reverting to brute query with: &#39; + selector, &#39;info&#39;, &#39;selector-native&#39;);</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">one</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// redo with skipNative true</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">node</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span> <span class="o">&amp;&amp;</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]);)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">selector</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">ret</span><span class="p">[</span><span class="nx">ret</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;invalid filter input (nodes: &#39;</span> <span class="o">+</span> <span class="nx">nodes</span> <span class="o">+</span>
                    <span class="s1">&#39;, selector: &#39;</span> <span class="o">+</span> <span class="nx">selector</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;Selector&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">useFrag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">groups</span><span class="p">,</span>
            <span class="nx">parent</span><span class="p">,</span>
            <span class="nx">item</span><span class="p">,</span>
            <span class="nx">items</span><span class="p">,</span>
            <span class="nx">frag</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">group</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// only test HTMLElements</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">selector</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// test with function</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// test with query</span>
                <span class="c1">// we need a root if off-doc</span>
                <span class="nx">groups</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">inDoc</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">parent</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span> 
                        <span class="nx">root</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// only use frag when no parent to query</span>
                        <span class="nx">frag</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">].</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
                        <span class="nx">frag</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                        <span class="nx">root</span> <span class="o">=</span> <span class="nx">frag</span><span class="p">;</span>
                        <span class="nx">useFrag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">];</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">guid</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">groups</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]);)</span> <span class="p">{</span> <span class="c1">// TODO: off-dom test</span>
                    <span class="nx">group</span> <span class="o">+=</span> <span class="s1">&#39;[id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">;</span>
                    <span class="nx">items</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">group</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>

                    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">j</span><span class="o">++</span><span class="p">];)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">===</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">useFrag</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// cleanup</span>
                    <span class="nx">frag</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * A convenience function to emulate Y.Node&#39;s aNode.ancestor(selector).</span>
<span class="cm">     * @param {HTMLElement} element An HTMLElement to start the query from.</span>
<span class="cm">     * @param {String} selector The CSS selector to test the node against.</span>
<span class="cm">     * @return {HTMLElement} The ancestor node matching the selector, or null.</span>
<span class="cm">     * @param {Boolean} testSelf optional Whether or not to include the element in the scan </span>
<span class="cm">     * @static</span>
<span class="cm">     * @method ancestor</span>
<span class="cm">     */</span>
    <span class="nx">ancestor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">testSelf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">ancestor</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">selector</span><span class="p">);</span>
        <span class="p">},</span> <span class="nx">testSelf</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">,</span> <span class="nx">Selector</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;selector&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>




<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;selector-native&#39;</span><span class="p">]});</span>


<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">){},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">use</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-core&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-base&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-attrs&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-create&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-class&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-size&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-style&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">,</span> <span class="s1">&#39;selector-native&#39;</span><span class="p">,</span> <span class="s1">&#39;selector&#39;</span><span class="p">]});</span>

<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;event-custom-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Custom event engine, DOM event listener abstraction layer, synthetic DOM</span>
<span class="cm"> * events.</span>
<span class="cm"> * @module event-custom</span>
<span class="cm"> */</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">handles</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">plugins</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">};</span>


<span class="cm">/**</span>
<span class="cm"> * Custom event engine, DOM event listener abstraction layer, synthetic DOM</span>
<span class="cm"> * events.</span>
<span class="cm"> * @module event-custom</span>
<span class="cm"> * @submodule event-custom-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Allows for the insertion of methods that are executed before or after</span>
<span class="cm"> * a specified method</span>
<span class="cm"> * @class Do</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">DO_BEFORE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">DO_AFTER</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

<span class="nx">DO</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Cache of objects touched by the utility</span>
<span class="cm">     * @property objs</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">objs</span><span class="o">:</span> <span class="p">{},</span>

    <span class="cm">/**</span>
<span class="cm">     * &lt;p&gt;Execute the supplied method before the specified function.  Wrapping</span>
<span class="cm">     * function may optionally return an instance of the following classes to</span>
<span class="cm">     * further alter runtime behavior:&lt;/p&gt;</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     *     &lt;dt&gt;&lt;/code&gt;Y.Do.Halt(message, returnValue)&lt;/code&gt;&lt;/dt&gt;</span>
<span class="cm">     *         &lt;dd&gt;Immediatly stop execution and return</span>
<span class="cm">     *         &lt;code&gt;returnValue&lt;/code&gt;.  No other wrapping functions will be</span>
<span class="cm">     *         executed.&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;&lt;/code&gt;Y.Do.AlterArgs(message, newArgArray)&lt;/code&gt;&lt;/dt&gt;</span>
<span class="cm">     *         &lt;dd&gt;Replace the arguments that the original function will be</span>
<span class="cm">     *         called with.&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;&lt;/code&gt;Y.Do.Prevent(message)&lt;/code&gt;&lt;/dt&gt;</span>
<span class="cm">     *         &lt;dd&gt;Don&#39;t execute the wrapped function.  Other before phase</span>
<span class="cm">     *         wrappers will be executed.&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     *</span>
<span class="cm">     * @method before</span>
<span class="cm">     * @param fn {Function} the function to execute</span>
<span class="cm">     * @param obj the object hosting the method to displace</span>
<span class="cm">     * @param sFn {string} the name of the method to displace</span>
<span class="cm">     * @param c The execution context for fn</span>
<span class="cm">     * @param arg* {mixed} 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * when the event fires.</span>
<span class="cm">     * @return {string} handle for the subscription</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">before</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">sFn</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Y.log(&#39;Do before: &#39; + sFn, &#39;info&#39;, &#39;event&#39;);</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">a</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">c</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
            <span class="nx">f</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">rbind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_inject</span><span class="p">(</span><span class="nx">DO_BEFORE</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">sFn</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * &lt;p&gt;Execute the supplied method after the specified function.  Wrapping</span>
<span class="cm">     * function may optionally return an instance of the following classes to</span>
<span class="cm">     * further alter runtime behavior:&lt;/p&gt;</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     *     &lt;dt&gt;&lt;/code&gt;Y.Do.Halt(message, returnValue)&lt;/code&gt;&lt;/dt&gt;</span>
<span class="cm">     *         &lt;dd&gt;Immediatly stop execution and return</span>
<span class="cm">     *         &lt;code&gt;returnValue&lt;/code&gt;.  No other wrapping functions will be</span>
<span class="cm">     *         executed.&lt;/dd&gt;</span>
<span class="cm">     *     &lt;dt&gt;&lt;/code&gt;Y.Do.AlterReturn(message, returnValue)&lt;/code&gt;&lt;/dt&gt;</span>
<span class="cm">     *         &lt;dd&gt;Return &lt;code&gt;returnValue&lt;/code&gt; instead of the wrapped</span>
<span class="cm">     *         method&#39;s original return value.  This can be further altered by</span>
<span class="cm">     *         other after phase wrappers.&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     *</span>
<span class="cm">     * &lt;p&gt;The static properties &lt;code&gt;Y.Do.originalRetVal&lt;/code&gt; and</span>
<span class="cm">     * &lt;code&gt;Y.Do.currentRetVal&lt;/code&gt; will be populated for reference.&lt;/p&gt;</span>
<span class="cm">     *</span>
<span class="cm">     * @method after</span>
<span class="cm">     * @param fn {Function} the function to execute</span>
<span class="cm">     * @param obj the object hosting the method to displace</span>
<span class="cm">     * @param sFn {string} the name of the method to displace</span>
<span class="cm">     * @param c The execution context for fn</span>
<span class="cm">     * @param arg* {mixed} 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * @return {string} handle for the subscription</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">after</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">sFn</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">a</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">c</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
            <span class="nx">f</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">rbind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_inject</span><span class="p">(</span><span class="nx">DO_AFTER</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">sFn</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Execute the supplied method before or after the specified function.</span>
<span class="cm">     * Used by &lt;code&gt;before&lt;/code&gt; and &lt;code&gt;after&lt;/code&gt;.</span>
<span class="cm">     *</span>
<span class="cm">     * @method _inject</span>
<span class="cm">     * @param when {string} before or after</span>
<span class="cm">     * @param fn {Function} the function to execute</span>
<span class="cm">     * @param obj the object hosting the method to displace</span>
<span class="cm">     * @param sFn {string} the name of the method to displace</span>
<span class="cm">     * @param c The execution context for fn</span>
<span class="cm">     * @return {string} handle for the subscription</span>
<span class="cm">     * @private</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">_inject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">when</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">sFn</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// object id</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">obj</span><span class="p">),</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">sid</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">objs</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="c1">// create a map entry for the obj if it doesn&#39;t exist</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">objs</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>

        <span class="nx">o</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">objs</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">o</span><span class="p">[</span><span class="nx">sFn</span><span class="p">])</span> <span class="p">{</span>
            <span class="c1">// create a map entry for the method if it doesn&#39;t exist</span>
            <span class="nx">o</span><span class="p">[</span><span class="nx">sFn</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">.</span><span class="nx">Method</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">sFn</span><span class="p">);</span>

            <span class="c1">// re-route the method to our wrapper</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">sFn</span><span class="p">]</span> <span class="o">=</span>
                <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">o</span><span class="p">[</span><span class="nx">sFn</span><span class="p">].</span><span class="nx">exec</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">sFn</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">);</span>
                <span class="p">};</span>
        <span class="p">}</span>

        <span class="c1">// subscriber id</span>
        <span class="nx">sid</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">+</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="o">+</span> <span class="nx">sFn</span><span class="p">;</span>

        <span class="c1">// register the callback</span>
        <span class="nx">o</span><span class="p">[</span><span class="nx">sFn</span><span class="p">].</span><span class="nx">register</span><span class="p">(</span><span class="nx">sid</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">when</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">sFn</span><span class="p">],</span> <span class="nx">sid</span><span class="p">);</span>

    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Detach a before or after subscription.</span>
<span class="cm">     *</span>
<span class="cm">     * @method detach</span>
<span class="cm">     * @param handle {string} the subscription handle</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">detach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">handle</span><span class="p">.</span><span class="nx">detach</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">handle</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
        <span class="p">}</span>

    <span class="p">},</span>

    <span class="nx">_unload</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">me</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span> <span class="o">=</span> <span class="nx">DO</span><span class="p">;</span>

<span class="c1">//////////////////////////////////////////////////////////////////////////</span>

<span class="cm">/**</span>
<span class="cm"> * Contains the return value from the wrapped method, accessible</span>
<span class="cm"> * by &#39;after&#39; event listeners.</span>
<span class="cm"> *</span>
<span class="cm"> * @property Do.originalRetVal</span>
<span class="cm"> * @static</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Contains the current state of the return value, consumable by</span>
<span class="cm"> * &#39;after&#39; event listeners, and updated if an after subscriber</span>
<span class="cm"> * changes the return value generated by the wrapped function.</span>
<span class="cm"> *</span>
<span class="cm"> * @property Do.currentRetVal</span>
<span class="cm"> * @static</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> */</span>

<span class="c1">//////////////////////////////////////////////////////////////////////////</span>

<span class="cm">/**</span>
<span class="cm"> * Wrapper for a displaced method with aop enabled</span>
<span class="cm"> * @class Do.Method</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param obj The object to operate on</span>
<span class="cm"> * @param sFn The name of the method to displace</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">Method</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">sFn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">methodName</span> <span class="o">=</span> <span class="nx">sFn</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">sFn</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">before</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">after</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Register a aop subscriber</span>
<span class="cm"> * @method register</span>
<span class="cm"> * @param sid {string} the subscriber id</span>
<span class="cm"> * @param fn {Function} the function to execute</span>
<span class="cm"> * @param when {string} when to execute the function</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">Method</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sid</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">when</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">when</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">after</span><span class="p">[</span><span class="nx">sid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">before</span><span class="p">[</span><span class="nx">sid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Unregister a aop subscriber</span>
<span class="cm"> * @method delete</span>
<span class="cm"> * @param sid {string} the subscriber id</span>
<span class="cm"> * @param fn {Function} the function to execute</span>
<span class="cm"> * @param when {string} when to execute the function</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">Method</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_delete</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sid</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Y.log(&#39;Y.Do._delete: &#39; + sid, &#39;info&#39;, &#39;Event&#39;);</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">before</span><span class="p">[</span><span class="nx">sid</span><span class="p">];</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">after</span><span class="p">[</span><span class="nx">sid</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;Execute the wrapped method.  All arguments are passed into the wrapping</span>
<span class="cm"> * functions.  If any of the before wrappers return an instance of</span>
<span class="cm"> * &lt;code&gt;Y.Do.Halt&lt;/code&gt; or &lt;code&gt;Y.Do.Prevent&lt;/code&gt;, neither the wrapped</span>
<span class="cm"> * function nor any after phase subscribers will be executed.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;The return value will be the return value of the wrapped function or one</span>
<span class="cm"> * provided by a wrapper function via an instance of &lt;code&gt;Y.Do.Halt&lt;/code&gt; or</span>
<span class="cm"> * &lt;code&gt;Y.Do.AlterReturn&lt;/code&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * @method exec</span>
<span class="cm"> * @param arg* {any} Arguments are passed to the wrapping and wrapped functions</span>
<span class="cm"> * @return {any} Return value of wrapped function unless overwritten (see above)</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">Method</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">exec</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">newRet</span><span class="p">,</span>
        <span class="nx">bf</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">before</span><span class="p">,</span>
        <span class="nx">af</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">after</span><span class="p">,</span>
        <span class="nx">prevented</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// execute before</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">bf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">bf</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">bf</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nx">ret</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="nx">DO</span><span class="p">.</span><span class="nx">Halt</span><span class="o">:</span>
                        <span class="k">return</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">retVal</span><span class="p">;</span>
                    <span class="k">case</span> <span class="nx">DO</span><span class="p">.</span><span class="nx">AlterArgs</span><span class="o">:</span>
                        <span class="nx">args</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">newArgs</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="nx">DO</span><span class="p">.</span><span class="nx">Prevent</span><span class="o">:</span>
                        <span class="nx">prevented</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="o">:</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// execute method</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prevented</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">DO</span><span class="p">.</span><span class="nx">originalRetVal</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="nx">DO</span><span class="p">.</span><span class="nx">currentRetVal</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">;</span>

    <span class="c1">// execute after methods.</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">af</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">af</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">newRet</span> <span class="o">=</span> <span class="nx">af</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="c1">// Stop processing if a Halt object is returned</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">newRet</span> <span class="o">&amp;&amp;</span> <span class="nx">newRet</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nx">DO</span><span class="p">.</span><span class="nx">Halt</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">newRet</span><span class="p">.</span><span class="nx">retVal</span><span class="p">;</span>
            <span class="c1">// Check for a new return value</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">newRet</span> <span class="o">&amp;&amp;</span> <span class="nx">newRet</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nx">DO</span><span class="p">.</span><span class="nx">AlterReturn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">newRet</span><span class="p">.</span><span class="nx">newRetVal</span><span class="p">;</span>
                <span class="c1">// Update the static retval state</span>
                <span class="nx">DO</span><span class="p">.</span><span class="nx">currentRetVal</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">//////////////////////////////////////////////////////////////////////////</span>

<span class="cm">/**</span>
<span class="cm"> * Return an AlterArgs object when you want to change the arguments that</span>
<span class="cm"> * were passed into the function.  Useful for Do.before subscribers.  An</span>
<span class="cm"> * example would be a service that scrubs out illegal characters prior to</span>
<span class="cm"> * executing the core business logic.</span>
<span class="cm"> * @class Do.AlterArgs</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param msg {String} (optional) Explanation of the altered return value</span>
<span class="cm"> * @param newArgs {Array} Call parameters to be used for the original method</span>
<span class="cm"> *                        instead of the arguments originally passed in.</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">AlterArgs</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">newArgs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">newArgs</span> <span class="o">=</span> <span class="nx">newArgs</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Return an AlterReturn object when you want to change the result returned</span>
<span class="cm"> * from the core method to the caller.  Useful for Do.after subscribers.</span>
<span class="cm"> * @class Do.AlterReturn</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param msg {String} (optional) Explanation of the altered return value</span>
<span class="cm"> * @param newRetVal {any} Return value passed to code that invoked the wrapped</span>
<span class="cm"> *                      function.</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">AlterReturn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">newRetVal</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">newRetVal</span> <span class="o">=</span> <span class="nx">newRetVal</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Return a Halt object when you want to terminate the execution</span>
<span class="cm"> * of all subsequent subscribers as well as the wrapped method</span>
<span class="cm"> * if it has not exectued yet.  Useful for Do.before subscribers.</span>
<span class="cm"> * @class Do.Halt</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param msg {String} (optional) Explanation of why the termination was done</span>
<span class="cm"> * @param retVal {any} Return value passed to code that invoked the wrapped</span>
<span class="cm"> *                      function.</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">Halt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">retVal</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">retVal</span> <span class="o">=</span> <span class="nx">retVal</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Return a Prevent object when you want to prevent the wrapped function</span>
<span class="cm"> * from executing, but want the remaining listeners to execute.  Useful</span>
<span class="cm"> * for Do.before subscribers.</span>
<span class="cm"> * @class Do.Prevent</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param msg {String} (optional) Explanation of why the termination was done</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nx">Prevent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Return an Error object when you want to terminate the execution</span>
<span class="cm"> * of all subsequent method calls.</span>
<span class="cm"> * @class Do.Error</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param msg {String} (optional) Explanation of the altered return value</span>
<span class="cm"> * @param retVal {any} Return value passed to code that invoked the wrapped</span>
<span class="cm"> *                      function.</span>
<span class="cm"> * @deprecated use Y.Do.Halt or Y.Do.Prevent</span>
<span class="cm"> */</span>
<span class="nx">DO</span><span class="p">.</span><span class="nb">Error</span> <span class="o">=</span> <span class="nx">DO</span><span class="p">.</span><span class="nx">Halt</span><span class="p">;</span>


<span class="c1">//////////////////////////////////////////////////////////////////////////</span>

<span class="c1">// Y[&quot;Event&quot;] &amp;&amp; Y.Event.addListener(window, &quot;unload&quot;, Y.Do._unload, Y.Do);</span>


<span class="cm">/**</span>
<span class="cm"> * Custom event engine, DOM event listener abstraction layer, synthetic DOM</span>
<span class="cm"> * events.</span>
<span class="cm"> * @module event-custom</span>
<span class="cm"> * @submodule event-custom-base</span>
<span class="cm"> */</span>


<span class="c1">// var onsubscribeType = &quot;_event:onsub&quot;,</span>
<span class="kd">var</span> <span class="nx">AFTER</span> <span class="o">=</span> <span class="s1">&#39;after&#39;</span><span class="p">,</span>
    <span class="nx">CONFIGS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;broadcast&#39;</span><span class="p">,</span>
        <span class="s1">&#39;monitored&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bubbles&#39;</span><span class="p">,</span>
        <span class="s1">&#39;context&#39;</span><span class="p">,</span>
        <span class="s1">&#39;contextFn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;currentTarget&#39;</span><span class="p">,</span>
        <span class="s1">&#39;defaultFn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;defaultTargetOnly&#39;</span><span class="p">,</span>
        <span class="s1">&#39;details&#39;</span><span class="p">,</span>
        <span class="s1">&#39;emitFacade&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fireOnce&#39;</span><span class="p">,</span>
        <span class="s1">&#39;async&#39;</span><span class="p">,</span>
        <span class="s1">&#39;host&#39;</span><span class="p">,</span>
        <span class="s1">&#39;preventable&#39;</span><span class="p">,</span>
        <span class="s1">&#39;preventedFn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;queuable&#39;</span><span class="p">,</span>
        <span class="s1">&#39;silent&#39;</span><span class="p">,</span>
        <span class="s1">&#39;stoppedFn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;target&#39;</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span>
    <span class="p">],</span>

    <span class="nx">YUI3_SIGNATURE</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
    <span class="nx">YUI_LOG</span> <span class="o">=</span> <span class="s1">&#39;yui:log&#39;</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Return value from all subscribe operations</span>
<span class="cm"> * @class EventHandle</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param {CustomEvent} evt the custom event.</span>
<span class="cm"> * @param {Subscriber} sub the subscriber.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">sub</span><span class="p">)</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * The custom event</span>
<span class="cm">     * @type CustomEvent</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">evt</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * The subscriber object</span>
<span class="cm">     * @type Subscriber</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="nx">sub</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">batch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">c</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">evt</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">evt</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">h</span><span class="p">.</span><span class="nx">batch</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">c</span> <span class="o">||</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">f</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Detaches this subscriber</span>
<span class="cm">     * @method detach</span>
<span class="cm">     * @return {int} the number of detached listeners</span>
<span class="cm">     */</span>
    <span class="nx">detach</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">detached</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Y.log(&#39;EventHandle.detach: &#39; + this.sub, &#39;info&#39;, &#39;Event&#39;);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">evt</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">detached</span> <span class="o">+=</span> <span class="nx">evt</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">detach</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">evt</span><span class="p">.</span><span class="nx">_delete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sub</span><span class="p">);</span>
                <span class="nx">detached</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">detached</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Monitor the event state for the subscribed event.  The first parameter</span>
<span class="cm">     * is what should be monitored, the rest are the normal parameters when</span>
<span class="cm">     * subscribing to an event.</span>
<span class="cm">     * @method monitor</span>
<span class="cm">     * @param what {string} what to monitor (&#39;attach&#39;, &#39;detach&#39;, &#39;publish&#39;).</span>
<span class="cm">     * @return {EventHandle} return value from the monitor event subscription.</span>
<span class="cm">     */</span>
    <span class="nx">monitor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">what</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">monitor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * The CustomEvent class lets you define events for your application</span>
<span class="cm"> * that can be subscribed to by one or more independent component.</span>
<span class="cm"> *</span>
<span class="cm"> * @param {String} type The type of event, which is passed to the callback</span>
<span class="cm"> * when the event fires.</span>
<span class="cm"> * @param {object} o configuration object.</span>
<span class="cm"> * @class CustomEvent</span>
<span class="cm"> * @constructor</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">CustomEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// if (arguments.length &gt; 2) {</span>
<span class="c1">// this.log(&#39;CustomEvent context and silent are now in the config&#39;, &#39;warn&#39;, &#39;Event&#39;);</span>
    <span class="c1">// }</span>

    <span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * The type of event, returned to subscribers when the event fires</span>
<span class="cm">     * @property type</span>
<span class="cm">     * @type string</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * The context the the event will fire from by default.  Defaults to the YUI</span>
<span class="cm">     * instance.</span>
<span class="cm">     * @property context</span>
<span class="cm">     * @type object</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Monitor when an event is attached or detached.</span>
<span class="cm">     *</span>
<span class="cm">     * @property monitored</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     */</span>
    <span class="c1">// this.monitored = false;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">logSystem</span> <span class="o">=</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">YUI_LOG</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * If 0, this event does not broadcast.  If 1, the YUI instance is notified</span>
<span class="cm">     * every time this event fires.  If 2, the YUI instance and the YUI global</span>
<span class="cm">     * (if event is enabled on the global) are notified every time this event</span>
<span class="cm">     * fires.</span>
<span class="cm">     * @property broadcast</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>
    <span class="c1">// this.broadcast = 0;</span>

    <span class="cm">/**</span>
<span class="cm">     * By default all custom events are logged in the debug build, set silent</span>
<span class="cm">     * to true to disable debug outpu for this event.</span>
<span class="cm">     * @property silent</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">silent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">logSystem</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Specifies whether this event should be queued when the host is actively</span>
<span class="cm">     * processing an event.  This will effect exectution order of the callbacks</span>
<span class="cm">     * for the various events.</span>
<span class="cm">     * @property queuable</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default false</span>
<span class="cm">     */</span>
    <span class="c1">// this.queuable = false;</span>

    <span class="cm">/**</span>
<span class="cm">     * The subscribers to this event</span>
<span class="cm">     * @property subscribers</span>
<span class="cm">     * @type Subscriber {}</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * &#39;After&#39; subscribers</span>
<span class="cm">     * @property afters</span>
<span class="cm">     * @type Subscriber {}</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">afters</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/**</span>
<span class="cm">     * This event has fired if true</span>
<span class="cm">     *</span>
<span class="cm">     * @property fired</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default false;</span>
<span class="cm">     */</span>
    <span class="c1">// this.fired = false;</span>

    <span class="cm">/**</span>
<span class="cm">     * An array containing the arguments the custom event</span>
<span class="cm">     * was last fired with.</span>
<span class="cm">     * @property firedWith</span>
<span class="cm">     * @type Array</span>
<span class="cm">     */</span>
    <span class="c1">// this.firedWith;</span>

    <span class="cm">/**</span>
<span class="cm">     * This event should only fire one time if true, and if</span>
<span class="cm">     * it has fired, any new subscribers should be notified</span>
<span class="cm">     * immediately.</span>
<span class="cm">     *</span>
<span class="cm">     * @property fireOnce</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default false;</span>
<span class="cm">     */</span>
    <span class="c1">// this.fireOnce = false;</span>

    <span class="cm">/**</span>
<span class="cm">     * fireOnce listeners will fire syncronously unless async</span>
<span class="cm">     * is set to true</span>
<span class="cm">     * @property async</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default false</span>
<span class="cm">     */</span>
    <span class="c1">//this.async = false;</span>

    <span class="cm">/**</span>
<span class="cm">     * Flag for stopPropagation that is modified during fire()</span>
<span class="cm">     * 1 means to stop propagation to bubble targets.  2 means</span>
<span class="cm">     * to also stop additional subscribers on this target.</span>
<span class="cm">     * @property stopped</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>
    <span class="c1">// this.stopped = 0;</span>

    <span class="cm">/**</span>
<span class="cm">     * Flag for preventDefault that is modified during fire().</span>
<span class="cm">     * if it is not 0, the default behavior for this event</span>
<span class="cm">     * @property prevented</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>
    <span class="c1">// this.prevented = 0;</span>

    <span class="cm">/**</span>
<span class="cm">     * Specifies the host for this custom event.  This is used</span>
<span class="cm">     * to enable event bubbling</span>
<span class="cm">     * @property host</span>
<span class="cm">     * @type EventTarget</span>
<span class="cm">     */</span>
    <span class="c1">// this.host = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * The default function to execute after event listeners</span>
<span class="cm">     * have fire, but only if the default action was not</span>
<span class="cm">     * prevented.</span>
<span class="cm">     * @property defaultFn</span>
<span class="cm">     * @type Function</span>
<span class="cm">     */</span>
    <span class="c1">// this.defaultFn = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * The function to execute if a subscriber calls</span>
<span class="cm">     * stopPropagation or stopImmediatePropagation</span>
<span class="cm">     * @property stoppedFn</span>
<span class="cm">     * @type Function</span>
<span class="cm">     */</span>
    <span class="c1">// this.stoppedFn = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * The function to execute if a subscriber calls</span>
<span class="cm">     * preventDefault</span>
<span class="cm">     * @property preventedFn</span>
<span class="cm">     * @type Function</span>
<span class="cm">     */</span>
    <span class="c1">// this.preventedFn = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * Specifies whether or not this event&#39;s default function</span>
<span class="cm">     * can be cancelled by a subscriber by executing preventDefault()</span>
<span class="cm">     * on the event facade</span>
<span class="cm">     * @property preventable</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default true</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">preventable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Specifies whether or not a subscriber can stop the event propagation</span>
<span class="cm">     * via stopPropagation(), stopImmediatePropagation(), or halt()</span>
<span class="cm">     *</span>
<span class="cm">     * Events can only bubble if emitFacade is true.</span>
<span class="cm">     *</span>
<span class="cm">     * @property bubbles</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default true</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bubbles</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Supports multiple options for listener signatures in order to</span>
<span class="cm">     * port YUI 2 apps.</span>
<span class="cm">     * @property signature</span>
<span class="cm">     * @type int</span>
<span class="cm">     * @default 9</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">signature</span> <span class="o">=</span> <span class="nx">YUI3_SIGNATURE</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">subCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">afterCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// this.hasSubscribers = false;</span>

    <span class="c1">// this.hasAfters = false;</span>

    <span class="cm">/**</span>
<span class="cm">     * If set to true, the custom event will deliver an EventFacade object</span>
<span class="cm">     * that is similar to a DOM event object.</span>
<span class="cm">     * @property emitFacade</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @default false</span>
<span class="cm">     */</span>
    <span class="c1">// this.emitFacade = false;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">applyConfig</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="c1">// this.log(&quot;Creating &quot; + this.type);</span>

<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">hasSubs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">when</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subCount</span><span class="p">,</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">afterCount</span><span class="p">,</span> <span class="nx">sib</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sibling</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">sib</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">s</span> <span class="o">+=</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">subCount</span><span class="p">;</span>
            <span class="nx">a</span> <span class="o">+=</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">afterCount</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">when</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">when</span> <span class="o">==</span> <span class="s1">&#39;after&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">s</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span><span class="nx">s</span> <span class="o">+</span> <span class="nx">a</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Monitor the event state for the subscribed event.  The first parameter</span>
<span class="cm">     * is what should be monitored, the rest are the normal parameters when</span>
<span class="cm">     * subscribing to an event.</span>
<span class="cm">     * @method monitor</span>
<span class="cm">     * @param what {string} what to monitor (&#39;detach&#39;, &#39;attach&#39;, &#39;publish&#39;).</span>
<span class="cm">     * @return {EventHandle} return value from the monitor event subscription.</span>
<span class="cm">     */</span>
    <span class="nx">monitor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">what</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">monitored</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">what</span><span class="p">,</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">host</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Get all of the subscribers to this event and any sibling event</span>
<span class="cm">     * @method getSubs</span>
<span class="cm">     * @return {Array} first item is the on subscribers, second the after.</span>
<span class="cm">     */</span>
    <span class="nx">getSubs</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">),</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">afters</span><span class="p">),</span> <span class="nx">sib</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sibling</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">sib</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">);</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">afters</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[</span><span class="nx">s</span><span class="p">,</span> <span class="nx">a</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Apply configuration properties.  Only applies the CONFIG whitelist</span>
<span class="cm">     * @method applyConfig</span>
<span class="cm">     * @param o hash of properties to apply.</span>
<span class="cm">     * @param force {boolean} if true, properties that exist on the event</span>
<span class="cm">     * will be overwritten.</span>
<span class="cm">     */</span>
    <span class="nx">applyConfig</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">force</span><span class="p">,</span> <span class="nx">CONFIGS</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">when</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Invalid callback for CE: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Subscriber</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">when</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fireOnce</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">fired</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_notify</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">firedWith</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">firedWith</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">when</span> <span class="o">==</span> <span class="nx">AFTER</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">afters</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">s</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">afterCount</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">s</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">subCount</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>

    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Listen for this event</span>
<span class="cm">     * @method subscribe</span>
<span class="cm">     * @param {Function} fn The function to execute.</span>
<span class="cm">     * @return {EventHandle} Unsubscribe handle.</span>
<span class="cm">     * @deprecated use on.</span>
<span class="cm">     */</span>
    <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ce.subscribe deprecated, use &quot;on&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;deprecated&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_on</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Listen for this event</span>
<span class="cm">     * @method on</span>
<span class="cm">     * @param {Function} fn The function to execute.</span>
<span class="cm">     * @param {object} context optional execution context.</span>
<span class="cm">     * @param {mixed} arg* 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * when the event fires.</span>
<span class="cm">     * @return {EventHandle} An object with a detach method to detch the handler(s).</span>
<span class="cm">     */</span>
    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">host</span><span class="p">.</span><span class="nx">_monitor</span><span class="p">(</span><span class="s1">&#39;attach&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">args</span><span class="o">:</span> <span class="nx">arguments</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_on</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Listen for this event after the normal subscribers have been notified and</span>
<span class="cm">     * the default behavior has been applied.  If a normal subscriber prevents the</span>
<span class="cm">     * default behavior, it also prevents after listeners from firing.</span>
<span class="cm">     * @method after</span>
<span class="cm">     * @param {Function} fn The function to execute.</span>
<span class="cm">     * @param {object} context optional execution context.</span>
<span class="cm">     * @param {mixed} arg* 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * when the event fires.</span>
<span class="cm">     * @return {EventHandle} handle Unsubscribe handle.</span>
<span class="cm">     */</span>
    <span class="nx">after</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_on</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">AFTER</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Detach listeners.</span>
<span class="cm">     * @method detach</span>
<span class="cm">     * @param {Function} fn  The subscribed function to remove, if not supplied</span>
<span class="cm">     *                       all will be removed.</span>
<span class="cm">     * @param {Object}   context The context object passed to subscribe.</span>
<span class="cm">     * @return {int} returns the number of subscribers unsubscribed.</span>
<span class="cm">     */</span>
    <span class="nx">detach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// unsubscribe handle</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span> <span class="o">&amp;&amp;</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">detach</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span>
            <span class="nx">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">subs</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">afters</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">subs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">subs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">s</span> <span class="o">=</span> <span class="nx">subs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="nx">fn</span> <span class="o">===</span> <span class="nx">s</span><span class="p">.</span><span class="nx">fn</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">_delete</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
                    <span class="nx">found</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">found</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Detach listeners.</span>
<span class="cm">     * @method unsubscribe</span>
<span class="cm">     * @param {Function} fn  The subscribed function to remove, if not supplied</span>
<span class="cm">     *                       all will be removed.</span>
<span class="cm">     * @param {Object}   context The context object passed to subscribe.</span>
<span class="cm">     * @return {int|undefined} returns the number of subscribers unsubscribed.</span>
<span class="cm">     * @deprecated use detach.</span>
<span class="cm">     */</span>
    <span class="nx">unsubscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">detach</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Notify a single subscriber</span>
<span class="cm">     * @method _notify</span>
<span class="cm">     * @param {Subscriber} s the subscriber.</span>
<span class="cm">     * @param {Array} args the arguments array to apply to the listener.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_notify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ef</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;sub: &#39;</span> <span class="o">+</span> <span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">ret</span><span class="p">;</span>

        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">===</span> <span class="nx">ret</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39; cancelled by subscriber&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Logger abstraction to centralize the application of the silent flag</span>
<span class="cm">     * @method log</span>
<span class="cm">     * @param {string} msg message to log.</span>
<span class="cm">     * @param {string} cat log category.</span>
<span class="cm">     */</span>
    <span class="nx">log</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">cat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">cat</span> <span class="o">||</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Notifies the subscribers.  The callback functions will be executed</span>
<span class="cm">     * from the context specified when the event was created, and with the</span>
<span class="cm">     * following parameters:</span>
<span class="cm">     *   &lt;ul&gt;</span>
<span class="cm">     *   &lt;li&gt;The type of event&lt;/li&gt;</span>
<span class="cm">     *   &lt;li&gt;All of the arguments fire() was executed with as an array&lt;/li&gt;</span>
<span class="cm">     *   &lt;li&gt;The custom object (if any) that was passed into the subscribe()</span>
<span class="cm">     *       method&lt;/li&gt;</span>
<span class="cm">     *   &lt;/ul&gt;</span>
<span class="cm">     * @method fire</span>
<span class="cm">     * @param {Object*} arguments an arbitrary set of parameters to pass to</span>
<span class="cm">     *                            the handler.</span>
<span class="cm">     * @return {boolean} false if one of the subscribers returned false,</span>
<span class="cm">     *                   true otherwise.</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">fire</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fireOnce</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">fired</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;fireOnce event: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39; already fired&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

            <span class="c1">// this doesn&#39;t happen if the event isn&#39;t published</span>
            <span class="c1">// this.host._monitor(&#39;fire&#39;, this.type, args);</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">fired</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">firedWith</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">emitFacade</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fireComplex</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fireSimple</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">fireSimple</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">prevented</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasSubs</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// this._procSubs(Y.merge(this.subscribers, this.afters), args);</span>
            <span class="kd">var</span> <span class="nx">subs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSubs</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_procSubs</span><span class="p">(</span><span class="nx">subs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_procSubs</span><span class="p">(</span><span class="nx">subs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_broadcast</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="c1">// Requires the event-custom-complex module for full funcitonality.</span>
    <span class="nx">fireComplex</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Missing event-custom-complex needed to emit a facade for: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fireSimple</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_procSubs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subs</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ef</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">subs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">subs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">s</span> <span class="o">=</span> <span class="nx">subs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">&amp;&amp;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ef</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_broadcast</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
            <span class="nx">a</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">host</span> <span class="o">!==</span> <span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">broadcast</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Global</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Global</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes all listeners</span>
<span class="cm">     * @method unsubscribeAll</span>
<span class="cm">     * @return {int} The number of listeners unsubscribed.</span>
<span class="cm">     * @deprecated use detachAll.</span>
<span class="cm">     */</span>
    <span class="nx">unsubscribeAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">detachAll</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes all listeners</span>
<span class="cm">     * @method detachAll</span>
<span class="cm">     * @return {int} The number of listeners unsubscribed.</span>
<span class="cm">     */</span>
    <span class="nx">detachAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * @method _delete</span>
<span class="cm">     * @param subscriber object.</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_delete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">subCount</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">afters</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">afters</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">afterCount</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">host</span><span class="p">.</span><span class="nx">_monitor</span><span class="p">(</span><span class="s1">&#39;detach&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">ce</span><span class="o">:</span> <span class="k">this</span><span class="p">,</span>
                <span class="nx">sub</span><span class="o">:</span> <span class="nx">s</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// delete s.fn;</span>
            <span class="c1">// delete s.context;</span>
            <span class="nx">s</span><span class="p">.</span><span class="nx">deleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">/////////////////////////////////////////////////////////////////////</span>

<span class="cm">/**</span>
<span class="cm"> * Stores the subscriber information to be used when the event fires.</span>
<span class="cm"> * @param {Function} fn       The wrapped function to execute.</span>
<span class="cm"> * @param {Object}   context  The value of the keyword &#39;this&#39; in the listener.</span>
<span class="cm"> * @param {Array} args*       0..n additional arguments to supply the listener.</span>
<span class="cm"> *</span>
<span class="cm"> * @class Subscriber</span>
<span class="cm"> * @constructor</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Subscriber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * The callback that will be execute when the event fires</span>
<span class="cm">     * This is wrapped by Y.rbind if obj was supplied.</span>
<span class="cm">     * @property fn</span>
<span class="cm">     * @type Function</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fn</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Optional &#39;this&#39; keyword for the listener</span>
<span class="cm">     * @property context</span>
<span class="cm">     * @type Object</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Unique subscriber id</span>
<span class="cm">     * @property id</span>
<span class="cm">     * @type String</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Additional arguments to propagate to the subscriber</span>
<span class="cm">     * @property args</span>
<span class="cm">     * @type Array</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Custom events for a given fire transaction.</span>
<span class="cm">     * @property events</span>
<span class="cm">     * @type {EventTarget}</span>
<span class="cm">     */</span>
    <span class="c1">// this.events = null;</span>

    <span class="cm">/**</span>
<span class="cm">     * This listener only reacts to the event once</span>
<span class="cm">     * @property once</span>
<span class="cm">     */</span>
    <span class="c1">// this.once = false;</span>

<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Subscriber</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">_notify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">deleted</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">postponed</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">postponed</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">fn</span><span class="p">;</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">postponed</span><span class="p">;</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">args</span><span class="p">,</span> <span class="nx">ret</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">signature</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">||</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span> <span class="o">||</span> <span class="p">[];</span>
                    <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">?</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">:</span> <span class="nx">args</span><span class="p">;</span>
                    <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">once</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ce</span><span class="p">.</span><span class="nx">_delete</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Executes the subscriber.</span>
<span class="cm">     * @method notify</span>
<span class="cm">     * @param args {Array} Arguments array for the subscriber.</span>
<span class="cm">     * @param ce {CustomEvent} The custom event that sent the notification.</span>
<span class="cm">     */</span>
    <span class="nx">notify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">contextFn</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">contextFn</span><span class="p">()</span> <span class="o">:</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// only catch errors if we will not re-throw them.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">throwFail</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ce</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_notify</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ce</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="k">this</span> <span class="o">+</span> <span class="s1">&#39; failed: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns true if the fn and obj match this objects properties.</span>
<span class="cm">     * Used by the unsubscribe method to match the right subscriber.</span>
<span class="cm">     *</span>
<span class="cm">     * @method contains</span>
<span class="cm">     * @param {Function} fn the function to execute.</span>
<span class="cm">     * @param {Object} context optional &#39;this&#39; keyword for the listener.</span>
<span class="cm">     * @return {boolean} true if the supplied arguments match this</span>
<span class="cm">     *                   subscriber&#39;s signature.</span>
<span class="cm">     */</span>
    <span class="nx">contains</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">fn</span> <span class="o">==</span> <span class="nx">fn</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">==</span> <span class="nx">context</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fn</span> <span class="o">==</span> <span class="nx">fn</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Custom event engine, DOM event listener abstraction layer, synthetic DOM</span>
<span class="cm"> * events.</span>
<span class="cm"> * @module event-custom</span>
<span class="cm"> * @submodule event-custom-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * EventTarget provides the implementation for any object to</span>
<span class="cm"> * publish, subscribe and fire to custom events, and also</span>
<span class="cm"> * alows other EventTargets to target the object with events</span>
<span class="cm"> * sourced from the other object.</span>
<span class="cm"> * EventTarget is designed to be used with Y.augment to wrap</span>
<span class="cm"> * EventCustom in an interface that allows events to be listened to</span>
<span class="cm"> * and fired by name.  This makes it possible for implementing code to</span>
<span class="cm"> * subscribe to an event that either has not been created yet, or will</span>
<span class="cm"> * not be created at all.</span>
<span class="cm"> * @class EventTarget</span>
<span class="cm"> * @param opts a configuration object</span>
<span class="cm"> * @config emitFacade {boolean} if true, all events will emit event</span>
<span class="cm"> * facade payloads by default (default false)</span>
<span class="cm"> * @config prefix {string} the prefix to apply to non-prefixed event names</span>
<span class="cm"> * @config chain {boolean} if true, on/after/detach return the host to allow</span>
<span class="cm"> * chaining, otherwise they return an EventHandle (default false)</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">L</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">,</span>
    <span class="nx">PREFIX_DELIMITER</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="nx">CATEGORY_DELIMITER</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
    <span class="nx">AFTER_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;~AFTER~&#39;</span><span class="p">,</span>
    <span class="nx">YArray</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">,</span>

    <span class="nx">_wildType</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">cached</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(.*)(:)(.*)/</span><span class="p">,</span> <span class="s2">&quot;*$2$3&quot;</span><span class="p">);</span>
    <span class="p">}),</span>

    <span class="cm">/**</span>
<span class="cm">     * If the instance has a prefix attribute and the</span>
<span class="cm">     * event type is not prefixed, the instance prefix is</span>
<span class="cm">     * applied to the supplied type.</span>
<span class="cm">     * @method _getType</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_getType</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">cached</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">pre</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pre</span> <span class="o">||</span> <span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="o">||</span> <span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">PREFIX_DELIMITER</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">type</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">pre</span> <span class="o">+</span> <span class="nx">PREFIX_DELIMITER</span> <span class="o">+</span> <span class="nx">type</span><span class="p">;</span>
    <span class="p">}),</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns an array with the detach key (if provided),</span>
<span class="cm">     * and the prefixed event name from _getType</span>
<span class="cm">     * Y.on(&#39;detachcategory| menu:click&#39;, fn)</span>
<span class="cm">     * @method _parseType</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_parseType</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">cached</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">pre</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">detachcategory</span><span class="p">,</span> <span class="nx">after</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">t</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">i</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">AFTER_PREFIX</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">after</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">AFTER_PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
            <span class="c1">// Y.log(t);</span>
        <span class="p">}</span>

        <span class="nx">i</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">CATEGORY_DELIMITER</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">detachcategory</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">));</span>
            <span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">t</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">t</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// detach category, full type with instance prefix, is this an after listener, short type</span>
        <span class="k">return</span> <span class="p">[</span><span class="nx">detachcategory</span><span class="p">,</span> <span class="p">(</span><span class="nx">pre</span><span class="p">)</span> <span class="o">?</span> <span class="nx">_getType</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">pre</span><span class="p">)</span> <span class="o">:</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">after</span><span class="p">,</span> <span class="nx">t</span><span class="p">];</span>
    <span class="p">}),</span>

    <span class="nx">ET</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Y.log(&#39;EventTarget constructor executed: &#39; + this._yuid);</span>

        <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">opts</span><span class="p">))</span> <span class="o">?</span> <span class="nx">opts</span> <span class="o">:</span> <span class="p">{};</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span> <span class="o">||</span> <span class="p">{</span>

            <span class="nx">id</span><span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">guid</span><span class="p">(),</span>

            <span class="nx">events</span><span class="o">:</span> <span class="p">{},</span>

            <span class="nx">targets</span><span class="o">:</span> <span class="p">{},</span>

            <span class="nx">config</span><span class="o">:</span> <span class="nx">o</span><span class="p">,</span>

            <span class="nx">chain</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;chain&#39;</span> <span class="k">in</span> <span class="nx">o</span><span class="p">)</span> <span class="o">?</span> <span class="nx">o</span><span class="p">.</span><span class="nx">chain</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">chain</span><span class="p">,</span>

            <span class="nx">bubbling</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

            <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">context</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span>
                <span class="nx">host</span><span class="o">:</span> <span class="k">this</span><span class="p">,</span>
                <span class="nx">emitFacade</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">emitFacade</span><span class="p">,</span>
                <span class="nx">fireOnce</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">fireOnce</span><span class="p">,</span>
                <span class="nx">queuable</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">queuable</span><span class="p">,</span>
                <span class="nx">monitored</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">monitored</span><span class="p">,</span>
                <span class="nx">broadcast</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">,</span>
                <span class="nx">defaultTargetOnly</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">defaultTargetOnly</span><span class="p">,</span>
                <span class="nx">bubbles</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;bubbles&#39;</span> <span class="k">in</span> <span class="nx">o</span><span class="p">)</span> <span class="o">?</span> <span class="nx">o</span><span class="p">.</span><span class="nx">bubbles</span> <span class="o">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">};</span>

    <span class="p">};</span>


<span class="nx">ET</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Listen to a custom event hosted by this object one time.</span>
<span class="cm">     * This is the equivalent to &lt;code&gt;on&lt;/code&gt; except the</span>
<span class="cm">     * listener is immediatelly detached when it is executed.</span>
<span class="cm">     * @method once</span>
<span class="cm">     * @param type    {string}   The type of the event</span>
<span class="cm">     * @param fn {Function} The callback</span>
<span class="cm">     * @param context {object} optional execution context.</span>
<span class="cm">     * @param arg* {mixed} 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * @return the event target or a detach handle per &#39;chain&#39; config</span>
<span class="cm">     */</span>
    <span class="nx">once</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">handle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="nx">handle</span><span class="p">.</span><span class="nx">batch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">hand</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">hand</span><span class="p">.</span><span class="nx">sub</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">hand</span><span class="p">.</span><span class="nx">sub</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">handle</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Listen to a custom event hosted by this object one time.</span>
<span class="cm">     * This is the equivalent to &lt;code&gt;after&lt;/code&gt; except the</span>
<span class="cm">     * listener is immediatelly detached when it is executed.</span>
<span class="cm">     * @method onceAfter</span>
<span class="cm">     * @param type    {string}   The type of the event</span>
<span class="cm">     * @param fn {Function} The callback</span>
<span class="cm">     * @param context {object} optional execution context.</span>
<span class="cm">     * @param arg* {mixed} 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * @return the event target or a detach handle per &#39;chain&#39; config</span>
<span class="cm">     */</span>
    <span class="nx">onceAfter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">AFTER_PREFIX</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">once</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Takes the type parameter passed to &#39;on&#39; and parses out the</span>
<span class="cm">     * various pieces that could be included in the type.  If the</span>
<span class="cm">     * event type is passed without a prefix, it will be expanded</span>
<span class="cm">     * to include the prefix one is supplied or the event target</span>
<span class="cm">     * is configured with a default prefix.</span>
<span class="cm">     * @method parseType</span>
<span class="cm">     * @param {string} type the type</span>
<span class="cm">     * @param {string} [pre=this._yuievt.config.prefix] the prefix</span>
<span class="cm">     * @since 3.3.0</span>
<span class="cm">     * @return {Array} an array containing:</span>
<span class="cm">     *  * the detach category, if supplied,</span>
<span class="cm">     *  * the prefixed event type,</span>
<span class="cm">     *  * whether or not this is an after listener,</span>
<span class="cm">     *  * the supplied event type</span>
<span class="cm">     */</span>
    <span class="nx">parseType</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">pre</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_parseType</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">pre</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prefix</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Subscribe to a custom event hosted by this object</span>
<span class="cm">     * @method on</span>
<span class="cm">     * @param type    {string}   The type of the event</span>
<span class="cm">     * @param fn {Function} The callback</span>
<span class="cm">     * @param context {object} optional execution context.</span>
<span class="cm">     * @param arg* {mixed} 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * @return the event target or a detach handle per &#39;chain&#39; config</span>
<span class="cm">     */</span>
    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">_parseType</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prefix</span><span class="p">),</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">ce</span><span class="p">,</span>
            <span class="nx">detachcategory</span><span class="p">,</span> <span class="nx">handle</span><span class="p">,</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">handles</span><span class="p">,</span> <span class="nx">after</span><span class="p">,</span> <span class="nx">adapt</span><span class="p">,</span> <span class="nx">shorttype</span><span class="p">,</span>
            <span class="nx">Node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">domevent</span><span class="p">,</span> <span class="nx">isArr</span><span class="p">;</span>

        <span class="c1">// full name, args, detachcategory, after</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_monitor</span><span class="p">(</span><span class="s1">&#39;attach&#39;</span><span class="p">,</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span>
            <span class="nx">args</span><span class="o">:</span> <span class="nx">arguments</span><span class="p">,</span>
            <span class="nx">category</span><span class="o">:</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">after</span><span class="o">:</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">.</span><span class="nx">before</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">f</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
            <span class="nx">c</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">isArr</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">after</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">_after</span><span class="p">;</span>
            <span class="k">delete</span> <span class="nx">type</span><span class="p">.</span><span class="nx">_after</span><span class="p">;</span>

            <span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">f</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">fn</span> <span class="o">||</span> <span class="p">((</span><span class="nx">L</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="o">?</span> <span class="nx">v</span> <span class="o">:</span> <span class="nx">f</span><span class="p">);</span>
                    <span class="nx">c</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">context</span> <span class="o">||</span> <span class="nx">c</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="kd">var</span> <span class="nx">nv</span> <span class="o">=</span> <span class="p">(</span><span class="nx">after</span><span class="p">)</span> <span class="o">?</span> <span class="nx">AFTER_PREFIX</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

                <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">nv</span> <span class="o">+</span> <span class="p">((</span><span class="nx">isArr</span><span class="p">)</span> <span class="o">?</span> <span class="nx">v</span> <span class="o">:</span> <span class="nx">k</span><span class="p">);</span>
                <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
                <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>

                <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>

            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

            <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">chain</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>

        <span class="p">}</span>

        <span class="nx">detachcategory</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">after</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="nx">shorttype</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

        <span class="c1">// extra redirection so we catch adaptor events too.  take a look at this.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Node</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Node</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">shorttype</span> <span class="k">in</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="c1">// Y.log(&quot;Node detected, redirecting with these args: &quot; + args);</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">type</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">YUI</span><span class="p">))</span> <span class="p">{</span>

            <span class="nx">adapt</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
            <span class="nx">args</span>  <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">shorttype</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">Node</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">n</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">n</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">getDOMNodes</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">n</span> <span class="o">=</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nx">domevent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">shorttype</span> <span class="k">in</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span><span class="p">);</span>

                <span class="c1">// Captures both DOM events and event plugins.</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">domevent</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// check for the existance of an event adaptor</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">adapt</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Using adaptor for &#39;</span> <span class="o">+</span> <span class="nx">shorttype</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">);</span>
                <span class="nx">handle</span> <span class="o">=</span> <span class="nx">adapt</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">type</span><span class="p">)</span> <span class="o">||</span> <span class="nx">domevent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">handle</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ce</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
            <span class="nx">handle</span> <span class="o">=</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">_on</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="p">(</span><span class="nx">after</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;after&#39;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">detachcategory</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">store</span><span class="p">[</span><span class="nx">detachcategory</span><span class="p">]</span> <span class="o">=</span> <span class="nx">store</span><span class="p">[</span><span class="nx">detachcategory</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
            <span class="nx">store</span><span class="p">[</span><span class="nx">detachcategory</span><span class="p">][</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">store</span><span class="p">[</span><span class="nx">detachcategory</span><span class="p">][</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span>
            <span class="nx">store</span><span class="p">[</span><span class="nx">detachcategory</span><span class="p">][</span><span class="nx">type</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">handle</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">chain</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="nx">handle</span><span class="p">;</span>

    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * subscribe to an event</span>
<span class="cm">     * @method subscribe</span>
<span class="cm">     * @deprecated use on</span>
<span class="cm">     */</span>
    <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;EventTarget subscribe() is deprecated, use on()&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;deprecated&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Detach one or more listeners the from the specified event</span>
<span class="cm">     * @method detach</span>
<span class="cm">     * @param type {string|Object}   Either the handle to the subscriber or the</span>
<span class="cm">     *                        type of event.  If the type</span>
<span class="cm">     *                        is not specified, it will attempt to remove</span>
<span class="cm">     *                        the listener from all hosted events.</span>
<span class="cm">     * @param fn   {Function} The subscribed function to unsubscribe, if not</span>
<span class="cm">     *                          supplied, all subscribers will be removed.</span>
<span class="cm">     * @param context  {Object}   The custom object passed to subscribe.  This is</span>
<span class="cm">     *                        optional, but if supplied will be used to</span>
<span class="cm">     *                        disambiguate multiple listeners that are the same</span>
<span class="cm">     *                        (e.g., you subscribe many object using a function</span>
<span class="cm">     *                        that lives on the prototype)</span>
<span class="cm">     * @return {EventTarget} the host</span>
<span class="cm">     */</span>
    <span class="nx">detach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span>
            <span class="nx">Node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">isNode</span> <span class="o">=</span> <span class="nx">Node</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Node</span><span class="p">));</span>

        <span class="c1">// detachAll disabled on the Y instance.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span> <span class="o">!==</span> <span class="nx">Y</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">evts</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">evts</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">evts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">detach</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">isNode</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">purgeElement</span><span class="p">(</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">_parseType</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prefix</span><span class="p">),</span>
        <span class="nx">detachcategory</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span> <span class="o">?</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">shorttype</span> <span class="o">=</span> <span class="p">(</span><span class="nx">parts</span><span class="p">)</span> <span class="o">?</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">adapt</span><span class="p">,</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">handles</span><span class="p">,</span> <span class="nx">detachhost</span><span class="p">,</span> <span class="nx">cat</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span>
        <span class="nx">ce</span><span class="p">,</span>

        <span class="nx">keyDetacher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lcat</span><span class="p">,</span> <span class="nx">ltype</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">handles</span> <span class="o">=</span> <span class="nx">lcat</span><span class="p">[</span><span class="nx">ltype</span><span class="p">],</span> <span class="nx">ce</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">handles</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">handles</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ce</span> <span class="o">=</span> <span class="nx">handles</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">evt</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">host</span> <span class="o">===</span> <span class="nx">host</span> <span class="o">||</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">el</span> <span class="o">===</span> <span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">handles</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">detach</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">detachcategory</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">cat</span> <span class="o">=</span> <span class="nx">store</span><span class="p">[</span><span class="nx">detachcategory</span><span class="p">];</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="nx">detachhost</span> <span class="o">=</span> <span class="p">(</span><span class="nx">isNode</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">:</span> <span class="k">this</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">cat</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">keyDetacher</span><span class="p">(</span><span class="nx">cat</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">detachhost</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">cat</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">cat</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">keyDetacher</span><span class="p">(</span><span class="nx">cat</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">detachhost</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="c1">// If this is an event handle, use it to detach</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span><span class="p">.</span><span class="nx">detach</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">type</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="c1">// extra redirection so we catch adaptor events too.  take a look at this.</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isNode</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="o">!</span><span class="nx">shorttype</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">shorttype</span> <span class="k">in</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">detach</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">adapt</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">shorttype</span><span class="p">];</span>

        <span class="c1">// The YUI instance handles DOM events and adaptors</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">YUI</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="c1">// use the adaptor specific detach code if</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">adapt</span> <span class="o">&amp;&amp;</span> <span class="nx">adapt</span><span class="p">.</span><span class="nx">detach</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">adapt</span><span class="p">.</span><span class="nx">detach</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="c1">// DOM event fork</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nx">adapt</span> <span class="o">&amp;&amp;</span> <span class="nx">Node</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">type</span> <span class="k">in</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span><span class="p">)))</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">detach</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// ce = evts[type];</span>
        <span class="nx">ce</span> <span class="o">=</span> <span class="nx">evts</span><span class="p">[</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ce</span><span class="p">.</span><span class="nx">detach</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * detach a listener</span>
<span class="cm">     * @method unsubscribe</span>
<span class="cm">     * @deprecated use detach</span>
<span class="cm">     */</span>
    <span class="nx">unsubscribe</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;EventTarget unsubscribe() is deprecated, use detach()&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;deprecated&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">detach</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes all listeners from the specified event.  If the event type</span>
<span class="cm">     * is not specified, all listeners from all hosted custom events will</span>
<span class="cm">     * be removed.</span>
<span class="cm">     * @method detachAll</span>
<span class="cm">     * @param type {string}   The type, or name of the event</span>
<span class="cm">     */</span>
    <span class="nx">detachAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">detach</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes all listeners from the specified event.  If the event type</span>
<span class="cm">     * is not specified, all listeners from all hosted custom events will</span>
<span class="cm">     * be removed.</span>
<span class="cm">     * @method unsubscribeAll</span>
<span class="cm">     * @param type {string}   The type, or name of the event</span>
<span class="cm">     * @deprecated use detachAll</span>
<span class="cm">     */</span>
    <span class="nx">unsubscribeAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;EventTarget unsubscribeAll() is deprecated, use detachAll()&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;deprecated&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">detachAll</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Creates a new custom event of the specified type.  If a custom event</span>
<span class="cm">     * by that name already exists, it will not be re-created.  In either</span>
<span class="cm">     * case the custom event is returned.</span>
<span class="cm">     *</span>
<span class="cm">     * @method publish</span>
<span class="cm">     *</span>
<span class="cm">     * @param type {string} the type, or name of the event</span>
<span class="cm">     * @param opts {object} optional config params.  Valid properties are:</span>
<span class="cm">     *</span>
<span class="cm">     *  &lt;ul&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;broadcast&#39;: whether or not the YUI instance and YUI global are notified when the event is fired (false)</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;bubbles&#39;: whether or not this event bubbles (true)</span>
<span class="cm">     *              Events can only bubble if emitFacade is true.</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;context&#39;: the default execution context for the listeners (this)</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;defaultFn&#39;: the default function to execute when this event fires if preventDefault was not called</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;emitFacade&#39;: whether or not this event emits a facade (false)</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;prefix&#39;: the prefix for this targets events, e.g., &#39;menu&#39; in &#39;menu:click&#39;</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;fireOnce&#39;: if an event is configured to fire once, new subscribers after</span>
<span class="cm">     *   the fire will be notified immediately.</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;async&#39;: fireOnce event listeners will fire synchronously if the event has already</span>
<span class="cm">     *    fired unless async is true.</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;preventable&#39;: whether or not preventDefault() has an effect (true)</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;preventedFn&#39;: a function that is executed when preventDefault is called</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;queuable&#39;: whether or not this event can be queued during bubbling (false)</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;silent&#39;: if silent is true, debug messages are not provided for this event.</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;stoppedFn&#39;: a function that is executed when stopPropagation is called</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;monitored&#39;: specifies whether or not this event should send notifications about</span>
<span class="cm">     *   when the event has been attached, detached, or published.</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *    &lt;li&gt;</span>
<span class="cm">     *   &#39;type&#39;: the event type (valid option if not provided as the first parameter to publish)</span>
<span class="cm">     *    &lt;/li&gt;</span>
<span class="cm">     *  &lt;/ul&gt;</span>
<span class="cm">     *</span>
<span class="cm">     *  @return {CustomEvent} the custom event</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">publish</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">ce</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">,</span>
            <span class="nx">edata</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">,</span>
            <span class="nx">pre</span>      <span class="o">=</span> <span class="nx">edata</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prefix</span><span class="p">;</span>

        <span class="nx">type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pre</span><span class="p">)</span> <span class="o">?</span> <span class="nx">_getType</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">pre</span><span class="p">)</span> <span class="o">:</span> <span class="nx">type</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_monitor</span><span class="p">(</span><span class="s1">&#39;publish&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">args</span><span class="o">:</span> <span class="nx">arguments</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">||</span> <span class="nx">opts</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

            <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">events</span> <span class="o">=</span> <span class="nx">edata</span><span class="p">.</span><span class="nx">events</span><span class="p">;</span>
        <span class="nx">ce</span> <span class="o">=</span> <span class="nx">events</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// ce.log(&quot;publish applying new config to published event: &#39;&quot;+type+&quot;&#39; exists&quot;, &#39;info&#39;, &#39;event&#39;);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ce</span><span class="p">.</span><span class="nx">applyConfig</span><span class="p">(</span><span class="nx">opts</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

            <span class="nx">defaults</span> <span class="o">=</span> <span class="nx">edata</span><span class="p">.</span><span class="nx">defaults</span><span class="p">;</span>

            <span class="c1">// apply defaults</span>
            <span class="nx">ce</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span>
                                  <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="o">:</span> <span class="nx">defaults</span><span class="p">);</span>
            <span class="nx">events</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ce</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// make sure we turn the broadcast flag off if this</span>
        <span class="c1">// event was published as a result of bubbling</span>
        <span class="c1">// if (opts instanceof Y.CustomEvent) {</span>
          <span class="c1">//   events[type].broadcast = false;</span>
        <span class="c1">// }</span>

        <span class="k">return</span> <span class="nx">events</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * This is the entry point for the event monitoring system.</span>
<span class="cm">     * You can monitor &#39;attach&#39;, &#39;detach&#39;, &#39;fire&#39;, and &#39;publish&#39;.</span>
<span class="cm">     * When configured, these events generate an event.  click -&gt;</span>
<span class="cm">     * click_attach, click_detach, click_publish -- these can</span>
<span class="cm">     * be subscribed to like other events to monitor the event</span>
<span class="cm">     * system.  Inividual published events can have monitoring</span>
<span class="cm">     * turned on or off (publish can&#39;t be turned off before it</span>
<span class="cm">     * it published) by setting the events &#39;monitor&#39; config.</span>
<span class="cm">     *</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_monitor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">what</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">monitorevt</span><span class="p">,</span> <span class="nx">ce</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">monitored</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">ce</span> <span class="o">||</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">monitored</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="nx">ce</span> <span class="o">&amp;&amp;</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">monitored</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">monitorevt</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">what</span><span class="p">;</span>
            <span class="c1">// Y.log(&#39;monitoring: &#39; + monitorevt);</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">monitored</span> <span class="o">=</span> <span class="nx">what</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">monitorevt</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

   <span class="cm">/**</span>
<span class="cm">     * Fire a custom event by name.  The callback functions will be executed</span>
<span class="cm">     * from the context specified when the event was created, and with the</span>
<span class="cm">     * following parameters.</span>
<span class="cm">     *</span>
<span class="cm">     * If the custom event object hasn&#39;t been created, then the event hasn&#39;t</span>
<span class="cm">     * been published and it has no subscribers.  For performance sake, we</span>
<span class="cm">     * immediate exit in this case.  This means the event won&#39;t bubble, so</span>
<span class="cm">     * if the intention is that a bubble target be notified, the event must</span>
<span class="cm">     * be published on this object first.</span>
<span class="cm">     *</span>
<span class="cm">     * The first argument is the event type, and any additional arguments are</span>
<span class="cm">     * passed to the listeners as parameters.  If the first of these is an</span>
<span class="cm">     * object literal, and the event is configured to emit an event facade,</span>
<span class="cm">     * that object is mixed into the event facade and the facade is provided</span>
<span class="cm">     * in place of the original object.</span>
<span class="cm">     *</span>
<span class="cm">     * @method fire</span>
<span class="cm">     * @param type {String|Object} The type of the event, or an object that contains</span>
<span class="cm">     * a &#39;type&#39; property.</span>
<span class="cm">     * @param arguments {Object*} an arbitrary set of parameters to pass to</span>
<span class="cm">     * the handler.  If the first of these is an object literal and the event is</span>
<span class="cm">     * configured to emit an event facade, the event facade will replace that</span>
<span class="cm">     * parameter after the properties the object literal contains are copied to</span>
<span class="cm">     * the event facade.</span>
<span class="cm">     * @return {EventTarget} the event host</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">fire</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">typeIncluded</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">type</span><span class="p">),</span>
            <span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">typeIncluded</span><span class="p">)</span> <span class="o">?</span> <span class="nx">type</span> <span class="o">:</span> <span class="p">(</span><span class="nx">type</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span><span class="p">.</span><span class="nx">type</span><span class="p">),</span>
            <span class="nx">ce</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">pre</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">ce2</span><span class="p">,</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="p">(</span><span class="nx">typeIncluded</span><span class="p">)</span> <span class="o">?</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">;</span>

        <span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pre</span><span class="p">)</span> <span class="o">?</span> <span class="nx">_getType</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">pre</span><span class="p">)</span> <span class="o">:</span> <span class="nx">t</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_monitor</span><span class="p">(</span><span class="s1">&#39;fire&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">args</span><span class="o">:</span> <span class="nx">args</span>
        <span class="p">});</span>

        <span class="nx">ce</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getEvent</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">ce2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSibling</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">ce</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ce2</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ce</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// this event has not been published or subscribed to</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">hasTargets</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bubble</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">t</span> <span class="p">},</span> <span class="nx">args</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// otherwise there is nothing to be done</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ce</span><span class="p">.</span><span class="nx">sibling</span> <span class="o">=</span> <span class="nx">ce2</span><span class="p">;</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ce</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">chain</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">getSibling</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ce2</span><span class="p">;</span>
        <span class="c1">// delegate to *:type events if there are subscribers</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">PREFIX_DELIMITER</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">_wildType</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
            <span class="c1">// console.log(type);</span>
            <span class="nx">ce2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ce2</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// console.log(&quot;GOT ONE: &quot; + type);</span>
                <span class="nx">ce2</span><span class="p">.</span><span class="nx">applyConfig</span><span class="p">(</span><span class="nx">ce</span><span class="p">);</span>
                <span class="nx">ce2</span><span class="p">.</span><span class="nx">bubbles</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="nx">ce2</span><span class="p">.</span><span class="nx">broadcast</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="c1">// ret = ce2.fire.apply(ce2, a);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ce2</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the custom event of the provided type has been created, a</span>
<span class="cm">     * falsy value otherwise</span>
<span class="cm">     * @method getEvent</span>
<span class="cm">     * @param type {string} the type, or name of the event</span>
<span class="cm">     * @param prefixed {string} if true, the type is prefixed already</span>
<span class="cm">     * @return {CustomEvent} the custom event or null</span>
<span class="cm">     */</span>
    <span class="nx">getEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">prefixed</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pre</span><span class="p">,</span> <span class="nx">e</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prefixed</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pre</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prefix</span><span class="p">;</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pre</span><span class="p">)</span> <span class="o">?</span> <span class="nx">_getType</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">pre</span><span class="p">)</span> <span class="o">:</span> <span class="nx">type</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">events</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">e</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Subscribe to a custom event hosted by this object.  The</span>
<span class="cm">     * supplied callback will execute after any listeners add</span>
<span class="cm">     * via the subscribe method, and after the default function,</span>
<span class="cm">     * if configured for the event, has executed.</span>
<span class="cm">     * @method after</span>
<span class="cm">     * @param type    {string}   The type of the event</span>
<span class="cm">     * @param fn {Function} The callback</span>
<span class="cm">     * @param context {object} optional execution context.</span>
<span class="cm">     * @param arg* {mixed} 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * @return the event target or a detach handle per &#39;chain&#39; config</span>
<span class="cm">     */</span>
    <span class="nx">after</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">YArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;function&#39;</span><span class="o">:</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">.</span><span class="nx">after</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="k">case</span> <span class="s1">&#39;array&#39;</span><span class="o">:</span>
            <span class="c1">//     YArray.each(a[0], function(v) {</span>
            <span class="c1">//         v = AFTER_PREFIX + v;</span>
            <span class="c1">//     });</span>
            <span class="c1">//     break;</span>
            <span class="k">case</span> <span class="s1">&#39;object&#39;</span><span class="o">:</span>
                <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">_after</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">AFTER_PREFIX</span> <span class="o">+</span> <span class="nx">type</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>

    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Executes the callback before a DOM event, custom event</span>
<span class="cm">     * or method.  If the first argument is a function, it</span>
<span class="cm">     * is assumed the target is a method.  For DOM and custom</span>
<span class="cm">     * events, this is an alias for Y.on.</span>
<span class="cm">     *</span>
<span class="cm">     * For DOM and custom events:</span>
<span class="cm">     * type, callback, context, 0-n arguments</span>
<span class="cm">     *</span>
<span class="cm">     * For methods:</span>
<span class="cm">     * callback, object (method host), methodName, context, 0-n arguments</span>
<span class="cm">     *</span>
<span class="cm">     * @method before</span>
<span class="cm">     * @return detach handle</span>
<span class="cm">     */</span>
    <span class="nx">before</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">EventTarget</span> <span class="o">=</span> <span class="nx">ET</span><span class="p">;</span>

<span class="c1">// make Y an event target</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">ET</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
<span class="nx">ET</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="p">{</span> <span class="nx">bubbles</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>

<span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">globalEvents</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">globalEvents</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">ET</span><span class="p">();</span>

<span class="cm">/**</span>
<span class="cm"> * Hosts YUI page level events.  This is where events bubble to</span>
<span class="cm"> * when the broadcast config is set to 2.  This property is</span>
<span class="cm"> * only available if the custom event module is loaded.</span>
<span class="cm"> * @property Global</span>
<span class="cm"> * @type EventTarget</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Global</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">globalEvents</span><span class="p">;</span>

<span class="c1">// @TODO implement a global namespace function on Y.Global?</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;code&gt;YUI&lt;/code&gt;&#39;s &lt;code&gt;on&lt;/code&gt; method is a unified interface for subscribing to</span>
<span class="cm"> * most events exposed by YUI.  This includes custom events, DOM events, and</span>
<span class="cm"> * function events.  &lt;code&gt;detach&lt;/code&gt; is also provided to remove listeners</span>
<span class="cm"> * serviced by this function.</span>
<span class="cm"> *</span>
<span class="cm"> * The signature that &lt;code&gt;on&lt;/code&gt; accepts varies depending on the type</span>
<span class="cm"> * of event being consumed.  Refer to the specific methods that will</span>
<span class="cm"> * service a specific request for additional information about subscribing</span>
<span class="cm"> * to that type of event.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;ul&gt;</span>
<span class="cm"> * &lt;li&gt;Custom events.  These events are defined by various</span>
<span class="cm"> * modules in the library.  This type of event is delegated to</span>
<span class="cm"> * &lt;code&gt;EventTarget&lt;/code&gt;&#39;s &lt;code&gt;on&lt;/code&gt; method.</span>
<span class="cm"> *   &lt;ul&gt;</span>
<span class="cm"> *     &lt;li&gt;The type of the event&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;The callback to execute&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;An optional context object&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;0..n additional arguments to supply the callback.&lt;/li&gt;</span>
<span class="cm"> *   &lt;/ul&gt;</span>
<span class="cm"> *   Example:</span>
<span class="cm"> *   &lt;code&gt;Y.on(&#39;drag:drophit&#39;, function() { // start work });&lt;/code&gt;</span>
<span class="cm"> * &lt;/li&gt;</span>
<span class="cm"> * &lt;li&gt;DOM events.  These are moments reported by the browser related</span>
<span class="cm"> * to browser functionality and user interaction.</span>
<span class="cm"> * This type of event is delegated to &lt;code&gt;Event&lt;/code&gt;&#39;s</span>
<span class="cm"> * &lt;code&gt;attach&lt;/code&gt; method.</span>
<span class="cm"> *   &lt;ul&gt;</span>
<span class="cm"> *     &lt;li&gt;The type of the event&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;The callback to execute&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;The specification for the Node(s) to attach the listener</span>
<span class="cm"> *     to.  This can be a selector, collections, or Node/Element</span>
<span class="cm"> *     refereces.&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;An optional context object&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;0..n additional arguments to supply the callback.&lt;/li&gt;</span>
<span class="cm"> *   &lt;/ul&gt;</span>
<span class="cm"> *   Example:</span>
<span class="cm"> *   &lt;code&gt;Y.on(&#39;click&#39;, function(e) { // something was clicked }, &#39;#someelement&#39;);&lt;/code&gt;</span>
<span class="cm"> * &lt;/li&gt;</span>
<span class="cm"> * &lt;li&gt;Function events.  These events can be used to react before or after a</span>
<span class="cm"> * function is executed.  This type of event is delegated to &lt;code&gt;Event.Do&lt;/code&gt;&#39;s</span>
<span class="cm"> * &lt;code&gt;before&lt;/code&gt; method.</span>
<span class="cm"> *   &lt;ul&gt;</span>
<span class="cm"> *     &lt;li&gt;The callback to execute&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;The object that has the function that will be listened for.&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;The name of the function to listen for.&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;An optional context object&lt;/li&gt;</span>
<span class="cm"> *     &lt;li&gt;0..n additional arguments to supply the callback.&lt;/li&gt;</span>
<span class="cm"> *   &lt;/ul&gt;</span>
<span class="cm"> *   Example &lt;code&gt;Y.on(function(arg1, arg2, etc) { // obj.methodname was executed }, obj &#39;methodname&#39;);&lt;/code&gt;</span>
<span class="cm"> * &lt;/li&gt;</span>
<span class="cm"> * &lt;/ul&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;code&gt;on&lt;/code&gt; corresponds to the moment before any default behavior of</span>
<span class="cm"> * the event.  &lt;code&gt;after&lt;/code&gt; works the same way, but these listeners</span>
<span class="cm"> * execute after the event&#39;s default behavior.  &lt;code&gt;before&lt;/code&gt; is an</span>
<span class="cm"> * alias for &lt;code&gt;on&lt;/code&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * @method on</span>
<span class="cm"> * @param type event type (this parameter does not apply for function events)</span>
<span class="cm"> * @param fn the callback</span>
<span class="cm"> * @param context optionally change the value of &#39;this&#39; in the callback</span>
<span class="cm"> * @param args* 0..n additional arguments to pass to the callback.</span>
<span class="cm"> * @return the event target or a detach handle per &#39;chain&#39; config</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>

 <span class="cm">/**</span>
<span class="cm">  * Listen for an event one time.  Equivalent to &lt;code&gt;on&lt;/code&gt;, except that</span>
<span class="cm">  * the listener is immediately detached when executed.</span>
<span class="cm">  * @see on</span>
<span class="cm">  * @method once</span>
<span class="cm">  * @param type event type (this parameter does not apply for function events)</span>
<span class="cm">  * @param fn the callback</span>
<span class="cm">  * @param context optionally change the value of &#39;this&#39; in the callback</span>
<span class="cm">  * @param args* 0..n additional arguments to pass to the callback.</span>
<span class="cm">  * @return the event target or a detach handle per &#39;chain&#39; config</span>
<span class="cm">  * @for YUI</span>
<span class="cm">  */</span>

<span class="cm">/**</span>
<span class="cm"> * after() is a unified interface for subscribing to</span>
<span class="cm"> * most events exposed by YUI.  This includes custom events,</span>
<span class="cm"> * DOM events, and AOP events.  This works the same way as</span>
<span class="cm"> * the on() function, only it operates after any default</span>
<span class="cm"> * behavior for the event has executed. @see &lt;code&gt;on&lt;/code&gt; for more</span>
<span class="cm"> * information.</span>
<span class="cm"> * @method after</span>
<span class="cm"> * @param type event type (this parameter does not apply for function events)</span>
<span class="cm"> * @param fn the callback</span>
<span class="cm"> * @param context optionally change the value of &#39;this&#39; in the callback</span>
<span class="cm"> * @param args* 0..n additional arguments to pass to the callback.</span>
<span class="cm"> * @return the event target or a detach handle per &#39;chain&#39; config</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;oop&#39;</span><span class="p">]});</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="kd">var</span> <span class="nx">GLOBAL_ENV</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ready</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ready</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">DOMReady</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span> <span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ready</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span> <span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ready</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">})();</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;event-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/*</span>
<span class="cm"> * DOM event listener abstraction layer</span>
<span class="cm"> * @module event</span>
<span class="cm"> * @submodule event-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The domready event fires at the moment the browser&#39;s DOM is</span>
<span class="cm"> * usable. In most cases, this is before images are fully</span>
<span class="cm"> * downloaded, allowing you to provide a more responsive user</span>
<span class="cm"> * interface.</span>
<span class="cm"> *</span>
<span class="cm"> * In YUI 3, domready subscribers will be notified immediately if</span>
<span class="cm"> * that moment has already passed when the subscription is created.</span>
<span class="cm"> *</span>
<span class="cm"> * One exception is if the yui.js file is dynamically injected into</span>
<span class="cm"> * the page.  If this is done, you must tell the YUI instance that</span>
<span class="cm"> * you did this in order for DOMReady (and window load events) to</span>
<span class="cm"> * fire normally.  That configuration option is &#39;injected&#39; -- set</span>
<span class="cm"> * it to true if the yui.js script is not included inline.</span>
<span class="cm"> *</span>
<span class="cm"> * This method is part of the &#39;event-ready&#39; module, which is a</span>
<span class="cm"> * submodule of &#39;event&#39;.</span>
<span class="cm"> *</span>
<span class="cm"> * @event domready</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;domready&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">fireOnce</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">async</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">DOMReady</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;domready&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;domready&#39;</span><span class="p">);</span> <span class="p">},</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span> <span class="s1">&#39;_ready&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Custom event engine, DOM event listener abstraction layer, synthetic DOM</span>
<span class="cm"> * events.</span>
<span class="cm"> * @module event</span>
<span class="cm"> * @submodule event-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Wraps a DOM event, properties requiring browser abstraction are</span>
<span class="cm"> * fixed here.  Provids a security layer when required.</span>
<span class="cm"> * @class DOMEventFacade</span>
<span class="cm"> * @param ev {Event} the DOM event</span>
<span class="cm"> * @param currentTarget {HTMLElement} the element the listener was attached to</span>
<span class="cm"> * @param wrapper {Event.Custom} the custom event wrapper for this DOM event</span>
<span class="cm"> */</span>

    <span class="kd">var</span> <span class="nx">ua</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">,</span>

    <span class="nx">EMPTY</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="cm">/**</span>
<span class="cm">     * webkit key remapping required for Safari &lt; 3.1</span>
<span class="cm">     * @property webkitKeymap</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">webkitKeymap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">63232</span><span class="o">:</span> <span class="mi">38</span><span class="p">,</span> <span class="c1">// up</span>
        <span class="mi">63233</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span> <span class="c1">// down</span>
        <span class="mi">63234</span><span class="o">:</span> <span class="mi">37</span><span class="p">,</span> <span class="c1">// left</span>
        <span class="mi">63235</span><span class="o">:</span> <span class="mi">39</span><span class="p">,</span> <span class="c1">// right</span>
        <span class="mi">63276</span><span class="o">:</span> <span class="mi">33</span><span class="p">,</span> <span class="c1">// page up</span>
        <span class="mi">63277</span><span class="o">:</span> <span class="mi">34</span><span class="p">,</span> <span class="c1">// page down</span>
        <span class="mi">25</span><span class="o">:</span>     <span class="mi">9</span><span class="p">,</span> <span class="c1">// SHIFT-TAB (Safari provides a different key code in</span>
                   <span class="c1">// this case, even though the shiftKey modifier is set)</span>
        <span class="mi">63272</span><span class="o">:</span> <span class="mi">46</span><span class="p">,</span> <span class="c1">// delete</span>
        <span class="mi">63273</span><span class="o">:</span> <span class="mi">36</span><span class="p">,</span> <span class="c1">// home</span>
        <span class="mi">63275</span><span class="o">:</span> <span class="mi">35</span>  <span class="c1">// end</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns a wrapped node.  Intended to be used on event targets,</span>
<span class="cm">     * so it will return the node&#39;s parent if the target is a text</span>
<span class="cm">     * node.</span>
<span class="cm">     *</span>
<span class="cm">     * If accessing a property of the node throws an error, this is</span>
<span class="cm">     * probably the anonymous div wrapper Gecko adds inside text</span>
<span class="cm">     * nodes.  This likely will only occur when attempting to access</span>
<span class="cm">     * the relatedTarget.  In this case, we now return null because</span>
<span class="cm">     * the anonymous div is completely useless and we do not know</span>
<span class="cm">     * what the related target was because we can&#39;t even get to</span>
<span class="cm">     * the element&#39;s parent node.</span>
<span class="cm">     *</span>
<span class="cm">     * @method resolve</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">resolve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="mi">3</span> <span class="o">==</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">n</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">DOMEventFacade</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">currentTarget</span><span class="p">,</span> <span class="nx">wrapper</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_event</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_currentTarget</span> <span class="o">=</span> <span class="nx">currentTarget</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span> <span class="o">=</span> <span class="nx">wrapper</span> <span class="o">||</span> <span class="nx">EMPTY</span><span class="p">;</span>

        <span class="c1">// if not lazy init</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
    <span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DOMEventFacade</span><span class="p">,</span> <span class="nb">Object</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">,</span>
            <span class="nx">overrides</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">overrides</span><span class="p">,</span>
            <span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span>
            <span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span><span class="p">,</span>
            <span class="nx">c</span><span class="p">,</span>
            <span class="nx">currentTarget</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentTarget</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">altKey</span>   <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">ctrlKey</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">metaKey</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">shiftKey</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">type</span>     <span class="o">=</span> <span class="p">(</span><span class="nx">overrides</span> <span class="o">&amp;&amp;</span> <span class="nx">overrides</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">clientX</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">clientY</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>

        <span class="nx">c</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ua</span><span class="p">.</span><span class="nx">webkit</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">c</span> <span class="k">in</span> <span class="nx">webkitKeymap</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">c</span> <span class="o">=</span> <span class="nx">webkitKeymap</span><span class="p">[</span><span class="nx">c</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">which</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">||</span> <span class="nx">c</span><span class="p">;</span>
        <span class="c1">// this.button = e.button;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">button</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">which</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">currentTarget</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">relatedTarget</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;mousewheel&quot;</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;DOMMouseScroll&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)</span> <span class="o">||</span> <span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_touch</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_touch</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">currentTarget</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">stopPropagation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">stopImmediatePropagation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">preventDefault</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">returnValue</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">prevented</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">prevented</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">halt</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">immediate</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">immediate</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">});</span>

<span class="nx">DOMEventFacade</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">DOM2EventFacade</span> <span class="o">=</span> <span class="nx">DOMEventFacade</span><span class="p">;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">DOMEventFacade</span> <span class="o">=</span> <span class="nx">DOMEventFacade</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * The native event</span>
<span class="cm">     * @property _event</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * The X location of the event on the page (including scroll)</span>
<span class="cm">     * @property pageX</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * The Y location of the event on the page (including scroll)</span>
<span class="cm">     * @property pageY</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * The keyCode for key events.  Uses charCode if keyCode is not available</span>
<span class="cm">     * @property keyCode</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * The charCode for key events.  Same as keyCode</span>
<span class="cm">     * @property charCode</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * The button that was pushed.</span>
<span class="cm">     * @property button</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * The button that was pushed.  Same as button.</span>
<span class="cm">     * @property which</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Node reference for the targeted element</span>
<span class="cm">     * @propery target</span>
<span class="cm">     * @type Node</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Node reference for the element that the listener was attached to.</span>
<span class="cm">     * @propery currentTarget</span>
<span class="cm">     * @type Node</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Node reference to the relatedTarget</span>
<span class="cm">     * @propery relatedTarget</span>
<span class="cm">     * @type Node</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Number representing the direction and velocity of the movement of the mousewheel.</span>
<span class="cm">     * Negative is down, the higher the number, the faster.  Applies to the mousewheel event.</span>
<span class="cm">     * @property wheelDelta</span>
<span class="cm">     * @type int</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Stops the propagation to the next bubble target</span>
<span class="cm">     * @method stopPropagation</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Stops the propagation to the next bubble target and</span>
<span class="cm">     * prevents any additional listeners from being exectued</span>
<span class="cm">     * on the current target.</span>
<span class="cm">     * @method stopImmediatePropagation</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Prevents the event&#39;s default behavior</span>
<span class="cm">     * @method preventDefault</span>
<span class="cm">     * @param returnValue {string} sets the returnValue of the event to this value</span>
<span class="cm">     * (rather than the default false value).  This can be used to add a customized</span>
<span class="cm">     * confirmation query to the beforeunload event).</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Stops the event propagation and prevents the default</span>
<span class="cm">     * event behavior.</span>
<span class="cm">     * @method halt</span>
<span class="cm">     * @param immediate {boolean} if true additional listeners</span>
<span class="cm">     * on the current target will not be executed</span>
<span class="cm">     */</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="cm">/**</span>
<span class="cm"> * DOM event listener abstraction layer</span>
<span class="cm"> * @module event</span>
<span class="cm"> * @submodule event-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The event utility provides functions to add and remove event listeners,</span>
<span class="cm"> * event cleansing.  It also tries to automatically remove listeners it</span>
<span class="cm"> * registers during the unload event.</span>
<span class="cm"> *</span>
<span class="cm"> * @class Event</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">dom_wrappers</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">dom_map</span> <span class="o">=</span> <span class="p">{};</span>

<span class="kd">var</span> <span class="nx">_eventenv</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">,</span>
    <span class="nx">config</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">,</span>
    <span class="nx">win</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">,</span>
    <span class="nx">add</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">add</span><span class="p">,</span>
    <span class="nx">remove</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">remove</span><span class="p">,</span>

    <span class="nx">onLoad</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">windowLoaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_load</span><span class="p">();</span>
        <span class="nx">remove</span><span class="p">(</span><span class="nx">win</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="nx">onLoad</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">onUnload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_unload</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">EVENT_READY</span> <span class="o">=</span> <span class="s1">&#39;domready&#39;</span><span class="p">,</span>

    <span class="nx">COMPAT_ARG</span> <span class="o">=</span> <span class="s1">&#39;~yui|2|compat~&#39;</span><span class="p">,</span>

    <span class="nx">shouldIterate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">!==</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">alert</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;collection check failure&quot;</span><span class="p">,</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">},</span>

    <span class="c1">// aliases to support DOM event subscription clean up when the last</span>
    <span class="c1">// subscriber is detached. deleteAndClean overrides the DOM event&#39;s wrapper</span>
    <span class="c1">// CustomEvent _delete method.</span>
    <span class="nx">_ceProtoDelete</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_delete</span><span class="p">,</span>
    <span class="nx">_deleteAndClean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">_ceProtoDelete</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">subCount</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">afterCount</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_clean</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

<span class="nx">Event</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * True after the onload event has fired</span>
<span class="cm">     * @property _loadComplete</span>
<span class="cm">     * @type boolean</span>
<span class="cm">     * @static</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="kd">var</span> <span class="nx">_loadComplete</span> <span class="o">=</span>  <span class="kc">false</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * The number of times to poll after window.onload.  This number is</span>
<span class="cm">     * increased if additional late-bound handlers are requested after</span>
<span class="cm">     * the page load.</span>
<span class="cm">     * @property _retryCount</span>
<span class="cm">     * @static</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_retryCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * onAvailable listeners</span>
<span class="cm">     * @property _avail</span>
<span class="cm">     * @static</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_avail</span> <span class="o">=</span> <span class="p">[],</span>

    <span class="cm">/**</span>
<span class="cm">     * Custom event wrappers for DOM events.  Key is</span>
<span class="cm">     * &#39;event:&#39; + Element uid stamp + event type</span>
<span class="cm">     * @property _wrappers</span>
<span class="cm">     * @type Y.Event.Custom</span>
<span class="cm">     * @static</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_wrappers</span> <span class="o">=</span> <span class="nx">_eventenv</span><span class="p">.</span><span class="nx">dom_wrappers</span><span class="p">,</span>

    <span class="nx">_windowLoadKey</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Custom event wrapper map DOM events.  Key is</span>
<span class="cm">     * Element uid stamp.  Each item is a hash of custom event</span>
<span class="cm">     * wrappers as provided in the _wrappers collection.  This</span>
<span class="cm">     * provides the infrastructure for getListeners.</span>
<span class="cm">     * @property _el_events</span>
<span class="cm">     * @static</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_el_events</span> <span class="o">=</span> <span class="nx">_eventenv</span><span class="p">.</span><span class="nx">dom_map</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">{</span>

        <span class="cm">/**</span>
<span class="cm">         * The number of times we should look for elements that are not</span>
<span class="cm">         * in the DOM at the time the event is requested after the document</span>
<span class="cm">         * has been loaded.  The default is 1000@amp;40 ms, so it will poll</span>
<span class="cm">         * for 40 seconds or until all outstanding handlers are bound</span>
<span class="cm">         * (whichever comes first).</span>
<span class="cm">         * @property POLL_RETRYS</span>
<span class="cm">         * @type int</span>
<span class="cm">         * @static</span>
<span class="cm">         * @final</span>
<span class="cm">         */</span>
        <span class="nx">POLL_RETRYS</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * The poll interval in milliseconds</span>
<span class="cm">         * @property POLL_INTERVAL</span>
<span class="cm">         * @type int</span>
<span class="cm">         * @static</span>
<span class="cm">         * @final</span>
<span class="cm">         */</span>
        <span class="nx">POLL_INTERVAL</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * addListener/removeListener can throw errors in unexpected scenarios.</span>
<span class="cm">         * These errors are suppressed, the method returns false, and this property</span>
<span class="cm">         * is set</span>
<span class="cm">         * @property lastError</span>
<span class="cm">         * @static</span>
<span class="cm">         * @type Error</span>
<span class="cm">         */</span>
        <span class="nx">lastError</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>


        <span class="cm">/**</span>
<span class="cm">         * poll handle</span>
<span class="cm">         * @property _interval</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">_interval</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * document readystate poll handle</span>
<span class="cm">         * @property _dri</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
         <span class="nx">_dri</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * True when the document is initially usable</span>
<span class="cm">         * @property DOMReady</span>
<span class="cm">         * @type boolean</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">DOMReady</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * @method startInterval</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">startInterval</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_interval</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">Event</span><span class="p">.</span><span class="nx">_interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_poll</span><span class="p">,</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">POLL_INTERVAL</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Executes the supplied callback when the item with the supplied</span>
<span class="cm">         * id is found.  This is meant to be used to execute behavior as</span>
<span class="cm">         * soon as possible as the page loads.  If you use this after the</span>
<span class="cm">         * initial page load it will poll for a fixed time for the element.</span>
<span class="cm">         * The number of times it will poll and the frequency are</span>
<span class="cm">         * configurable.  By default it will poll for 10 seconds.</span>
<span class="cm">         *</span>
<span class="cm">         * &lt;p&gt;The callback is executed with a single parameter:</span>
<span class="cm">         * the custom object parameter, if provided.&lt;/p&gt;</span>
<span class="cm">         *</span>
<span class="cm">         * @method onAvailable</span>
<span class="cm">         *</span>
<span class="cm">         * @param {string||string[]}   id the id of the element, or an array</span>
<span class="cm">         * of ids to look for.</span>
<span class="cm">         * @param {function} fn what to execute when the element is found.</span>
<span class="cm">         * @param {object}   p_obj an optional object to be passed back as</span>
<span class="cm">         *                   a parameter to fn.</span>
<span class="cm">         * @param {boolean|object}  p_override If set to true, fn will execute</span>
<span class="cm">         *                   in the context of p_obj, if set to an object it</span>
<span class="cm">         *                   will execute in the context of that object</span>
<span class="cm">         * @param checkContent {boolean} check child node readiness (onContentReady)</span>
<span class="cm">         * @static</span>
<span class="cm">         * @deprecated Use Y.on(&quot;available&quot;)</span>
<span class="cm">         */</span>
        <span class="c1">// @TODO fix arguments</span>
        <span class="nx">onAvailable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">p_obj</span><span class="p">,</span> <span class="nx">p_override</span><span class="p">,</span> <span class="nx">checkContent</span><span class="p">,</span> <span class="nx">compat</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">id</span><span class="p">),</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">availHandle</span><span class="p">;</span>

            <span class="c1">// Y.log(&#39;onAvailable registered for: &#39; + id);</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">=</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_avail</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
                    <span class="nx">id</span><span class="o">:</span>         <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
                    <span class="nx">fn</span><span class="o">:</span>         <span class="nx">fn</span><span class="p">,</span>
                    <span class="nx">obj</span><span class="o">:</span>        <span class="nx">p_obj</span><span class="p">,</span>
                    <span class="nx">override</span><span class="o">:</span>   <span class="nx">p_override</span><span class="p">,</span>
                    <span class="nx">checkReady</span><span class="o">:</span> <span class="nx">checkContent</span><span class="p">,</span>
                    <span class="nx">compat</span><span class="o">:</span>     <span class="nx">compat</span>
                <span class="p">});</span>
            <span class="p">}</span>
            <span class="nx">_retryCount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">POLL_RETRYS</span><span class="p">;</span>

            <span class="c1">// We want the first test to be immediate, but async</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_poll</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

            <span class="nx">availHandle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">({</span>

                <span class="nx">_delete</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// set by the event system for lazy DOM listeners</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">availHandle</span><span class="p">.</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">availHandle</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">;</span>

                    <span class="c1">// otherwise try to remove the onAvailable listener(s)</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">_avail</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">_avail</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">_avail</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

            <span class="p">});</span>

            <span class="k">return</span> <span class="nx">availHandle</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Works the same way as onAvailable, but additionally checks the</span>
<span class="cm">         * state of sibling elements to determine if the content of the</span>
<span class="cm">         * available element is safe to modify.</span>
<span class="cm">         *</span>
<span class="cm">         * &lt;p&gt;The callback is executed with a single parameter:</span>
<span class="cm">         * the custom object parameter, if provided.&lt;/p&gt;</span>
<span class="cm">         *</span>
<span class="cm">         * @method onContentReady</span>
<span class="cm">         *</span>
<span class="cm">         * @param {string}   id the id of the element to look for.</span>
<span class="cm">         * @param {function} fn what to execute when the element is ready.</span>
<span class="cm">         * @param {object}   obj an optional object to be passed back as</span>
<span class="cm">         *                   a parameter to fn.</span>
<span class="cm">         * @param {boolean|object}  override If set to true, fn will execute</span>
<span class="cm">         *                   in the context of p_obj.  If an object, fn will</span>
<span class="cm">         *                   exectute in the context of that object</span>
<span class="cm">         *</span>
<span class="cm">         * @static</span>
<span class="cm">         * @deprecated Use Y.on(&quot;contentready&quot;)</span>
<span class="cm">         */</span>
        <span class="c1">// @TODO fix arguments</span>
        <span class="nx">onContentReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">override</span><span class="p">,</span> <span class="nx">compat</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">onAvailable</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">override</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">compat</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Adds an event listener</span>
<span class="cm">         *</span>
<span class="cm">         * @method attach</span>
<span class="cm">         *</span>
<span class="cm">         * @param {String}   type     The type of event to append</span>
<span class="cm">         * @param {Function} fn        The method the event invokes</span>
<span class="cm">         * @param {String|HTMLElement|Array|NodeList} el An id, an element</span>
<span class="cm">         *  reference, or a collection of ids and/or elements to assign the</span>
<span class="cm">         *  listener to.</span>
<span class="cm">         * @param {Object}   context optional context object</span>
<span class="cm">         * @param {Boolean|object}  args 0..n arguments to pass to the callback</span>
<span class="cm">         * @return {EventHandle} an object to that can be used to detach the listener</span>
<span class="cm">         *</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>

        <span class="nx">attach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
        <span class="p">},</span>

        <span class="nx">_createWrapper</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">capture</span><span class="p">,</span> <span class="nx">compat</span><span class="p">,</span> <span class="nx">facade</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">cewrapper</span><span class="p">,</span>
                <span class="nx">ek</span>  <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">el</span><span class="p">),</span>
                <span class="nx">key</span> <span class="o">=</span> <span class="s1">&#39;event:&#39;</span> <span class="o">+</span> <span class="nx">ek</span> <span class="o">+</span> <span class="nx">type</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">===</span> <span class="nx">facade</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">key</span> <span class="o">+=</span> <span class="s1">&#39;native&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">capture</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">key</span> <span class="o">+=</span> <span class="s1">&#39;capture&#39;</span><span class="p">;</span>
            <span class="p">}</span>


            <span class="nx">cewrapper</span> <span class="o">=</span> <span class="nx">_wrappers</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>


            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cewrapper</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// create CE wrapper</span>
                <span class="nx">cewrapper</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">silent</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nx">bubbles</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nx">contextFn</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">compat</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">el</span><span class="p">;</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">nodeRef</span> <span class="o">=</span> <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">nodeRef</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">cewrapper</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
                            <span class="k">return</span> <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">nodeRef</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">});</span>

                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">overrides</span> <span class="o">=</span> <span class="p">{};</span>

                <span class="c1">// for later removeListener calls</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">el</span><span class="p">;</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">domkey</span> <span class="o">=</span> <span class="nx">ek</span><span class="p">;</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="p">(</span><span class="nx">compat</span> <span class="o">||</span> <span class="p">(</span><span class="kc">false</span> <span class="o">===</span> <span class="nx">facade</span><span class="p">))));</span>
                <span class="p">};</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">capture</span> <span class="o">=</span> <span class="nx">capture</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">==</span> <span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;load&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// window load happens once</span>
                    <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">fireOnce</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">_windowLoadKey</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">_delete</span> <span class="o">=</span> <span class="nx">_deleteAndClean</span><span class="p">;</span>

                <span class="nx">_wrappers</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cewrapper</span><span class="p">;</span>
                <span class="nx">_el_events</span><span class="p">[</span><span class="nx">ek</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_el_events</span><span class="p">[</span><span class="nx">ek</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
                <span class="nx">_el_events</span><span class="p">[</span><span class="nx">ek</span><span class="p">][</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cewrapper</span><span class="p">;</span>

                <span class="nx">add</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">capture</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">cewrapper</span><span class="p">;</span>

        <span class="p">},</span>

        <span class="nx">_attach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">conf</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">compat</span><span class="p">,</span>
                <span class="nx">handles</span><span class="p">,</span> <span class="nx">oEl</span><span class="p">,</span> <span class="nx">cewrapper</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span>
                <span class="nx">fireNow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">ret</span><span class="p">,</span>
                <span class="nx">type</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="nx">fn</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="nx">el</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="nx">win</span><span class="p">,</span>
                <span class="nx">facade</span> <span class="o">=</span> <span class="nx">conf</span> <span class="o">&amp;&amp;</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">facade</span><span class="p">,</span>
                <span class="nx">capture</span> <span class="o">=</span> <span class="nx">conf</span> <span class="o">&amp;&amp;</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">capture</span><span class="p">,</span>
                <span class="nx">overrides</span> <span class="o">=</span> <span class="nx">conf</span> <span class="o">&amp;&amp;</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">overrides</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">COMPAT_ARG</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">compat</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="o">!</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// throw new TypeError(type + &quot; attach call failed, callback undefined&quot;);</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot; attach call failed, invalid callback&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// The el argument can be an array of elements or element ids.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">shouldIterate</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span> <span class="p">{</span>

                <span class="nx">handles</span><span class="o">=</span><span class="p">[];</span>

                <span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
                    <span class="nx">handles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(),</span> <span class="nx">conf</span><span class="p">));</span>
                <span class="p">});</span>

                <span class="c1">// return (handles.length === 1) ? handles[0] : handles;</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">(</span><span class="nx">handles</span><span class="p">);</span>

            <span class="c1">// If the el argument is a string, we assume it is</span>
            <span class="c1">// actually the id of the element.  If the page is loaded</span>
            <span class="c1">// we convert el to the actual element, otherwise we</span>
            <span class="c1">// defer attaching the event until the element is</span>
            <span class="c1">// ready</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span> <span class="p">{</span>

                <span class="c1">// oEl = (compat) ? Y.DOM.byId(el) : Y.Selector.query(el);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">compat</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">oEl</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

                    <span class="nx">oEl</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>

                    <span class="k">switch</span> <span class="p">(</span><span class="nx">oEl</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                            <span class="nx">oEl</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                            <span class="nx">oEl</span> <span class="o">=</span> <span class="nx">oEl</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">default</span><span class="o">:</span>
                            <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">oEl</span><span class="p">;</span>
                            <span class="k">return</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">conf</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">oEl</span><span class="p">)</span> <span class="p">{</span>

                    <span class="nx">el</span> <span class="o">=</span> <span class="nx">oEl</span><span class="p">;</span>

                <span class="c1">// Not found = defer adding the event until the element is available</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

                    <span class="c1">// Y.log(el + &#39; not found&#39;);</span>
                    <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">onAvailable</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="c1">// Y.log(&#39;lazy attach: &#39; + args);</span>

                        <span class="nx">ret</span><span class="p">.</span><span class="nx">handle</span> <span class="o">=</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">conf</span><span class="p">);</span>

                    <span class="p">},</span> <span class="nx">Event</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">compat</span><span class="p">);</span>

                    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>

                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// Element should be an html element or node</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;unable to attach event &quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">el</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">cewrapper</span> <span class="o">=</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">_createWrapper</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">capture</span><span class="p">,</span> <span class="nx">compat</span><span class="p">,</span> <span class="nx">facade</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">overrides</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">cewrapper</span><span class="p">.</span><span class="nx">overrides</span><span class="p">,</span> <span class="nx">overrides</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">==</span> <span class="nx">win</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;load&quot;</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// if the load is complete, fire immediately.</span>
                <span class="c1">// all subscribers, including the current one</span>
                <span class="c1">// will be notified.</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">windowLoaded</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">fireNow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">compat</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="nx">context</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

            <span class="c1">// set context to the Node if not specified</span>
            <span class="c1">// ret = cewrapper.on.apply(cewrapper, trimmedArgs);</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">_on</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">?</span> <span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">fireNow</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">cewrapper</span><span class="p">.</span><span class="nx">fire</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>

        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Removes an event listener.  Supports the signature the event was bound</span>
<span class="cm">         * with, but the preferred way to remove listeners is using the handle</span>
<span class="cm">         * that is returned when using Y.on</span>
<span class="cm">         *</span>
<span class="cm">         * @method detach</span>
<span class="cm">         *</span>
<span class="cm">         * @param {String} type the type of event to remove.</span>
<span class="cm">         * @param {Function} fn the method the event invokes.  If fn is</span>
<span class="cm">         * undefined, then all event handlers for the type of event are</span>
<span class="cm">         * removed.</span>
<span class="cm">         * @param {String|HTMLElement|Array|NodeList|EventHandle} el An</span>
<span class="cm">         * event handle, an id, an element reference, or a collection</span>
<span class="cm">         * of ids and/or elements to remove the listener from.</span>
<span class="cm">         * @return {boolean} true if the unbind was successful, false otherwise.</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">detach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">args</span><span class="o">=</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span> <span class="nx">compat</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">ok</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span>
                <span class="nx">id</span><span class="p">,</span> <span class="nx">ce</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">COMPAT_ARG</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">compat</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="c1">// args.pop();</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span><span class="p">.</span><span class="nx">detach</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">type</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// The el argument can be a string</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">el</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// el = (compat) ? Y.DOM.byId(el) : Y.all(el);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">compat</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">el</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">el</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
                    <span class="nx">l</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">l</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">el</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">el</span> <span class="o">=</span> <span class="nx">el</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="c1">// return Event.detach.apply(Event, args);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">detach</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">detach</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="c1">// The el argument can be an array of elements or element ids.</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">shouldIterate</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">el</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">el</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="nx">ok</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">detach</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">ok</span> <span class="p">);</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="nx">ok</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span> <span class="o">||</span> <span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="o">!</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">purgeElement</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;event:&#39;</span> <span class="o">+</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">+</span> <span class="nx">type</span><span class="p">;</span>
            <span class="nx">ce</span> <span class="o">=</span> <span class="nx">_wrappers</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">detach</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Finds the event in the window object, the caller&#39;s arguments, or</span>
<span class="cm">         * in the arguments of another method in the callstack.  This is</span>
<span class="cm">         * executed automatically for events registered through the event</span>
<span class="cm">         * manager, so the implementer should not normally need to execute</span>
<span class="cm">         * this function at all.</span>
<span class="cm">         * @method getEvent</span>
<span class="cm">         * @param {Event} e the event parameter from the handler</span>
<span class="cm">         * @param {HTMLElement} el the element the listener was attached to</span>
<span class="cm">         * @return {Event} the event</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">getEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">noFacade</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ev</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">||</span> <span class="nx">win</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>

            <span class="k">return</span> <span class="p">(</span><span class="nx">noFacade</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ev</span> <span class="o">:</span>
                <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOMEventFacade</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">_wrappers</span><span class="p">[</span><span class="s1">&#39;event:&#39;</span> <span class="o">+</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">]);</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Generates an unique ID for the element if it does not already</span>
<span class="cm">         * have one.</span>
<span class="cm">         * @method generateId</span>
<span class="cm">         * @param el the element to create the id for</span>
<span class="cm">         * @return {string} the resulting id of the element</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">generateId</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">generateID</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * We want to be able to use getElementsByTagName as a collection</span>
<span class="cm">         * to attach a group of events to.  Unfortunately, different</span>
<span class="cm">         * browsers return different types of collections.  This function</span>
<span class="cm">         * tests to determine if the object is array-like.  It will also</span>
<span class="cm">         * fail if the object is an array, but is empty.</span>
<span class="cm">         * @method _isValidCollection</span>
<span class="cm">         * @param o the object to test</span>
<span class="cm">         * @return {boolean} true if the object is array-like and populated</span>
<span class="cm">         * @deprecated was not meant to be used directly</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">_isValidCollection</span><span class="o">:</span> <span class="nx">shouldIterate</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * hook up any deferred listeners</span>
<span class="cm">         * @method _load</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">_load</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_loadComplete</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Y.log(&#39;Load Complete&#39;, &#39;info&#39;, &#39;event&#39;);</span>
                <span class="nx">_loadComplete</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                <span class="c1">// Just in case DOMReady did not go off for some reason</span>
                <span class="c1">// E._ready();</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">EVENT_READY</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// Available elements may not have been detected before the</span>
                <span class="c1">// window load event fires. Try to find them now so that the</span>
                <span class="c1">// the user is more likely to get the onAvailable notifications</span>
                <span class="c1">// before the window load notification</span>
                <span class="nx">Event</span><span class="p">.</span><span class="nx">_poll</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Polling function that runs before the onload event fires,</span>
<span class="cm">         * attempting to attach to DOM Nodes as soon as they are</span>
<span class="cm">         * available</span>
<span class="cm">         * @method _poll</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">_poll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">locked</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">DOMReady</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Hold off if DOMReady has not fired and check current</span>
                <span class="c1">// readyState to protect against the IE operation aborted</span>
                <span class="c1">// issue.</span>
                <span class="nx">Event</span><span class="p">.</span><span class="nx">startInterval</span><span class="p">();</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">Event</span><span class="p">.</span><span class="nx">locked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="c1">// Y.log.debug(&quot;poll&quot;);</span>
            <span class="c1">// keep trying until after the page is loaded.  We need to</span>
            <span class="c1">// check the page load state prior to trying to bind the</span>
            <span class="c1">// elements so that we can be certain all elements have been</span>
            <span class="c1">// tested appropriately</span>
            <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">notAvail</span><span class="p">,</span> <span class="nx">executeItem</span><span class="p">,</span>
                <span class="nx">tryAgain</span> <span class="o">=</span> <span class="o">!</span><span class="nx">_loadComplete</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tryAgain</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">tryAgain</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_retryCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// onAvailable</span>
            <span class="nx">notAvail</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="nx">executeItem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">ov</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">override</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">compat</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">override</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">ov</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">context</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">obj</span><span class="p">;</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">context</span> <span class="o">=</span> <span class="nx">ov</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">context</span> <span class="o">=</span> <span class="nx">el</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">item</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">obj</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">context</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">obj</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
                    <span class="nx">item</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">ov</span><span class="p">))</span> <span class="o">?</span> <span class="nx">ov</span> <span class="o">:</span> <span class="p">[]);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="c1">// onAvailable</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">_avail</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">item</span> <span class="o">=</span> <span class="nx">_avail</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">checkReady</span><span class="p">)</span> <span class="p">{</span>

                    <span class="c1">// el = (item.compat) ? Y.DOM.byId(item.id) : Y.one(item.id);</span>
                    <span class="nx">el</span> <span class="o">=</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">compat</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Y.log(&#39;avail: &#39; + el);</span>
                        <span class="nx">executeItem</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
                        <span class="nx">_avail</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// Y.log(&#39;NOT avail: &#39; + el);</span>
                        <span class="nx">notAvail</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// onContentReady</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">_avail</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">item</span> <span class="o">=</span> <span class="nx">_avail</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">checkReady</span><span class="p">)</span> <span class="p">{</span>

                    <span class="c1">// el = (item.compat) ? Y.DOM.byId(item.id) : Y.one(item.id);</span>
                    <span class="nx">el</span> <span class="o">=</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">compat</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// The element is available, but not necessarily ready</span>
                        <span class="c1">// @todo should we test parentNode.nextSibling?</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">_loadComplete</span> <span class="o">||</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">get</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;nextSibling&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="nx">el</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">executeItem</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
                            <span class="nx">_avail</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">notAvail</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nx">_retryCount</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notAvail</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">_retryCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">tryAgain</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// we may need to strip the nulled out items here</span>
                <span class="nx">Event</span><span class="p">.</span><span class="nx">startInterval</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_interval</span><span class="p">);</span>
                <span class="nx">Event</span><span class="p">.</span><span class="nx">_interval</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">Event</span><span class="p">.</span><span class="nx">locked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="k">return</span><span class="p">;</span>

        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Removes all listeners attached to the given element via addListener.</span>
<span class="cm">         * Optionally, the node&#39;s children can also be purged.</span>
<span class="cm">         * Optionally, you can specify a specific type of event to remove.</span>
<span class="cm">         * @method purgeElement</span>
<span class="cm">         * @param {HTMLElement} el the element to purge</span>
<span class="cm">         * @param {boolean} recurse recursively purge this element&#39;s children</span>
<span class="cm">         * as well.  Use with caution.</span>
<span class="cm">         * @param {string} type optional type of listener to purge. If</span>
<span class="cm">         * left out, all listeners will be removed</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">purgeElement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">recurse</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// var oEl = (Y.Lang.isString(el)) ? Y.one(el) : el,</span>
            <span class="kd">var</span> <span class="nx">oEl</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span> <span class="o">?</span>  <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
                <span class="nx">lis</span> <span class="o">=</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">getListeners</span><span class="p">(</span><span class="nx">oEl</span><span class="p">,</span> <span class="nx">type</span><span class="p">),</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">child</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">recurse</span> <span class="o">&amp;&amp;</span> <span class="nx">oEl</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">lis</span> <span class="o">=</span> <span class="nx">lis</span> <span class="o">||</span> <span class="p">[];</span>
                <span class="nx">children</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="nx">oEl</span><span class="p">);</span>
                <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">len</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span> <span class="o">=</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">getListeners</span><span class="p">(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">type</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">lis</span> <span class="o">=</span> <span class="nx">lis</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">child</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">lis</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">lis</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">lis</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">detachAll</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Removes all object references and the DOM proxy subscription for</span>
<span class="cm">         * a given event for a DOM node.</span>
<span class="cm">         *</span>
<span class="cm">         * @method _clean</span>
<span class="cm">         * @param wrapper {CustomEvent} Custom event proxy for the DOM</span>
<span class="cm">         *                  subscription</span>
<span class="cm">         * @private</span>
<span class="cm">         * @static</span>
<span class="cm">         * @since 3.4.0</span>
<span class="cm">         */</span>
        <span class="nx">_clean</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">wrapper</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">key</span>    <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
                <span class="nx">domkey</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">domkey</span><span class="p">;</span>

            <span class="nx">remove</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">el</span><span class="p">,</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">capture</span><span class="p">);</span>
            <span class="k">delete</span> <span class="nx">_wrappers</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="k">delete</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">_yuievt</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">_el_events</span><span class="p">[</span><span class="nx">domkey</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="nx">_el_events</span><span class="p">[</span><span class="nx">domkey</span><span class="p">][</span><span class="nx">key</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">_el_events</span><span class="p">[</span><span class="nx">domkey</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="nx">_el_events</span><span class="p">[</span><span class="nx">domkey</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Returns all listeners attached to the given element via addListener.</span>
<span class="cm">         * Optionally, you can specify a specific type of event to return.</span>
<span class="cm">         * @method getListeners</span>
<span class="cm">         * @param el {HTMLElement|string} the element or element id to inspect</span>
<span class="cm">         * @param type {string} optional type of listener to return. If</span>
<span class="cm">         * left out, all listeners will be returned</span>
<span class="cm">         * @return {Y.Custom.Event} the custom event wrapper for the DOM event(s)</span>
<span class="cm">         * @static</span>
<span class="cm">         */</span>
        <span class="nx">getListeners</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ek</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">_el_events</span><span class="p">[</span><span class="nx">ek</span><span class="p">],</span>
                <span class="nx">results</span><span class="o">=</span><span class="p">[]</span> <span class="p">,</span> <span class="nx">key</span> <span class="o">=</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;event:&#39;</span> <span class="o">+</span> <span class="nx">ek</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
                <span class="nx">adapters</span> <span class="o">=</span> <span class="nx">_eventenv</span><span class="p">.</span><span class="nx">plugins</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">evts</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// look for synthetic events</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">adapters</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">adapters</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">eventDef</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">key</span> <span class="o">+=</span> <span class="s1">&#39;_synth&#39;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">evts</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">evts</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
                <span class="p">}</span>

                <span class="c1">// get native events as well</span>
                <span class="nx">key</span> <span class="o">+=</span> <span class="s1">&#39;native&#39;</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">evts</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">evts</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
                <span class="p">}</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">evts</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">?</span> <span class="nx">results</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Removes all listeners registered by pe.event.  Called</span>
<span class="cm">         * automatically during the unload event.</span>
<span class="cm">         * @method _unload</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">_unload</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_wrappers</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;unload&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">v</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">v</span><span class="p">.</span><span class="nx">detachAll</span><span class="p">();</span>
            <span class="p">});</span>
            <span class="nx">remove</span><span class="p">(</span><span class="nx">win</span><span class="p">,</span> <span class="s2">&quot;unload&quot;</span><span class="p">,</span> <span class="nx">onUnload</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Adds a DOM event directly without the caching, cleanup, context adj, etc</span>
<span class="cm">         *</span>
<span class="cm">         * @method nativeAdd</span>
<span class="cm">         * @param {HTMLElement} el      the element to bind the handler to</span>
<span class="cm">         * @param {string}      type   the type of event handler</span>
<span class="cm">         * @param {function}    fn      the callback to invoke</span>
<span class="cm">         * @param {boolen}      capture capture or bubble phase</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">nativeAdd</span><span class="o">:</span> <span class="nx">add</span><span class="p">,</span>

        <span class="cm">/**</span>
<span class="cm">         * Basic remove listener</span>
<span class="cm">         *</span>
<span class="cm">         * @method nativeRemove</span>
<span class="cm">         * @param {HTMLElement} el      the element to bind the handler to</span>
<span class="cm">         * @param {string}      type   the type of event handler</span>
<span class="cm">         * @param {function}    fn      the callback to invoke</span>
<span class="cm">         * @param {boolen}      capture capture or bubble phase</span>
<span class="cm">         * @static</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">nativeRemove</span><span class="o">:</span> <span class="nx">remove</span>
    <span class="p">};</span>

<span class="p">}();</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span> <span class="o">=</span> <span class="nx">Event</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">injected</span> <span class="o">||</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">windowLoaded</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">onLoad</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">add</span><span class="p">(</span><span class="nx">win</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="nx">onLoad</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Process onAvailable/onContentReady items when when the DOM is ready in IE</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">EVENT_READY</span><span class="p">,</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">_poll</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">add</span><span class="p">(</span><span class="nx">win</span><span class="p">,</span> <span class="s2">&quot;unload&quot;</span><span class="p">,</span> <span class="nx">onUnload</span><span class="p">);</span>

<span class="nx">Event</span><span class="p">.</span><span class="nx">Custom</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">;</span>
<span class="nx">Event</span><span class="p">.</span><span class="nx">Subscriber</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Subscriber</span><span class="p">;</span>
<span class="nx">Event</span><span class="p">.</span><span class="nx">Target</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventTarget</span><span class="p">;</span>
<span class="nx">Event</span><span class="p">.</span><span class="nx">Handle</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">;</span>
<span class="nx">Event</span><span class="p">.</span><span class="nx">Facade</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventFacade</span><span class="p">;</span>

<span class="nx">Event</span><span class="p">.</span><span class="nx">_poll</span><span class="p">();</span>

<span class="p">})();</span>

<span class="cm">/**</span>
<span class="cm"> * DOM event listener abstraction layer</span>
<span class="cm"> * @module event</span>
<span class="cm"> * @submodule event-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Executes the callback as soon as the specified element</span>
<span class="cm"> * is detected in the DOM.  This function expects a selector</span>
<span class="cm"> * string for the element(s) to detect.  If you already have</span>
<span class="cm"> * an element reference, you don&#39;t need this event.</span>
<span class="cm"> * @event available</span>
<span class="cm"> * @param type {string} &#39;available&#39;</span>
<span class="cm"> * @param fn {function} the callback function to execute.</span>
<span class="cm"> * @param el {string} an selector for the element(s) to attach</span>
<span class="cm"> * @param context optional argument that specifies what &#39;this&#39; refers to.</span>
<span class="cm"> * @param args* 0..n additional arguments to pass on to the callback function.</span>
<span class="cm"> * These arguments will be added after the event object.</span>
<span class="cm"> * @return {EventHandle} the detach handle</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">available</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">?</span>  <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">onAvailable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Executes the callback as soon as the specified element</span>
<span class="cm"> * is detected in the DOM with a nextSibling property</span>
<span class="cm"> * (indicating that the element&#39;s children are available).</span>
<span class="cm"> * This function expects a selector</span>
<span class="cm"> * string for the element(s) to detect.  If you already have</span>
<span class="cm"> * an element reference, you don&#39;t need this event.</span>
<span class="cm"> * @event contentready</span>
<span class="cm"> * @param type {string} &#39;contentready&#39;</span>
<span class="cm"> * @param fn {function} the callback function to execute.</span>
<span class="cm"> * @param el {string} an selector for the element(s) to attach.</span>
<span class="cm"> * @param context optional argument that specifies what &#39;this&#39; refers to.</span>
<span class="cm"> * @param args* 0..n additional arguments to pass on to the callback function.</span>
<span class="cm"> * These arguments will be added after the event object.</span>
<span class="cm"> * @return {EventHandle} the detach handle</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">contentready</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">onContentReady</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;event-custom-base&#39;</span><span class="p">]});</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">stateChangeListener</span><span class="p">,</span>
    <span class="nx">GLOBAL_ENV</span>   <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">Env</span><span class="p">,</span>
    <span class="nx">config</span>       <span class="o">=</span> <span class="nx">YUI</span><span class="p">.</span><span class="nx">config</span><span class="p">,</span>
    <span class="nx">doc</span>          <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">,</span>
    <span class="nx">docElement</span>   <span class="o">=</span> <span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
    <span class="nx">EVENT_NAME</span>   <span class="o">=</span> <span class="s1">&#39;onreadystatechange&#39;</span><span class="p">,</span>
    <span class="nx">pollInterval</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">pollInterval</span> <span class="o">||</span> <span class="mi">40</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">docElement</span><span class="p">.</span><span class="nx">doScroll</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ieready</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ieready</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ready</span><span class="p">();</span>
    <span class="p">};</span>

<span class="cm">/*! DOMReady: based on work by: Dean Edwards/John Resig/Matthias Miller/Diego Perini */</span>
<span class="c1">// Internet Explorer: use the doScroll() method on the root element.</span>
<span class="c1">// This isolates what appears to be a safe moment to manipulate the</span>
<span class="c1">// DOM prior to when the document&#39;s readyState suggests it is safe to do so.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span> <span class="o">!==</span> <span class="nx">self</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">stateChangeListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">EVENT_NAME</span><span class="p">,</span> <span class="nx">stateChangeListener</span><span class="p">);</span>
                <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">ieready</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">EVENT_NAME</span><span class="p">,</span> <span class="nx">stateChangeListener</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_dri</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">docElement</span><span class="p">.</span><span class="nx">doScroll</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">);</span>
                <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_dri</span><span class="p">);</span>
                <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_dri</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="nx">GLOBAL_ENV</span><span class="p">.</span><span class="nx">_ieready</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">domNotReady</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
        <span class="p">},</span> <span class="nx">pollInterval</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">})();</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;event-base-ie&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/*</span>
<span class="cm"> * Custom event engine, DOM event listener abstraction layer, synthetic DOM</span>
<span class="cm"> * events.</span>
<span class="cm"> * @module event</span>
<span class="cm"> * @submodule event-base</span>
<span class="cm"> */</span>

<span class="kd">function</span> <span class="nx">IEEventFacade</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// IEEventFacade.superclass.constructor.apply(this, arguments);</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM2EventFacade</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * (intentially left out of API docs)</span>
<span class="cm"> * Alternate Facade implementation that is based on Object.defineProperty, which</span>
<span class="cm"> * is partially supported in IE8.  Properties that involve setup work are</span>
<span class="cm"> * deferred to temporary getters using the static _define method.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">IELazyFacade</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createEventObject</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span>
        <span class="nx">proto</span> <span class="o">=</span> <span class="nx">IELazyFacade</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>

    <span class="c1">// TODO: necessary?</span>
    <span class="nx">proxy</span><span class="p">.</span><span class="nx">hasOwnProperty</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">};</span>

    <span class="nx">proxy</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">.</span><span class="nx">init</span><span class="p">;</span>
    <span class="nx">proxy</span><span class="p">.</span><span class="nx">halt</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">.</span><span class="nx">halt</span><span class="p">;</span>
    <span class="nx">proxy</span><span class="p">.</span><span class="nx">preventDefault</span>           <span class="o">=</span> <span class="nx">proto</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">;</span>
    <span class="nx">proxy</span><span class="p">.</span><span class="nx">stopPropagation</span>          <span class="o">=</span> <span class="nx">proto</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">;</span>
    <span class="nx">proxy</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">;</span>

    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM2EventFacade</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">proxy</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">proxy</span><span class="p">;</span>
<span class="p">}</span>


<span class="kd">var</span> <span class="nx">imp</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">implementation</span><span class="p">,</span>
    <span class="nx">useLazyFacade</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">lazyEventFacade</span><span class="p">,</span>

    <span class="nx">buttonMap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">2</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="mi">4</span><span class="o">:</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="nx">relatedTargetMap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">mouseout</span><span class="o">:</span> <span class="s1">&#39;toElement&#39;</span><span class="p">,</span>
        <span class="nx">mouseover</span><span class="o">:</span> <span class="s1">&#39;fromElement&#39;</span>
    <span class="p">},</span>

    <span class="nx">resolve</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM2EventFacade</span><span class="p">.</span><span class="nx">resolve</span><span class="p">,</span>

    <span class="nx">proto</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

            <span class="nx">IEEventFacade</span><span class="p">.</span><span class="nx">superclass</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">,</span>
                <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">de</span><span class="p">,</span> <span class="nx">t</span><span class="p">;</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;clientX&#39;</span> <span class="k">in</span> <span class="nx">e</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mi">0</span> <span class="o">!==</span> <span class="nx">x</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
                <span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>

                <span class="nx">d</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
                <span class="nx">b</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
                <span class="nx">de</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

                <span class="nx">x</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">de</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
                <span class="nx">y</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">de</span><span class="p">.</span><span class="nx">scrollTop</span>  <span class="o">||</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">)</span>  <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;mouseout&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">t</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">toElement</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;mouseover&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">t</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">fromElement</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// fallback to t.relatedTarget to support simulated events.</span>
            <span class="c1">// IE doesn&#39;t support setting toElement or fromElement on generic</span>
            <span class="c1">// events, so Y.Event.simulate sets relatedTarget instead.</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">relatedTarget</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">t</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">);</span>

            <span class="c1">// which should contain the unicode key code if this is a key event</span>
            <span class="c1">// if (e.charCode) {</span>
            <span class="c1">//     this.which = e.charCode;</span>
            <span class="c1">// }</span>

            <span class="c1">// for click events, which is normalized for which mouse button was</span>
            <span class="c1">// clicked.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">which</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">button</span> <span class="o">=</span> <span class="nx">buttonMap</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">]</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">},</span>

        <span class="nx">stopPropagation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">cancelBubble</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">stopImmediatePropagation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stopped</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">preventDefault</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">returnValue</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">prevented</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">prevented</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">IEEventFacade</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM2EventFacade</span><span class="p">,</span> <span class="nx">proto</span><span class="p">);</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">IELazyFacade</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM2EventFacade</span><span class="p">,</span> <span class="nx">proto</span><span class="p">);</span>
<span class="nx">IELazyFacade</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span>         <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">,</span>
        <span class="nx">overrides</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">.</span><span class="nx">overrides</span><span class="p">,</span>
        <span class="nx">define</span>    <span class="o">=</span> <span class="nx">IELazyFacade</span><span class="p">.</span><span class="nx">_define</span><span class="p">,</span>
        <span class="nx">lazyProperties</span> <span class="o">=</span> <span class="nx">IELazyFacade</span><span class="p">.</span><span class="nx">_lazyProperties</span><span class="p">,</span>
        <span class="nx">prop</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">altKey</span>   <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ctrlKey</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metaKey</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shiftKey</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span>     <span class="o">=</span> <span class="p">(</span><span class="nx">overrides</span> <span class="o">&amp;&amp;</span> <span class="nx">overrides</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clientX</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clientY</span>  <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">lazyProperties</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lazyProperties</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">define</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">lazyProperties</span><span class="p">[</span><span class="nx">prop</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_touch</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_touch</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentTarget</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_wrapper</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">IELazyFacade</span><span class="p">.</span><span class="nx">_lazyProperties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">charCode</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">keyCode</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">charCode</span><span class="p">;</span> <span class="p">},</span>

    <span class="nx">button</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">)</span> <span class="o">?</span>
            <span class="p">(</span><span class="nx">buttonMap</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">]</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">button</span><span class="p">)</span> <span class="o">:</span>
            <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">charCode</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">which</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">button</span><span class="p">;</span> <span class="p">},</span>

    <span class="nx">target</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">relatedTarget</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">,</span>
            <span class="nx">targetProp</span> <span class="o">=</span> <span class="nx">relatedTargetMap</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;relatedTarget&#39;</span><span class="p">;</span>

        <span class="c1">// fallback to t.relatedTarget to support simulated events.</span>
        <span class="c1">// IE doesn&#39;t support setting toElement or fromElement on generic</span>
        <span class="c1">// events, so Y.Event.simulate sets relatedTarget instead.</span>
        <span class="k">return</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">targetProp</span><span class="p">]</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">currentTarget</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentTarget</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">wheelDelta</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mousewheel&quot;</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;DOMMouseScroll&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">)</span> <span class="o">?</span>
                <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span>
                <span class="c1">// wheelDelta between -80 and 80 result in -1 or 1</span>
                <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)</span> <span class="o">||</span> <span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">pageX</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">,</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span>
            <span class="nx">doc</span><span class="p">,</span> <span class="nx">bodyScroll</span><span class="p">,</span> <span class="nx">docScroll</span><span class="p">;</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
            <span class="nx">bodyScroll</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">;</span>
            <span class="nx">docScroll</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">;</span>

            <span class="nx">val</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">+</span> <span class="p">(</span><span class="nx">docScroll</span> <span class="o">||</span> <span class="nx">bodyScroll</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">pageY</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">,</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span><span class="p">,</span>
            <span class="nx">doc</span><span class="p">,</span> <span class="nx">bodyScroll</span><span class="p">,</span> <span class="nx">docScroll</span><span class="p">;</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
            <span class="nx">bodyScroll</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
            <span class="nx">docScroll</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>

            <span class="nx">val</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">+</span> <span class="p">(</span><span class="nx">docScroll</span> <span class="o">||</span> <span class="nx">bodyScroll</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>


<span class="cm">/**</span>
<span class="cm"> * Wrapper function for Object.defineProperty that creates a property whose</span>
<span class="cm"> * value will be calulated only when asked for.  After calculating the value,</span>
<span class="cm"> * the getter wll be removed, so it will behave as a normal property beyond that</span>
<span class="cm"> * point.  A setter is also assigned so assigning to the property will clear</span>
<span class="cm"> * the getter, so foo.prop = &#39;a&#39;; foo.prop; won&#39;t trigger the getter,</span>
<span class="cm"> * overwriting value &#39;a&#39;.</span>
<span class="cm"> *</span>
<span class="cm"> * Used only by the DOMEventFacades used by IE8 when the YUI configuration</span>
<span class="cm"> * &lt;code&gt;lazyEventFacade&lt;/code&gt; is set to true.</span>
<span class="cm"> *</span>
<span class="cm"> * @method _define</span>
<span class="cm"> * @param o {DOMObject} A DOM object to add the property to</span>
<span class="cm"> * @param prop {String} The name of the new property</span>
<span class="cm"> * @param valueFn {Function} The function that will return the initial, default</span>
<span class="cm"> *                  value for the property.</span>
<span class="cm"> * @static</span>
<span class="cm"> * @private</span>
<span class="cm"> */</span>
<span class="nx">IELazyFacade</span><span class="p">.</span><span class="nx">_define</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">valueFn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">val</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">?</span> <span class="nx">v</span> <span class="o">:</span> <span class="nx">valueFn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="k">delete</span> <span class="nx">o</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">value</span><span class="o">:</span> <span class="nx">ret</span><span class="p">,</span>
            <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">writable</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">get</span><span class="o">:</span> <span class="nx">val</span><span class="p">,</span>
        <span class="nx">set</span><span class="o">:</span> <span class="nx">val</span><span class="p">,</span>
        <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">imp</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">imp</span><span class="p">.</span><span class="nx">hasFeature</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0&#39;</span><span class="p">)))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">useLazyFacade</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Make sure we can use the lazy facade logic</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createEventObject</span><span class="p">(),</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="p">{});</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">useLazyFacade</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
        
    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOMEventFacade</span> <span class="o">=</span> <span class="p">(</span><span class="nx">useLazyFacade</span><span class="p">)</span> <span class="o">?</span> <span class="nx">IELazyFacade</span> <span class="o">:</span> <span class="nx">IEEventFacade</span><span class="p">;</span>
<span class="p">}</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">after</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;event-base&#39;</span><span class="p">],</span> <span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;node-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;pluginhost-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Provides the augmentable PluginHost interface, which can be added to any class.</span>
<span class="cm">     * @module pluginhost</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Provides the augmentable PluginHost interface, which can be added to any class.</span>
<span class="cm">     * @module pluginhost-base</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * &lt;p&gt;</span>
<span class="cm">     * An augmentable class, which provides the augmented class with the ability to host plugins.</span>
<span class="cm">     * It adds &lt;a href=&quot;#method_plug&quot;&gt;plug&lt;/a&gt; and &lt;a href=&quot;#method_unplug&quot;&gt;unplug&lt;/a&gt; methods to the augmented class, which can </span>
<span class="cm">     * be used to add or remove plugins from instances of the class.</span>
<span class="cm">     * &lt;/p&gt;</span>
<span class="cm">     *</span>
<span class="cm">     * &lt;p&gt;Plugins can also be added through the constructor configuration object passed to the host class&#39; constructor using</span>
<span class="cm">     * the &quot;plugins&quot; property. Supported values for the &quot;plugins&quot; property are those defined by the &lt;a href=&quot;#method_plug&quot;&gt;plug&lt;/a&gt; method. </span>
<span class="cm">     * </span>
<span class="cm">     * For example the following code would add the AnimPlugin and IOPlugin to Overlay (the plugin host):</span>
<span class="cm">     * &lt;xmp&gt;</span>
<span class="cm">     * var o = new Overlay({plugins: [ AnimPlugin, {fn:IOPlugin, cfg:{section:&quot;header&quot;}}]});</span>
<span class="cm">     * &lt;/xmp&gt;</span>
<span class="cm">     * &lt;/p&gt;</span>
<span class="cm">     * &lt;p&gt;</span>
<span class="cm">     * Plug.Host&#39;s protected &lt;a href=&quot;#method_initPlugins&quot;&gt;_initPlugins&lt;/a&gt; and &lt;a href=&quot;#method_destroyPlugins&quot;&gt;_destroyPlugins&lt;/a&gt; </span>
<span class="cm">     * methods should be invoked by the host class at the appropriate point in the host&#39;s lifecyle.  </span>
<span class="cm">     * &lt;/p&gt;</span>
<span class="cm">     *</span>
<span class="cm">     * @class Plugin.Host</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">L</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">PluginHost</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="nx">PluginHost</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

        <span class="cm">/**</span>
<span class="cm">         * Adds a plugin to the host object. This will instantiate the </span>
<span class="cm">         * plugin and attach it to the configured namespace on the host object.</span>
<span class="cm">         *</span>
<span class="cm">         * @method plug</span>
<span class="cm">         * @chainable</span>
<span class="cm">         * @param P {Function | Object |Array} Accepts the plugin class, or an </span>
<span class="cm">         * object with a &quot;fn&quot; property specifying the plugin class and </span>
<span class="cm">         * a &quot;cfg&quot; property specifying the configuration for the Plugin.</span>
<span class="cm">         * &lt;p&gt;</span>
<span class="cm">         * Additionally an Array can also be passed in, with the above function or </span>
<span class="cm">         * object values, allowing the user to add multiple plugins in a single call.</span>
<span class="cm">         * &lt;/p&gt;</span>
<span class="cm">         * @param config (Optional) If the first argument is the plugin class, the second argument</span>
<span class="cm">         * can be the configuration for the plugin.</span>
<span class="cm">         * @return {Base} A reference to the host object</span>
<span class="cm">         */</span>
        <span class="nx">plug</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Plugin</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ln</span><span class="p">,</span> <span class="nx">ns</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">Plugin</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ln</span> <span class="o">=</span> <span class="nx">Plugin</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ln</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">plug</span><span class="p">(</span><span class="nx">Plugin</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Plugin</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">Plugin</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">config</span> <span class="o">=</span> <span class="nx">Plugin</span><span class="p">.</span><span class="nx">cfg</span><span class="p">;</span>
                    <span class="nx">Plugin</span> <span class="o">=</span> <span class="nx">Plugin</span><span class="p">.</span><span class="nx">fn</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// Plugin should be fn by now</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Plugin</span> <span class="o">&amp;&amp;</span> <span class="nx">Plugin</span><span class="p">.</span><span class="nx">NS</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ns</span> <span class="o">=</span> <span class="nx">Plugin</span><span class="p">.</span><span class="nx">NS</span><span class="p">;</span>
        
                    <span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span> <span class="o">||</span> <span class="p">{};</span>
                    <span class="nx">config</span><span class="p">.</span><span class="nx">host</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasPlugin</span><span class="p">(</span><span class="nx">ns</span><span class="p">))</span> <span class="p">{</span>
                        <span class="c1">// Update config</span>
                        <span class="k">this</span><span class="p">[</span><span class="nx">ns</span><span class="p">].</span><span class="nx">setAttrs</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// Create new instance</span>
                        <span class="k">this</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Plugin</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Plugin</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Attempt to plug in an invalid plugin. Host:&quot;</span> <span class="o">+</span> <span class="k">this</span> <span class="o">+</span> <span class="s2">&quot;, Plugin:&quot;</span> <span class="o">+</span> <span class="nx">Plugin</span><span class="p">);</span> <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Removes a plugin from the host object. This will destroy the </span>
<span class="cm">         * plugin instance and delete the namepsace from the host object. </span>
<span class="cm">         *</span>
<span class="cm">         * @method unplug</span>
<span class="cm">         * @param {String | Function} plugin The namespace of the plugin, or the plugin class with the static NS namespace property defined. If not provided,</span>
<span class="cm">         * all registered plugins are unplugged.</span>
<span class="cm">         * @return {Base} A reference to the host object</span>
<span class="cm">         * @chainable</span>
<span class="cm">         */</span>
        <span class="nx">unplug</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">plugin</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ns</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">,</span> 
                <span class="nx">plugins</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span><span class="p">;</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nx">plugin</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">plugin</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">ns</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">NS</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">ns</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span> <span class="o">||</span> <span class="nx">plugins</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">plugin</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">ns</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
        
                <span class="k">if</span> <span class="p">(</span><span class="nx">ns</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">ns</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">[</span><span class="nx">ns</span><span class="p">].</span><span class="nx">destroy</span><span class="p">();</span>
                        <span class="k">delete</span> <span class="k">this</span><span class="p">[</span><span class="nx">ns</span><span class="p">];</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">ns</span><span class="p">])</span> <span class="p">{</span>
                        <span class="k">delete</span> <span class="nx">plugins</span><span class="p">[</span><span class="nx">ns</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">ns</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">ns</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">unplug</span><span class="p">(</span><span class="nx">ns</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Determines if a plugin has plugged into this host.</span>
<span class="cm">         *</span>
<span class="cm">         * @method hasPlugin</span>
<span class="cm">         * @param {String} ns The plugin&#39;s namespace</span>
<span class="cm">         * @return {boolean} returns true, if the plugin has been plugged into this host, false otherwise.</span>
<span class="cm">         */</span>
        <span class="nx">hasPlugin</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ns</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="nx">ns</span><span class="p">]);</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Initializes static plugins registered on the host (using the</span>
<span class="cm">         * Base.plug static method) and any plugins passed to the </span>
<span class="cm">         * instance through the &quot;plugins&quot; configuration property.</span>
<span class="cm">         *</span>
<span class="cm">         * @method _initPlugins</span>
<span class="cm">         * @param {Config} config The configuration object with property name/value pairs.</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        
        <span class="nx">_initPlugins</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_plugins</span> <span class="o">||</span> <span class="p">{};</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_initConfigPlugins</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_initConfigPlugins</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="cm">/**</span>
<span class="cm">         * Unplugs and destroys all plugins on the host</span>
<span class="cm">         * @method _destroyPlugins</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="nx">_destroyPlugins</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">unplug</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;Plugin&quot;</span><span class="p">).</span><span class="nx">Host</span> <span class="o">=</span> <span class="nx">PluginHost</span><span class="p">;</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;pluginhost-config&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Adds pluginhost constructor configuration and static configuration support</span>
<span class="cm">     * @submodule pluginhost-config</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Constructor and static configuration support for plugins</span>
<span class="cm">     * </span>
<span class="cm">     * @for Plugin.Host</span>
<span class="cm">     */</span>
    <span class="kd">var</span> <span class="nx">PluginHost</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span>
        <span class="nx">L</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">;</span>

    <span class="nx">PluginHost</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_initConfigPlugins</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Class Configuration</span>
        <span class="kd">var</span> <span class="nx">classes</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_getClasses</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getClasses</span><span class="p">()</span> <span class="o">:</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">],</span>
            <span class="nx">plug</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">unplug</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">constructor</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">classPlug</span><span class="p">,</span> <span class="nx">classUnplug</span><span class="p">,</span> <span class="nx">pluginClassName</span><span class="p">;</span>

        <span class="c1">// TODO: Room for optimization. Can we apply statically/unplug in same pass?</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">constructor</span> <span class="o">=</span> <span class="nx">classes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="nx">classUnplug</span> <span class="o">=</span> <span class="nx">constructor</span><span class="p">.</span><span class="nx">_UNPLUG</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">classUnplug</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// subclasses over-write</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">unplug</span><span class="p">,</span> <span class="nx">classUnplug</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">classPlug</span> <span class="o">=</span> <span class="nx">constructor</span><span class="p">.</span><span class="nx">_PLUG</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">classPlug</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// subclasses over-write</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">plug</span><span class="p">,</span> <span class="nx">classPlug</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">pluginClassName</span> <span class="k">in</span> <span class="nx">plug</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">plug</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">pluginClassName</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">unplug</span><span class="p">[</span><span class="nx">pluginClassName</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">plug</span><span class="p">(</span><span class="nx">plug</span><span class="p">[</span><span class="nx">pluginClassName</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// User Configuration</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">plugins</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">plug</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">plugins</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="cm">/**</span>
<span class="cm">     * Registers plugins to be instantiated at the class level (plugins </span>
<span class="cm">     * which should be plugged into every instance of the class by default).</span>
<span class="cm">     *</span>
<span class="cm">     * @method Plugin.Host.plug</span>
<span class="cm">     * @static</span>
<span class="cm">     *</span>
<span class="cm">     * @param {Function} hostClass The host class on which to register the plugins</span>
<span class="cm">     * @param {Function | Array} plugin Either the plugin class, an array of plugin classes or an array of objects (with fn and cfg properties defined)</span>
<span class="cm">     * @param {Object} config (Optional) If plugin is the plugin class, the configuration for the plugin</span>
<span class="cm">     */</span>
    <span class="nx">PluginHost</span><span class="p">.</span><span class="nx">plug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hostClass</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Cannot plug into Base, since Plugins derive from Base [ will cause infinite recurrsion ]</span>
        <span class="kd">var</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">name</span><span class="p">;</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="nx">hostClass</span> <span class="o">!==</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Base</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">hostClass</span><span class="p">.</span><span class="nx">_PLUG</span> <span class="o">=</span> <span class="nx">hostClass</span><span class="p">.</span><span class="nx">_PLUG</span> <span class="o">||</span> <span class="p">{};</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">plugin</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">plugin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">fn</span><span class="o">:</span><span class="nx">plugin</span><span class="p">,</span> <span class="nx">cfg</span><span class="o">:</span><span class="nx">config</span><span class="p">};</span>
                <span class="p">}</span>
                <span class="nx">plugin</span> <span class="o">=</span> <span class="p">[</span><span class="nx">plugin</span><span class="p">];</span>
            <span class="p">}</span>
    
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">p</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">name</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">NAME</span> <span class="o">||</span> <span class="nx">p</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">NAME</span><span class="p">;</span>
                <span class="nx">hostClass</span><span class="p">.</span><span class="nx">_PLUG</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="cm">/**</span>
<span class="cm">     * Unregisters any class level plugins which have been registered by the host class, or any</span>
<span class="cm">     * other class in the hierarchy.</span>
<span class="cm">     *</span>
<span class="cm">     * @method Plugin.Host.unplug</span>
<span class="cm">     * @static</span>
<span class="cm">     *</span>
<span class="cm">     * @param {Function} hostClass The host class from which to unregister the plugins</span>
<span class="cm">     * @param {Function | Array} plugin The plugin class, or an array of plugin classes</span>
<span class="cm">     */</span>
    <span class="nx">PluginHost</span><span class="p">.</span><span class="nx">unplug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hostClass</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">name</span><span class="p">;</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="nx">hostClass</span> <span class="o">!==</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Base</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">hostClass</span><span class="p">.</span><span class="nx">_UNPLUG</span> <span class="o">=</span> <span class="nx">hostClass</span><span class="p">.</span><span class="nx">_UNPLUG</span> <span class="o">||</span> <span class="p">{};</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">plugin</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">plugin</span> <span class="o">=</span> <span class="p">[</span><span class="nx">plugin</span><span class="p">];</span>
            <span class="p">}</span>
    
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">p</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">name</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">NAME</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hostClass</span><span class="p">.</span><span class="nx">_PLUG</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">hostClass</span><span class="p">.</span><span class="nx">_UNPLUG</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="nx">hostClass</span><span class="p">.</span><span class="nx">_PLUG</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;pluginhost-base&#39;</span><span class="p">]});</span>


<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;pluginhost&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">){},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">use</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;pluginhost-base&#39;</span><span class="p">,</span> <span class="s1">&#39;pluginhost-config&#39;</span><span class="p">]});</span>

<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;node-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * The Node Utility provides a DOM-like interface for interacting with DOM nodes.</span>
<span class="cm"> * @module node</span>
<span class="cm"> * @submodule node-base</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The Node class provides a wrapper for manipulating DOM Nodes.</span>
<span class="cm"> * Node properties can be accessed via the set/get methods.</span>
<span class="cm"> * Use Y.one() to retrieve Node instances.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;strong&gt;NOTE:&lt;/strong&gt; Node properties are accessed using</span>
<span class="cm"> * the &lt;code&gt;set&lt;/code&gt; and &lt;code&gt;get&lt;/code&gt; methods.</span>
<span class="cm"> *</span>
<span class="cm"> * @class Node</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @param {DOMNode} node the DOM node to be mapped to the Node instance.</span>
<span class="cm"> * @for Node</span>
<span class="cm"> */</span>

<span class="c1">// &quot;globals&quot;</span>
<span class="kd">var</span> <span class="nx">DOT</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="nx">NODE_NAME</span> <span class="o">=</span> <span class="s1">&#39;nodeName&#39;</span><span class="p">,</span>
    <span class="nx">NODE_TYPE</span> <span class="o">=</span> <span class="s1">&#39;nodeType&#39;</span><span class="p">,</span>
    <span class="nx">OWNER_DOCUMENT</span> <span class="o">=</span> <span class="s1">&#39;ownerDocument&#39;</span><span class="p">,</span>
    <span class="nx">TAG_NAME</span> <span class="o">=</span> <span class="s1">&#39;tagName&#39;</span><span class="p">,</span>
    <span class="nx">UID</span> <span class="o">=</span> <span class="s1">&#39;_yuid&#39;</span><span class="p">,</span>
    <span class="nx">EMPTY_OBJ</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="nx">_slice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">,</span>

    <span class="nx">Y_DOM</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span>

    <span class="nx">Y_Node</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// support optional &quot;new&quot;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Y_Node</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">node</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_fromString</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// NOTE: return</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">9</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">uniqueID</span> <span class="o">:</span> <span class="nx">node</span><span class="p">[</span><span class="nx">UID</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">uid</span> <span class="o">&amp;&amp;</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">uid</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">uid</span><span class="p">].</span><span class="nx">_node</span> <span class="o">!==</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">[</span><span class="nx">UID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// unset existing uid to prevent collision (via clone or hack)</span>
        <span class="p">}</span>

        <span class="nx">uid</span> <span class="o">=</span> <span class="nx">uid</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uid</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// stamp failed; likely IE non-HTMLElement</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">guid</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">[</span><span class="nx">UID</span><span class="p">]</span> <span class="o">=</span> <span class="nx">uid</span><span class="p">;</span>

        <span class="cm">/**</span>
<span class="cm">         * The underlying DOM node bound to the Y.Node instance</span>
<span class="cm">         * @property _node</span>
<span class="cm">         * @private</span>
<span class="cm">         */</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_stateProxy</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span> <span class="c1">// when augmented with Attribute</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_initPlugins</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// when augmented with Plugin.Host</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_initPlugins</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">SHOW_TRANSITION</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">SHOW_TRANSITION</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">HIDE_TRANSITION</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">HIDE_TRANSITION</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="c1">// used with previous/next/ancestor tests</span>
    <span class="nx">_wrapFn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fn</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
            <span class="p">}</span> <span class="o">:</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
<span class="c1">// end &quot;globals&quot;</span>

<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_fromString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// doc OR document</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// win OR window</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">node</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * The name of the component</span>
<span class="cm"> * @static</span>
<span class="cm"> * @property NAME</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">NAME</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * The pattern used to identify ARIA attributes</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">re_aria</span> <span class="o">=</span> <span class="sr">/^(?:role$|aria-)/</span><span class="p">;</span>

<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">SHOW_TRANSITION</span> <span class="o">=</span> <span class="s1">&#39;fadeIn&#39;</span><span class="p">;</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">HIDE_TRANSITION</span> <span class="o">=</span> <span class="s1">&#39;fadeOut&#39;</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * List of events that route to DOM events</span>
<span class="cm"> * @static</span>
<span class="cm"> * @property DOM_EVENTS</span>
<span class="cm"> */</span>

<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">abort</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">beforeunload</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">blur</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">change</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">click</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">close</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">command</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">contextmenu</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">dblclick</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">DOMMouseScroll</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">drag</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">dragstart</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">dragenter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">dragover</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">dragleave</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">dragend</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">drop</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">error</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">focus</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">keydown</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">keypress</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">keyup</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">load</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">message</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mousedown</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mouseenter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mouseleave</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mousemove</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mousemultiwheel</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mouseout</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mouseover</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mouseup</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">mousewheel</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">orientationchange</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">reset</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">resize</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">select</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">selectstart</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">submit</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">scroll</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">textInput</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">unload</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="c1">// Add custom event adaptors to this list.  This will make it so</span>
<span class="c1">// that delegate, key, available, contentready, etc all will</span>
<span class="c1">// be available through Node.on</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">plugins</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * A list of Node instances that have been created</span>
<span class="cm"> * @private</span>
<span class="cm"> * @property _instances</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_instances</span> <span class="o">=</span> <span class="p">{};</span>

<span class="cm">/**</span>
<span class="cm"> * Retrieves the DOM node bound to a Node instance</span>
<span class="cm"> * @method getDOMNode</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Y.Node || HTMLNode} node The Node instance or an HTMLNode</span>
<span class="cm"> * @return {HTMLNode} The DOM node bound to the Node instance.  If a DOM node is passed</span>
<span class="cm"> * as the node argument, it is simply returned.</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">getDOMNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">_node</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Checks Node return values and wraps DOM Nodes as Y.Node instances</span>
<span class="cm"> * and DOM Collections / Arrays as Y.NodeList instances.</span>
<span class="cm"> * Other return values just pass thru.  If undefined is returned (e.g. no return)</span>
<span class="cm"> * then the Node instance is returned for chainability.</span>
<span class="cm"> * @method scrubVal</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> * @param {any} node The Node instance or an HTMLNode</span>
<span class="cm"> * @return {Y.Node | Y.NodeList | any} Depends on what is returned from the DOM node.</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">scrubVal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// only truthy values are risky</span>
         <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// safari nodeList === function</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">NODE_TYPE</span> <span class="k">in</span> <span class="nx">val</span> <span class="o">||</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">isWindow</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">{</span><span class="c1">// node || window</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">val</span><span class="p">.</span><span class="nx">item</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">val</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">)</span> <span class="o">||</span> <span class="c1">// dom collection or Node instance</span>
                    <span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nx">NODE_TYPE</span><span class="p">]))</span> <span class="p">{</span> <span class="c1">// array of DOM Nodes</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span> <span class="c1">// for chaining</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// IE: DOM null not the same as null</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Adds methods to the Y.Node prototype, routing through scrubVal.</span>
<span class="cm"> * @method addMethod</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> * @param {String} name The name of the method to add</span>
<span class="cm"> * @param {Function} fn The function that becomes the method</span>
<span class="cm"> * @param {Object} context An optional context to call the method with</span>
<span class="cm"> * (defaults to the Node instance)</span>
<span class="cm"> * @return {any} Depends on what is returned from the DOM node.</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">addMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">fn</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">fn</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
                <span class="nx">ret</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">Y_Node</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">_node</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">Y_Node</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">_node</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">_node</span><span class="p">);</span>

            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// scrub truthy</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">scrubVal</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="p">(</span><span class="k">typeof</span> <span class="nx">ret</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">=</span> <span class="nx">node</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
        <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unable to add method: &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;Node&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Imports utility methods to be added as Y.Node methods.</span>
<span class="cm"> * @method importMethod</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Object} host The object that contains the method to import.</span>
<span class="cm"> * @param {String} name The name of the method to import</span>
<span class="cm"> * @param {String} altName An optional name to use in place of the host name</span>
<span class="cm"> * @param {Object} context An optional context to call the method with</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">importMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">altName</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">altName</span> <span class="o">=</span> <span class="nx">altName</span> <span class="o">||</span> <span class="nx">name</span><span class="p">;</span>
        <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="nx">altName</span><span class="p">,</span> <span class="nx">host</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span> <span class="nx">host</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a single Node instance bound to the node or the</span>
<span class="cm"> * first element matching the given selector. Returns null if no match found.</span>
<span class="cm"> * &lt;strong&gt;Note:&lt;/strong&gt; For chaining purposes you may want to</span>
<span class="cm"> * use &lt;code&gt;Y.all&lt;/code&gt;, which returns a NodeList when no match is found.</span>
<span class="cm"> * @method Y.one</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param {String | HTMLElement} node a node or Selector</span>
<span class="cm"> * @return {Y.Node | null} a Node instance or null if no match found.</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">one</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">cachedNode</span><span class="p">,</span>
        <span class="nx">uid</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">node</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_fromString</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// NOTE: return</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">;</span> <span class="c1">// NOTE: return</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">isWindow</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// avoid bad input (numbers, boolean, etc)</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">uniqueID</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">9</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">uniqueID</span> <span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">_yuid</span><span class="p">;</span>
            <span class="nx">instance</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">uid</span><span class="p">];</span> <span class="c1">// reuse exising instances</span>
            <span class="nx">cachedNode</span> <span class="o">=</span> <span class="nx">instance</span> <span class="o">?</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">_node</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">instance</span> <span class="o">||</span> <span class="p">(</span><span class="nx">cachedNode</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span> <span class="o">!==</span> <span class="nx">cachedNode</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// new Node when nodes don&#39;t match</span>
                <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y_Node</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">instance</span><span class="p">[</span><span class="nx">UID</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">;</span> <span class="c1">// cache node</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a new dom node using the provided markup string.</span>
<span class="cm"> * @method create</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param {String} html The markup used to create the element</span>
<span class="cm"> * @param {HTMLDocument} doc An optional document context</span>
<span class="cm"> * @return {Node} A Node instance bound to a DOM node or fragment</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span><span class="p">));</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Static collection of configuration attributes for special handling</span>
<span class="cm"> * @property ATTRS</span>
<span class="cm"> * @static</span>
<span class="cm"> * @type object</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">ATTRS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Allows for getting and setting the text of an element.</span>
<span class="cm">     * Formatting is preserved and special characters are treated literally.</span>
<span class="cm">     * @config text</span>
<span class="cm">     * @type String</span>
<span class="cm">     */</span>
    <span class="nx">text</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">content</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">content</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Allows for getting and setting the text of an element.</span>
<span class="cm">     * Formatting is preserved and special characters are treated literally.</span>
<span class="cm">     * @config text</span>
<span class="cm">     * @type String</span>
<span class="cm">     */</span>
    <span class="s1">&#39;for&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="s1">&#39;for&#39;</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="s1">&#39;for&#39;</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="s1">&#39;options&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns a NodeList instance of all HTMLElement children.</span>
<span class="cm">     * @readOnly</span>
<span class="cm">     * @config children</span>
<span class="cm">     * @type NodeList</span>
<span class="cm">     */</span>
    <span class="s1">&#39;children&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
                <span class="nx">children</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span>
                <span class="nx">childNodes</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">childNodes</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
                <span class="nx">children</span> <span class="o">=</span> <span class="p">[];</span>

                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">TAG_NAME</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">children</span><span class="p">[</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">childNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">children</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">value</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * The default setter for DOM properties</span>
<span class="cm"> * Called with instance context (this === the Node instance)</span>
<span class="cm"> * @method DEFAULT_SETTER</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param {String} name The attribute/property being set</span>
<span class="cm"> * @param {any} val The value to be set</span>
<span class="cm"> * @return {any} The value</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">DEFAULT_SETTER</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stateProxy</span><span class="p">,</span>
        <span class="nx">strPath</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">DOT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">strPath</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">DOT</span><span class="p">);</span>
        <span class="c1">// only allow when defined on node</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">node</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// pass thru DOM properties</span>
        <span class="nx">node</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * The default getter for DOM properties</span>
<span class="cm"> * Called with instance context (this === the Node instance)</span>
<span class="cm"> * @method DEFAULT_GETTER</span>
<span class="cm"> * @static</span>
<span class="cm"> * @param {String} name The attribute/property to look up</span>
<span class="cm"> * @return {any} The current value</span>
<span class="cm"> */</span>
<span class="nx">Y_Node</span><span class="p">.</span><span class="nx">DEFAULT_GETTER</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stateProxy</span><span class="p">,</span>
        <span class="nx">val</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">DOT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">DOT</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">node</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// pass thru from DOM</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">augment</span><span class="p">(</span><span class="nx">Y_Node</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventTarget</span><span class="p">);</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y_Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * The method called when outputting Node instances as strings</span>
<span class="cm">     * @method toString</span>
<span class="cm">     * @return {String} A string representation of the Node instance</span>
<span class="cm">     */</span>
    <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">UID</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: not bound to a node&#39;</span><span class="p">,</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">attrs</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">className</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attrs</span> <span class="o">&amp;&amp;</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">className</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attrs</span> <span class="o">&amp;&amp;</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">className</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;className&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">str</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">NODE_NAME</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// TODO: add yuid?</span>
            <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">[</span><span class="nx">UID</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns an attribute value on the Node instance.</span>
<span class="cm">     * Unless pre-configured (via Node.ATTRS), get hands</span>
<span class="cm">     * off to the underlying DOM node.  Only valid</span>
<span class="cm">     * attributes/properties for the node will be queried.</span>
<span class="cm">     * @method get</span>
<span class="cm">     * @param {String} attr The attribute</span>
<span class="cm">     * @return {any} The current value of the attribute</span>
<span class="cm">     */</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">val</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_getAttr</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// use Attribute imple</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getAttr</span><span class="p">(</span><span class="nx">attr</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_get</span><span class="p">(</span><span class="nx">attr</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">scrubVal</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// IE: DOM null is not true null (even though they ===)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Helper method for get.</span>
<span class="cm">     * @method _get</span>
<span class="cm">     * @private</span>
<span class="cm">     * @param {String} attr The attribute</span>
<span class="cm">     * @return {any} The current value of the attribute</span>
<span class="cm">     */</span>
    <span class="nx">_get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attrConfig</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">[</span><span class="nx">attr</span><span class="p">],</span>
            <span class="nx">val</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">attrConfig</span> <span class="o">&amp;&amp;</span> <span class="nx">attrConfig</span><span class="p">.</span><span class="nx">getter</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">attrConfig</span><span class="p">.</span><span class="nx">getter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y_Node</span><span class="p">.</span><span class="nx">re_aria</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">DEFAULT_GETTER</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Sets an attribute on the Node instance.</span>
<span class="cm">     * Unless pre-configured (via Node.ATTRS), set hands</span>
<span class="cm">     * off to the underlying DOM node.  Only valid</span>
<span class="cm">     * attributes/properties for the node will be set.</span>
<span class="cm">     * To set custom attributes use setAttribute.</span>
<span class="cm">     * @method set</span>
<span class="cm">     * @param {String} attr The attribute to be set.</span>
<span class="cm">     * @param {any} val The value to set the attribute to.</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attrConfig</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">[</span><span class="nx">attr</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_setAttr</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// use Attribute imple</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_setAttr</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// use setters inline</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attrConfig</span> <span class="o">&amp;&amp;</span> <span class="nx">attrConfig</span><span class="p">.</span><span class="nx">setter</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">attrConfig</span><span class="p">.</span><span class="nx">setter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">attr</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y_Node</span><span class="p">.</span><span class="nx">re_aria</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// special case Aria</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">DEFAULT_SETTER</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Sets multiple attributes.</span>
<span class="cm">     * @method setAttrs</span>
<span class="cm">     * @param {Object} attrMap an object of name/value pairs to set</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">setAttrs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrMap</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_setAttrs</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// use Attribute imple</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_setAttrs</span><span class="p">(</span><span class="nx">attrMap</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// use setters inline</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">attrMap</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns an object containing the values for the requested attributes.</span>
<span class="cm">     * @method getAttrs</span>
<span class="cm">     * @param {Array} attrs an array of attributes to get values</span>
<span class="cm">     * @return {Object} An object with attribute name/value pairs.</span>
<span class="cm">     */</span>
    <span class="nx">getAttrs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_getAttrs</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// use Attribute imple</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_getAttrs</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// use setters inline</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Creates a new Node using the provided markup string.</span>
<span class="cm">     * @method create</span>
<span class="cm">     * @param {String} html The markup used to create the element</span>
<span class="cm">     * @param {HTMLDocument} doc An optional document context</span>
<span class="cm">     * @return {Node} A Node instance bound to a DOM node or fragment</span>
<span class="cm">     */</span>
    <span class="nx">create</span><span class="o">:</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">create</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Compares nodes to determine if they match.</span>
<span class="cm">     * Node instances can be compared to each other and/or HTMLElements.</span>
<span class="cm">     * @method compareTo</span>
<span class="cm">     * @param {HTMLElement | Node} refNode The reference node to compare to the node.</span>
<span class="cm">     * @return {Boolean} True if the nodes match, false if they do not.</span>
<span class="cm">     */</span>
    <span class="nx">compareTo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">refNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">refNode</span><span class="p">,</span> <span class="nx">Y_Node</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">refNode</span> <span class="o">=</span> <span class="nx">refNode</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">node</span> <span class="o">===</span> <span class="nx">refNode</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Determines whether the node is appended to the document.</span>
<span class="cm">     * @method inDoc</span>
<span class="cm">     * @param {Node|HTMLElement} doc optional An optional document to check against.</span>
<span class="cm">     * Defaults to current document.</span>
<span class="cm">     * @return {Boolean} Whether or not this node is appended to the document.</span>
<span class="cm">     */</span>
    <span class="nx">inDoc</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="o">?</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_node</span> <span class="o">||</span> <span class="nx">doc</span> <span class="o">:</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">getById</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">node</span><span class="p">[</span><span class="nx">OWNER_DOCUMENT</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">&amp;&amp;</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">ret</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

   <span class="cm">/**</span>
<span class="cm">     * Returns the nearest ancestor that passes the test applied by supplied boolean method.</span>
<span class="cm">     * @method ancestor</span>
<span class="cm">     * @param {String | Function} fn A selector string or boolean method for testing elements.</span>
<span class="cm">     * @param {Boolean} testSelf optional Whether or not to include the element in the scan</span>
<span class="cm">     * If a function is used, it receives the current node being tested as the only argument.</span>
<span class="cm">     * @return {Node} The matching Node instance or null if not found</span>
<span class="cm">     */</span>
    <span class="nx">ancestor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">testSelf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">ancestor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">_wrapFn</span><span class="p">(</span><span class="nx">fn</span><span class="p">),</span> <span class="nx">testSelf</span><span class="p">));</span>
    <span class="p">},</span>

   <span class="cm">/**</span>
<span class="cm">     * Returns the ancestors that pass the test applied by supplied boolean method.</span>
<span class="cm">     * @method ancestors</span>
<span class="cm">     * @param {String | Function} fn A selector string or boolean method for testing elements.</span>
<span class="cm">     * @param {Boolean} testSelf optional Whether or not to include the element in the scan</span>
<span class="cm">     * If a function is used, it receives the current node being tested as the only argument.</span>
<span class="cm">     * @return {NodeList} A NodeList instance containing the matching elements </span>
<span class="cm">     */</span>
    <span class="nx">ancestors</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">testSelf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">ancestors</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">_wrapFn</span><span class="p">(</span><span class="nx">fn</span><span class="p">),</span> <span class="nx">testSelf</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the previous matching sibling.</span>
<span class="cm">     * Returns the nearest element node sibling if no method provided.</span>
<span class="cm">     * @method previous</span>
<span class="cm">     * @param {String | Function} fn A selector or boolean method for testing elements.</span>
<span class="cm">     * If a function is used, it receives the current node being tested as the only argument.</span>
<span class="cm">     * @return {Node} Node instance or null if not found</span>
<span class="cm">     */</span>
    <span class="nx">previous</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">elementByAxis</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="s1">&#39;previousSibling&#39;</span><span class="p">,</span> <span class="nx">_wrapFn</span><span class="p">(</span><span class="nx">fn</span><span class="p">),</span> <span class="nx">all</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the next matching sibling.</span>
<span class="cm">     * Returns the nearest element node sibling if no method provided.</span>
<span class="cm">     * @method next</span>
<span class="cm">     * @param {String | Function} fn A selector or boolean method for testing elements.</span>
<span class="cm">     * If a function is used, it receives the current node being tested as the only argument.</span>
<span class="cm">     * @return {Node} Node instance or null if not found</span>
<span class="cm">     */</span>
    <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">elementByAxis</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="s1">&#39;nextSibling&#39;</span><span class="p">,</span> <span class="nx">_wrapFn</span><span class="p">(</span><span class="nx">fn</span><span class="p">),</span> <span class="nx">all</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns all matching siblings.</span>
<span class="cm">     * Returns all siblings if no method provided.</span>
<span class="cm">     * @method siblings</span>
<span class="cm">     * @param {String | Function} fn A selector or boolean method for testing elements.</span>
<span class="cm">     * If a function is used, it receives the current node being tested as the only argument.</span>
<span class="cm">     * @return {NodeList} NodeList instance bound to found siblings</span>
<span class="cm">     */</span>
    <span class="nx">siblings</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">siblings</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">_wrapFn</span><span class="p">(</span><span class="nx">fn</span><span class="p">)));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Retrieves a Node instance of nodes based on the given CSS selector.</span>
<span class="cm">     * @method one</span>
<span class="cm">     *</span>
<span class="cm">     * @param {string} selector The CSS selector to test against.</span>
<span class="cm">     * @return {Node} A Node instance for the matching HTMLElement.</span>
<span class="cm">     */</span>
    <span class="nx">one</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Retrieves a nodeList based on the given CSS selector.</span>
<span class="cm">     * @method all</span>
<span class="cm">     *</span>
<span class="cm">     * @param {string} selector The CSS selector to test against.</span>
<span class="cm">     * @return {NodeList} A NodeList instance for the matching HTMLCollection/Array.</span>
<span class="cm">     */</span>
    <span class="nx">all</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">nodelist</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">));</span>
        <span class="nx">nodelist</span><span class="p">.</span><span class="nx">_query</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">;</span>
        <span class="nx">nodelist</span><span class="p">.</span><span class="nx">_queryRoot</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">nodelist</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="c1">// TODO: allow fn test</span>
    <span class="cm">/**</span>
<span class="cm">     * Test if the supplied node matches the supplied selector.</span>
<span class="cm">     * @method test</span>
<span class="cm">     *</span>
<span class="cm">     * @param {string} selector The CSS selector to test against.</span>
<span class="cm">     * @return {boolean} Whether or not the node matches the selector.</span>
<span class="cm">     */</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">selector</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes the node from its parent.</span>
<span class="cm">     * Shortcut for myNode.get(&#39;parentNode&#39;).removeChild(myNode);</span>
<span class="cm">     * @method remove</span>
<span class="cm">     * @param {Boolean} destroy whether or not to call destroy() on the node</span>
<span class="cm">     * after removal.</span>
<span class="cm">     * @chainable</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">destroy</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">destroy</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Replace the node with the other node. This is a DOM update only</span>
<span class="cm">     * and does not change the node bound to the Node instance.</span>
<span class="cm">     * Shortcut for myNode.get(&#39;parentNode&#39;).replaceChild(newNode, myNode);</span>
<span class="cm">     * @method replace</span>
<span class="cm">     * @param {Y.Node || HTMLNode} newNode Node to be inserted</span>
<span class="cm">     * @chainable</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">replace</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">newNode</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">newNode</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">newNode</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">Y_Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">newNode</span><span class="p">),</span> <span class="nx">node</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * @method replaceChild</span>
<span class="cm">     * @for Node</span>
<span class="cm">     * @param {String | HTMLElement | Node} node Node to be inserted </span>
<span class="cm">     * @param {HTMLElement | Node} refNode Node to be replaced </span>
<span class="cm">     * @return {Node} The replaced node</span>
<span class="cm">     */</span>
    <span class="nx">replaceChild</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">refNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">node</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">Y_Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">refNode</span><span class="p">)));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * @method appendChild</span>
<span class="cm">     * @param {String | HTMLElement | Node} node Node to be appended </span>
<span class="cm">     * @return {Node} The appended node </span>
<span class="cm">     */</span>
    <span class="nx">appendChild</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">scrubVal</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_insert</span><span class="p">(</span><span class="nx">node</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * @method insertBefore</span>
<span class="cm">     * @param {String | HTMLElement | Node} newNode Node to be appended </span>
<span class="cm">     * @param {HTMLElement | Node} refNode Node to be inserted before </span>
<span class="cm">     * @return {Node} The inserted node </span>
<span class="cm">     */</span>
    <span class="nx">insertBefore</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newNode</span><span class="p">,</span> <span class="nx">refNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">scrubVal</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_insert</span><span class="p">(</span><span class="nx">newNode</span><span class="p">,</span> <span class="nx">refNode</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes event listeners from the node and (optionally) its subtree</span>
<span class="cm">     * @method purge</span>
<span class="cm">     * @param {Boolean} recurse (optional) Whether or not to remove listeners from the</span>
<span class="cm">     * node&#39;s subtree</span>
<span class="cm">     * @param {String} type (optional) Only remove listeners of the specified type</span>
<span class="cm">     * @chainable</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">purge</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">recurse</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">purgeElement</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">recurse</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Nulls internal node references, removes any plugins and event listeners</span>
<span class="cm">     * @method destroy</span>
<span class="cm">     * @param {Boolean} recursivePurge (optional) Whether or not to remove listeners from the</span>
<span class="cm">     * node&#39;s subtree (default is false)</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">recursive</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">UID</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">uniqueID</span> <span class="o">?</span> <span class="s1">&#39;uniqueID&#39;</span> <span class="o">:</span> <span class="s1">&#39;_yuid&#39;</span><span class="p">,</span>
            <span class="nx">instance</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">purge</span><span class="p">();</span> <span class="c1">// TODO: only remove events add via this Node</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">unplug</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// may not be a PluginHost</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">unplug</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">clearData</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">recursive</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">instance</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">node</span><span class="p">[</span><span class="nx">UID</span><span class="p">]];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
                   <span class="nx">instance</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span> 
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_node</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_stateProxy</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">delete</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_yuid</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Invokes a method on the Node instance</span>
<span class="cm">     * @method invoke</span>
<span class="cm">     * @param {String} method The name of the method to invoke</span>
<span class="cm">     * @param {Any}  a, b, c, etc. Arguments to invoke the method with.</span>
<span class="cm">     * @return Whatever the underly method returns.</span>
<span class="cm">     * DOM Nodes and Collections return values</span>
<span class="cm">     * are converted to Node/NodeList instances.</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nx">invoke</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">ret</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">Y_Node</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">Y_Node</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">scrubVal</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Inserts the content before the reference node.</span>
<span class="cm">     * @method insert</span>
<span class="cm">     * @param {String | Y.Node | HTMLElement | Y.NodeList | HTMLCollection} content The content to insert</span>
<span class="cm">     * @param {Int | Y.Node | HTMLElement | String} where The position to insert at.</span>
<span class="cm">     * Possible &quot;where&quot; arguments</span>
<span class="cm">     * &lt;dl&gt;</span>
<span class="cm">     * &lt;dt&gt;Y.Node&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;The Node to insert before&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;HTMLElement&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;The element to insert before&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;Int&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;The index of the child element to insert before&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;replace&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Replaces the existing HTML&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;before&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Inserts before the existing HTML&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;before&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Inserts content before the node&lt;/dd&gt;</span>
<span class="cm">     * &lt;dt&gt;&quot;after&quot;&lt;/dt&gt;</span>
<span class="cm">     * &lt;dd&gt;Inserts content after the node&lt;/dd&gt;</span>
<span class="cm">     * &lt;/dl&gt;</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">insert</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_insert</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">where</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_insert</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">where</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// allow index</span>
            <span class="nx">where</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">where</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">where</span> <span class="o">&amp;&amp;</span> <span class="nx">where</span><span class="p">.</span><span class="nx">_node</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Node</span>
            <span class="nx">where</span> <span class="o">=</span> <span class="nx">where</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">content</span> <span class="o">!=</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// allow Node or NodeList/Array instances</span>
            <span class="nx">content</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">_node</span> <span class="o">||</span> <span class="nx">content</span><span class="p">.</span><span class="nx">_nodes</span> <span class="o">||</span> <span class="nx">content</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">addHTML</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">where</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Inserts the content as the firstChild of the node.</span>
<span class="cm">     * @method prepend</span>
<span class="cm">     * @param {String | Y.Node | HTMLElement} content The content to insert</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">prepend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Inserts the content as the lastChild of the node.</span>
<span class="cm">     * @method append</span>
<span class="cm">     * @param {String | Y.Node | HTMLElement} content The content to insert</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">append</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Appends the node to the given node. </span>
<span class="cm">     * @method appendTo</span>
<span class="cm">     * @param {Y.Node | HTMLElement} node The node to append to</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">appendTo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Replaces the node&#39;s current content with the content.</span>
<span class="cm">     * @method setContent</span>
<span class="cm">     * @param {String | Y.Node | HTMLElement | Y.NodeList | HTMLCollection} content The content to insert</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">setContent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_insert</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the node&#39;s current content (e.g. innerHTML) </span>
<span class="cm">     * @method getContent</span>
<span class="cm">     * @return {String} The current content</span>
<span class="cm">     */</span>
    <span class="nx">getContent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;innerHTML&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">    * @method swap</span>
<span class="cm">    * @description Swap DOM locations with the given node.</span>
<span class="cm">    * This does not change which DOM node each Node instance refers to.</span>
<span class="cm">    * @param {Node} otherNode The node to swap with</span>
<span class="cm">     * @chainable</span>
<span class="cm">    */</span>
    <span class="nx">swap</span><span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">swapNode</span> <span class="o">?</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">swapNode</span><span class="p">(</span><span class="nx">Y_Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">));</span>
        <span class="p">}</span> <span class="o">:</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">otherNode</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
                <span class="nx">parent</span> <span class="o">=</span> <span class="nx">otherNode</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span>
                <span class="nx">nextSibling</span> <span class="o">=</span> <span class="nx">otherNode</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">nextSibling</span> <span class="o">===</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">parent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">otherNode</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">otherNode</span> <span class="o">===</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">parent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">otherNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
                <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">addHTML</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">nextSibling</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>


    <span class="cm">/**</span>
<span class="cm">    * @method getData</span>
<span class="cm">    * @description Retrieves arbitrary data stored on a Node instance.</span>
<span class="cm">    * This is not stored with the DOM node.</span>
<span class="cm">    * @param {string} name Optional name of the data field to retrieve.</span>
<span class="cm">    * If no name is given, all data is returned.</span>
<span class="cm">    * @return {any | Object} Whatever is stored at the given field,</span>
<span class="cm">    * or an object hash of all fields.</span>
<span class="cm">    */</span>
    <span class="nx">getData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>

    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">    * @method setData</span>
<span class="cm">    * @description Stores arbitrary data on a Node instance.</span>
<span class="cm">    * This is not stored with the DOM node.</span>
<span class="cm">    * @param {string} name The name of the field to set. If no name</span>
<span class="cm">    * is given, name is treated as the data and overrides any existing data.</span>
<span class="cm">    * @param {any} val The value to be assigned to the field.</span>
<span class="cm">    * @chainable</span>
<span class="cm">    */</span>
    <span class="nx">setData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="p">}</span>

       <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">    * @method clearData</span>
<span class="cm">    * @description Clears stored data.</span>
<span class="cm">    * @param {string} name The name of the field to clear. If no name</span>
<span class="cm">    * is given, all data is cleared.</span>
<span class="cm">    * @chainable</span>
<span class="cm">    */</span>
    <span class="nx">clearData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_data&#39;</span> <span class="k">in</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">hasMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">method</span> <span class="k">in</span> <span class="nx">node</span> <span class="o">&amp;&amp;</span>
                <span class="k">typeof</span> <span class="nx">node</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;unknown&#39;</span> <span class="o">&amp;&amp;</span>
            <span class="p">(</span><span class="k">typeof</span> <span class="nx">node</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span> <span class="o">||</span>
                <span class="nb">String</span><span class="p">(</span><span class="nx">node</span><span class="p">[</span><span class="nx">method</span><span class="p">]).</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">));</span> <span class="c1">// IE reports as object, prepends space</span>
    <span class="p">},</span>

    <span class="nx">SHOW_TRANSITION</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">HIDE_TRANSITION</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Makes the node visible.</span>
<span class="cm">     * If the &quot;transition&quot; module is loaded, show optionally</span>
<span class="cm">     * animates the showing of the node using either the default</span>
<span class="cm">     * transition effect (&#39;fadeIn&#39;), or the given named effect.</span>
<span class="cm">     * @method show</span>
<span class="cm">     * @param {String} name A named Transition effect to use as the show effect. </span>
<span class="cm">     * @param {Object} config Options to use with the transition. </span>
<span class="cm">     * @param {Function} callback An optional function to run after the transition completes. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">toggleView</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * The implementation for showing nodes.</span>
<span class="cm">     * Default is to toggle the style.display property.</span>
<span class="cm">     * @protected</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">_show</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="p">},</span>

    <span class="nx">_isHidden</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="s1">&#39;display&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">toggleView</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">on</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_toggleView</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_toggleView</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">on</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

        <span class="c1">// base on current state if not forcing </span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">on</span> <span class="o">!=</span> <span class="s1">&#39;boolean&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">on</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isHidden</span><span class="p">())</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">on</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_show</span><span class="p">();</span>
        <span class="p">}</span>  <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_hide</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Hides the node.</span>
<span class="cm">     * If the &quot;transition&quot; module is loaded, hide optionally</span>
<span class="cm">     * animates the hiding of the node using either the default</span>
<span class="cm">     * transition effect (&#39;fadeOut&#39;), or the given named effect.</span>
<span class="cm">     * @method hide</span>
<span class="cm">     * @param {String} name A named Transition effect to use as the show effect. </span>
<span class="cm">     * @param {Object} config Options to use with the transition. </span>
<span class="cm">     * @param {Function} callback An optional function to run after the transition completes. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">toggleView</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * The implementation for hiding nodes.</span>
<span class="cm">     * Default is to toggle the style.display property.</span>
<span class="cm">     * @protected</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">_hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">isFragment</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;nodeType&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">11</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes and destroys all of the nodes within the node.</span>
<span class="cm">     * @method empty</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">empty</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;childNodes&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">().</span><span class="nx">destroy</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the DOM node bound to the Node instance </span>
<span class="cm">     * @method getDOMNode</span>
<span class="cm">     * @return {DOMNode}</span>
<span class="cm">     */</span>
    <span class="nx">getDOMNode</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span> <span class="o">=</span> <span class="nx">Y_Node</span><span class="p">;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">one</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">one</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * The NodeList module provides support for managing collections of Nodes.</span>
<span class="cm"> * @module node</span>
<span class="cm"> * @submodule nodelist</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * The NodeList class provides a wrapper for manipulating DOM NodeLists.</span>
<span class="cm"> * NodeList properties can be accessed via the set/get methods.</span>
<span class="cm"> * Use Y.all() to retrieve NodeList instances.</span>
<span class="cm"> *</span>
<span class="cm"> * @class NodeList</span>
<span class="cm"> * @constructor</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">NodeList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">nodes</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// selector query</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_query</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">;</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">nodes</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">||</span> <span class="nx">Y_DOM</span><span class="p">.</span><span class="nx">isWindow</span><span class="p">(</span><span class="nx">nodes</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// domNode || window</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nx">nodes</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">_node</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// allow array of Y.Nodes</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">_node</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">tmp</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">_node</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// array of domNodes or domNodeList (no mixed array of Y.Node/domNodes)</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * The underlying array of DOM nodes bound to the Y.NodeList instance</span>
<span class="cm">     * @property _nodes</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">NodeList</span><span class="p">.</span><span class="nx">NAME</span> <span class="o">=</span> <span class="s1">&#39;NodeList&#39;</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Retrieves the DOM nodes bound to a NodeList instance</span>
<span class="cm"> * @method NodeList.getDOMNodes</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Y.NodeList} nodelist The NodeList instance</span>
<span class="cm"> * @return {Array} The array of DOM nodes bound to the NodeList</span>
<span class="cm"> */</span>
<span class="nx">NodeList</span><span class="p">.</span><span class="nx">getDOMNodes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodelist</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">nodelist</span> <span class="o">&amp;&amp;</span> <span class="nx">nodelist</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">)</span> <span class="o">?</span> <span class="nx">nodelist</span><span class="p">.</span><span class="nx">_nodes</span> <span class="o">:</span> <span class="nx">nodelist</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">NodeList</span><span class="p">.</span><span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span> <span class="o">&amp;&amp;</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span> <span class="o">||</span> <span class="nx">instance</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;no nodes bound to &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;NodeList&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">NodeList</span><span class="p">.</span><span class="nx">addMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>

            <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">UID</span> <span class="o">=</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">uniqueID</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">9</span> <span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;uniqueID&#39;</span> <span class="o">:</span> <span class="s1">&#39;_yuid&#39;</span><span class="p">,</span>
                    <span class="nx">instance</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">node</span><span class="p">[</span><span class="nx">UID</span><span class="p">]],</span>
                    <span class="nx">ctx</span><span class="p">,</span>
                    <span class="nx">result</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">instance</span> <span class="o">=</span> <span class="nx">NodeList</span><span class="p">.</span><span class="nx">_getTempNode</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="nx">instance</span><span class="p">;</span>
                <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">result</span> <span class="o">!==</span> <span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ret</span><span class="p">[</span><span class="nx">ret</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="c1">// TODO: remove tmp pointer</span>
            <span class="k">return</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">ret</span> <span class="o">:</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unable to add method: &#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; to NodeList&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">NodeList</span><span class="p">.</span><span class="nx">importMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">altName</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">altName</span> <span class="o">=</span> <span class="nx">altName</span> <span class="o">||</span> <span class="nx">name</span><span class="p">;</span>
        <span class="nx">NodeList</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">host</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">NodeList</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">NodeList</span><span class="p">.</span><span class="nx">_getTempNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">NodeList</span><span class="p">.</span><span class="nx">_tempNode</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tmp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&lt;/div&gt;&#39;</span><span class="p">);</span>
        <span class="nx">NodeList</span><span class="p">.</span><span class="nx">_tempNode</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">tmp</span><span class="p">.</span><span class="nx">_node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
    <span class="nx">tmp</span><span class="p">.</span><span class="nx">_stateProxy</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">tmp</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Retrieves the Node instance at the given index.</span>
<span class="cm">     * @method item</span>
<span class="cm">     *</span>
<span class="cm">     * @param {Number} index The index of the target Node.</span>
<span class="cm">     * @return {Node} The Node instance at the given index.</span>
<span class="cm">     */</span>
    <span class="nx">item</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span> <span class="o">||</span> <span class="p">[])[</span><span class="nx">index</span><span class="p">]);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Applies the given function to each Node in the NodeList.</span>
<span class="cm">     * @method each</span>
<span class="cm">     * @param {Function} fn The function to apply. It receives 3 arguments:</span>
<span class="cm">     * the current node instance, the node&#39;s index, and the NodeList instance</span>
<span class="cm">     * @param {Object} context optional An optional context to apply the function with</span>
<span class="cm">     * Default context is the current Node instance</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">each</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span> <span class="o">||</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">instance</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">batch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">nodelist</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">node</span><span class="p">[</span><span class="nx">UID</span><span class="p">]];</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">instance</span> <span class="o">=</span> <span class="nx">NodeList</span><span class="p">.</span><span class="nx">_getTempNode</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span> <span class="o">||</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">nodelist</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">nodelist</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Executes the function once for each node until a true value is returned.</span>
<span class="cm">     * @method some</span>
<span class="cm">     * @param {Function} fn The function to apply. It receives 3 arguments:</span>
<span class="cm">     * the current node instance, the node&#39;s index, and the NodeList instance</span>
<span class="cm">     * @param {Object} context optional An optional context to execute the function from.</span>
<span class="cm">     * Default context is the current Node instance</span>
<span class="cm">     * @return {Boolean} Whether or not the function returned true for any node.</span>
<span class="cm">     */</span>
    <span class="nx">some</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="nx">node</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">instance</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Creates a documenFragment from the nodes bound to the NodeList instance</span>
<span class="cm">     * @method toFrag</span>
<span class="cm">     * @return Node a Node instance bound to the documentFragment</span>
<span class="cm">     */</span>
    <span class="nx">toFrag</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_nl2frag</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the index of the node in the NodeList instance</span>
<span class="cm">     * or -1 if the node isn&#39;t found.</span>
<span class="cm">     * @method indexOf</span>
<span class="cm">     * @param {Y.Node || DOMNode} node the node to search for</span>
<span class="cm">     * @return {Int} the index of the node value or -1 if not found</span>
<span class="cm">     */</span>
    <span class="nx">indexOf</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">node</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Filters the NodeList instance down to only nodes matching the given selector.</span>
<span class="cm">     * @method filter</span>
<span class="cm">     * @param {String} selector The selector to filter against</span>
<span class="cm">     * @return {NodeList} NodeList containing the updated collection</span>
<span class="cm">     * @see Selector</span>
<span class="cm">     */</span>
    <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span> <span class="nx">selector</span><span class="p">));</span>
    <span class="p">},</span>


    <span class="cm">/**</span>
<span class="cm">     * Creates a new NodeList containing all nodes at every n indices, where</span>
<span class="cm">     * remainder n % index equals r.</span>
<span class="cm">     * (zero-based index).</span>
<span class="cm">     * @method modulus</span>
<span class="cm">     * @param {Int} n The offset to use (return every nth node)</span>
<span class="cm">     * @param {Int} r An optional remainder to use with the modulus operation (defaults to zero)</span>
<span class="cm">     * @return {NodeList} NodeList containing the updated collection</span>
<span class="cm">     */</span>
    <span class="nx">modulus</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">NodeList</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">n</span> <span class="o">===</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">nodes</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Creates a new NodeList containing all nodes at odd indices</span>
<span class="cm">     * (zero-based index).</span>
<span class="cm">     * @method odd</span>
<span class="cm">     * @return {NodeList} NodeList containing the updated collection</span>
<span class="cm">     */</span>
    <span class="nx">odd</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">modulus</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Creates a new NodeList containing all nodes at even indices</span>
<span class="cm">     * (zero-based index), including zero.</span>
<span class="cm">     * @method even</span>
<span class="cm">     * @return {NodeList} NodeList containing the updated collection</span>
<span class="cm">     */</span>
    <span class="nx">even</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">modulus</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">destructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Reruns the initial query, when created using a selector query</span>
<span class="cm">     * @method refresh</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">refresh</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">doc</span><span class="p">,</span>
            <span class="nx">nodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span>
            <span class="nx">query</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_query</span><span class="p">,</span>
            <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_queryRoot</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span> <span class="o">&amp;&amp;</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ownerDocument</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">root</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ownerDocument</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_prepEvtArgs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// map to Y.on/after signature (type, fn, nodes, context, arg1, arg2, etc)</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// type only (event hash) just add nodes</span>
            <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span> <span class="c1">// default to NodeList instance as context</span>

        <span class="k">return</span> <span class="nx">args</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Applies an event listener to each Node bound to the NodeList.</span>
<span class="cm">     * @method on</span>
<span class="cm">     * @param {String} type The event being listened for</span>
<span class="cm">     * @param {Function} fn The handler to call when the event fires</span>
<span class="cm">     * @param {Object} context The context to call the handler with.</span>
<span class="cm">     * Default is the NodeList instance.</span>
<span class="cm">     * @param {Object} context The context to call the handler with.</span>
<span class="cm">     * param {mixed} arg* 0..n additional arguments to supply to the subscriber</span>
<span class="cm">     * when the event fires.</span>
<span class="cm">     * @return {Object} Returns an event handle that can later be use to detach().</span>
<span class="cm">     * @see Event.on</span>
<span class="cm">     */</span>
    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_prepEvtArgs</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Applies an one-time event listener to each Node bound to the NodeList.</span>
<span class="cm">     * @method once</span>
<span class="cm">     * @param {String} type The event being listened for</span>
<span class="cm">     * @param {Function} fn The handler to call when the event fires</span>
<span class="cm">     * @param {Object} context The context to call the handler with.</span>
<span class="cm">     * Default is the NodeList instance.</span>
<span class="cm">     * @return {Object} Returns an event handle that can later be use to detach().</span>
<span class="cm">     * @see Event.on</span>
<span class="cm">     */</span>
    <span class="nx">once</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">once</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_prepEvtArgs</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Applies an event listener to each Node bound to the NodeList.</span>
<span class="cm">     * The handler is called only after all on() handlers are called</span>
<span class="cm">     * and the event is not prevented.</span>
<span class="cm">     * @method after</span>
<span class="cm">     * @param {String} type The event being listened for</span>
<span class="cm">     * @param {Function} fn The handler to call when the event fires</span>
<span class="cm">     * @param {Object} context The context to call the handler with.</span>
<span class="cm">     * Default is the NodeList instance.</span>
<span class="cm">     * @return {Object} Returns an event handle that can later be use to detach().</span>
<span class="cm">     * @see Event.on</span>
<span class="cm">     */</span>
    <span class="nx">after</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">after</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_prepEvtArgs</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the current number of items in the NodeList.</span>
<span class="cm">     * @method size</span>
<span class="cm">     * @return {Int} The number of items in the NodeList.</span>
<span class="cm">     */</span>
    <span class="nx">size</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Determines if the instance is bound to any nodes</span>
<span class="cm">     * @method isEmpty</span>
<span class="cm">     * @return {Boolean} Whether or not the NodeList is bound to any nodes</span>
<span class="cm">     */</span>
    <span class="nx">isEmpty</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">errorMsg</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">UID</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: not bound to any nodes&#39;</span><span class="p">,</span>
            <span class="nx">nodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span>
            <span class="nx">node</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span> <span class="o">&amp;&amp;</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="nx">str</span> <span class="o">+=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">NODE_NAME</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;...[&#39;</span> <span class="o">+</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s1">&#39; items]&#39;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">str</span> <span class="o">||</span> <span class="nx">errorMsg</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the DOM node bound to the Node instance </span>
<span class="cm">     * @method getDOMNodes</span>
<span class="cm">     * @return {Array}</span>
<span class="cm">     */</span>
    <span class="nx">getDOMNodes</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">NodeList</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">[</span>
    <span class="cm">/**</span>
<span class="cm">     * Called on each Node instance</span>
<span class="cm">     * @for NodeList</span>
<span class="cm">     * @method append</span>
<span class="cm">     * @see Node.append</span>
<span class="cm">     */</span>
    <span class="s1">&#39;append&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method destroy</span>
<span class="cm">      * @see Node.destroy</span>
<span class="cm">      */</span>
    <span class="s1">&#39;destroy&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">      * Called on each Node instance</span>
<span class="cm">      * @method detach</span>
<span class="cm">      * @see Node.detach</span>
<span class="cm">      */</span>
    <span class="s1">&#39;detach&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method detachAll</span>
<span class="cm">      * @see Node.detachAll</span>
<span class="cm">      */</span>
    <span class="s1">&#39;detachAll&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method empty</span>
<span class="cm">      * @see Node.empty</span>
<span class="cm">      */</span>
    <span class="s1">&#39;empty&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method insert</span>
<span class="cm">      * @see Node.insert</span>
<span class="cm">      */</span>
    <span class="s1">&#39;insert&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method prepend</span>
<span class="cm">      * @see Node.prepend</span>
<span class="cm">      */</span>
    <span class="s1">&#39;prepend&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method remove</span>
<span class="cm">      * @see Node.remove</span>
<span class="cm">      */</span>
    <span class="s1">&#39;remove&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method set</span>
<span class="cm">      * @see Node.set</span>
<span class="cm">      */</span>
    <span class="s1">&#39;set&#39;</span><span class="p">,</span>

    <span class="cm">/** Called on each Node instance</span>
<span class="cm">      * @method setContent</span>
<span class="cm">      * @see Node.setContent</span>
<span class="cm">      */</span>
    <span class="s1">&#39;setContent&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Makes each node visible.</span>
<span class="cm">     * If the &quot;transition&quot; module is loaded, show optionally</span>
<span class="cm">     * animates the showing of the node using either the default</span>
<span class="cm">     * transition effect (&#39;fadeIn&#39;), or the given named effect.</span>
<span class="cm">     * @method show</span>
<span class="cm">     * @param {String} name A named Transition effect to use as the show effect. </span>
<span class="cm">     * @param {Object} config Options to use with the transition. </span>
<span class="cm">     * @param {Function} callback An optional function to run after the transition completes. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;show&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Hides each node.</span>
<span class="cm">     * If the &quot;transition&quot; module is loaded, hide optionally</span>
<span class="cm">     * animates the hiding of the node using either the default</span>
<span class="cm">     * transition effect (&#39;fadeOut&#39;), or the given named effect.</span>
<span class="cm">     * @method hide</span>
<span class="cm">     * @param {String} name A named Transition effect to use as the show effect. </span>
<span class="cm">     * @param {Object} config Options to use with the transition. </span>
<span class="cm">     * @param {Function} callback An optional function to run after the transition completes. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;hide&#39;</span><span class="p">,</span>

    <span class="s1">&#39;toggleView&#39;</span>
<span class="p">]);</span>

<span class="c1">// one-off implementation to convert array of Nodes to NodeList</span>
<span class="c1">// e.g. Y.all(&#39;input&#39;).get(&#39;parentNode&#39;);</span>

<span class="cm">/** Called on each Node instance</span>
<span class="cm">  * @method get</span>
<span class="cm">  * @see Node</span>
<span class="cm">  */</span>
<span class="nx">NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">nodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span>
        <span class="nx">isNodeList</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">getTemp</span> <span class="o">=</span> <span class="nx">NodeList</span><span class="p">.</span><span class="nx">_getTempNode</span><span class="p">,</span>
        <span class="nx">instance</span><span class="p">,</span>
        <span class="nx">val</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">instance</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">_yuid</span><span class="p">]</span> <span class="o">||</span> <span class="nx">getTemp</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">_get</span><span class="p">(</span><span class="nx">attr</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">&amp;&amp;</span> <span class="nx">val</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">isNodeList</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">instance</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">_instances</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">_yuid</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">instance</span> <span class="o">=</span> <span class="nx">getTemp</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">val</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">_get</span><span class="p">(</span><span class="nx">attr</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isNodeList</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// convert array of Nodes to NodeList</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">scrubVal</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">instance</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">(</span><span class="nx">isNodeList</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">ret</span><span class="p">)</span> <span class="o">:</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span> <span class="o">=</span> <span class="nx">NodeList</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">all</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">NodeList</span><span class="p">(</span><span class="nx">nodes</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">all</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span>
    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @for Node</span>
<span class="cm">     * @method removeChild</span>
<span class="cm">     * @param {HTMLElement | Node} node Node to be removed </span>
<span class="cm">     * @return {Node} The removed node </span>
<span class="cm">     */</span>
    <span class="s1">&#39;removeChild&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method hasChildNodes</span>
<span class="cm">     * @return {Boolean} Whether or not the node has any childNodes </span>
<span class="cm">     */</span>
    <span class="s1">&#39;hasChildNodes&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method cloneNode</span>
<span class="cm">     * @param {Boolean} deep Whether or not to perform a deep clone, which includes</span>
<span class="cm">     * subtree and attributes</span>
<span class="cm">     * @return {Node} The clone </span>
<span class="cm">     */</span>
    <span class="s1">&#39;cloneNode&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method hasAttribute</span>
<span class="cm">     * @param {String} attribute The attribute to test for </span>
<span class="cm">     * @return {Boolean} Whether or not the attribute is present </span>
<span class="cm">     */</span>
    <span class="s1">&#39;hasAttribute&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method removeAttribute</span>
<span class="cm">     * @param {String} attribute The attribute to be removed </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;removeAttribute&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method scrollIntoView</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;scrollIntoView&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method getElementsByTagName</span>
<span class="cm">     * @param {String} tagName The tagName to collect </span>
<span class="cm">     * @return {NodeList} A NodeList representing the HTMLCollection</span>
<span class="cm">     */</span>
    <span class="s1">&#39;getElementsByTagName&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method focus</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;focus&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method blur</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;blur&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * Only valid on FORM elements</span>
<span class="cm">     * @method submit</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;submit&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * Only valid on FORM elements</span>
<span class="cm">     * @method reset</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;reset&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * @method select</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
     <span class="s1">&#39;select&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Passes through to DOM method.</span>
<span class="cm">     * Only valid on TABLE elements</span>
<span class="cm">     * @method createCaption</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;createCaption&#39;</span>

<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;adding: &#39;</span> <span class="o">+</span> <span class="nx">method</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">);</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">arg3</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">arg3</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">});</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="p">[</span>
    <span class="cm">/**</span>
<span class="cm">     * Determines whether the node is an ancestor of another HTML element in the DOM hierarchy.</span>
<span class="cm">     * @method contains</span>
<span class="cm">     * @param {Node | HTMLElement} needle The possible node or descendent</span>
<span class="cm">     * @return {Boolean} Whether or not this node is the needle its ancestor</span>
<span class="cm">     */</span>
    <span class="s1">&#39;contains&#39;</span><span class="p">,</span>
    <span class="cm">/**</span>
<span class="cm">     * Allows setting attributes on DOM nodes, normalizing in some cases.</span>
<span class="cm">     * This passes through to the DOM node, allowing for custom attributes.</span>
<span class="cm">     * @method setAttribute</span>
<span class="cm">     * @for Node</span>
<span class="cm">     * @for NodeList</span>
<span class="cm">     * @chainable</span>
<span class="cm">     * @param {string} name The attribute name </span>
<span class="cm">     * @param {string} value The value to set</span>
<span class="cm">     */</span>
    <span class="s1">&#39;setAttribute&#39;</span><span class="p">,</span>
    <span class="cm">/**</span>
<span class="cm">     * Allows getting attributes on DOM nodes, normalizing in some cases.</span>
<span class="cm">     * This passes through to the DOM node, allowing for custom attributes.</span>
<span class="cm">     * @method getAttribute</span>
<span class="cm">     * @for Node</span>
<span class="cm">     * @for NodeList</span>
<span class="cm">     * @param {string} name The attribute name </span>
<span class="cm">     * @return {string} The attribute value </span>
<span class="cm">     */</span>
    <span class="s1">&#39;getAttribute&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Wraps the given HTML around the node.</span>
<span class="cm">     * @method wrap</span>
<span class="cm">     * @param {String} html The markup to wrap around the node. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;wrap&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes the node&#39;s parent node. </span>
<span class="cm">     * @method unwrap</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;unwrap&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Applies a unique ID to the node if none exists</span>
<span class="cm">     * @method generateID</span>
<span class="cm">     * @return {String} The existing or generated ID</span>
<span class="cm">     */</span>
    <span class="s1">&#39;generateID&#39;</span>
<span class="p">]);</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">[</span>
<span class="cm">/**</span>
<span class="cm"> * Allows getting attributes on DOM nodes, normalizing in some cases.</span>
<span class="cm"> * This passes through to the DOM node, allowing for custom attributes.</span>
<span class="cm"> * @method getAttribute</span>
<span class="cm"> * @see Node</span>
<span class="cm"> * @for NodeList</span>
<span class="cm"> * @param {string} name The attribute name </span>
<span class="cm"> * @return {string} The attribute value </span>
<span class="cm"> */</span>

    <span class="s1">&#39;getAttribute&#39;</span><span class="p">,</span>
<span class="cm">/**</span>
<span class="cm"> * Allows setting attributes on DOM nodes, normalizing in some cases.</span>
<span class="cm"> * This passes through to the DOM node, allowing for custom attributes.</span>
<span class="cm"> * @method setAttribute</span>
<span class="cm"> * @see Node</span>
<span class="cm"> * @for NodeList</span>
<span class="cm"> * @chainable</span>
<span class="cm"> * @param {string} name The attribute name </span>
<span class="cm"> * @param {string} value The value to set</span>
<span class="cm"> */</span>
    <span class="s1">&#39;setAttribute&#39;</span><span class="p">,</span>
 
<span class="cm">/**</span>
<span class="cm"> * Allows for removing attributes on DOM nodes.</span>
<span class="cm"> * This passes through to the DOM node, allowing for custom attributes.</span>
<span class="cm"> * @method removeAttribute</span>
<span class="cm"> * @see Node</span>
<span class="cm"> * @for NodeList</span>
<span class="cm"> * @param {string} name The attribute to remove </span>
<span class="cm"> */</span>
    <span class="s1">&#39;removeAttribute&#39;</span><span class="p">,</span>
<span class="cm">/**</span>
<span class="cm"> * Removes the parent node from node in the list. </span>
<span class="cm"> * @method unwrap</span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>
    <span class="s1">&#39;unwrap&#39;</span><span class="p">,</span>
<span class="cm">/**</span>
<span class="cm"> * Wraps the given HTML around each node.</span>
<span class="cm"> * @method wrap</span>
<span class="cm"> * @param {String} html The markup to wrap around the node. </span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>
    <span class="s1">&#39;wrap&#39;</span><span class="p">,</span>

<span class="cm">/**</span>
<span class="cm"> * Applies a unique ID to each node if none exists</span>
<span class="cm"> * @method generateID</span>
<span class="cm"> * @return {String} The existing or generated ID</span>
<span class="cm"> */</span>
    <span class="s1">&#39;generateID&#39;</span>
<span class="p">]);</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">methods</span> <span class="o">=</span> <span class="p">[</span>
    <span class="cm">/**</span>
<span class="cm">     * Determines whether each node has the given className.</span>
<span class="cm">     * @method hasClass</span>
<span class="cm">     * @for Node</span>
<span class="cm">     * @param {String} className the class name to search for</span>
<span class="cm">     * @return {Boolean} Whether or not the element has the specified class </span>
<span class="cm">     */</span>
     <span class="s1">&#39;hasClass&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Adds a class name to each node.</span>
<span class="cm">     * @method addClass         </span>
<span class="cm">     * @param {String} className the class name to add to the node&#39;s class attribute</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
     <span class="s1">&#39;addClass&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes a class name from each node.</span>
<span class="cm">     * @method removeClass         </span>
<span class="cm">     * @param {String} className the class name to remove from the node&#39;s class attribute</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
     <span class="s1">&#39;removeClass&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Replace a class with another class for each node.</span>
<span class="cm">     * If no oldClassName is present, the newClassName is simply added.</span>
<span class="cm">     * @method replaceClass  </span>
<span class="cm">     * @param {String} oldClassName the class name to be replaced</span>
<span class="cm">     * @param {String} newClassName the class name that will be replacing the old class name</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
     <span class="s1">&#39;replaceClass&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * If the className exists on the node it is removed, if it doesn&#39;t exist it is added.</span>
<span class="cm">     * @method toggleClass  </span>
<span class="cm">     * @param {String} className the class name to be toggled</span>
<span class="cm">     * @param {Boolean} force Option to force adding or removing the class. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
     <span class="s1">&#39;toggleClass&#39;</span>
    <span class="p">];</span>

    <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="nx">methods</span><span class="p">);</span>
    <span class="cm">/**</span>
<span class="cm">     * Determines whether each node has the given className.</span>
<span class="cm">     * @method hasClass</span>
<span class="cm">     * @see Node.hasClass</span>
<span class="cm">     * @for NodeList</span>
<span class="cm">     * @param {String} className the class name to search for</span>
<span class="cm">     * @return {Array} An array of booleans for each node bound to the NodeList. </span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Adds a class name to each node.</span>
<span class="cm">     * @method addClass         </span>
<span class="cm">     * @see Node.addClass</span>
<span class="cm">     * @param {String} className the class name to add to the node&#39;s class attribute</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Removes a class name from each node.</span>
<span class="cm">     * @method removeClass         </span>
<span class="cm">     * @see Node.removeClass</span>
<span class="cm">     * @param {String} className the class name to remove from the node&#39;s class attribute</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * Replace a class with another class for each node.</span>
<span class="cm">     * If no oldClassName is present, the newClassName is simply added.</span>
<span class="cm">     * @method replaceClass  </span>
<span class="cm">     * @see Node.replaceClass</span>
<span class="cm">     * @param {String} oldClassName the class name to be replaced</span>
<span class="cm">     * @param {String} newClassName the class name that will be replacing the old class name</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>

    <span class="cm">/**</span>
<span class="cm">     * If the className exists on the node it is removed, if it doesn&#39;t exist it is added.</span>
<span class="cm">     * @method toggleClass  </span>
<span class="cm">     * @see Node.toggleClass</span>
<span class="cm">     * @param {String} className the class name to be toggled</span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">methods</span><span class="p">);</span>
<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">hasAttribute</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IE &lt; 8</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasAttribute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">===</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IE &lt; 8 fails to populate specified when set in HTML</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">attr</span><span class="p">].</span><span class="nx">specified</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// IE throws an error when calling focus() on an element that&#39;s invisible, not</span>
<span class="c1">// displayed, or disabled.</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">focus</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error focusing node: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// IE throws error when setting input.type = &#39;hidden&#39;,</span>
<span class="c1">// input.setAttribute(&#39;type&#39;, &#39;hidden&#39;) and input.attributes.type.value = &#39;hidden&#39;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;hidden&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_inputType</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span> <span class="c1">// IE errors when changing the type from &quot;hidden&#39;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error setting type: &#39;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_inputType</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_bypassProxy</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// don&#39;t update DOM when using with Attribute</span>
<span class="p">};</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">elements</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// IE: elements collection is also FORM node which trips up scrubVal.</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">.</span><span class="nx">elements</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;input, textarea, button, select&#39;</span><span class="p">);</span>
            <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">offsetHeight</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">setHeight</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">h</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">offsetWidth</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">setWidth</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">w</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">w</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">sizeTo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">w</span><span class="p">);</span>
            <span class="nx">w</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetWidth&#39;</span><span class="p">);</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setAttrs</span><span class="p">({</span>
            <span class="nx">offsetWidth</span><span class="o">:</span> <span class="nx">w</span><span class="p">,</span>
            <span class="nx">offsetHeight</span><span class="o">:</span> <span class="nx">h</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">Y_NodeList</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">,</span>
    <span class="nx">ArrayProto</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nx">ArrayMethods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="cm">/** Returns a new NodeList combining the given NodeList(s) </span>
<span class="cm">          * @for NodeList</span>
<span class="cm">          * @method concat</span>
<span class="cm">          * @param {NodeList | Array} valueN Arrays/NodeLists and/or values to</span>
<span class="cm">          * concatenate to the resulting NodeList</span>
<span class="cm">          * @return {NodeList} A new NodeList comprised of this NodeList joined with the input.</span>
<span class="cm">          */</span>
        <span class="s1">&#39;concat&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="cm">/** Removes the first last from the NodeList and returns it.</span>
<span class="cm">          * @for NodeList</span>
<span class="cm">          * @method pop</span>
<span class="cm">          * @return {Node} The last item in the NodeList.</span>
<span class="cm">          */</span>
        <span class="s1">&#39;pop&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/** Adds the given Node(s) to the end of the NodeList. </span>
<span class="cm">          * @for NodeList</span>
<span class="cm">          * @method push</span>
<span class="cm">          * @param {Node | DOMNode} nodes One or more nodes to add to the end of the NodeList. </span>
<span class="cm">          */</span>
        <span class="s1">&#39;push&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/** Removes the first item from the NodeList and returns it.</span>
<span class="cm">          * @for NodeList</span>
<span class="cm">          * @method shift</span>
<span class="cm">          * @return {Node} The first item in the NodeList.</span>
<span class="cm">          */</span>
        <span class="s1">&#39;shift&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/** Returns a new NodeList comprising the Nodes in the given range. </span>
<span class="cm">          * @for NodeList</span>
<span class="cm">          * @method slice</span>
<span class="cm">          * @param {Number} begin Zero-based index at which to begin extraction.</span>
<span class="cm">          As a negative index, start indicates an offset from the end of the sequence. slice(-2) extracts the second-to-last element and the last element in the sequence.</span>
<span class="cm">          * @param {Number} end Zero-based index at which to end extraction. slice extracts up to but not including end.</span>
<span class="cm">          slice(1,4) extracts the second element through the fourth element (elements indexed 1, 2, and 3).</span>
<span class="cm">          As a negative index, end indicates an offset from the end of the sequence. slice(2,-1) extracts the third element through the second-to-last element in the sequence.</span>
<span class="cm">          If end is omitted, slice extracts to the end of the sequence.</span>
<span class="cm">          * @return {NodeList} A new NodeList comprised of this NodeList joined with the input.</span>
<span class="cm">          */</span>
        <span class="s1">&#39;slice&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="cm">/** Changes the content of the NodeList, adding new elements while removing old elements.</span>
<span class="cm">          * @for NodeList</span>
<span class="cm">          * @method splice</span>
<span class="cm">          * @param {Number} index Index at which to start changing the array. If negative, will begin that many elements from the end.</span>
<span class="cm">          * @param {Number} howMany An integer indicating the number of old array elements to remove. If howMany is 0, no elements are removed. In this case, you should specify at least one new element. If no howMany parameter is specified (second syntax above, which is a SpiderMonkey extension), all elements after index are removed.</span>
<span class="cm">          * {Node | DOMNode| element1, ..., elementN </span>
<span class="cm">          The elements to add to the array. If you don&#39;t specify any elements, splice simply removes elements from the array.</span>
<span class="cm">          * @return {NodeList} The element(s) removed.</span>
<span class="cm">          */</span>
        <span class="s1">&#39;splice&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="cm">/** Adds the given Node(s) to the beginning of the NodeList. </span>
<span class="cm">          * @for NodeList</span>
<span class="cm">          * @method push</span>
<span class="cm">          * @param {Node | DOMNode} nodes One or more nodes to add to the NodeList. </span>
<span class="cm">          */</span>
        <span class="s1">&#39;unshift&#39;</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">};</span>


<span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ArrayMethods</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">returnNodeList</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y_NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">arg</span><span class="p">,</span>
            <span class="nx">ret</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">arg</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">])</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// use DOM nodes/nodeLists </span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arg</span><span class="p">.</span><span class="nx">_node</span> <span class="o">||</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">_nodes</span> <span class="o">||</span> <span class="nx">arg</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">ArrayProto</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">returnNodeList</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">scrubVal</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">});</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-base&#39;</span><span class="p">,</span> <span class="s1">&#39;selector-css2&#39;</span><span class="p">,</span> <span class="s1">&#39;event-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;node-style&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/**</span>
<span class="cm"> * Extended Node interface for managing node styles.</span>
<span class="cm"> * @module node</span>
<span class="cm"> * @submodule node-style</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">methods</span> <span class="o">=</span> <span class="p">[</span>
    <span class="cm">/**</span>
<span class="cm">     * Returns the style&#39;s current value.</span>
<span class="cm">     * @method getStyle</span>
<span class="cm">     * @for Node</span>
<span class="cm">     * @param {String} attr The style attribute to retrieve. </span>
<span class="cm">     * @return {String} The current value of the style property for the element.</span>
<span class="cm">     */</span>
    <span class="s1">&#39;getStyle&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the computed value for the given style property.</span>
<span class="cm">     * @method getComputedStyle</span>
<span class="cm">     * @param {String} attr The style attribute to retrieve. </span>
<span class="cm">     * @return {String} The computed value of the style property for the element.</span>
<span class="cm">     */</span>
    <span class="s1">&#39;getComputedStyle&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Sets a style property of the node.</span>
<span class="cm">     * @method setStyle</span>
<span class="cm">     * @param {String} attr The style attribute to set. </span>
<span class="cm">     * @param {String|Number} val The value. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;setStyle&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Sets multiple style properties on the node.</span>
<span class="cm">     * @method setStyles</span>
<span class="cm">     * @param {Object} hash An object literal of property:value pairs. </span>
<span class="cm">     * @chainable</span>
<span class="cm">     */</span>
    <span class="s1">&#39;setStyles&#39;</span>
<span class="p">];</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="nx">methods</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * Returns an array of values for each node.</span>
<span class="cm"> * @method getStyle</span>
<span class="cm"> * @for NodeList</span>
<span class="cm"> * @see Node.getStyle</span>
<span class="cm"> * @param {String} attr The style attribute to retrieve. </span>
<span class="cm"> * @return {Array} The current values of the style property for the element.</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Returns an array of the computed value for each node.</span>
<span class="cm"> * @method getComputedStyle</span>
<span class="cm"> * @see Node.getComputedStyle</span>
<span class="cm"> * @param {String} attr The style attribute to retrieve. </span>
<span class="cm"> * @return {Array} The computed values for each node.</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Sets a style property on each node.</span>
<span class="cm"> * @method setStyle</span>
<span class="cm"> * @see Node.setStyle</span>
<span class="cm"> * @param {String} attr The style attribute to set. </span>
<span class="cm"> * @param {String|Number} val The value. </span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Sets multiple style properties on each node.</span>
<span class="cm"> * @method setStyles</span>
<span class="cm"> * @see Node.setStyles</span>
<span class="cm"> * @param {Object} hash An object literal of property:value pairs. </span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">methods</span><span class="p">);</span>
<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-style&#39;</span><span class="p">,</span> <span class="s1">&#39;node-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;node-screen&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Extended Node interface for managing regions and screen positioning.</span>
<span class="cm"> * Adds support for positioning elements and normalizes window size and scroll detection. </span>
<span class="cm"> * @module node</span>
<span class="cm"> * @submodule node-screen</span>
<span class="cm"> */</span>

<span class="c1">// these are all &quot;safe&quot; returns, no wrapping required</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span>
    <span class="cm">/**</span>
<span class="cm">     * Returns the inner width of the viewport (exludes scrollbar). </span>
<span class="cm">     * @config winWidth</span>
<span class="cm">     * @for Node</span>
<span class="cm">     * @type {Int}</span>
<span class="cm">     */</span>
    <span class="s1">&#39;winWidth&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the inner height of the viewport (exludes scrollbar). </span>
<span class="cm">     * @config winHeight</span>
<span class="cm">     * @type {Int}</span>
<span class="cm">     */</span>
    <span class="s1">&#39;winHeight&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Document width </span>
<span class="cm">     * @config winHeight</span>
<span class="cm">     * @type {Int}</span>
<span class="cm">     */</span>
    <span class="s1">&#39;docWidth&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Document height </span>
<span class="cm">     * @config docHeight</span>
<span class="cm">     * @type {Int}</span>
<span class="cm">     */</span>
    <span class="s1">&#39;docHeight&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Amount page has been scroll vertically </span>
<span class="cm">     * @config docScrollX</span>
<span class="cm">     * @type {Int}</span>
<span class="cm">     */</span>
    <span class="s1">&#39;docScrollX&#39;</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Amount page has been scroll horizontally </span>
<span class="cm">     * @config docScrollY</span>
<span class="cm">     * @type {Int}</span>
<span class="cm">     */</span>
    <span class="s1">&#39;docScrollY&#39;</span>
    <span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
                <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

                <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;scrollLeft&#39;</span> <span class="k">in</span> <span class="nx">node</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">docScrollX</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;scrollLeft&#39;</span> <span class="k">in</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nb">document</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_getWin</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">scrollTo</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">docScrollY</span><span class="p">(</span><span class="nx">node</span><span class="p">));</span> <span class="c1">// scroll window if win or doc</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unable to set scrollLeft for &#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Node&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;scrollTop&#39;</span> <span class="k">in</span> <span class="nx">node</span><span class="p">)</span> <span class="o">?</span> <span class="nx">node</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">docScrollY</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;scrollTop&#39;</span> <span class="k">in</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nb">document</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_getWin</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">scrollTo</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">docScrollX</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">val</span><span class="p">);</span> <span class="c1">// scroll window if win or doc</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unable to set scrollTop for &#39;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Node&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="p">[</span>
<span class="cm">/**</span>
<span class="cm"> * Gets the current position of the node in page coordinates. </span>
<span class="cm"> * @method getXY</span>
<span class="cm"> * @for Node</span>
<span class="cm"> * @return {Array} The XY position of the node</span>
<span class="cm">*/</span>
    <span class="s1">&#39;getXY&#39;</span><span class="p">,</span>

<span class="cm">/**</span>
<span class="cm"> * Set the position of the node in page coordinates, regardless of how the node is positioned.</span>
<span class="cm"> * @method setXY</span>
<span class="cm"> * @param {Array} xy Contains X &amp; Y values for new position (coordinates are page-based)</span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>
    <span class="s1">&#39;setXY&#39;</span><span class="p">,</span>

<span class="cm">/**</span>
<span class="cm"> * Gets the current position of the node in page coordinates. </span>
<span class="cm"> * @method getX</span>
<span class="cm"> * @return {Int} The X position of the node</span>
<span class="cm">*/</span>
    <span class="s1">&#39;getX&#39;</span><span class="p">,</span>

<span class="cm">/**</span>
<span class="cm"> * Set the position of the node in page coordinates, regardless of how the node is positioned.</span>
<span class="cm"> * @method setX</span>
<span class="cm"> * @param {Int} x X value for new position (coordinates are page-based)</span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>
    <span class="s1">&#39;setX&#39;</span><span class="p">,</span>

<span class="cm">/**</span>
<span class="cm"> * Gets the current position of the node in page coordinates. </span>
<span class="cm"> * @method getY</span>
<span class="cm"> * @return {Int} The Y position of the node</span>
<span class="cm">*/</span>
    <span class="s1">&#39;getY&#39;</span><span class="p">,</span>

<span class="cm">/**</span>
<span class="cm"> * Set the position of the node in page coordinates, regardless of how the node is positioned.</span>
<span class="cm"> * @method setY</span>
<span class="cm"> * @param {Int} y Y value for new position (coordinates are page-based)</span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>
    <span class="s1">&#39;setY&#39;</span><span class="p">,</span>

<span class="cm">/**</span>
<span class="cm"> * Swaps the XY position of this node with another node. </span>
<span class="cm"> * @method swapXY</span>
<span class="cm"> * @param {Y.Node || HTMLElement} otherNode The node to swap with.</span>
<span class="cm"> * @chainable</span>
<span class="cm"> */</span>
    <span class="s1">&#39;swapXY&#39;</span>
<span class="p">]);</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a region object for the node</span>
<span class="cm"> * @config region</span>
<span class="cm"> * @for Node</span>
<span class="cm"> * @type Node</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">.</span><span class="nx">region</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(),</span>
            <span class="nx">region</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// document</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">isWindow</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">region</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">viewportRegion</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">region</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">region</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">region</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a region object for the node&#39;s viewport</span>
<span class="cm"> * @config viewportRegion</span>
<span class="cm"> * @type Node</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">ATTRS</span><span class="p">.</span><span class="nx">viewportRegion</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">viewportRegion</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">importMethod</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span> <span class="s1">&#39;inViewportRegion&#39;</span><span class="p">);</span>

<span class="c1">// these need special treatment to extract 2nd node arg</span>
<span class="cm">/**</span>
<span class="cm"> * Compares the intersection of the node with another node or region</span>
<span class="cm"> * @method intersect</span>
<span class="cm"> * @for Node</span>
<span class="cm"> * @param {Node|Object} node2 The node or region to compare with.</span>
<span class="cm"> * @param {Object} altRegion An alternate region to use (rather than this node&#39;s).</span>
<span class="cm"> * @return {Object} An object representing the intersection of the regions.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">intersect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node2</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node1</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">node2</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// might be a region object</span>
        <span class="nx">node2</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">node2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">node1</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Determines whether or not the node is within the giving region.</span>
<span class="cm"> * @method inRegion</span>
<span class="cm"> * @param {Node|Object} node2 The node or region to compare with.</span>
<span class="cm"> * @param {Boolean} all Whether or not all of the node must be in the region.</span>
<span class="cm"> * @param {Object} altRegion An alternate region to use (rather than this node&#39;s).</span>
<span class="cm"> * @return {Object} An object representing the intersection of the regions.</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">inRegion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node2</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node1</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">instanceOf</span><span class="p">(</span><span class="nx">node2</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// might be a region object</span>
        <span class="nx">node2</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">(</span><span class="nx">node2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">inRegion</span><span class="p">(</span><span class="nx">node1</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">altRegion</span><span class="p">);</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;node-base&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-screen&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;node-pluginhost&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Registers plugins to be instantiated at the class level (plugins </span>
<span class="cm"> * which should be plugged into every instance of Node by default).</span>
<span class="cm"> *</span>
<span class="cm"> * @method Node.plug</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Function | Array} plugin Either the plugin class, an array of plugin classes or an array of objects (with fn and cfg properties defined)</span>
<span class="cm"> * @param {Object} config (Optional) If plugin is the plugin class, the configuration for the plugin</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">plug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">);</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">.</span><span class="nx">Host</span><span class="p">.</span><span class="nx">plug</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Base</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Unregisters any class level plugins which have been registered by the Node</span>
<span class="cm"> *</span>
<span class="cm"> * @method Node.unplug</span>
<span class="cm"> * @static</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Function | Array} plugin The plugin class, or an array of plugin classes</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">unplug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">);</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">.</span><span class="nx">Host</span><span class="p">.</span><span class="nx">unplug</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Base</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// allow batching of plug/unplug via NodeList</span>
<span class="c1">// doesn&#39;t use NodeList.importMethod because we need real Nodes (not tmpNode)</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">plug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">plug</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unplug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unplug</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;node-base&#39;</span><span class="p">,</span> <span class="s1">&#39;pluginhost&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;node-event-delegate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Functionality to make the node a delegated event container</span>
<span class="cm"> * @module node</span>
<span class="cm"> * @submodule node-event-delegate</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;Sets up a delegation listener for an event occurring inside the Node.</span>
<span class="cm"> * The delegated event will be verified against a supplied selector or</span>
<span class="cm"> * filtering function to test if the event references at least one node that</span>
<span class="cm"> * should trigger the subscription callback.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;Selector string filters will trigger the callback if the event originated</span>
<span class="cm"> * from a node that matches it or is contained in a node that matches it.</span>
<span class="cm"> * Function filters are called for each Node up the parent axis to the</span>
<span class="cm"> * subscribing container node, and receive at each level the Node and the event</span>
<span class="cm"> * object.  The function should return true (or a truthy value) if that Node</span>
<span class="cm"> * should trigger the subscription callback.  Note, it is possible for filters</span>
<span class="cm"> * to match multiple Nodes for a single event.  In this case, the delegate</span>
<span class="cm"> * callback will be executed for each matching Node.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;For each matching Node, the callback will be executed with its &#39;this&#39;</span>
<span class="cm"> * object set to the Node matched by the filter (unless a specific context was</span>
<span class="cm"> * provided during subscription), and the provided event&#39;s</span>
<span class="cm"> * &lt;code&gt;currentTarget&lt;/code&gt; will also be set to the matching Node.  The</span>
<span class="cm"> * containing Node from which the subscription was originally made can be</span>
<span class="cm"> * referenced as &lt;code&gt;e.container&lt;/code&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * @method delegate</span>
<span class="cm"> * @param type {String} the event type to delegate</span>
<span class="cm"> * @param fn {Function} the callback function to execute.  This function</span>
<span class="cm"> *              will be provided the event object for the delegated event.</span>
<span class="cm"> * @param spec {String|Function} a selector that must match the target of the</span>
<span class="cm"> *              event or a function to test target and its parents for a match</span>
<span class="cm"> * @param context {Object} optional argument that specifies what &#39;this&#39; refers to.</span>
<span class="cm"> * @param args* {any} 0..n additional arguments to pass on to the callback function.</span>
<span class="cm"> *              These arguments will be added after the event object.</span>
<span class="cm"> * @return {EventHandle} the detach handle</span>
<span class="cm"> * @for Node</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>

    <span class="nx">args</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;node-base&#39;</span><span class="p">,</span> <span class="s1">&#39;event-delegate&#39;</span><span class="p">]});</span>


<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">){},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">skinnable</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> <span class="nx">use</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;node-base&#39;</span><span class="p">,</span> <span class="s1">&#39;node-style&#39;</span><span class="p">,</span> <span class="s1">&#39;node-screen&#39;</span><span class="p">,</span> <span class="s1">&#39;node-pluginhost&#39;</span><span class="p">,</span> <span class="s1">&#39;node-event-delegate&#39;</span><span class="p">]});</span>

<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;event-delegate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Adds event delegation support to the library.</span>
<span class="cm"> * </span>
<span class="cm"> * @module event</span>
<span class="cm"> * @submodule event-delegate</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">toArray</span>          <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Array</span><span class="p">,</span>
    <span class="nx">YLang</span>            <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">,</span>
    <span class="nx">isString</span>         <span class="o">=</span> <span class="nx">YLang</span><span class="p">.</span><span class="nx">isString</span><span class="p">,</span>
    <span class="nx">isObject</span>         <span class="o">=</span> <span class="nx">YLang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">,</span>
    <span class="nx">isArray</span>          <span class="o">=</span> <span class="nx">YLang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">,</span>
    <span class="nx">selectorTest</span>     <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span>
    <span class="nx">detachCategories</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Env</span><span class="p">.</span><span class="nx">evt</span><span class="p">.</span><span class="nx">handles</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;Sets up event delegation on a container element.  The delegated event</span>
<span class="cm"> * will use a supplied selector or filtering function to test if the event</span>
<span class="cm"> * references at least one node that should trigger the subscription</span>
<span class="cm"> * callback.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;Selector string filters will trigger the callback if the event originated</span>
<span class="cm"> * from a node that matches it or is contained in a node that matches it.</span>
<span class="cm"> * Function filters are called for each Node up the parent axis to the</span>
<span class="cm"> * subscribing container node, and receive at each level the Node and the event</span>
<span class="cm"> * object.  The function should return true (or a truthy value) if that Node</span>
<span class="cm"> * should trigger the subscription callback.  Note, it is possible for filters</span>
<span class="cm"> * to match multiple Nodes for a single event.  In this case, the delegate</span>
<span class="cm"> * callback will be executed for each matching Node.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;For each matching Node, the callback will be executed with its &#39;this&#39;</span>
<span class="cm"> * object set to the Node matched by the filter (unless a specific context was</span>
<span class="cm"> * provided during subscription), and the provided event&#39;s</span>
<span class="cm"> * &lt;code&gt;currentTarget&lt;/code&gt; will also be set to the matching Node.  The</span>
<span class="cm"> * containing Node from which the subscription was originally made can be</span>
<span class="cm"> * referenced as &lt;code&gt;e.container&lt;/code&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * @method delegate</span>
<span class="cm"> * @param type {String} the event type to delegate</span>
<span class="cm"> * @param fn {Function} the callback function to execute.  This function</span>
<span class="cm"> *              will be provided the event object for the delegated event.</span>
<span class="cm"> * @param el {String|node} the element that is the delegation container</span>
<span class="cm"> * @param spec {string|Function} a selector that must match the target of the</span>
<span class="cm"> *              event or a function to test target and its parents for a match</span>
<span class="cm"> * @param context optional argument that specifies what &#39;this&#39; refers to.</span>
<span class="cm"> * @param args* 0..n additional arguments to pass on to the callback function.</span>
<span class="cm"> *              These arguments will be added after the event object.</span>
<span class="cm"> * @return {EventHandle} the detach handle</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">delegate</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span>     <span class="o">=</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="nx">query</span>    <span class="o">=</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">?</span> <span class="nx">el</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">typeBits</span><span class="p">,</span> <span class="nx">synth</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">categories</span><span class="p">,</span> <span class="nx">cat</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">handles</span><span class="p">,</span> <span class="nx">handle</span><span class="p">;</span>

    <span class="c1">// Support Y.delegate({ click: fnA, key: fnB }, context, filter, ...);</span>
    <span class="c1">// and Y.delegate([&#39;click&#39;, &#39;key&#39;], fn, context, filter, ...);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">handles</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">handles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Y.delegate({&#39;click&#39;, fn}, context, filter) =&gt;</span>
            <span class="c1">// Y.delegate(&#39;click&#39;, fn, context, filter)</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span> <span class="c1">// one arg becomes two; need to make space</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
                    <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="nx">handles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventHandle</span><span class="p">(</span><span class="nx">handles</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">typeBits</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\|/</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">typeBits</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cat</span>  <span class="o">=</span> <span class="nx">typeBits</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">typeBits</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">synth</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">synth</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">synth</span><span class="p">.</span><span class="nx">delegate</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">handle</span> <span class="o">=</span> <span class="nx">synth</span><span class="p">.</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">synth</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">type</span> <span class="o">||</span> <span class="o">!</span><span class="nx">fn</span> <span class="o">||</span> <span class="o">!</span><span class="nx">el</span> <span class="o">||</span> <span class="o">!</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;delegate requires type, callback, parent, &amp; filter&quot;</span><span class="p">,</span> <span class="s2">&quot;warn&quot;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">container</span> <span class="o">=</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="nx">el</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">container</span> <span class="o">&amp;&amp;</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">handle</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;available&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">handle</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">args</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">},</span> <span class="nx">el</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handle</span> <span class="o">&amp;&amp;</span> <span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">container</span><span class="p">);</span> <span class="c1">// remove the filter</span>

            <span class="nx">handle</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">_attach</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="p">{</span> <span class="nx">facade</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>
            <span class="nx">handle</span><span class="p">.</span><span class="nx">sub</span><span class="p">.</span><span class="nx">filter</span>  <span class="o">=</span> <span class="nx">filter</span><span class="p">;</span>
            <span class="nx">handle</span><span class="p">.</span><span class="nx">sub</span><span class="p">.</span><span class="nx">_notify</span> <span class="o">=</span> <span class="nx">delegate</span><span class="p">.</span><span class="nx">notifySub</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">handle</span> <span class="o">&amp;&amp;</span> <span class="nx">cat</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">categories</span> <span class="o">=</span> <span class="nx">detachCategories</span><span class="p">[</span><span class="nx">cat</span><span class="p">]</span>  <span class="o">||</span> <span class="p">(</span><span class="nx">detachCategories</span><span class="p">[</span><span class="nx">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">{});</span>
        <span class="nx">categories</span> <span class="o">=</span> <span class="nx">categories</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">categories</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]);</span>
        <span class="nx">categories</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">handle</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">handle</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Overrides the &lt;code&gt;_notify&lt;/code&gt; method on the normal DOM subscription to</span>
<span class="cm"> * inject the filtering logic and only proceed in the case of a match.</span>
<span class="cm"> * </span>
<span class="cm"> * @method delegate.notifySub</span>
<span class="cm"> * @param thisObj {Object} default &#39;this&#39; object for the callback</span>
<span class="cm"> * @param args {Array} arguments passed to the event&#39;s &lt;code&gt;fire()&lt;/code&gt;</span>
<span class="cm"> * @param ce {CustomEvent} the custom event managing the DOM subscriptions for</span>
<span class="cm"> *              the subscribed event on the subscribing node.</span>
<span class="cm"> * @return {Boolean} false if the event was stopped</span>
<span class="cm"> * @private</span>
<span class="cm"> * @static</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> */</span>
<span class="nx">delegate</span><span class="p">.</span><span class="nx">notifySub</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">thisObj</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Preserve args for other subscribers</span>
    <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Only notify subs if the event occurred on a targeted element</span>
    <span class="kd">var</span> <span class="nx">currentTarget</span> <span class="o">=</span> <span class="nx">delegate</span><span class="p">.</span><span class="nx">_applyFilter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ce</span><span class="p">),</span>
        <span class="c1">//container     = e.currentTarget,</span>
        <span class="nx">e</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">ret</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">currentTarget</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Support multiple matches up the the container subtree</span>
        <span class="nx">currentTarget</span> <span class="o">=</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">currentTarget</span><span class="p">);</span>

        <span class="c1">// The second arg is the currentTarget, but we&#39;ll be reusing this</span>
        <span class="c1">// facade, replacing the currentTarget for each use, so it doesn&#39;t</span>
        <span class="c1">// matter what element we seed it with.</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOMEventFacade</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">el</span><span class="p">,</span> <span class="nx">ce</span><span class="p">);</span>

        <span class="nx">e</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">currentTarget</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">stopped</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">currentTarget</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>

            <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// stop further notifications</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;Compiles a selector string into a filter function to identify whether</span>
<span class="cm"> * Nodes along the parent axis of an event&#39;s target should trigger event</span>
<span class="cm"> * notification.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;This function is memoized, so previously compiled filter functions are</span>
<span class="cm"> * returned if the same selector string is provided.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;This function may be useful when defining synthetic events for delegate</span>
<span class="cm"> * handling.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @method delegate.compileFilter</span>
<span class="cm"> * @param selector {String} the selector string to base the filtration on</span>
<span class="cm"> * @return {Function}</span>
<span class="cm"> * @since 3.2.0</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">delegate</span><span class="p">.</span><span class="nx">compileFilter</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">cached</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">selectorTest</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">_node</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">});</span>

<span class="cm">/**</span>
<span class="cm"> * Walks up the parent axis of an event&#39;s target, and tests each element</span>
<span class="cm"> * against a supplied filter function.  If any Nodes, including the container,</span>
<span class="cm"> * satisfy the filter, the delegated callback will be triggered for each.</span>
<span class="cm"> *</span>
<span class="cm"> * @method delegate._applyFilter</span>
<span class="cm"> * @param filter {Function} boolean function to test for inclusion in event</span>
<span class="cm"> *                  notification</span>
<span class="cm"> * @param args {Array} the arguments that would be passed to subscribers</span>
<span class="cm"> * @param ce   {CustomEvent} the DOM event wrapper</span>
<span class="cm"> * @return {Node|Node[]|undefined} The Node or Nodes that satisfy the filter</span>
<span class="cm"> * @protected</span>
<span class="cm"> */</span>
<span class="nx">delegate</span><span class="p">.</span><span class="nx">_applyFilter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ce</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span>         <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">container</span> <span class="o">=</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">el</span><span class="p">,</span> <span class="c1">// facadeless events in IE, have no e.currentTarget</span>
        <span class="nx">target</span>    <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">,</span>
        <span class="nx">match</span>     <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">isContainer</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// Resolve text nodes to their containing element</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// passing target as the first arg rather than leaving well enough alone</span>
    <span class="c1">// making &#39;this&#39; in the filter function refer to the target.  This is to</span>
    <span class="c1">// support bound filter functions.</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">isString</span><span class="p">(</span><span class="nx">filter</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">isContainer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">container</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">selectorTest</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">filter</span><span class="p">,</span> <span class="p">(</span><span class="nx">isContainer</span> <span class="o">?</span><span class="kc">null</span><span class="o">:</span> <span class="nx">container</span><span class="p">)))</span> <span class="p">{</span>
                <span class="nx">match</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">isContainer</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// filter functions are implementer code and should receive wrappers</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOMEventFacade</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">ce</span><span class="p">);</span>

        <span class="k">while</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// filter(target, e, extra args...) - this === target</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">match</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
            <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span> <span class="c1">// restore the raw DOM event</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// single match or undefined</span>
    <span class="p">}</span>

    <span class="c1">// remove the target</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Sets up event delegation on a container element.  The delegated event</span>
<span class="cm"> * will use a supplied filter to test if the callback should be executed.</span>
<span class="cm"> * This filter can be either a selector string or a function that returns</span>
<span class="cm"> * a Node to use as the currentTarget for the event.</span>
<span class="cm"> *</span>
<span class="cm"> * The event object for the delegated event is supplied to the callback</span>
<span class="cm"> * function.  It is modified slightly in order to support all properties</span>
<span class="cm"> * that may be needed for event delegation.  &#39;currentTarget&#39; is set to</span>
<span class="cm"> * the element that matched the selector string filter or the Node returned</span>
<span class="cm"> * from the filter function.  &#39;container&#39; is set to the element that the</span>
<span class="cm"> * listener is delegated from (this normally would be the &#39;currentTarget&#39;).</span>
<span class="cm"> *</span>
<span class="cm"> * Filter functions will be called with the arguments that would be passed to</span>
<span class="cm"> * the callback function, including the event object as the first parameter.</span>
<span class="cm"> * The function should return false (or a falsey value) if the success criteria</span>
<span class="cm"> * aren&#39;t met, and the Node to use as the event&#39;s currentTarget and &#39;this&#39;</span>
<span class="cm"> * object if they are.</span>
<span class="cm"> *</span>
<span class="cm"> * @method delegate</span>
<span class="cm"> * @param type {string} the event type to delegate</span>
<span class="cm"> * @param fn {function} the callback function to execute.  This function</span>
<span class="cm"> * will be provided the event object for the delegated event.</span>
<span class="cm"> * @param el {string|node} the element that is the delegation container</span>
<span class="cm"> * @param filter {string|function} a selector that must match the target of the</span>
<span class="cm"> * event or a function that returns a Node or false.</span>
<span class="cm"> * @param context optional argument that specifies what &#39;this&#39; refers to.</span>
<span class="cm"> * @param args* 0..n additional arguments to pass on to the callback function.</span>
<span class="cm"> * These arguments will be added after the event object.</span>
<span class="cm"> * @return {EventHandle} the detach handle</span>
<span class="cm"> * @for YUI</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="nx">delegate</span><span class="p">;</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;node-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;io-base&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

   <span class="cm">/**</span>
<span class="cm">    * Base IO functionality. Provides basic XHR transport support.</span>
<span class="cm">    * @module io</span>
<span class="cm">    * @submodule io-base</span>
<span class="cm">    */</span>

   <span class="cm">/**</span>
<span class="cm">    * The io class is a utility that brokers HTTP requests through a simplified</span>
<span class="cm">    * interface.  Specifically, it allows JavaScript to make HTTP requests to</span>
<span class="cm">    * a resource without a page reload.  The underlying transport for making</span>
<span class="cm">    * same-domain requests is the XMLHttpRequest object.  YUI.io can also use</span>
<span class="cm">    * Flash, if specified as a transport, for cross-domain requests.</span>
<span class="cm">    *</span>
<span class="cm">    * @class io</span>
<span class="cm">    */</span>

   <span class="cm">/**</span>
<span class="cm">    * @event io:start</span>
<span class="cm">    * @description This event is fired by YUI.io when a transaction is initiated.</span>
<span class="cm">    * @type Event Custom</span>
<span class="cm">    */</span>
    <span class="kd">var</span> <span class="nx">E_START</span> <span class="o">=</span> <span class="s1">&#39;io:start&#39;</span><span class="p">,</span>

   <span class="cm">/**</span>
<span class="cm">    * @event io:complete</span>
<span class="cm">    * @description This event is fired by YUI.io when a transaction is complete.</span>
<span class="cm">    * Response status and data are accessible, if available.</span>
<span class="cm">    * @type Event Custom</span>
<span class="cm">    */</span>
    <span class="nx">E_COMPLETE</span> <span class="o">=</span> <span class="s1">&#39;io:complete&#39;</span><span class="p">,</span>

   <span class="cm">/**</span>
<span class="cm">    * @event io:success</span>
<span class="cm">    * @description This event is fired by YUI.io when a transaction is complete, and</span>
<span class="cm">    * the HTTP status resolves to HTTP2xx.</span>
<span class="cm">    * @type Event Custom</span>
<span class="cm">    */</span>
    <span class="nx">E_SUCCESS</span> <span class="o">=</span> <span class="s1">&#39;io:success&#39;</span><span class="p">,</span>

   <span class="cm">/**</span>
<span class="cm">    * @event io:failure</span>
<span class="cm">    * @description This event is fired by YUI.io when a transaction is complete, and</span>
<span class="cm">    * the HTTP status resolves to HTTP4xx, 5xx and above.</span>
<span class="cm">    * @type Event Custom</span>
<span class="cm">    */</span>
    <span class="nx">E_FAILURE</span> <span class="o">=</span> <span class="s1">&#39;io:failure&#39;</span><span class="p">,</span>

   <span class="cm">/**</span>
<span class="cm">    * @event io:end</span>
<span class="cm">    * @description This event signifies the end of the transaction lifecycle.  The</span>
<span class="cm">    * transaction transport is destroyed.</span>
<span class="cm">    * @type Event Custom</span>
<span class="cm">    */</span>
    <span class="nx">E_END</span> <span class="o">=</span> <span class="s1">&#39;io:end&#39;</span><span class="p">,</span>

    <span class="c1">//--------------------------------------</span>
    <span class="c1">//  Properties</span>
    <span class="c1">//--------------------------------------</span>
   <span class="cm">/**</span>
<span class="cm">    * @description A transaction counter that increments for each transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @property transactionId</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @type int</span>
<span class="cm">    */</span>
    <span class="nx">transactionId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Object of default HTTP headers to be initialized and sent</span>
<span class="cm">    * for all transactions.</span>
<span class="cm">    *</span>
<span class="cm">    * @property _headers</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @type object</span>
<span class="cm">    */</span>
    <span class="nx">_headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;X-Requested-With&#39;</span> <span class="o">:</span> <span class="s1">&#39;XMLHttpRequest&#39;</span>
    <span class="p">},</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Object that stores timeout values for any transaction with</span>
<span class="cm">    * a defined &quot;timeout&quot; configuration property.</span>
<span class="cm">    *</span>
<span class="cm">    * @property _timeout</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @type object</span>
<span class="cm">    */</span>
    <span class="nx">_timeout</span> <span class="o">=</span> <span class="p">{},</span>

    <span class="c1">// Window reference</span>
    <span class="nx">w</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">;</span>

    <span class="c1">//--------------------------------------</span>
    <span class="c1">//  Methods</span>
    <span class="c1">//--------------------------------------</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method that creates the XMLHttpRequest transport</span>
<span class="cm">    *</span>
<span class="cm">    * @method _xhr</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @return object</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_xhr</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">w</span><span class="p">.</span><span class="nx">XMLHttpRequest</span> <span class="o">?</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">&#39;Microsoft.XMLHTTP&#39;</span><span class="p">);</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method that increments _transactionId for each transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _id</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @return int</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_id</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">transactionId</span><span class="p">;</span>

		<span class="nx">transactionId</span><span class="o">++</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">id</span><span class="p">;</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method that creates a unique transaction object for each</span>
<span class="cm">    * request.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _create</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {number} c - configuration object subset to determine if</span>
<span class="cm">    *                     the transaction is an XDR or file upload,</span>
<span class="cm">    *                     requiring an alternate transport.</span>
<span class="cm">    * @param {number} i - transaction id</span>
<span class="cm">    * @return object</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_create</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">?</span> <span class="nx">i</span> <span class="o">:</span> <span class="nx">_id</span><span class="p">();</span>
            <span class="nx">c</span> <span class="o">=</span> <span class="nx">c</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">use</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">upload</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">_xhr</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">use</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">use</span> <span class="o">===</span> <span class="s1">&#39;native&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">XDomainRequest</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XDomainRequest</span><span class="p">();</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">use</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">_xhr</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">_transport</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">use</span><span class="p">];</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">use</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="p">{};</span>
			<span class="nx">o</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="s1">&#39;io:iframe&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="nx">_destroy</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">&amp;&amp;</span> <span class="nx">w</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">===</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
				<span class="c1">// IE, when using XMLHttpRequest as an ActiveX Object, will throw</span>
				<span class="c1">// a &quot;Type Mismatch&quot; error if the event handler is set to &quot;null&quot;.</span>
				<span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
			<span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">o</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method for creating and subscribing transaction events.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _tE</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {string} e - event to be published</span>
<span class="cm">    * @param {object} c - configuration data subset for event subscription.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_tE</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">eT</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">EventTarget</span><span class="p">().</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;transaction:&#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">),</span>
            <span class="nx">cT</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">context</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">,</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">eT</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">[</span><span class="nx">e</span><span class="p">],</span> <span class="nx">cT</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">eT</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">[</span><span class="nx">e</span><span class="p">],</span> <span class="nx">cT</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">eT</span><span class="p">;</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Fires event &quot;io:start&quot; and creates, fires a</span>
<span class="cm">    * transaction-specific start event, if config.on.start is</span>
<span class="cm">    * defined.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _ioStart</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {number} id - transaction id</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_ioStart</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_START</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_START</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_tE</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">c</span><span class="p">).</span><span class="nx">fire</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>


   <span class="cm">/**</span>
<span class="cm">    * @description Fires event &quot;io:complete&quot; and creates, fires a</span>
<span class="cm">    * transaction-specific &quot;complete&quot; event, if config.on.complete is</span>
<span class="cm">    * defined.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _ioComplete</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - transaction object.</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_ioComplete</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">e</span> <span class="o">?</span> <span class="p">{</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">statusText</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">e</span> <span class="p">}</span> <span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">,</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_COMPLETE</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_COMPLETE</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">complete</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_tE</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="nx">c</span><span class="p">).</span><span class="nx">fire</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Fires event &quot;io:end&quot; and creates, fires a</span>
<span class="cm">    * transaction-specific &quot;end&quot; event, if config.on.end is</span>
<span class="cm">    * defined.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _ioEnd</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - transaction object.</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_ioEnd</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_END</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_END</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_tE</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="nx">c</span><span class="p">).</span><span class="nx">fire</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">_destroy</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Fires event &quot;io:success&quot; and creates, fires a</span>
<span class="cm">    * transaction-specific &quot;success&quot; event, if config.on.success is</span>
<span class="cm">    * defined.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _ioSuccess</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - transaction object.</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_ioSuccess</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_SUCCESS</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_SUCCESS</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_tE</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="nx">c</span><span class="p">).</span><span class="nx">fire</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">_ioEnd</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Fires event &quot;io:failure&quot; and creates, fires a</span>
<span class="cm">    * transaction-specific &quot;failure&quot; event, if config.on.failure is</span>
<span class="cm">    * defined.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _ioFailure</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - transaction object.</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_ioFailure</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">e</span> <span class="o">?</span> <span class="p">{</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">statusText</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">e</span> <span class="p">}</span> <span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">,</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_FAILURE</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">E_FAILURE</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">failure</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_tE</span><span class="p">(</span><span class="s1">&#39;failure&#39;</span><span class="p">,</span> <span class="nx">c</span><span class="p">).</span><span class="nx">fire</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">_ioEnd</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Resends an XDR transaction, using the Flash tranport,</span>
<span class="cm">    * if the native transport fails.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _resend</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>

<span class="cm">    * @param {object} o - Transaction object generated by _create().</span>
<span class="cm">    * @param {string} uri - qualified path to transaction resource.</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_resend</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_destroy</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">xdr</span><span class="p">.</span><span class="nx">use</span> <span class="o">=</span> <span class="s1">&#39;flash&#39;</span><span class="p">;</span>
        <span class="c1">// If the original request included serialized form data and</span>
        <span class="c1">// additional data are defined in the configuration, it must</span>
        <span class="c1">// be reset to prevent data duplication.</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">form</span> <span class="o">&amp;&amp;</span> <span class="nx">d</span> <span class="o">?</span> <span class="nx">d</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">io</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method that concatenates string data for HTTP GET transactions.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _concat</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {string} s - URI or root data.</span>
<span class="cm">    * @param {string} d - data to be concatenated onto URI.</span>
<span class="cm">    * @return int</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_concat</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;?&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">d</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method that stores default client headers for all transactions.</span>
<span class="cm">    * If a label is passed with no value argument, the header will be deleted.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _setHeader</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {string} l - HTTP header</span>
<span class="cm">    * @param {string} v - HTTP header value</span>
<span class="cm">    * @return int</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_setHeader</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_headers</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="nx">_headers</span><span class="p">[</span><span class="nx">l</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method that sets all HTTP headers to be sent in a transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _setHeaders</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - XHR instance for the specific transaction.</span>
<span class="cm">    * @param {object} h - HTTP headers for the specific transaction, as defined</span>
<span class="cm">    *                     in the configuration object passed to YUI.io().</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_setHeaders</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">p</span><span class="p">;</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">_headers</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">_headers</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">[</span><span class="nx">p</span><span class="p">])</span> <span class="p">{</span>
					<span class="nx">h</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_headers</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
				<span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">h</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;disable&#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">o</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">h</span><span class="p">[</span><span class="nx">p</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Terminates a transaction due to an explicit abort or</span>
<span class="cm">    * timeout.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _ioCancel</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - Transaction object generated by _create().</span>
<span class="cm">    * @param {string} s - Identifies timed out or aborted transaction.</span>
<span class="cm">    *</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_ioCancel</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">s</span><span class="p">;</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Starts timeout count if the configuration object</span>
<span class="cm">    * has a defined timeout property.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _startTimeout</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - Transaction object generated by _create().</span>
<span class="cm">    * @param {object} t - Timeout in milliseconds.</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_startTimeout</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_timeout</span><span class="p">[</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">_ioCancel</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="s1">&#39;timeout&#39;</span><span class="p">);</span> <span class="p">},</span> <span class="nx">t</span><span class="p">);</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Clears the timeout interval started by _startTimeout().</span>
<span class="cm">    *</span>
<span class="cm">    * @method _clearTimeout</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {number} id - Transaction id.</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_clearTimeout</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">w</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">_timeout</span><span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
        <span class="k">delete</span> <span class="nx">_timeout</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method that determines if a transaction response qualifies</span>
<span class="cm">    * as success or failure, based on the response HTTP status code, and</span>
<span class="cm">    * fires the appropriate success or failure events.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _handleResponse</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - Transaction object generated by _create().</span>
<span class="cm">    * @param {object} c - Configuration object passed to io().</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_handleResponse</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>

        <span class="c1">// IE reports HTTP 204 as HTTP 1223.</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">responseText</span> <span class="o">||</span> <span class="nx">status</span> <span class="o">===</span> <span class="mi">1223</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">status</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_ioSuccess</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
		<span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">_ioFailure</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Event handler bound to onreadystatechange.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _readyState</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {object} o - Transaction object generated by _create().</span>
<span class="cm">    * @param {object} c - Configuration object passed to YUI.io().</span>
<span class="cm">    * @return void</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_readyState</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_clearTimeout</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">w</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span>
                <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">_ioComplete</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
                    <span class="nx">_handleResponse</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
                <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method for requesting a transaction. _io() is implemented as</span>
<span class="cm">    * yui.io().  Each transaction may include a configuration object.  Its</span>
<span class="cm">    * properties are:</span>
<span class="cm">    *</span>
<span class="cm">    * method: HTTP method verb (e.g., GET or POST). If this property is not</span>
<span class="cm">    *         not defined, the default value will be GET.</span>
<span class="cm">    *</span>
<span class="cm">    * data: This is the name-value string that will be sent as the transaction</span>
<span class="cm">    *       data.  If the request is HTTP GET, the data become part of</span>
<span class="cm">    *       querystring. If HTTP POST, the data are sent in the message body.</span>
<span class="cm">    *</span>
<span class="cm">    * xdr: Defines the transport to be used for cross-domain requests.  By</span>
<span class="cm">    *      setting this property, the transaction will use the specified</span>
<span class="cm">    *      transport instead of XMLHttpRequest.</span>
<span class="cm">    *      The properties are:</span>
<span class="cm">    *      {</span>
<span class="cm">    *        use: Specify the transport to be used: &#39;flash&#39; and &#39;native&#39;</span>
<span class="cm">    *        dataType: Set the value to &#39;XML&#39; if that is the expected</span>
<span class="cm">    *                  response content type.</span>
<span class="cm">    *      }</span>
<span class="cm">    *</span>
<span class="cm">    *</span>
<span class="cm">    * form: This is a defined object used to process HTML form as data.  The</span>
<span class="cm">    *       properties are:</span>
<span class="cm">    *       {</span>
<span class="cm">    *         id: Node object or id of HTML form.</span>
<span class="cm">    *         useDisabled: Boolean value to allow disabled HTML form field</span>
<span class="cm">    *                      values to be sent as part of the data.</span>
<span class="cm">    *       }</span>
<span class="cm">    *</span>
<span class="cm">    * on: This is a defined object used to create and handle specific</span>
<span class="cm">    *     events during a transaction lifecycle.  These events will fire in</span>
<span class="cm">    *     addition to the global io events. The events are:</span>
<span class="cm">    *     start - This event is fired when a request is sent to a resource.</span>
<span class="cm">    *     complete - This event fires when the transaction is complete.</span>
<span class="cm">    *     success - This event fires when the response status resolves to</span>
<span class="cm">    *               HTTP 2xx.</span>
<span class="cm">    *     failure - This event fires when the response status resolves to</span>
<span class="cm">    *               HTTP 4xx, 5xx; and, for all transaction exceptions,</span>
<span class="cm">    *               including aborted transactions and transaction timeouts.</span>
<span class="cm">    *     end -  This even is fired at the conclusion of the transaction</span>
<span class="cm">    *            lifecycle, after a success or failure resolution.</span>
<span class="cm">    *</span>
<span class="cm">    *     The properties are:</span>
<span class="cm">    *     {</span>
<span class="cm">    *       start: function(id, arguments){},</span>
<span class="cm">    *       complete: function(id, responseobject, arguments){},</span>
<span class="cm">    *       success: function(id, responseobject, arguments){},</span>
<span class="cm">    *       failure: function(id, responseobject, arguments){},</span>
<span class="cm">    *       end: function(id, arguments){}</span>
<span class="cm">    *     }</span>
<span class="cm">    *     Each property can reference a function or be written as an</span>
<span class="cm">    *     inline function.</span>
<span class="cm">    *</span>
<span class="cm">    * sync: To enable synchronous transactions, set the configuration property</span>
<span class="cm">    *       &quot;sync&quot; to true; the default behavior is false.  Synchronous</span>
<span class="cm">    *       transactions are limited to same-domain requests only.</span>
<span class="cm">    *</span>
<span class="cm">    * context: Object reference for all defined transaction event handlers</span>
<span class="cm">    *          when it is implemented as a method of a base object. Defining</span>
<span class="cm">    *          &quot;context&quot; will set the reference of &quot;this,&quot; used in the</span>
<span class="cm">    *          event handlers, to the context value.  In the case where</span>
<span class="cm">    *          different event handlers all have different contexts,</span>
<span class="cm">    *          use Y.bind() to set the execution context, bypassing this</span>
<span class="cm">    *          configuration.</span>
<span class="cm">    *</span>
<span class="cm">    * headers: This is a defined object of client headers, as many as.</span>
<span class="cm">    *          desired for the transaction.  The object pattern is:</span>
<span class="cm">    *          { &#39;header&#39;: &#39;value&#39; }.</span>
<span class="cm">    *</span>
<span class="cm">    * timeout: This value, defined as milliseconds, is a time threshold for the</span>
<span class="cm">    *          transaction. When this threshold is reached, and the transaction&#39;s</span>
<span class="cm">    *          Complete event has not yet fired, the transaction will be aborted.</span>
<span class="cm">    *</span>
<span class="cm">    * arguments: Object, array, string, or number passed to all registered</span>
<span class="cm">    *            event handlers.  This value is available as the second</span>
<span class="cm">    *            argument in the &quot;start&quot; and &quot;abort&quot; event handlers; and, it is</span>
<span class="cm">    *            the third argument in the &quot;complete&quot;, &quot;success&quot;, and &quot;failure&quot;</span>
<span class="cm">    *            event handlers.</span>
<span class="cm">    *</span>
<span class="cm">    * @method _io</span>
<span class="cm">    * @private</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {string} uri - qualified path to transaction resource.</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    * @param {number} i - transaction id, if already set.</span>
<span class="cm">    * @return object</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_io</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">oD</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">usr</span><span class="p">,</span> <span class="nx">pwd</span><span class="p">,</span>
            <span class="nx">u</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">;</span>
            <span class="nx">c</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="o">||</span> <span class="p">{};</span>
            <span class="nx">o</span> <span class="o">=</span> <span class="nx">_create</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">xdr</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">form</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
			<span class="nx">usr</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">username</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
			<span class="nx">pwd</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">password</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">method</span> <span class="o">?</span> <span class="nx">c</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span><span class="p">;</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">sync</span><span class="p">;</span>
            <span class="nx">oD</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

        <span class="c1">// Serialize an object into a key-value string using</span>
        <span class="c1">// querystring-stringify-simple.</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">upload</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// This is a file upload transaction, calling</span>
                <span class="c1">// upload() in io-upload-iframe.</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">upload</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Serialize HTML form data into a key-value string.</span>
                <span class="nx">f</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">_serialize</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">form</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">===</span> <span class="s1">&#39;POST&#39;</span> <span class="o">||</span> <span class="nx">m</span> <span class="o">===</span> <span class="s1">&#39;PUT&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">c</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">===</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">uri</span> <span class="o">=</span> <span class="nx">_concat</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">f</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="s1">&#39;GET&#39;</span><span class="o">:</span>
				<span class="k">case</span> <span class="s1">&#39;HEAD&#39;</span><span class="o">:</span>
				<span class="k">case</span> <span class="s1">&#39;DELETE&#39;</span><span class="o">:</span>
					<span class="nx">uri</span> <span class="o">=</span> <span class="nx">_concat</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
					<span class="nx">c</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
					<span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;HTTP&#39;</span> <span class="o">+</span> <span class="nx">m</span> <span class="o">+</span> <span class="s1">&#39; with data.  The querystring is: &#39;</span> <span class="o">+</span> <span class="nx">uri</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;io&#39;</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="s1">&#39;POST&#39;</span><span class="o">:</span>
				<span class="k">case</span> <span class="s1">&#39;PUT&#39;</span><span class="o">:</span>
					<span class="c1">// If Content-Type is defined in the configuration object, or</span>
					<span class="c1">// or as a default header, it will be used instead of</span>
					<span class="c1">// &#39;application/x-www-form-urlencoded; charset=UTF-8&#39;</span>
					<span class="nx">c</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span> <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/x-www-form-urlencoded; charset=UTF-8&#39;</span> <span class="p">},</span> <span class="nx">c</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// Cross-domain request or custom transport detected.</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">xdr</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">_readyState</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span> <span class="p">};</span>
        <span class="p">}</span>

        <span class="k">try</span> <span class="p">{</span>
			<span class="c1">// Determine if request is to be set as</span>
			<span class="c1">// synchronous or asynchronous.</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">s</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">usr</span><span class="p">,</span> <span class="nx">pwd</span><span class="p">);</span>
			<span class="nx">_setHeaders</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>
			<span class="nx">_ioStart</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>

            <span class="c1">// Will work only in browsers that implement the</span>
            <span class="c1">// Cross-Origin Resource Sharing draft.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">xdr</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">xdr</span><span class="p">.</span><span class="nx">credentials</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
				<span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// Using &quot;null&quot; with HTTP POST will  result in a request</span>
            <span class="c1">// with no Content-Length header defined.</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
				<span class="c1">// Create a response object for synchronous transactions,</span>
				<span class="c1">// merging ID and arguments fields into a single object.</span>
                <span class="nx">d</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
                <span class="nx">a</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;statusText&#39;</span><span class="p">,</span> <span class="s1">&#39;responseText&#39;</span><span class="p">,</span> <span class="s1">&#39;responseXML&#39;</span><span class="p">];</span>
                <span class="nx">r</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span> <span class="o">?</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">arguments</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arguments</span> <span class="p">}</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span> <span class="p">};</span>
                <span class="nx">r</span><span class="p">.</span><span class="nx">getAllResponseHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getAllResponseHeaders</span><span class="p">();</span> <span class="p">};</span>
                <span class="nx">r</span><span class="p">.</span><span class="nx">getResponseHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getResponseHeader</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span> <span class="p">};</span>

                <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">r</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
                <span class="p">}</span>

                <span class="nx">_ioComplete</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
                <span class="nx">_handleResponse</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>

                <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">xdr</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">xdr</span><span class="p">.</span><span class="nx">use</span> <span class="o">===</span> <span class="s1">&#39;native&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// This exception is usually thrown by browsers</span>
                <span class="c1">// that do not support XMLHttpRequest Level 2.</span>
				<span class="c1">// Retry the request with the XDR transport set</span>
				<span class="c1">// to &#39;flash&#39;.  If the Flash transport is not</span>
				<span class="c1">// initialized or available, the transaction</span>
				<span class="c1">// will resolve to a transport error.</span>
                <span class="k">return</span> <span class="nx">_resend</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">u</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">oD</span><span class="p">);</span>
            <span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
                <span class="nx">_ioComplete</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
				<span class="nx">_handleResponse</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
			<span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// If config.timeout is defined, and the request is standard XHR,</span>
        <span class="c1">// initialize timeout polling.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_startTimeout</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">timeout</span><span class="p">);</span>
            <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Configuration timeout set to: &#39;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;io&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="nx">abort</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">?</span> <span class="nx">_ioCancel</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="s1">&#39;abort&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="nx">isInProgress</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span> <span class="o">?</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">!==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="nx">_io</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="nx">_ioStart</span><span class="p">;</span>
    <span class="nx">_io</span><span class="p">.</span><span class="nx">complete</span> <span class="o">=</span> <span class="nx">_ioComplete</span><span class="p">;</span>
    <span class="nx">_io</span><span class="p">.</span><span class="nx">success</span> <span class="o">=</span> <span class="nx">_ioSuccess</span><span class="p">;</span>
    <span class="nx">_io</span><span class="p">.</span><span class="nx">failure</span> <span class="o">=</span> <span class="nx">_ioFailure</span><span class="p">;</span>
    <span class="nx">_io</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="nx">_ioEnd</span><span class="p">;</span>
    <span class="nx">_io</span><span class="p">.</span><span class="nx">_id</span> <span class="o">=</span> <span class="nx">_id</span><span class="p">;</span>
    <span class="nx">_io</span><span class="p">.</span><span class="nx">_timeout</span> <span class="o">=</span> <span class="nx">_timeout</span><span class="p">;</span>

    <span class="c1">//--------------------------------------</span>
    <span class="c1">//  Begin public interface definition</span>
    <span class="c1">//--------------------------------------</span>
   <span class="cm">/**</span>
<span class="cm">    * @description Method that stores default client headers for all transactions.</span>
<span class="cm">    * If a label is passed with no value argument, the header will be deleted.</span>
<span class="cm">    * This is the interface for _setHeader().</span>
<span class="cm">    *</span>
<span class="cm">    * @method header</span>
<span class="cm">    * @public</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {string} l - HTTP header</span>
<span class="cm">    * @param {string} v - HTTP header value</span>
<span class="cm">    * @return int</span>
<span class="cm">    */</span>
    <span class="nx">_io</span><span class="p">.</span><span class="nx">header</span> <span class="o">=</span> <span class="nx">_setHeader</span><span class="p">;</span>

   <span class="cm">/**</span>
<span class="cm">    * @description Method for requesting a transaction. This</span>
<span class="cm">    * is the interface for _io().</span>
<span class="cm">    *</span>
<span class="cm">    * @method io</span>
<span class="cm">    * @public</span>
<span class="cm">    * @static</span>
<span class="cm">    * @param {string} uri - qualified path to transaction resource.</span>
<span class="cm">    * @param {object} c - configuration object for the transaction.</span>
<span class="cm">    * @return object</span>
<span class="cm">    */</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">io</span> <span class="o">=</span> <span class="nx">_io</span><span class="p">;</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">http</span> <span class="o">=</span> <span class="nx">_io</span><span class="p">;</span>



<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;event-custom-base&#39;</span><span class="p">,</span> <span class="s1">&#39;querystring-stringify-simple&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;querystring-stringify-simple&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/*global Y */</span>
<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;Provides Y.QueryString.stringify method for converting objects to Query Strings.</span>
<span class="cm"> * This is a subset implementation of the full querystring-stringify.&lt;/p&gt;</span>
<span class="cm"> * &lt;p&gt;This module provides the bare minimum functionality (encoding a hash of simple values),</span>
<span class="cm"> * without the additional support for nested data structures.  Every key-value pair is</span>
<span class="cm"> * encoded by encodeURIComponent.&lt;/p&gt;</span>
<span class="cm"> * &lt;p&gt;This module provides a minimalistic way for io to handle  single-level objects</span>
<span class="cm"> * as transaction data.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @module querystring</span>
<span class="cm"> * @submodule querystring-stringify-simple</span>
<span class="cm"> * @for QueryString</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">QueryString</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;QueryString&quot;</span><span class="p">),</span>
    <span class="nx">EUC</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;Converts a simple object to a Query String representation.&lt;/p&gt;</span>
<span class="cm"> * &lt;p&gt;Nested objects, Arrays, and so on, are not supported.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @method stringify</span>
<span class="cm"> * @for QueryString</span>
<span class="cm"> * @public</span>
<span class="cm"> * @submodule querystring-stringify-simple</span>
<span class="cm"> * @param obj {Object} A single-level object to convert to a querystring.</span>
<span class="cm"> * @param cfg {Object} (optional) Configuration object.  In the simple</span>
<span class="cm"> *                                module, only the arrayKey setting is</span>
<span class="cm"> *                                supported.  When set to true, the key of an</span>
<span class="cm"> *                                array will have the &#39;[]&#39; notation appended</span>
<span class="cm"> *                                to the key;.</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">QueryString</span><span class="p">.</span><span class="nx">stringify</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">qs</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="c1">// Default behavior is false; standard key notation.</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="nx">c</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">arrayKey</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">key</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">qs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">EUC</span><span class="p">(</span><span class="nx">s</span> <span class="o">?</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;[]&#39;</span> <span class="o">:</span> <span class="nx">key</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">EUC</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">i</span><span class="p">]));</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">qs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">EUC</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">EUC</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;json-parse&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;The JSON module adds support for serializing JavaScript objects into</span>
<span class="cm"> * JSON strings and parsing JavaScript objects from strings in JSON format.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;The JSON namespace is added to your YUI instance including static methods</span>
<span class="cm"> * Y.JSON.parse(..) and Y.JSON.stringify(..).&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;The functionality and method signatures follow the ECMAScript 5</span>
<span class="cm"> * specification.  In browsers with native JSON support, the native</span>
<span class="cm"> * implementation is used.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;The &lt;code&gt;json&lt;/code&gt; module is a rollup of &lt;code&gt;json-parse&lt;/code&gt; and</span>
<span class="cm"> * &lt;code&gt;json-stringify&lt;/code&gt;.&lt;/p&gt;</span>
<span class="cm"> * </span>
<span class="cm"> * &lt;p&gt;As their names suggest, &lt;code&gt;json-parse&lt;/code&gt; adds support for parsing</span>
<span class="cm"> * JSON data (Y.JSON.parse) and &lt;code&gt;json-stringify&lt;/code&gt; for serializing</span>
<span class="cm"> * JavaScript data into JSON strings (Y.JSON.stringify).  You may choose to</span>
<span class="cm"> * include either of the submodules individually if you don&#39;t need the</span>
<span class="cm"> * complementary functionality, or include the rollup for both.&lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @module json</span>
<span class="cm"> * @class JSON</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * Provides Y.JSON.parse method to accept JSON strings and return native</span>
<span class="cm"> * JavaScript objects.</span>
<span class="cm"> *</span>
<span class="cm"> * @module json</span>
<span class="cm"> * @submodule json-parse</span>
<span class="cm"> * @for JSON</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>


<span class="c1">// All internals kept private for security reasons</span>
<span class="kd">function</span> <span class="nx">fromGlobal</span><span class="p">(</span><span class="nx">ref</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span> <span class="o">||</span> <span class="k">this</span> <span class="o">||</span> <span class="p">{})[</span><span class="nx">ref</span><span class="p">];</span>
<span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">     * Alias to native browser implementation of the JSON object if available.</span>
<span class="cm">     *</span>
<span class="cm">     * @property Native</span>
<span class="cm">     * @type {Object}</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
<span class="kd">var</span> <span class="nx">_JSON</span>  <span class="o">=</span> <span class="nx">fromGlobal</span><span class="p">(</span><span class="s1">&#39;JSON&#39;</span><span class="p">),</span>
    <span class="c1">// Create an indirect reference to eval to allow for minification</span>
    <span class="nx">_eval</span>  <span class="o">=</span> <span class="nx">fromGlobal</span><span class="p">(</span><span class="s1">&#39;eval&#39;</span><span class="p">),</span>
    <span class="nx">Native</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_JSON</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;[object JSON]&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">_JSON</span><span class="p">),</span>
    <span class="nx">useNative</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">Native</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Replace certain Unicode characters that JavaScript may handle incorrectly</span>
<span class="cm">     * during eval--either by deleting them or treating them as line</span>
<span class="cm">     * endings--with escape sequences.</span>
<span class="cm">     * IMPORTANT NOTE: This regex will be used to modify the input if a match is</span>
<span class="cm">     * found.</span>
<span class="cm">     *</span>
<span class="cm">     * @property _UNICODE_EXCEPTIONS</span>
<span class="cm">     * @type {RegExp}</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_UNICODE_EXCEPTIONS</span> <span class="o">=</span> <span class="sr">/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g</span><span class="p">,</span>


    <span class="cm">/**</span>
<span class="cm">     * First step in the safety evaluation.  Regex used to replace all escape</span>
<span class="cm">     * sequences (i.e. &quot;\\&quot;, etc) with &#39;@&#39; characters (a non-JSON character).</span>
<span class="cm">     *</span>
<span class="cm">     * @property _ESCAPES</span>
<span class="cm">     * @type {RegExp}</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_ESCAPES</span> <span class="o">=</span> <span class="sr">/\\(?:[&quot;\\\/bfnrt]|u[0-9a-fA-F]{4})/g</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Second step in the safety evaluation.  Regex used to replace all simple</span>
<span class="cm">     * values with &#39;]&#39; characters.</span>
<span class="cm">     *</span>
<span class="cm">     * @property _VALUES</span>
<span class="cm">     * @type {RegExp}</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_VALUES</span>  <span class="o">=</span> <span class="sr">/&quot;[^&quot;\\\n\r]*&quot;|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Third step in the safety evaluation.  Regex used to remove all open</span>
<span class="cm">     * square brackets following a colon, comma, or at the beginning of the</span>
<span class="cm">     * string.</span>
<span class="cm">     *</span>
<span class="cm">     * @property _BRACKETS</span>
<span class="cm">     * @type {RegExp}</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_BRACKETS</span> <span class="o">=</span> <span class="sr">/(?:^|:|,)(?:\s*\[)+/g</span><span class="p">,</span>

    <span class="cm">/**</span>
<span class="cm">     * Final step in the safety evaluation.  Regex used to test the string left</span>
<span class="cm">     * after all previous replacements for invalid characters.</span>
<span class="cm">     *</span>
<span class="cm">     * @property _UNSAFE</span>
<span class="cm">     * @type {RegExp}</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_UNSAFE</span> <span class="o">=</span> <span class="sr">/[^\],:{}\s]/</span><span class="p">,</span>
    
    <span class="cm">/**</span>
<span class="cm">     * Replaces specific unicode characters with their appropriate \unnnn</span>
<span class="cm">     * format. Some browsers ignore certain characters during eval.</span>
<span class="cm">     *</span>
<span class="cm">     * @method escapeException</span>
<span class="cm">     * @param c {String} Unicode character</span>
<span class="cm">     * @return {String} the \unnnn escapement of the character</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_escapeException</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;\\u&#39;</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;0000&#39;</span><span class="o">+</span><span class="p">(</span><span class="o">+</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">))).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Traverses nested objects, applying a reviver function to each (key,value)</span>
<span class="cm">     * from the scope if the key:value&#39;s containing object.  The value returned</span>
<span class="cm">     * from the function will replace the original value in the key:value pair.</span>
<span class="cm">     * If the value returned is undefined, the key will be omitted from the</span>
<span class="cm">     * returned object.</span>
<span class="cm">     *</span>
<span class="cm">     * @method _revive</span>
<span class="cm">     * @param data {MIXED} Any JavaScript data</span>
<span class="cm">     * @param reviver {Function} filter or mutation function</span>
<span class="cm">     * @return {MIXED} The results of the filtered data</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>
    <span class="nx">_revive</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">reviver</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">walk</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">,</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">v</span> <span class="o">=</span> <span class="nx">walk</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">k</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">delete</span> <span class="nx">value</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">value</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">reviver</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="k">typeof</span> <span class="nx">reviver</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">?</span> <span class="nx">walk</span><span class="p">({</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="nx">data</span><span class="p">},</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">data</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Parse a JSON string, returning the native JavaScript representation.</span>
<span class="cm">     *</span>
<span class="cm">     * @param s {string} JSON string data</span>
<span class="cm">     * @param reviver {function} (optional) function(k,v) passed each key value</span>
<span class="cm">     *          pair of object literals, allowing pruning or altering values</span>
<span class="cm">     * @return {MIXED} the native JavaScript representation of the JSON string</span>
<span class="cm">     * @throws SyntaxError</span>
<span class="cm">     * @method parse</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="c1">// JavaScript implementation in lieu of native browser support.  Based on</span>
    <span class="c1">// the json2.js library from http://json.org</span>
    <span class="nx">_parse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">reviver</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Replace certain Unicode characters that are otherwise handled</span>
        <span class="c1">// incorrectly by some browser implementations.</span>
        <span class="c1">// NOTE: This modifies the input if such characters are found!</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_UNICODE_EXCEPTIONS</span><span class="p">,</span> <span class="nx">_escapeException</span><span class="p">);</span>
        
        <span class="c1">// Test for any remaining invalid characters</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_UNSAFE</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">_ESCAPES</span><span class="p">,</span><span class="s1">&#39;@&#39;</span><span class="p">).</span>
                            <span class="nx">replace</span><span class="p">(</span><span class="nx">_VALUES</span><span class="p">,</span><span class="s1">&#39;]&#39;</span><span class="p">).</span>
                            <span class="nx">replace</span><span class="p">(</span><span class="nx">_BRACKETS</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)))</span> <span class="p">{</span>

            <span class="c1">// Eval the text into a JavaScript data structure, apply any</span>
            <span class="c1">// reviver function, and return</span>
            <span class="k">return</span> <span class="nx">_revive</span><span class="p">(</span> <span class="nx">_eval</span><span class="p">(</span><span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">),</span> <span class="nx">reviver</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nx">SyntaxError</span><span class="p">(</span><span class="s1">&#39;JSON.parse&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    
<span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;JSON&#39;</span><span class="p">).</span><span class="nx">parse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">reviver</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">s</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">s</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Native</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">useNativeParse</span> <span class="o">?</span>
            <span class="nx">Native</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">reviver</span><span class="p">)</span> <span class="o">:</span> <span class="nx">_parse</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">reviver</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">workingNative</span><span class="p">(</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">k</span> <span class="o">===</span> <span class="s2">&quot;ok&quot;</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">v</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Double check basic functionality.  This is mainly to catch early broken</span>
<span class="c1">// implementations of the JSON API in Firefox 3.1 beta1 and beta2</span>
<span class="k">if</span> <span class="p">(</span> <span class="nx">Native</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">useNative</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">Native</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span> <span class="s1">&#39;{&quot;ok&quot;:false}&#39;</span><span class="p">,</span> <span class="nx">workingNative</span> <span class="p">)</span> <span class="p">).</span><span class="nx">ok</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">useNative</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Leverage native JSON parse if the browser has a native implementation.</span>
<span class="cm"> * In general, this is a good idea.  See the Known Issues section in the</span>
<span class="cm"> * JSON user guide for caveats.  The default value is true for browsers with</span>
<span class="cm"> * native JSON support.</span>
<span class="cm"> *</span>
<span class="cm"> * @property useNativeParse</span>
<span class="cm"> * @type Boolean</span>
<span class="cm"> * @default true</span>
<span class="cm"> * @static</span>
<span class="cm"> */</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">useNativeParse</span> <span class="o">=</span> <span class="nx">useNative</span><span class="p">;</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">);</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;transition-native&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm">* Provides the transition method for Node.</span>
<span class="cm">* Transition has no API of its own, but adds the transition method to Node.</span>
<span class="cm">*</span>
<span class="cm">* @module transition</span>
<span class="cm">* @requires node-style</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">TRANSITION</span> <span class="o">=</span> <span class="s1">&#39;-webkit-transition&#39;</span><span class="p">,</span>
    <span class="nx">TRANSITION_CAMEL</span> <span class="o">=</span> <span class="s1">&#39;WebkitTransition&#39;</span><span class="p">,</span>
    <span class="nx">TRANSITION_PROPERTY_CAMEL</span> <span class="o">=</span> <span class="s1">&#39;WebkitTransitionProperty&#39;</span><span class="p">,</span>
    <span class="nx">TRANSITION_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;-webkit-transition-property&#39;</span><span class="p">,</span>
    <span class="nx">TRANSITION_DURATION</span> <span class="o">=</span> <span class="s1">&#39;-webkit-transition-duration&#39;</span><span class="p">,</span>
    <span class="nx">TRANSITION_TIMING_FUNCTION</span> <span class="o">=</span> <span class="s1">&#39;-webkit-transition-timing-function&#39;</span><span class="p">,</span>
    <span class="nx">TRANSITION_DELAY</span> <span class="o">=</span> <span class="s1">&#39;-webkit-transition-delay&#39;</span><span class="p">,</span>
    <span class="nx">TRANSITION_END</span> <span class="o">=</span> <span class="s1">&#39;webkitTransitionEnd&#39;</span><span class="p">,</span>
    <span class="nx">ON_TRANSITION_END</span> <span class="o">=</span> <span class="s1">&#39;onwebkittransitionend&#39;</span><span class="p">,</span>
    <span class="nx">TRANSFORM_CAMEL</span> <span class="o">=</span> <span class="s1">&#39;WebkitTransform&#39;</span><span class="p">,</span>

    <span class="nx">EMPTY_OBJ</span> <span class="o">=</span> <span class="p">{},</span>

<span class="cm">/**</span>
<span class="cm"> * A class for constructing transition instances.</span>
<span class="cm"> * Adds the &quot;transition&quot; method to Node.</span>
<span class="cm"> * @class Transition</span>
<span class="cm"> * @constructor</span>
<span class="cm"> */</span>

<span class="nx">Transition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">fx</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">Transition</span><span class="p">.</span><span class="nx">toggles</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">_hasEnd</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">_toCamel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">property</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-([a-z])/gi</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m0</span><span class="p">,</span> <span class="nx">m1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">property</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">_toHyphen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">property</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([A-Z]?)([a-z]+)([A-Z]?)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m0</span><span class="p">,</span> <span class="nx">m1</span><span class="p">,</span> <span class="nx">m2</span><span class="p">,</span> <span class="nx">m3</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">m1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">m2</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">m3</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">m3</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">});</span> 

    <span class="k">return</span> <span class="nx">property</span><span class="p">;</span>
<span class="p">};</span>


<span class="nx">Transition</span><span class="p">.</span><span class="nx">_reKeywords</span> <span class="o">=</span> <span class="sr">/^(?:node|duration|iterations|easing|delay|on|onstart|onend)$/i</span><span class="p">;</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">useNative</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">TRANSITION</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Transition</span><span class="p">.</span><span class="nx">useNative</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">Transition</span><span class="p">.</span><span class="nx">supported</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// TODO: remove</span>
<span class="p">}</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">DOM_EVENTS</span><span class="p">[</span><span class="nx">TRANSITION_END</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 

<span class="nx">Transition</span><span class="p">.</span><span class="nx">NAME</span> <span class="o">=</span> <span class="s1">&#39;transition&#39;</span><span class="p">;</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_EASING</span> <span class="o">=</span> <span class="s1">&#39;ease&#39;</span><span class="p">;</span>
<span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_DURATION</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_DELAY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="o">:</span> <span class="nx">Transition</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_running</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">_transition</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">;</span> <span class="c1">// cache for reuse</span>

            <span class="nx">anim</span><span class="p">.</span><span class="nx">_duration</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;duration&#39;</span> <span class="k">in</span> <span class="nx">config</span><span class="p">)</span> <span class="o">?</span>
                <span class="nx">config</span><span class="p">.</span><span class="nx">duration</span><span class="o">:</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">DEFAULT_DURATION</span><span class="p">;</span>

            <span class="nx">anim</span><span class="p">.</span><span class="nx">_delay</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;delay&#39;</span> <span class="k">in</span> <span class="nx">config</span><span class="p">)</span> <span class="o">?</span>
                <span class="nx">config</span><span class="p">.</span><span class="nx">delay</span><span class="o">:</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">DEFAULT_DELAY</span><span class="p">;</span>

            <span class="nx">anim</span><span class="p">.</span><span class="nx">_easing</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">easing</span> <span class="o">||</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">DEFAULT_EASING</span><span class="p">;</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// track number of animated properties</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">anim</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">addProperty</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">nodeInstance</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">uid</span><span class="p">],</span>
            <span class="nx">computed</span><span class="p">,</span>
            <span class="nx">compareVal</span><span class="p">,</span>
            <span class="nx">dur</span><span class="p">,</span>
            <span class="nx">attr</span><span class="p">,</span>
            <span class="nx">val</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>

        <span class="nx">attr</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>

        <span class="c1">// might just be a value</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">config</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span> 
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">EMPTY_OBJ</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">nodeInstance</span><span class="p">,</span> <span class="nx">nodeInstance</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">&amp;&amp;</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">transition</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// take control if another transition owns this property</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">transition</span> <span class="o">!==</span> <span class="nx">anim</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">attr</span><span class="p">.</span><span class="nx">transition</span><span class="p">.</span><span class="nx">_count</span><span class="o">--</span><span class="p">;</span> <span class="c1">// remapping attr to this transition</span>
            <span class="p">}</span>
        <span class="p">}</span> 

        <span class="nx">anim</span><span class="p">.</span><span class="nx">_count</span><span class="o">++</span><span class="p">;</span> <span class="c1">// properties per transition</span>

        <span class="c1">// make 0 async and fire events</span>
        <span class="nx">dur</span> <span class="o">=</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">duration</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">config</span><span class="p">.</span><span class="nx">duration</span> <span class="o">:</span>
                    <span class="nx">anim</span><span class="p">.</span><span class="nx">_duration</span><span class="p">)</span> <span class="o">||</span> <span class="mf">0.0001</span><span class="p">;</span>

        <span class="nx">attrs</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">value</span><span class="o">:</span> <span class="nx">val</span><span class="p">,</span>
            <span class="nx">duration</span><span class="o">:</span> <span class="nx">dur</span><span class="p">,</span>
            <span class="nx">delay</span><span class="o">:</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">delay</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">config</span><span class="p">.</span><span class="nx">delay</span> <span class="o">:</span>
                    <span class="nx">anim</span><span class="p">.</span><span class="nx">_delay</span><span class="p">,</span>

            <span class="nx">easing</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">easing</span> <span class="o">||</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_easing</span><span class="p">,</span>

            <span class="nx">transition</span><span class="o">:</span> <span class="nx">anim</span>
        <span class="p">};</span>

        <span class="c1">// native end event doesnt fire when setting to same value</span>
        <span class="c1">// supplementing with timer</span>
        <span class="c1">// val may be a string or number (height: 0, etc), but computedStyle is always string</span>
        <span class="nx">computed</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
        <span class="nx">compareVal</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">computed</span> <span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">computed</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">useNative</span> <span class="o">&amp;&amp;</span> <span class="nx">compareVal</span> <span class="o">===</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">anim</span><span class="p">.</span><span class="nx">_onNativeEnd</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">propertyName</span><span class="o">:</span> <span class="nx">prop</span><span class="p">,</span>
                    <span class="nx">elapsedTime</span><span class="o">:</span> <span class="nx">dur</span>
                <span class="p">});</span>
            <span class="p">},</span> <span class="nx">dur</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">removeProperty</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">)];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">attrs</span> <span class="o">&amp;&amp;</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_count</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">},</span>

    <span class="nx">initAttrs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attr</span><span class="p">,</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">transform</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">config</span><span class="p">[</span><span class="nx">TRANSFORM_CAMEL</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">config</span><span class="p">[</span><span class="nx">TRANSFORM_CAMEL</span><span class="p">]</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">transform</span><span class="p">;</span>
            <span class="k">delete</span> <span class="nx">config</span><span class="p">.</span><span class="nx">transform</span><span class="p">;</span> <span class="c1">// TODO: copy</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">attr</span> <span class="k">in</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">_reKeywords</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addProperty</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">config</span><span class="p">[</span><span class="nx">attr</span><span class="p">]);</span>

                <span class="c1">// when size is auto or % webkit starts from zero instead of computed </span>
                <span class="c1">// (https://bugs.webkit.org/show_bug.cgi?id=16020)</span>
                <span class="c1">// TODO: selective set</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * Starts or an animation.</span>
<span class="cm">     * @method run</span>
<span class="cm">     * @chainable</span>
<span class="cm">     * @private</span>
<span class="cm">     */</span>    
    <span class="nx">run</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_config</span><span class="p">,</span>
            <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;transition:start&#39;</span><span class="p">,</span>
                <span class="nx">config</span><span class="o">:</span> <span class="nx">config</span>
            <span class="p">};</span>


        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_running</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="c1">//anim._node.fire(&#39;transition:start&#39;, data);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">config</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">anim</span><span class="p">.</span><span class="nx">initAttrs</span><span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_config</span><span class="p">);</span>

            <span class="nx">anim</span><span class="p">.</span><span class="nx">_callback</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_start</span><span class="p">();</span>
        <span class="p">}</span>


        <span class="k">return</span> <span class="nx">anim</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_runNative</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">_prepDur</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dur</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dur</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">dur</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">dur</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_runNative</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">style</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span>
            <span class="nx">computed</span> <span class="o">=</span> <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">uid</span><span class="p">],</span>
            <span class="nx">cssText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">cssTransition</span> <span class="o">=</span> <span class="nx">computed</span><span class="p">[</span><span class="nx">TRANSITION_PROPERTY</span><span class="p">],</span>

            <span class="nx">transitionText</span> <span class="o">=</span> <span class="nx">TRANSITION_PROPERTY</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span>
            <span class="nx">duration</span> <span class="o">=</span> <span class="nx">TRANSITION_DURATION</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span>
            <span class="nx">easing</span> <span class="o">=</span> <span class="nx">TRANSITION_TIMING_FUNCTION</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span>
            <span class="nx">delay</span> <span class="o">=</span> <span class="nx">TRANSITION_DELAY</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span>
            <span class="nx">hyphy</span><span class="p">,</span>
            <span class="nx">attr</span><span class="p">,</span>
            <span class="nx">name</span><span class="p">;</span>

        <span class="c1">// preserve existing transitions</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cssTransition</span> <span class="o">!==</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">transitionText</span> <span class="o">+=</span> <span class="nx">cssTransition</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
            <span class="nx">duration</span> <span class="o">+=</span> <span class="nx">computed</span><span class="p">[</span><span class="nx">TRANSITION_DURATION</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
            <span class="nx">easing</span> <span class="o">+=</span> <span class="nx">computed</span><span class="p">[</span><span class="nx">TRANSITION_TIMING_FUNCTION</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
            <span class="nx">delay</span> <span class="o">+=</span> <span class="nx">computed</span><span class="p">[</span><span class="nx">TRANSITION_DELAY</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>

        <span class="p">}</span>

        <span class="c1">// run transitions mapped to this instance</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">hyphy</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_toHyphen</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">transition</span> <span class="o">===</span> <span class="nx">anim</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// only native styles allowed</span>
                    <span class="nx">duration</span> <span class="o">+=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_prepDur</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">duration</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
                    <span class="nx">delay</span> <span class="o">+=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_prepDur</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">delay</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
                    <span class="nx">easing</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">easing</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>

                    <span class="nx">transitionText</span> <span class="o">+=</span> <span class="nx">hyphy</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
                    <span class="nx">cssText</span> <span class="o">+=</span> <span class="nx">hyphy</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">transitionText</span> <span class="o">=</span> <span class="nx">transitionText</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,$/</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>
        <span class="nx">duration</span> <span class="o">=</span> <span class="nx">duration</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,$/</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>
        <span class="nx">easing</span> <span class="o">=</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,$/</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>
        <span class="nx">delay</span> <span class="o">=</span> <span class="nx">delay</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,$/</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>

        <span class="c1">// only one native end event per node</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">_hasEnd</span><span class="p">[</span><span class="nx">uid</span><span class="p">])</span> <span class="p">{</span>
            <span class="c1">//anim._detach = Y.on(TRANSITION_END, anim._onNativeEnd, node);</span>
            <span class="c1">//node[ON_TRANSITION_END] = anim._onNativeEnd;</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">TRANSITION_END</span><span class="p">,</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_onNativeEnd</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="nx">Transition</span><span class="p">.</span><span class="nx">_hasEnd</span><span class="p">[</span><span class="nx">uid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="p">}</span>
        
        <span class="c1">//setTimeout(function() { // allow updates to apply (size fix, onstart, etc)</span>
            <span class="nx">style</span><span class="p">.</span><span class="nx">cssText</span> <span class="o">+=</span> <span class="nx">transitionText</span> <span class="o">+</span> <span class="nx">duration</span> <span class="o">+</span> <span class="nx">easing</span> <span class="o">+</span> <span class="nx">delay</span> <span class="o">+</span> <span class="nx">cssText</span><span class="p">;</span>
        <span class="c1">//}, 1);</span>

    <span class="p">},</span>

    <span class="nx">_end</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_callback</span><span class="p">,</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_config</span><span class="p">,</span>
            <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;transition:end&#39;</span><span class="p">,</span>
                <span class="nx">config</span><span class="o">:</span> <span class="nx">config</span><span class="p">,</span>
                <span class="nx">elapsedTime</span><span class="o">:</span> <span class="nx">elapsed</span> 
            <span class="p">},</span>

            <span class="nx">nodeInstance</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span> 

        <span class="nx">anim</span><span class="p">.</span><span class="nx">_running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">_callback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// IE: allow previous update to finish</span>
                    <span class="nx">config</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">nodeInstance</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

                    <span class="c1">// nested to ensure proper fire order</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">nodeInstance</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
                    <span class="p">}</span>

                <span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// IE: allow previous update to finish</span>
                    <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">nodeInstance</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
                <span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">//node.fire(&#39;transition:end&#39;, data);</span>
        <span class="p">}</span>

    <span class="p">},</span>

    <span class="nx">_endNative</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="nx">TRANSITION_PROPERTY</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;(?:^|,\\s)&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;,?&#39;</span><span class="p">),</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^,|,$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">TRANSITION_CAMEL</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_onNativeEnd</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">event</span> <span class="o">=</span> <span class="nx">e</span><span class="p">,</span><span class="c1">//e._event,</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_toCamel</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">propertyName</span><span class="p">),</span>
            <span class="nx">elapsed</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">elapsedTime</span><span class="p">,</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">uid</span><span class="p">],</span>
            <span class="nx">attr</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span>
            <span class="nx">anim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="o">?</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">transition</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">data</span><span class="p">,</span>
            <span class="nx">config</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">anim</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_endNative</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_config</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>

            <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;propertyEnd&#39;</span><span class="p">,</span>
                <span class="nx">propertyName</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
                <span class="nx">elapsedTime</span><span class="o">:</span> <span class="nx">elapsed</span><span class="p">,</span>
                <span class="nx">config</span><span class="o">:</span> <span class="nx">config</span>
            <span class="p">};</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">config</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">config</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">//node.fire(&#39;transition:propertyEnd&#39;, data);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>  <span class="p">{</span> <span class="c1">// after propertyEnd fires</span>
                <span class="nx">anim</span><span class="p">.</span><span class="nx">_end</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="cm">/*</span>
<span class="cm">        if (anim._detach) {</span>
<span class="cm">            anim._detach.detach();</span>
<span class="cm">        }</span>
<span class="cm">        */</span>
        <span class="c1">//anim._node[ON_TRANSITION_END] = null;</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">TRANSITION_END</span><span class="p">,</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_onNativeEnd</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">;</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">TransitionNative</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">;</span> <span class="c1">// TODO: remove</span>

<span class="cm">/** </span>
<span class="cm"> *   Animate one or more css properties to a given value. Requires the &quot;transition&quot; module.</span>
<span class="cm"> *   &lt;pre&gt;example usage:</span>
<span class="cm"> *       Y.one(&#39;#demo&#39;).transition({</span>
<span class="cm"> *           duration: 1, // in seconds, default is 0.5</span>
<span class="cm"> *           easing: &#39;ease-out&#39;, // default is &#39;ease&#39;</span>
<span class="cm"> *           delay: &#39;1&#39;, // delay start for 1 second, default is 0</span>
<span class="cm"> *</span>
<span class="cm"> *           height: &#39;10px&#39;,</span>
<span class="cm"> *           width: &#39;10px&#39;,</span>
<span class="cm"> *</span>
<span class="cm"> *           opacity: { // per property</span>
<span class="cm"> *               value: 0,</span>
<span class="cm"> *               duration: 2,</span>
<span class="cm"> *               delay: 2,</span>
<span class="cm"> *               easing: &#39;ease-in&#39;</span>
<span class="cm"> *           }</span>
<span class="cm"> *       });</span>
<span class="cm"> *   &lt;/pre&gt;</span>
<span class="cm"> *   @for Node</span>
<span class="cm"> *   @method transition</span>
<span class="cm"> *   @param {Object} config An object containing one or more style properties, a duration and an easing.</span>
<span class="cm"> *   @param {Function} callback A function to run after the transition has completed. </span>
<span class="cm"> *   @chainable</span>
<span class="cm">*/</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">transition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> 
        <span class="nx">transitionAttrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">)],</span>
        <span class="nx">anim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">transitionAttrs</span><span class="p">)</span> <span class="o">?</span> <span class="nx">transitionAttrs</span><span class="p">.</span><span class="nx">transition</span> <span class="o">||</span> <span class="kc">null</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">fxConfig</span><span class="p">,</span>
        <span class="nx">prop</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// named effect, pull config from registry</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">config</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">fxConfig</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">fx</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">config</span> <span class="o">!==</span> <span class="s1">&#39;boolean&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">fxConfig</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">fxConfig</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="nx">config</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">config</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fxConfig</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span> 
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">fxConfig</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// name is a config, config is a callback or undefined</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
        <span class="nx">config</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">anim</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_running</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">anim</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Transition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">anim</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_show</span><span class="p">();</span> <span class="c1">// show prior to transition</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">name</span><span class="p">.</span><span class="nx">push</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// named effect or array of effects supercedes default</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">config</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callback</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
                <span class="nx">config</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">SHOW_TRANSITION</span><span class="p">;</span> 
        <span class="p">}</span>    
        <span class="k">this</span><span class="p">.</span><span class="nx">transition</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">)</span> <span class="p">{</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unable to transition show; missing transition module&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">_wrapCallBack</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anim</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">anim</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">config</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">_wrapCallBack</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_hide</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span> <span class="c1">// wrap with existing callback</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">name</span><span class="p">.</span><span class="nx">push</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// named effect or array of effects supercedes default</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">config</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callback</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
                <span class="nx">config</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">HIDE_TRANSITION</span><span class="p">;</span> 
        <span class="p">}</span>    
        <span class="k">this</span><span class="p">.</span><span class="nx">transition</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">)</span> <span class="p">{</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unable to transition hide; missing transition module&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">);</span> <span class="c1">// end if on nex</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_hide</span><span class="p">();</span>
    <span class="p">}</span>    
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span> 

<span class="cm">/** </span>
<span class="cm"> *   Animate one or more css properties to a given value. Requires the &quot;transition&quot; module.</span>
<span class="cm"> *   &lt;pre&gt;example usage:</span>
<span class="cm"> *       Y.all(&#39;.demo&#39;).transition({</span>
<span class="cm"> *           duration: 1, // in seconds, default is 0.5</span>
<span class="cm"> *           easing: &#39;ease-out&#39;, // default is &#39;ease&#39;</span>
<span class="cm"> *           delay: &#39;1&#39;, // delay start for 1 second, default is 0</span>
<span class="cm"> *</span>
<span class="cm"> *           height: &#39;10px&#39;,</span>
<span class="cm"> *           width: &#39;10px&#39;,</span>
<span class="cm"> *</span>
<span class="cm"> *           opacity: { // per property</span>
<span class="cm"> *               value: 0,</span>
<span class="cm"> *               duration: 2,</span>
<span class="cm"> *               delay: 2,</span>
<span class="cm"> *               easing: &#39;ease-in&#39;</span>
<span class="cm"> *           }</span>
<span class="cm"> *       });</span>
<span class="cm"> *   &lt;/pre&gt;</span>
<span class="cm"> *   @for NodeList</span>
<span class="cm"> *   @method transition</span>
<span class="cm"> *   @param {Object} config An object containing one or more style properties, a duration and an easing.</span>
<span class="cm"> *   @param {Function} callback A function to run after the transition has completed. The callback fires</span>
<span class="cm"> *       once per item in the NodeList.</span>
<span class="cm"> *   @chainable</span>
<span class="cm">*/</span>
<span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">transition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">node</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">((</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">transition</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggleView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">on</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_toggles</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_toggles</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">callback</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;boolean&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// no transition, just toggle</span>
        <span class="nx">on</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">||</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_TOGGLE</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">on</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_toggles</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// reverse current toggle</span>
        <span class="nx">on</span> <span class="o">=</span> <span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">_toggles</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="nx">on</span> <span class="o">=</span> <span class="p">(</span><span class="nx">on</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">on</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_show</span><span class="p">();</span>
    <span class="p">}</span>  <span class="k">else</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">_wrapCallBack</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_hide</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_toggles</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">on</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transition</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">toggles</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">on</span><span class="p">],</span> <span class="nx">callback</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">NodeList</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggleView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">on</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_nodes</span><span class="p">,</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">node</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">((</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">toggleView</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">on</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">fx</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">fadeOut</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">duration</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="nx">easing</span><span class="o">:</span> <span class="s1">&#39;ease-out&#39;</span>
    <span class="p">},</span>

    <span class="nx">fadeIn</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">duration</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="nx">easing</span><span class="o">:</span> <span class="s1">&#39;ease-in&#39;</span>
    <span class="p">},</span>

    <span class="nx">sizeOut</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">height</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">duration</span><span class="o">:</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="nx">easing</span><span class="o">:</span> <span class="s1">&#39;ease-out&#39;</span>
    <span class="p">},</span>

    <span class="nx">sizeIn</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">height</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;scrollHeight&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">width</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;scrollWidth&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">duration</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="nx">easing</span><span class="o">:</span> <span class="s1">&#39;ease-in&#39;</span><span class="p">,</span>
        
        <span class="nx">on</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">overflow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="s1">&#39;overflow&#39;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">overflow</span> <span class="o">!==</span> <span class="s1">&#39;hidden&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// enable scrollHeight/Width</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;overflow&#39;</span><span class="p">,</span> <span class="s1">&#39;hidden&#39;</span><span class="p">);</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">_transitionOverflow</span> <span class="o">=</span> <span class="nx">overflow</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">},</span>

            <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_transitionOverflow</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// revert overridden value</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;overflow&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transitionOverflow</span><span class="p">);</span>
                    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transitionOverflow</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> 
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">toggles</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">size</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;sizeOut&#39;</span><span class="p">,</span> <span class="s1">&#39;sizeIn&#39;</span><span class="p">],</span>
    <span class="nx">fade</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;fadeOut&#39;</span><span class="p">,</span> <span class="s1">&#39;fadeIn&#39;</span><span class="p">]</span>
<span class="p">});</span>

<span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_TOGGLE</span> <span class="o">=</span> <span class="s1">&#39;fade&#39;</span><span class="p">;</span>



<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;node-base&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;transition-timer&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/*</span>
<span class="cm">* The Transition Utility provides an API for creating advanced transitions.</span>
<span class="cm">* @module transition</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm">* Provides the base Transition class, for animating numeric properties.</span>
<span class="cm">*</span>
<span class="cm">* @module transition</span>
<span class="cm">* @submodule transition-timer</span>
<span class="cm">*/</span>


<span class="kd">var</span> <span class="nx">Transition</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">_start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">useNative</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_runNative</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_runTimer</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_runTimer</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">_initAttrs</span><span class="p">();</span>

        <span class="nx">Transition</span><span class="p">.</span><span class="nx">_running</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">anim</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">;</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">_startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
        <span class="nx">Transition</span><span class="p">.</span><span class="nx">_startTimer</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">_endTimer</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_running</span><span class="p">[</span><span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">anim</span><span class="p">)];</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">_startTime</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_runFrame</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_runAttrs</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_runAttrs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">node</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_config</span><span class="p">,</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">uid</span><span class="p">],</span>
            <span class="nx">customAttr</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">,</span>
            <span class="nx">done</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">allDone</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">data</span><span class="p">,</span>
            <span class="nx">name</span><span class="p">,</span>
            <span class="nx">attribute</span><span class="p">,</span>
            <span class="nx">setter</span><span class="p">,</span>
            <span class="nx">elapsed</span><span class="p">,</span>
            <span class="nx">delay</span><span class="p">,</span>
            <span class="nx">d</span><span class="p">,</span>
            <span class="nx">t</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attribute</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">attribute</span> <span class="o">&amp;&amp;</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">transition</span> <span class="o">===</span> <span class="nx">anim</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">d</span> <span class="o">=</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
                <span class="nx">delay</span> <span class="o">=</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">delay</span><span class="p">;</span>
                <span class="nx">elapsed</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span> <span class="o">-</span> <span class="nx">delay</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
                <span class="nx">t</span> <span class="o">=</span> <span class="nx">time</span><span class="p">;</span>
                <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;propertyEnd&#39;</span><span class="p">,</span>
                    <span class="nx">propertyName</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
                    <span class="nx">config</span><span class="o">:</span> <span class="nx">config</span><span class="p">,</span>
                    <span class="nx">elapsedTime</span><span class="o">:</span> <span class="nx">elapsed</span>
                <span class="p">};</span>

                <span class="nx">setter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">customAttr</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;set&#39;</span> <span class="k">in</span> <span class="nx">customAttr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">?</span>
                        <span class="nx">customAttr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">set</span> <span class="o">:</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_SETTER</span><span class="p">;</span>

                <span class="nx">done</span> <span class="o">=</span> <span class="p">(</span><span class="nx">t</span> <span class="o">&gt;=</span> <span class="nx">d</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">t</span> <span class="o">&gt;</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">t</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">delay</span> <span class="o">||</span> <span class="nx">time</span> <span class="o">&gt;=</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">setter</span><span class="p">(</span><span class="nx">anim</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">from</span><span class="p">,</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">to</span><span class="p">,</span> <span class="nx">t</span> <span class="o">-</span> <span class="nx">delay</span><span class="p">,</span> <span class="nx">d</span> <span class="o">-</span> <span class="nx">delay</span><span class="p">,</span>
                        <span class="nx">attribute</span><span class="p">.</span><span class="nx">easing</span><span class="p">,</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">unit</span><span class="p">);</span> 

                    <span class="k">if</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">delete</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                        <span class="nx">anim</span><span class="p">.</span><span class="nx">_count</span><span class="o">--</span><span class="p">;</span>

                        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">on</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">on</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">config</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">on</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="nx">data</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="c1">//node.fire(&#39;transition:propertyEnd&#39;, data);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">allDone</span> <span class="o">&amp;&amp;</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">allDone</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                            <span class="nx">anim</span><span class="p">.</span><span class="nx">_end</span><span class="p">(</span><span class="nx">elapsed</span><span class="p">);</span>
                            <span class="nx">anim</span><span class="p">.</span><span class="nx">_endTimer</span><span class="p">();</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_initAttrs</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anim</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">customAttr</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">,</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">stamp</span><span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">),</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_nodeAttrs</span><span class="p">[</span><span class="nx">uid</span><span class="p">],</span>
            <span class="nx">attribute</span><span class="p">,</span>
            <span class="nx">duration</span><span class="p">,</span>
            <span class="nx">delay</span><span class="p">,</span>
            <span class="nx">easing</span><span class="p">,</span>
            <span class="nx">val</span><span class="p">,</span>
            <span class="nx">name</span><span class="p">,</span>
            <span class="nx">mTo</span><span class="p">,</span>
            <span class="nx">mFrom</span><span class="p">,</span>
            <span class="nx">unit</span><span class="p">,</span> <span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">attribute</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">attribute</span> <span class="o">&amp;&amp;</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">transition</span> <span class="o">===</span> <span class="nx">anim</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">duration</span> <span class="o">=</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">duration</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
                <span class="nx">delay</span> <span class="o">=</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">delay</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
                <span class="nx">easing</span> <span class="o">=</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">easing</span><span class="p">;</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

                <span class="c1">// only allow supported properties</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">.</span><span class="nx">style</span> <span class="o">||</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">begin</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">customAttr</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;get&#39;</span> <span class="k">in</span> <span class="nx">customAttr</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span>  <span class="o">?</span>
                            <span class="nx">customAttr</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">anim</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_GETTER</span><span class="p">(</span><span class="nx">anim</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>

                    <span class="nx">mFrom</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">RE_UNITS</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">begin</span><span class="p">);</span>
                    <span class="nx">mTo</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">RE_UNITS</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>

                    <span class="nx">begin</span> <span class="o">=</span> <span class="nx">mFrom</span> <span class="o">?</span> <span class="nx">mFrom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="nx">begin</span><span class="p">;</span>
                    <span class="nx">end</span> <span class="o">=</span> <span class="nx">mTo</span> <span class="o">?</span> <span class="nx">mTo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="nx">val</span><span class="p">;</span>
                    <span class="nx">unit</span> <span class="o">=</span> <span class="nx">mTo</span> <span class="o">?</span> <span class="nx">mTo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:</span> <span class="nx">mFrom</span> <span class="o">?</span>  <span class="nx">mFrom</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">// one might be zero TODO: mixed units</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">unit</span> <span class="o">&amp;&amp;</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">RE_DEFAULT_UNIT</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">unit</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">DEFAULT_UNIT</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">easing</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">easing</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;cubic-bezier&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">easing</span> <span class="o">=</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">easings</span><span class="p">[</span><span class="nx">easing</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nx">easing</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">easings</span><span class="p">[</span><span class="nx">easing</span><span class="p">];</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="nx">attribute</span><span class="p">.</span><span class="nx">from</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">begin</span><span class="p">);</span>
                    <span class="nx">attribute</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">end</span><span class="p">);</span>
                    <span class="nx">attribute</span><span class="p">.</span><span class="nx">unit</span> <span class="o">=</span> <span class="nx">unit</span><span class="p">;</span>
                    <span class="nx">attribute</span><span class="p">.</span><span class="nx">easing</span> <span class="o">=</span> <span class="nx">easing</span><span class="p">;</span>
                    <span class="nx">attribute</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">duration</span> <span class="o">+</span> <span class="nx">delay</span><span class="p">;</span>
                    <span class="nx">attribute</span><span class="p">.</span><span class="nx">delay</span> <span class="o">=</span> <span class="nx">delay</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                    <span class="nx">anim</span><span class="p">.</span><span class="nx">_count</span><span class="o">--</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">detachAll</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_node</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">_runtimeAttrs</span><span class="o">:</span> <span class="p">{},</span>
    <span class="cm">/*</span>
<span class="cm">     * Regex of properties that should use the default unit.</span>
<span class="cm">     *</span>
<span class="cm">     * @property RE_DEFAULT_UNIT</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">RE_DEFAULT_UNIT</span><span class="o">:</span> <span class="sr">/^width|height|top|right|bottom|left|margin.*|padding.*|border.*$/i</span><span class="p">,</span>

    <span class="cm">/*</span>
<span class="cm">     * The default unit to use with properties that pass the RE_DEFAULT_UNIT test.</span>
<span class="cm">     *</span>
<span class="cm">     * @property DEFAULT_UNIT</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">DEFAULT_UNIT</span><span class="o">:</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>

    <span class="cm">/*</span>
<span class="cm">     * Time in milliseconds passed to setInterval for frame processing </span>
<span class="cm">     *</span>
<span class="cm">     * @property intervalTime</span>
<span class="cm">     * @default 20</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">intervalTime</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>

    <span class="cm">/*</span>
<span class="cm">     * Bucket for custom getters and setters</span>
<span class="cm">     *</span>
<span class="cm">     * @property behaviors</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">behaviors</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">left</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anim</span><span class="p">,</span> <span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">_getAttrOffset</span><span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span> <span class="nx">attr</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/*</span>
<span class="cm">     * The default setter to use when setting object properties.</span>
<span class="cm">     *</span>
<span class="cm">     * @property DEFAULT_SETTER</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">DEFAULT_SETTER</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anim</span><span class="p">,</span> <span class="nx">att</span><span class="p">,</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">elapsed</span><span class="p">,</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">unit</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">from</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">from</span><span class="p">);</span>
        <span class="nx">to</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">to</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">cubicBezier</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">elapsed</span> <span class="o">/</span> <span class="nx">duration</span><span class="p">);</span>

        <span class="nx">val</span> <span class="o">=</span> <span class="nx">from</span> <span class="o">+</span> <span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nx">to</span> <span class="o">-</span> <span class="nx">from</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">att</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span> <span class="o">||</span> <span class="nx">att</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">unit</span> <span class="o">=</span> <span class="nx">unit</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">,</span> <span class="nx">val</span> <span class="o">+</span> <span class="nx">unit</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">anim</span><span class="p">.</span><span class="nx">_end</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/*</span>
<span class="cm">     * The default getter to use when getting object properties.</span>
<span class="cm">     *</span>
<span class="cm">     * @property DEFAULT_GETTER</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>
    <span class="nx">DEFAULT_GETTER</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anim</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">anim</span><span class="p">.</span><span class="nx">_node</span><span class="p">,</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">att</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span> <span class="o">||</span> <span class="nx">att</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_startTimer</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">_timer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Transition</span><span class="p">.</span><span class="nx">_timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">_runFrame</span><span class="p">,</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">intervalTime</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_stopTimer</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">_timer</span><span class="p">);</span>
        <span class="nx">Transition</span><span class="p">.</span><span class="nx">_timer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/*</span>
<span class="cm">     * Called per Interval to handle each animation frame.</span>
<span class="cm">     * @method _runFrame</span>
<span class="cm">     * @private</span>
<span class="cm">     * @static</span>
<span class="cm">     */</span>    
    <span class="nx">_runFrame</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">anim</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">anim</span> <span class="k">in</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">_running</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">Transition</span><span class="p">.</span><span class="nx">_running</span><span class="p">[</span><span class="nx">anim</span><span class="p">].</span><span class="nx">_runFrame</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">done</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="nx">Transition</span><span class="p">.</span><span class="nx">_running</span><span class="p">[</span><span class="nx">anim</span><span class="p">].</span><span class="nx">_runFrame</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Transition</span><span class="p">.</span><span class="nx">_stopTimer</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">cubicBezier</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">x0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">y0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">x1</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">y1</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="nx">x2</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="nx">y2</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="nx">x3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">y3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

            <span class="nx">A</span> <span class="o">=</span> <span class="nx">x3</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">x2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">x1</span> <span class="o">-</span> <span class="nx">x0</span><span class="p">,</span>
            <span class="nx">B</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">x2</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="nx">x1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">x0</span><span class="p">,</span>
            <span class="nx">C</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">x1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">x0</span><span class="p">,</span>
            <span class="nx">D</span> <span class="o">=</span> <span class="nx">x0</span><span class="p">,</span>
            <span class="nx">E</span> <span class="o">=</span> <span class="nx">y3</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">y2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">y1</span> <span class="o">-</span> <span class="nx">y0</span><span class="p">,</span>
            <span class="nx">F</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">y2</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="nx">y1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">y0</span><span class="p">,</span>
            <span class="nx">G</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">y1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">y0</span><span class="p">,</span>
            <span class="nx">H</span> <span class="o">=</span> <span class="nx">y0</span><span class="p">,</span>

            <span class="nx">x</span> <span class="o">=</span> <span class="p">(((</span><span class="nx">A</span><span class="o">*</span><span class="nx">t</span><span class="p">)</span> <span class="o">+</span> <span class="nx">B</span><span class="p">)</span><span class="o">*</span><span class="nx">t</span> <span class="o">+</span> <span class="nx">C</span><span class="p">)</span><span class="o">*</span><span class="nx">t</span> <span class="o">+</span> <span class="nx">D</span><span class="p">,</span>
            <span class="nx">y</span> <span class="o">=</span> <span class="p">(((</span><span class="nx">E</span><span class="o">*</span><span class="nx">t</span><span class="p">)</span> <span class="o">+</span> <span class="nx">F</span><span class="p">)</span><span class="o">*</span><span class="nx">t</span> <span class="o">+</span> <span class="nx">G</span><span class="p">)</span><span class="o">*</span><span class="nx">t</span> <span class="o">+</span> <span class="nx">H</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="nx">easings</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">ease</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
        <span class="nx">linear</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;ease-in&#39;</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.42</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;ease-out&#39;</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;ease-in-out&#39;</span><span class="o">:</span> <span class="p">[</span><span class="mf">0.42</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">},</span>

    <span class="nx">_running</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">_timer</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

    <span class="nx">RE_UNITS</span><span class="o">:</span> <span class="sr">/^(-?\d*\.?\d*){1}(em|ex|px|in|cm|mm|pt|pc|%)*$/</span>
<span class="p">},</span> <span class="kc">true</span><span class="p">);</span> 

<span class="nx">Transition</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Transition</span> <span class="o">=</span> <span class="nx">Transition</span><span class="p">;</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;transition-native&#39;</span><span class="p">,</span> <span class="s1">&#39;node-style&#39;</span><span class="p">]});</span>


<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;transition&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">){},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">use</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;transition-native&#39;</span><span class="p">,</span> <span class="s1">&#39;transition-timer&#39;</span><span class="p">]});</span>

<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;selector-css3&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * The selector css3 module provides support for css3 selectors.</span>
<span class="cm"> * @module dom</span>
<span class="cm"> * @submodule selector-css3</span>
<span class="cm"> * @for Selector</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm">    an+b = get every _a_th node starting at the _b_th</span>
<span class="cm">    0n+b = no repeat (&quot;0&quot; and &quot;n&quot; may both be omitted (together) , e.g. &quot;0n+1&quot; or &quot;1&quot;, not &quot;0+1&quot;), return only the _b_th element</span>
<span class="cm">    1n+b =  get every element starting from b (&quot;1&quot; may may be omitted, e.g. &quot;1n+0&quot; or &quot;n+0&quot; or &quot;n&quot;)</span>
<span class="cm">    an+0 = get every _a_th element, &quot;0&quot; may be omitted </span>
<span class="cm">*/</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_reNth</span> <span class="o">=</span> <span class="sr">/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/</span><span class="p">;</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_getNth</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">,</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">reverse</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_reNth</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">expr</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">.</span><span class="nx">$1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="c1">// include every _a_ elements (zero means no repeat, just first _a_)</span>
        <span class="nx">n</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">$2</span><span class="p">,</span> <span class="c1">// &quot;n&quot;</span>
        <span class="nx">oddeven</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">$3</span><span class="p">,</span> <span class="c1">// &quot;odd&quot; or &quot;even&quot;</span>
        <span class="nx">b</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">.</span><span class="nx">$4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">// start scan from element _b_</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">siblings</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_children</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">tag</span><span class="p">),</span>
        <span class="nx">op</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">oddeven</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// always every other</span>
        <span class="nx">op</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">;</span>
        <span class="nx">n</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span><span class="p">;</span>
        <span class="nx">b</span> <span class="o">=</span> <span class="p">(</span><span class="nx">oddeven</span> <span class="o">===</span> <span class="s1">&#39;odd&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// start from the first or no repeat</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// just the first</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">reverse</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> 
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">siblings</span><span class="p">[</span><span class="nx">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">reverse</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">reverse</span><span class="p">;</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">reverse</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">siblings</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">-=</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="o">&amp;&amp;</span> <span class="nx">siblings</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">pseudos</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;root&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span> <span class="o">===</span> <span class="nx">node</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="s1">&#39;nth-child&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_getNth</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="s1">&#39;nth-last-child&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_getNth</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="s1">&#39;nth-of-type&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_getNth</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">);</span>
    <span class="p">},</span>
     
    <span class="s1">&#39;nth-last-of-type&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_getNth</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>
     
    <span class="s1">&#39;last-child&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_children</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">children</span><span class="p">[</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="s1">&#39;first-of-type&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_children</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">},</span>
     
    <span class="s1">&#39;last-of-type&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_children</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">children</span><span class="p">[</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">},</span>
     
    <span class="s1">&#39;only-child&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_children</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="s1">&#39;only-of-type&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">_children</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="s1">&#39;empty&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="s1">&#39;not&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="s1">&#39;contains&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">expr</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">text</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="s1">&#39;checked&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">checked</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">selected</span> <span class="o">===</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">enabled</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">disabled</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">disabled</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">disabled</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">operators</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;^=&#39;</span><span class="o">:</span> <span class="s1">&#39;^{val}&#39;</span><span class="p">,</span> <span class="c1">// Match starts with value</span>
    <span class="s1">&#39;$=&#39;</span><span class="o">:</span> <span class="s1">&#39;{val}$&#39;</span><span class="p">,</span> <span class="c1">// Match ends with value</span>
    <span class="s1">&#39;*=&#39;</span><span class="o">:</span> <span class="s1">&#39;{val}&#39;</span> <span class="c1">// Match contains value as substring </span>
<span class="p">});</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">Selector</span><span class="p">.</span><span class="nx">combinators</span><span class="p">[</span><span class="s1">&#39;~&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">axis</span><span class="o">:</span> <span class="s1">&#39;previousSibling&#39;</span>
<span class="p">};</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;selector-native&#39;</span><span class="p">,</span> <span class="s1">&#39;selector-css2&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;dom-style-ie&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">var</span> <span class="nx">HAS_LAYOUT</span> <span class="o">=</span> <span class="s1">&#39;hasLayout&#39;</span><span class="p">,</span>
    <span class="nx">PX</span> <span class="o">=</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
    <span class="nx">FILTER</span> <span class="o">=</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span>
    <span class="nx">FILTERS</span> <span class="o">=</span> <span class="s1">&#39;filters&#39;</span><span class="p">,</span>
    <span class="nx">OPACITY</span> <span class="o">=</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span>
    <span class="nx">AUTO</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>

    <span class="nx">BORDER_WIDTH</span> <span class="o">=</span> <span class="s1">&#39;borderWidth&#39;</span><span class="p">,</span>
    <span class="nx">BORDER_TOP_WIDTH</span> <span class="o">=</span> <span class="s1">&#39;borderTopWidth&#39;</span><span class="p">,</span>
    <span class="nx">BORDER_RIGHT_WIDTH</span> <span class="o">=</span> <span class="s1">&#39;borderRightWidth&#39;</span><span class="p">,</span>
    <span class="nx">BORDER_BOTTOM_WIDTH</span> <span class="o">=</span> <span class="s1">&#39;borderBottomWidth&#39;</span><span class="p">,</span>
    <span class="nx">BORDER_LEFT_WIDTH</span> <span class="o">=</span> <span class="s1">&#39;borderLeftWidth&#39;</span><span class="p">,</span>
    <span class="nx">WIDTH</span> <span class="o">=</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span>
    <span class="nx">HEIGHT</span> <span class="o">=</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span>
    <span class="nx">TRANSPARENT</span> <span class="o">=</span> <span class="s1">&#39;transparent&#39;</span><span class="p">,</span>
    <span class="nx">VISIBLE</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span><span class="p">,</span>
    <span class="nx">GET_COMPUTED_STYLE</span> <span class="o">=</span> <span class="s1">&#39;getComputedStyle&#39;</span><span class="p">,</span>
    <span class="nx">UNDEFINED</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">documentElement</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>

    <span class="nx">testFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span>
    <span class="nx">addFeature</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Features</span><span class="p">.</span><span class="nx">add</span><span class="p">,</span>

    <span class="c1">// TODO: unit-less lineHeight (e.g. 1.22)</span>
    <span class="nx">re_unit</span> <span class="o">=</span> <span class="sr">/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz|%){1}?/i</span><span class="p">,</span>

    <span class="nx">isIE8</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">),</span>

    <span class="nx">_getStyleObj</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">currentStyle</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">ComputedStyle</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">CUSTOM_STYLES</span><span class="o">:</span> <span class="p">{},</span>

        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="nx">current</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">current</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">el</span><span class="p">)[</span><span class="nx">property</span><span class="p">];</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">property</span> <span class="o">===</span> <span class="nx">OPACITY</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">OPACITY</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">OPACITY</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>        
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">current</span> <span class="o">||</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">&amp;&amp;</span> <span class="nx">current</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">PX</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// no need to convert</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">IE</span><span class="p">.</span><span class="nx">COMPUTED</span><span class="p">[</span><span class="nx">property</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// use compute function</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">IE</span><span class="p">.</span><span class="nx">COMPUTED</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">el</span><span class="p">,</span> <span class="nx">property</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">re_unit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">current</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// convert to pixel</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getPixel</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">+</span> <span class="nx">PX</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">sizeOffsets</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">width</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;Right&#39;</span><span class="p">],</span>
            <span class="nx">height</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom&#39;</span><span class="p">],</span>
            <span class="nx">top</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Top&#39;</span><span class="p">],</span>
            <span class="nx">bottom</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Bottom&#39;</span><span class="p">]</span>
        <span class="p">},</span>

        <span class="nx">getOffset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">el</span><span class="p">)[</span><span class="nx">prop</span><span class="p">],</span>                     <span class="c1">// value of &quot;width&quot;, &quot;top&quot;, etc.</span>
                <span class="nx">capped</span> <span class="o">=</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="c1">// &quot;Width&quot;, &quot;Top&quot;, etc.</span>
                <span class="nx">offset</span> <span class="o">=</span> <span class="s1">&#39;offset&#39;</span> <span class="o">+</span> <span class="nx">capped</span><span class="p">,</span>                             <span class="c1">// &quot;offsetWidth&quot;, &quot;offsetTop&quot;, etc.</span>
                <span class="nx">pixel</span> <span class="o">=</span> <span class="s1">&#39;pixel&#39;</span> <span class="o">+</span> <span class="nx">capped</span><span class="p">,</span>                               <span class="c1">// &quot;pixelWidth&quot;, &quot;pixelTop&quot;, etc.</span>
                <span class="nx">sizeOffsets</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">sizeOffsets</span><span class="p">[</span><span class="nx">prop</span><span class="p">],</span> 
                <span class="nx">mode</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">.</span><span class="nx">compatMode</span><span class="p">,</span>
                <span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

            <span class="c1">// IE pixelWidth incorrect for percent</span>
            <span class="c1">// manually compute by subtracting padding and border from offset size</span>
            <span class="c1">// NOTE: clientWidth/Height (size minus border) is 0 when current === AUTO so offsetHeight is used</span>
            <span class="c1">// reverting to auto from auto causes position stacking issues (old impl)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">current</span> <span class="o">===</span> <span class="nx">AUTO</span> <span class="o">||</span> <span class="nx">current</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">value</span> <span class="o">=</span> <span class="nx">el</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span> <span class="o">+</span> <span class="nx">capped</span><span class="p">];</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">!==</span> <span class="s1">&#39;BackCompat&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">sizeOffsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">value</span> <span class="o">-=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getPixel</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span> <span class="o">+</span> <span class="nx">sizeOffsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                        <span class="nx">value</span> <span class="o">-=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getBorderWidth</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="s1">&#39;border&#39;</span> <span class="o">+</span> <span class="nx">sizeOffsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Width&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">sizeOffsets</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                        <span class="nx">value</span> <span class="o">-=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getPixel</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span> <span class="o">+</span> <span class="nx">sizeOffsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                        <span class="nx">value</span> <span class="o">-=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getBorderWidth</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="s1">&#39;border&#39;</span> <span class="o">+</span> <span class="nx">sizeOffsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Width&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// use style.pixelWidth, etc. to convert to pixels</span>
                <span class="c1">// need to map style.width to currentStyle (no currentStyle.pixelWidth)</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">pixel</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">value</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">pixel</span><span class="p">];</span>
                
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">value</span> <span class="o">+</span> <span class="nx">PX</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">borderMap</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">thin</span><span class="o">:</span> <span class="p">(</span><span class="nx">isIE8</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;1px&#39;</span> <span class="o">:</span> <span class="s1">&#39;2px&#39;</span><span class="p">,</span>
            <span class="nx">medium</span><span class="o">:</span> <span class="p">(</span><span class="nx">isIE8</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;3px&#39;</span><span class="o">:</span> <span class="s1">&#39;4px&#39;</span><span class="p">,</span> 
            <span class="nx">thick</span><span class="o">:</span> <span class="p">(</span><span class="nx">isIE8</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;5px&#39;</span> <span class="o">:</span> <span class="s1">&#39;6px&#39;</span>
        <span class="p">},</span>

        <span class="nx">getBorderWidth</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">omitUnit</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">unit</span> <span class="o">=</span> <span class="nx">omitUnit</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">PX</span><span class="p">,</span>
                <span class="nx">current</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">PX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// look up keywords if a border exists</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">borderMap</span><span class="p">[</span><span class="nx">current</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
                        <span class="nx">el</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">.</span><span class="nx">borderStyle</span> <span class="o">!==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">current</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">borderMap</span><span class="p">[</span><span class="nx">current</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// otherwise no border (default is &quot;medium&quot;)</span>
                    <span class="nx">current</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">omitUnit</span><span class="p">)</span> <span class="o">?</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span> <span class="o">:</span> <span class="nx">current</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">getPixel</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// use pixelRight to convert to px</span>
            <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
                <span class="nx">style</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
                <span class="nx">styleRight</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span>
                <span class="nx">current</span> <span class="o">=</span> <span class="nx">style</span><span class="p">[</span><span class="nx">att</span><span class="p">];</span>

            <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">pixelRight</span><span class="p">;</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="nx">styleRight</span><span class="p">;</span> <span class="c1">// revert</span>

            <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">getMargin</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">val</span><span class="p">,</span>
                <span class="nx">style</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">style</span><span class="p">[</span><span class="nx">att</span><span class="p">]</span> <span class="o">==</span> <span class="nx">AUTO</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getPixel</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">val</span> <span class="o">+</span> <span class="nx">PX</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">getVisibility</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">current</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">current</span><span class="p">[</span><span class="nx">att</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inherit&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// NOTE: assignment in test</span>
                <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">current</span><span class="p">)</span> <span class="o">?</span> <span class="nx">current</span><span class="p">[</span><span class="nx">att</span><span class="p">]</span> <span class="o">:</span> <span class="nx">VISIBLE</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">getColor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">node</span><span class="p">)[</span><span class="nx">att</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">current</span> <span class="o">||</span> <span class="nx">current</span> <span class="o">===</span> <span class="nx">TRANSPARENT</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">elementByAxis</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;parentNode&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">current</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">parent</span><span class="p">)[</span><span class="nx">att</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">current</span> <span class="o">!==</span> <span class="nx">TRANSPARENT</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">node</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">toRGB</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">getBorderColor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">att</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">current</span><span class="p">[</span><span class="nx">att</span><span class="p">]</span> <span class="o">||</span> <span class="nx">current</span><span class="p">.</span><span class="nx">color</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">toRGB</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Color</span><span class="p">.</span><span class="nx">toHex</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="c1">//fontSize: getPixelFont,</span>
    <span class="nx">IEComputed</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;computedStyle&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;getComputedStyle&#39;</span> <span class="k">in</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">win</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;opacity&#39;</span> <span class="k">in</span> <span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">addFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;filters&#39;</span> <span class="k">in</span> <span class="nx">documentElement</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// use alpha filter for IE opacity</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">[</span><span class="nx">OPACITY</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
            <span class="k">try</span> <span class="p">{</span> <span class="c1">// will error if no DXImageTransform</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">FILTERS</span><span class="p">][</span><span class="s1">&#39;DXImageTransform.Microsoft.Alpha&#39;</span><span class="p">][</span><span class="nx">OPACITY</span><span class="p">];</span>

            <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span> <span class="c1">// make sure its in the document</span>
                    <span class="nx">val</span> <span class="o">=</span> <span class="nx">node</span><span class="p">[</span><span class="nx">FILTERS</span><span class="p">](</span><span class="s1">&#39;alpha&#39;</span><span class="p">)[</span><span class="nx">OPACITY</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;getStyle: IE opacity filter not found; returning 1&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-style&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">val</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">current</span><span class="p">,</span>
                <span class="nx">styleObj</span> <span class="o">=</span> <span class="nx">_getStyleObj</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span>
                <span class="nx">currentFilter</span> <span class="o">=</span> <span class="nx">styleObj</span><span class="p">[</span><span class="nx">FILTER</span><span class="p">];</span>

            <span class="nx">style</span> <span class="o">=</span> <span class="nx">style</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// normalize inline style behavior</span>
                <span class="nx">current</span> <span class="o">=</span> <span class="p">(</span><span class="nx">OPACITY</span> <span class="k">in</span> <span class="nx">styleObj</span><span class="p">)</span> <span class="o">?</span> <span class="nx">styleObj</span><span class="p">[</span><span class="nx">OPACITY</span><span class="p">]</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// revert to original opacity</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currentFilter</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// in case not appended</span>
                <span class="nx">style</span><span class="p">[</span><span class="nx">FILTER</span><span class="p">]</span> <span class="o">=</span> <span class="nx">currentFilter</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/alpha([^)]*\))/gi</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>
                        <span class="p">((</span><span class="nx">val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;alpha(&#39;</span> <span class="o">+</span> <span class="nx">OPACITY</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">val</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">style</span><span class="p">[</span><span class="nx">FILTER</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">style</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="nx">FILTER</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">styleObj</span><span class="p">[</span><span class="nx">HAS_LAYOUT</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">style</span><span class="p">.</span><span class="nx">zoom</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// needs layout </span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s1">&#39;-1px&#39;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IE throws error on invalid style set; trap common cases</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">floatVal</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">floatVal</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;auto&#39;</span> <span class="o">||</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;invalid style value for height: &#39;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-style&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">CUSTOM_STYLES</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">floatVal</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">floatVal</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;auto&#39;</span> <span class="o">||</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;invalid style value for width: &#39;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;dom-style&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">testFeature</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;computedStyle&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// TODO: top, right, bottom, left</span>
    <span class="nx">IEComputed</span><span class="p">[</span><span class="nx">WIDTH</span><span class="p">]</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">[</span><span class="nx">HEIGHT</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getOffset</span><span class="p">;</span>

    <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getColor</span><span class="p">;</span>

    <span class="nx">IEComputed</span><span class="p">[</span><span class="nx">BORDER_WIDTH</span><span class="p">]</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">[</span><span class="nx">BORDER_TOP_WIDTH</span><span class="p">]</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">[</span><span class="nx">BORDER_RIGHT_WIDTH</span><span class="p">]</span> <span class="o">=</span>
            <span class="nx">IEComputed</span><span class="p">[</span><span class="nx">BORDER_BOTTOM_WIDTH</span><span class="p">]</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">[</span><span class="nx">BORDER_LEFT_WIDTH</span><span class="p">]</span> <span class="o">=</span>
            <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getBorderWidth</span><span class="p">;</span>

    <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">marginTop</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">marginRight</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">marginBottom</span> <span class="o">=</span>
            <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">marginLeft</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getMargin</span><span class="p">;</span>

    <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getVisibility</span><span class="p">;</span>
    <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">borderTopColor</span> <span class="o">=</span>
            <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">borderRightColor</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">borderBottomColor</span> <span class="o">=</span>
            <span class="nx">IEComputed</span><span class="p">.</span><span class="nx">borderLeftColor</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">getBorderColor</span><span class="p">;</span>

    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">[</span><span class="nx">GET_COMPUTED_STYLE</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">.</span><span class="nx">get</span><span class="p">;</span> 

    <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;DOM.IE&#39;</span><span class="p">);</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">IE</span><span class="p">.</span><span class="nx">COMPUTED</span> <span class="o">=</span> <span class="nx">IEComputed</span><span class="p">;</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">IE</span><span class="p">.</span><span class="nx">ComputedStyle</span> <span class="o">=</span> <span class="nx">ComputedStyle</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">})(</span><span class="nx">Y</span><span class="p">);</span>


<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">requires</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;dom-style&#39;</span><span class="p">]});</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;simpleyui&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">)</span> <span class="p">{</span>

<span class="c1">// empty</span>



<span class="p">},</span> <span class="s1">&#39;3.4.0&#39;</span> <span class="p">,{</span><span class="nx">use</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;yui&#39;</span><span class="p">,</span><span class="s1">&#39;oop&#39;</span><span class="p">,</span><span class="s1">&#39;dom&#39;</span><span class="p">,</span><span class="s1">&#39;event-custom-base&#39;</span><span class="p">,</span><span class="s1">&#39;event-base&#39;</span><span class="p">,</span><span class="s1">&#39;pluginhost&#39;</span><span class="p">,</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="s1">&#39;event-delegate&#39;</span><span class="p">,</span><span class="s1">&#39;io-base&#39;</span><span class="p">,</span><span class="s1">&#39;json-parse&#39;</span><span class="p">,</span><span class="s1">&#39;transition&#39;</span><span class="p">,</span><span class="s1">&#39;selector-css3&#39;</span><span class="p">,</span><span class="s1">&#39;dom-style-ie&#39;</span><span class="p">,</span><span class="s1">&#39;querystring-stringify-simple&#39;</span><span class="p">]});</span>
<span class="kd">var</span> <span class="nx">Y</span> <span class="o">=</span> <span class="nx">YUI</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">);</span>
</pre></div>

							</div>
						<!-- /End/Start -->
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="aui-footer">
		Copyright &copy; 2011 Yahoo! Inc. All rights reserved.
	</div>
</div>

<script type="text/javascript">

    var ALL_YUI_PROPS = [{"url": "Array.html#method_()", "access": "", "host": "Array", "type": "method", "name": "()"}, {"url": "Object.html#method_()", "access": "", "host": "Object", "type": "method", "name": "()"}, {"url": "config.html#property_2in3", "access": "", "host": "config", "type": "property", "name": "2in3"}, {"url": "Get.html#method_abort", "access": "", "host": "Get", "type": "method", "name": "abort"}, {"url": "YUI.html#config_acceptChildren", "access": "", "host": "YUI", "type": "config", "name": "acceptChildren"}, {"url": "YUI.html#event_acceptChildrenChange", "access": "", "host": "YUI", "type": "event", "name": "acceptChildrenChange"}, {"url": "YUI.html#method_add", "access": "", "host": "YUI", "type": "method", "name": "add"}, {"url": "Queue.html#method_add", "access": "", "host": "Queue", "type": "method", "name": "add"}, {"url": "Intl.html#method_add", "access": "", "host": "Intl", "type": "method", "name": "add"}, {"url": "YUI.html#method_addHTML", "access": "", "host": "YUI", "type": "method", "name": "addHTML"}, {"url": "YUI.html#method_addListener", "access": "", "host": "YUI", "type": "method", "name": "addListener"}, {"url": "YUI.html#method_after", "access": "", "host": "YUI", "type": "method", "name": "after"}, {"url": "YUI.html#method__afterActiveTabChange", "access": "", "host": "YUI", "type": "method", "name": "_afterActiveTabChange"}, {"url": "YUI.html#method__afterFieldsChange", "access": "", "host": "YUI", "type": "method", "name": "_afterFieldsChange"}, {"url": "YUI.html#method__afterSelectDate", "access": "protected", "host": "YUI", "type": "method", "name": "_afterSelectDate"}, {"url": "YUI.html#method__afterSelectedChange", "access": "", "host": "YUI", "type": "method", "name": "_afterSelectedChange"}, {"url": "YUI.html#method__afterUniqueFieldsAdd", "access": "", "host": "YUI", "type": "method", "name": "_afterUniqueFieldsAdd"}, {"url": "YUI.html#method__afterUniqueFieldsRemove", "access": "", "host": "YUI", "type": "method", "name": "_afterUniqueFieldsRemove"}, {"url": "UA.html#property_air", "access": "", "host": "UA", "type": "property", "name": "air"}, {"url": "UA.html#property_android", "access": "", "host": "UA", "type": "property", "name": "android"}, {"url": "YUI.html#method_appendFields", "access": "", "host": "YUI", "type": "method", "name": "appendFields"}, {"url": "YUI.html#method_applyConfig", "access": "", "host": "YUI", "type": "method", "name": "applyConfig"}, {"url": "YUI.html#method_applyTo", "access": "", "host": "YUI", "type": "method", "name": "applyTo"}, {"url": "YUI.html#property_ATTRS", "access": "", "host": "YUI", "type": "property", "name": "ATTRS"}, {"url": "YUI.html#property_AutoComplete.ATTRS", "access": "", "host": "YUI", "type": "property", "name": "AutoComplete.ATTRS"}, {"url": "YUI.html#config_autoSelectFields", "access": "", "host": "YUI", "type": "config", "name": "autoSelectFields"}, {"url": "YUI.html#event_autoSelectFieldsChange", "access": "", "host": "YUI", "type": "event", "name": "autoSelectFieldsChange"}, {"url": "YUI.html#event_available", "access": "", "host": "YUI", "type": "event", "name": "available"}, {"url": "YUI.html#config_availableFields", "access": "", "host": "YUI", "type": "config", "name": "availableFields"}, {"url": "YUI.html#event_availableFieldsChange", "access": "", "host": "YUI", "type": "event", "name": "availableFieldsChange"}, {"url": "config.html#property_base", "access": "", "host": "config", "type": "property", "name": "base"}, {"url": "YUI.html#method_bindUI", "access": "protected", "host": "YUI", "type": "method", "name": "bindUI"}, {"url": "YUI.html#method__bindUIInputTextControl", "access": "protected", "host": "YUI", "type": "method", "name": "_bindUIInputTextControl"}, {"url": "YUI.html#method__bindUISearchBrowserView", "access": "protected", "host": "YUI", "type": "method", "name": "_bindUISearchBrowserView"}, {"url": "YUI.html#method__bindUITreeBrowserView", "access": "protected", "host": "YUI", "type": "method", "name": "_bindUITreeBrowserView"}, {"url": "config.html#property_bootstrap", "access": "", "host": "config", "type": "property", "name": "bootstrap"}, {"url": "YUI.html#config_button", "access": "", "host": "YUI", "type": "config", "name": "button"}, {"url": "YUI.html#event_buttonChange", "access": "", "host": "YUI", "type": "event", "name": "buttonChange"}, {"url": "YUI.html#config_buttonType", "access": "", "host": "YUI", "type": "config", "name": "buttonType"}, {"url": "YUI.html#event_buttonTypeChange", "access": "", "host": "YUI", "type": "event", "name": "buttonTypeChange"}, {"url": "YUI.html#method_cached", "access": "", "host": "YUI", "type": "method", "name": "cached"}, {"url": "config.html#property_cacheUse", "access": "", "host": "config", "type": "property", "name": "cacheUse"}, {"url": "UA.html#property_caja", "access": "", "host": "UA", "type": "property", "name": "caja"}, {"url": "YUI.html#config_calendar", "access": "", "host": "YUI", "type": "config", "name": "calendar"}, {"url": "YUI.html#event_calendarChange", "access": "", "host": "YUI", "type": "event", "name": "calendarChange"}, {"url": "YUI.html#method__checkConstrain", "access": "protected", "host": "YUI", "type": "method", "name": "_checkConstrain"}, {"url": "YUI.html#method__checkHeight", "access": "protected", "host": "YUI", "type": "method", "name": "_checkHeight"}, {"url": "YUI.html#method__checkRatio", "access": "protected", "host": "YUI", "type": "method", "name": "_checkRatio"}, {"url": "YUI.html#method__checkRegion", "access": "protected", "host": "YUI", "type": "method", "name": "_checkRegion"}, {"url": "YUI.html#method__checkWidth", "access": "protected", "host": "YUI", "type": "method", "name": "_checkWidth"}, {"url": "UA.html#property_chrome", "access": "", "host": "UA", "type": "property", "name": "chrome"}, {"url": "YUI.html#method__clearSelection", "access": "protected", "host": "YUI", "type": "method", "name": "_clearSelection"}, {"url": "YUI.html#method__cloneField", "access": "", "host": "YUI", "type": "method", "name": "_cloneField"}, {"url": "config.html#property_combine", "access": "", "host": "config", "type": "property", "name": "combine"}, {"url": "config.html#property_comboBase", "access": "", "host": "config", "type": "property", "name": "comboBase"}, {"url": "YUI.html#config_constrain", "access": "", "host": "YUI", "type": "config", "name": "constrain"}, {"url": "YUI.html#event_constrainChange", "access": "", "host": "YUI", "type": "event", "name": "constrainChange"}, {"url": "YUI.html#property_constrainSurrounding", "access": "", "host": "YUI", "type": "property", "name": "constrainSurrounding"}, {"url": "YUI.html#event_containerCollapse", "access": "", "host": "YUI", "type": "event", "name": "containerCollapse"}, {"url": "YUI.html#event_containerExpand", "access": "", "host": "YUI", "type": "event", "name": "containerExpand"}, {"url": "YUI.html#event_containerPopulate", "access": "", "host": "YUI", "type": "event", "name": "containerPopulate"}, {"url": "YUI.html#event_contentready", "access": "", "host": "YUI", "type": "event", "name": "contentready"}, {"url": "config.html#property_core", "access": "", "host": "config", "type": "property", "name": "core"}, {"url": "YUI.html#method_create", "access": "", "host": "YUI", "type": "method", "name": "create"}, {"url": "Get.html#method_css", "access": "", "host": "Get", "type": "method", "name": "css"}, {"url": "config.html#property_cssAttributes", "access": "", "host": "config", "type": "property", "name": "cssAttributes"}, {"url": "YUI.html#method_curveTo", "access": "", "host": "YUI", "type": "method", "name": "curveTo"}, {"url": "YUI.html#event_dataError", "access": "", "host": "YUI", "type": "event", "name": "dataError"}, {"url": "YUI.html#event_dataRequest", "access": "", "host": "YUI", "type": "event", "name": "dataRequest"}, {"url": "YUI.html#event_dataReturn", "access": "", "host": "YUI", "type": "event", "name": "dataReturn"}, {"url": "YUI.html#config_dataSource", "access": "", "host": "YUI", "type": "config", "name": "dataSource"}, {"url": "YUI.html#event_dataSourceChange", "access": "", "host": "YUI", "type": "event", "name": "dataSourceChange"}, {"url": "YUI.html#config_dataSourceType", "access": "", "host": "YUI", "type": "config", "name": "dataSourceType"}, {"url": "YUI.html#event_dataSourceTypeChange", "access": "", "host": "YUI", "type": "event", "name": "dataSourceTypeChange"}, {"url": "YUI.html#config_dataType", "access": "", "host": "YUI", "type": "config", "name": "dataType"}, {"url": "YUI.html#event_dataTypeChange", "access": "", "host": "YUI", "type": "event", "name": "dataTypeChange"}, {"url": "YUI.html#config_dateFormat", "access": "", "host": "YUI", "type": "config", "name": "dateFormat"}, {"url": "config.html#property_dateFormat", "access": "", "host": "config", "type": "property", "name": "dateFormat"}, {"url": "YUI.html#event_dateFormatChange", "access": "", "host": "YUI", "type": "event", "name": "dateFormatChange"}, {"url": "Array.html#method_dedupe", "access": "", "host": "Array", "type": "method", "name": "dedupe"}, {"url": "YUI.html#property_delay", "access": "", "host": "YUI", "type": "property", "name": "delay"}, {"url": "YUI.html#method_delegate", "access": "", "host": "YUI", "type": "method", "name": "delegate"}, {"url": "YUI.html#method_delegate._applyFilter", "access": "protected", "host": "YUI", "type": "method", "name": "delegate._applyFilter"}, {"url": "YUI.html#method_delegate.compileFilter", "access": "", "host": "YUI", "type": "method", "name": "delegate.compileFilter"}, {"url": "YUI.html#config_delimChar", "access": "", "host": "YUI", "type": "config", "name": "delimChar"}, {"url": "YUI.html#event_delimCharChange", "access": "", "host": "YUI", "type": "event", "name": "delimCharChange"}, {"url": "YUI.html#method_destroy", "access": "", "host": "YUI", "type": "method", "name": "destroy"}, {"url": "YUI.html#method_destructor", "access": "protected", "host": "YUI", "type": "method", "name": "destructor"}, {"url": "YUI.html#config_disabled", "access": "", "host": "YUI", "type": "config", "name": "disabled"}, {"url": "YUI.html#event_disabledChange", "access": "", "host": "YUI", "type": "event", "name": "disabledChange"}, {"url": "YUI.html#method_doBeforeLoadData", "access": "", "host": "YUI", "type": "method", "name": "doBeforeLoadData"}, {"url": "config.html#property_doc", "access": "", "host": "config", "type": "property", "name": "doc"}, {"url": "YUI.html#event_domready", "access": "", "host": "YUI", "type": "event", "name": "domready"}, {"url": "YUI.html#method_drawRect", "access": "", "host": "YUI", "type": "method", "name": "drawRect"}, {"url": "YUI.html#method_drawWedge", "access": "", "host": "YUI", "type": "method", "name": "drawWedge"}, {"url": "YUI.html#method__dropField", "access": "", "host": "YUI", "type": "method", "name": "_dropField"}, {"url": "YUI.html#method_duplicateField", "access": "", "host": "YUI", "type": "method", "name": "duplicateField"}, {"url": "YUI.html#method_each", "access": "", "host": "YUI", "type": "method", "name": "each"}, {"url": "Array.html#method_each", "access": "", "host": "Array", "type": "method", "name": "each"}, {"url": "Object.html#method_each", "access": "", "host": "Object", "type": "method", "name": "each"}, {"url": "YUI.html#config_enableEditing", "access": "", "host": "YUI", "type": "config", "name": "enableEditing"}, {"url": "YUI.html#event_enableEditingChange", "access": "", "host": "YUI", "type": "event", "name": "enableEditingChange"}, {"url": "YUI.html#method__enableIntervalDetection", "access": "protected", "host": "YUI", "type": "method", "name": "_enableIntervalDetection"}, {"url": "YUI.html#method_end", "access": "", "host": "YUI", "type": "method", "name": "end"}, {"url": "YUI.html#property_Env.meta", "access": "", "host": "YUI", "type": "property", "name": "Env.meta"}, {"url": "UA.html#method_Env.parseUA", "access": "", "host": "UA", "type": "method", "name": "Env.parseUA"}, {"url": "YUI.html#method_error", "access": "", "host": "YUI", "type": "method", "name": "error"}, {"url": "config.html#property_errorFn", "access": "", "host": "config", "type": "property", "name": "errorFn"}, {"url": "YUI.html#method__extractQuery", "access": "protected", "host": "YUI", "type": "method", "name": "_extractQuery"}, {"url": "config.html#property_fetchCSS", "access": "", "host": "config", "type": "property", "name": "fetchCSS"}, {"url": "config.html#property_filter", "access": "", "host": "config", "type": "property", "name": "filter"}, {"url": "config.html#property_filters", "access": "", "host": "config", "type": "property", "name": "filters"}, {"url": "YUI.html#config_firstDayOfWeek", "access": "", "host": "YUI", "type": "config", "name": "firstDayOfWeek"}, {"url": "YUI.html#event_firstDayOfWeekChange", "access": "", "host": "YUI", "type": "event", "name": "firstDayOfWeekChange"}, {"url": "YUI.html#config_fixed", "access": "", "host": "YUI", "type": "config", "name": "fixed"}, {"url": "YUI.html#event_fixedChange", "access": "", "host": "YUI", "type": "event", "name": "fixedChange"}, {"url": "YUI.html#event_flick", "access": "", "host": "YUI", "type": "event", "name": "flick"}, {"url": "YUI.html#method__focus", "access": "protected", "host": "YUI", "type": "method", "name": "_focus"}, {"url": "config.html#property_force", "access": "", "host": "config", "type": "property", "name": "force"}, {"url": "Object.html#property__forceEnum", "access": "protected", "host": "Object", "type": "property", "name": "_forceEnum"}, {"url": "YUI.html#config_forceSelection", "access": "", "host": "YUI", "type": "config", "name": "forceSelection"}, {"url": "YUI.html#event_forceSelectionChange", "access": "", "host": "YUI", "type": "event", "name": "forceSelectionChange"}, {"url": "Array.html#method_forEach", "access": "", "host": "Array", "type": "method", "name": "forEach"}, {"url": "YUI.html#method_formatResult", "access": "", "host": "YUI", "type": "method", "name": "formatResult"}, {"url": "YUI.html#config_formatter", "access": "", "host": "YUI", "type": "config", "name": "formatter"}, {"url": "YUI.html#event_formatterChange", "access": "", "host": "YUI", "type": "event", "name": "formatterChange"}, {"url": "YUI.html#config_formBuilder", "access": "", "host": "YUI", "type": "config", "name": "formBuilder"}, {"url": "YUI.html#event_formBuilderChange", "access": "", "host": "YUI", "type": "event", "name": "formBuilderChange"}, {"url": "config.html#property_gallery", "access": "", "host": "config", "type": "property", "name": "gallery"}, {"url": "UA.html#property_gecko", "access": "", "host": "UA", "type": "property", "name": "gecko"}, {"url": "YUI.html#method_generateRequest", "access": "", "host": "YUI", "type": "method", "name": "generateRequest"}, {"url": "YUI.html#event_gesturemove", "access": "", "host": "YUI", "type": "event", "name": "gesturemove"}, {"url": "YUI.html#event_gesturemoveend", "access": "", "host": "YUI", "type": "event", "name": "gesturemoveend"}, {"url": "YUI.html#event_gesturemovestart", "access": "", "host": "YUI", "type": "event", "name": "gesturemovestart"}, {"url": "Intl.html#method_get", "access": "", "host": "Intl", "type": "method", "name": "get"}, {"url": "YUI.html#method_getAttibute", "access": "", "host": "YUI", "type": "method", "name": "getAttibute"}, {"url": "Intl.html#method_getAvailableLangs", "access": "", "host": "Intl", "type": "method", "name": "getAvailableLangs"}, {"url": "YUI.html#method_getCharCode", "access": "", "host": "YUI", "type": "method", "name": "getCharCode"}, {"url": "YUI.html#method__getConstrainRegion", "access": "protected", "host": "YUI", "type": "method", "name": "_getConstrainRegion"}, {"url": "YUI.html#method_getDefaultLocale", "access": "", "host": "YUI", "type": "method", "name": "getDefaultLocale"}, {"url": "YUI.html#method__getDragNodeByKey", "access": "", "host": "YUI", "type": "method", "name": "_getDragNodeByKey"}, {"url": "YUI.html#method__getFieldInstance", "access": "", "host": "YUI", "type": "method", "name": "_getFieldInstance"}, {"url": "YUI.html#method_getFieldNode", "access": "", "host": "YUI", "type": "method", "name": "getFieldNode"}, {"url": "YUI.html#method__getFieldParentByNode", "access": "", "host": "YUI", "type": "method", "name": "_getFieldParentByNode"}, {"url": "YUI.html#method__getFieldParentNode", "access": "", "host": "YUI", "type": "method", "name": "_getFieldParentNode"}, {"url": "YUI.html#method_getFlashVersion", "access": "", "host": "YUI", "type": "method", "name": "getFlashVersion"}, {"url": "YUI.html#method_getHTML", "access": "", "host": "YUI", "type": "method", "name": "getHTML"}, {"url": "YUI.html#method_getIframeHash", "access": "", "host": "YUI", "type": "method", "name": "getIframeHash"}, {"url": "Intl.html#method_getLang", "access": "", "host": "Intl", "type": "method", "name": "getLang"}, {"url": "YUI.html#method_getNode", "access": "", "host": "YUI", "type": "method", "name": "getNode"}, {"url": "YUI.html#method_getPageX", "access": "", "host": "YUI", "type": "method", "name": "getPageX"}, {"url": "YUI.html#method_getPageY", "access": "", "host": "YUI", "type": "method", "name": "getPageY"}, {"url": "YUI.html#method_getRelatedTarget", "access": "", "host": "YUI", "type": "method", "name": "getRelatedTarget"}, {"url": "YUI.html#method_getString", "access": "", "host": "YUI", "type": "method", "name": "getString"}, {"url": "YUI.html#method__getStrings", "access": "protected", "host": "YUI", "type": "method", "name": "_getStrings"}, {"url": "YUI.html#method_getStrings", "access": "", "host": "YUI", "type": "method", "name": "getStrings"}, {"url": "YUI.html#method_getTarget", "access": "", "host": "YUI", "type": "method", "name": "getTarget"}, {"url": "YUI.html#method_getText", "access": "", "host": "YUI", "type": "method", "name": "getText"}, {"url": "YUI.html#method_getTime", "access": "", "host": "YUI", "type": "method", "name": "getTime"}, {"url": "Object.html#method_getValue", "access": "", "host": "Object", "type": "method", "name": "getValue"}, {"url": "YUI.html#method_getXY", "access": "", "host": "YUI", "type": "method", "name": "getXY"}, {"url": "YUI.html#property_Global", "access": "", "host": "YUI", "type": "property", "name": "Global"}, {"url": "config.html#property_groups", "access": "", "host": "config", "type": "property", "name": "groups"}, {"url": "YUI.html#method_guid", "access": "", "host": "YUI", "type": "method", "name": "guid"}, {"url": "YUI.html#method_handleResponse", "access": "", "host": "YUI", "type": "method", "name": "handleResponse"}, {"url": "Object.html#property__hasEnumBug", "access": "protected", "host": "Object", "type": "property", "name": "_hasEnumBug"}, {"url": "Array.html#method_hash", "access": "", "host": "Array", "type": "method", "name": "hash"}, {"url": "YUI.html#event_hashchange", "access": "", "host": "YUI", "type": "event", "name": "hashchange"}, {"url": "Object.html#method_hasKey", "access": "", "host": "Object", "type": "method", "name": "hasKey"}, {"url": "Object.html#method_hasValue", "access": "", "host": "Object", "type": "method", "name": "hasValue"}, {"url": "YUI.html#config_icon", "access": "", "host": "YUI", "type": "config", "name": "icon"}, {"url": "YUI.html#event_iconChange", "access": "", "host": "YUI", "type": "event", "name": "iconChange"}, {"url": "YUI.html#config_id", "access": "", "host": "YUI", "type": "config", "name": "id"}, {"url": "YUI.html#event_idChange", "access": "", "host": "YUI", "type": "event", "name": "idChange"}, {"url": "UA.html#property_ie", "access": "", "host": "UA", "type": "property", "name": "ie"}, {"url": "config.html#property_ignore", "access": "", "host": "config", "type": "property", "name": "ignore"}, {"url": "Array.html#method_indexOf", "access": "", "host": "Array", "type": "method", "name": "indexOf"}, {"url": "Queue.html#method_indexOf", "access": "", "host": "Queue", "type": "method", "name": "indexOf"}, {"url": "Queue.html#method__init", "access": "protected", "host": "Queue", "type": "method", "name": "_init"}, {"url": "YUI.html#method_initializer", "access": "protected", "host": "YUI", "type": "method", "name": "initializer"}, {"url": "config.html#property_injected", "access": "", "host": "config", "type": "property", "name": "injected"}, {"url": "YUI.html#config_input", "access": "", "host": "YUI", "type": "config", "name": "input"}, {"url": "YUI.html#event_inputChange", "access": "", "host": "YUI", "type": "event", "name": "inputChange"}, {"url": "config.html#property_insertBefore", "access": "", "host": "config", "type": "property", "name": "insertBefore"}, {"url": "YUI.html#method_instanceOf", "access": "", "host": "YUI", "type": "method", "name": "instanceOf"}, {"url": "Intl.html#event_intl:langChange", "access": "", "host": "Intl", "type": "event", "name": "intl:langChange"}, {"url": "YUI.html#event_io:xdrReady", "access": "", "host": "YUI", "type": "event", "name": "io:xdrReady"}, {"url": "UA.html#property_ios", "access": "", "host": "UA", "type": "property", "name": "ios"}, {"url": "UA.html#property_ipad", "access": "", "host": "UA", "type": "property", "name": "ipad"}, {"url": "UA.html#property_iphone", "access": "", "host": "UA", "type": "property", "name": "iphone"}, {"url": "UA.html#property_ipod", "access": "", "host": "UA", "type": "property", "name": "ipod"}, {"url": "Lang.html#method_isArray", "access": "", "host": "Lang", "type": "method", "name": "isArray"}, {"url": "Lang.html#method_isBoolean", "access": "", "host": "Lang", "type": "method", "name": "isBoolean"}, {"url": "Lang.html#method_isDate", "access": "", "host": "Lang", "type": "method", "name": "isDate"}, {"url": "Object.html#method_isEmpty", "access": "", "host": "Object", "type": "method", "name": "isEmpty"}, {"url": "YUI.html#method_isFlashVersionAtLeast", "access": "", "host": "YUI", "type": "method", "name": "isFlashVersionAtLeast"}, {"url": "Lang.html#method_isFunction", "access": "", "host": "Lang", "type": "method", "name": "isFunction"}, {"url": "Lang.html#method_isNull", "access": "", "host": "Lang", "type": "method", "name": "isNull"}, {"url": "Lang.html#method_isNumber", "access": "", "host": "Lang", "type": "method", "name": "isNumber"}, {"url": "Lang.html#method_isObject", "access": "", "host": "Lang", "type": "method", "name": "isObject"}, {"url": "Lang.html#method_isPlainObject", "access": "", "host": "Lang", "type": "method", "name": "isPlainObject"}, {"url": "Lang.html#method_isString", "access": "", "host": "Lang", "type": "method", "name": "isString"}, {"url": "Lang.html#method_isUndefined", "access": "", "host": "Lang", "type": "method", "name": "isUndefined"}, {"url": "Lang.html#method_isValue", "access": "", "host": "Lang", "type": "method", "name": "isValue"}, {"url": "YUI.html#method_item", "access": "", "host": "YUI", "type": "method", "name": "item"}, {"url": "YUI.html#event_itemArrowFrom", "access": "", "host": "YUI", "type": "event", "name": "itemArrowFrom"}, {"url": "YUI.html#event_itemArrowTo", "access": "", "host": "YUI", "type": "event", "name": "itemArrowTo"}, {"url": "YUI.html#event_itemMouseOut", "access": "", "host": "YUI", "type": "event", "name": "itemMouseOut"}, {"url": "YUI.html#event_itemMouseOver", "access": "", "host": "YUI", "type": "event", "name": "itemMouseOver"}, {"url": "YUI.html#event_itemSelect", "access": "", "host": "YUI", "type": "event", "name": "itemSelect"}, {"url": "config.html#property_jsAttributes", "access": "", "host": "config", "type": "property", "name": "jsAttributes"}, {"url": "YUI.html#event_key", "access": "", "host": "YUI", "type": "event", "name": "key"}, {"url": "YUI.html#event_keyChange", "access": "", "host": "YUI", "type": "event", "name": "keyChange"}, {"url": "Object.html#method_keys", "access": "", "host": "Object", "type": "method", "name": "keys"}, {"url": "YUI.html#config_label", "access": "", "host": "YUI", "type": "config", "name": "label"}, {"url": "YUI.html#event_labelChange", "access": "", "host": "YUI", "type": "event", "name": "labelChange"}, {"url": "config.html#property_lang", "access": "", "host": "config", "type": "property", "name": "lang"}, {"url": "Queue.html#method_last", "access": "", "host": "Queue", "type": "method", "name": "last"}, {"url": "YUI.html#method_later", "access": "", "host": "YUI", "type": "method", "name": "later"}, {"url": "YUI.html#method_lineTo", "access": "", "host": "YUI", "type": "method", "name": "lineTo"}, {"url": "config.html#property_loaderPath", "access": "", "host": "config", "type": "property", "name": "loaderPath"}, {"url": "config.html#property_loadErrorFn", "access": "", "host": "config", "type": "property", "name": "loadErrorFn"}, {"url": "YUI.html#config_locale", "access": "", "host": "YUI", "type": "config", "name": "locale"}, {"url": "config.html#property_locale", "access": "", "host": "config", "type": "property", "name": "locale"}, {"url": "YUI.html#event_localeChange", "access": "", "host": "YUI", "type": "event", "name": "localeChange"}, {"url": "YUI.html#method_log", "access": "", "host": "YUI", "type": "method", "name": "log"}, {"url": "config.html#property_logExclude", "access": "", "host": "config", "type": "property", "name": "logExclude"}, {"url": "config.html#property_logFn", "access": "", "host": "config", "type": "property", "name": "logFn"}, {"url": "config.html#property_logInclude", "access": "", "host": "config", "type": "property", "name": "logInclude"}, {"url": "Intl.html#method_lookupBestLang", "access": "", "host": "Intl", "type": "method", "name": "lookupBestLang"}, {"url": "YUI.html#config_matchKey", "access": "", "host": "YUI", "type": "config", "name": "matchKey"}, {"url": "YUI.html#event_matchKeyChange", "access": "", "host": "YUI", "type": "event", "name": "matchKeyChange"}, {"url": "YUI.html#config_maxHeight", "access": "", "host": "YUI", "type": "config", "name": "maxHeight"}, {"url": "YUI.html#event_maxHeightChange", "access": "", "host": "YUI", "type": "event", "name": "maxHeightChange"}, {"url": "YUI.html#config_maxWidth", "access": "", "host": "YUI", "type": "config", "name": "maxWidth"}, {"url": "YUI.html#event_maxWidthChange", "access": "", "host": "YUI", "type": "event", "name": "maxWidthChange"}, {"url": "YUI.html#method_merge", "access": "", "host": "YUI", "type": "method", "name": "merge"}, {"url": "YUI.html#method_message", "access": "", "host": "YUI", "type": "method", "name": "message"}, {"url": "YUI.html#config_minHeight", "access": "", "host": "YUI", "type": "config", "name": "minHeight"}, {"url": "YUI.html#event_minHeightChange", "access": "", "host": "YUI", "type": "event", "name": "minHeightChange"}, {"url": "YUI.html#config_minQueryLength", "access": "", "host": "YUI", "type": "config", "name": "minQueryLength"}, {"url": "YUI.html#event_minQueryLengthChange", "access": "", "host": "YUI", "type": "event", "name": "minQueryLengthChange"}, {"url": "YUI.html#config_minWidth", "access": "", "host": "YUI", "type": "config", "name": "minWidth"}, {"url": "YUI.html#event_minWidthChange", "access": "", "host": "YUI", "type": "event", "name": "minWidthChange"}, {"url": "YUI.html#method_mix", "access": "", "host": "YUI", "type": "method", "name": "mix"}, {"url": "UA.html#property_mobile", "access": "", "host": "UA", "type": "property", "name": "mobile"}, {"url": "config.html#property_modules", "access": "", "host": "config", "type": "property", "name": "modules"}, {"url": "YUI.html#event_mousewheel", "access": "", "host": "YUI", "type": "event", "name": "mousewheel"}, {"url": "YUI.html#method_moveTo", "access": "", "host": "YUI", "type": "method", "name": "moveTo"}, {"url": "YUI.html#config_multiple", "access": "", "host": "YUI", "type": "config", "name": "multiple"}, {"url": "YUI.html#event_multipleChange", "access": "", "host": "YUI", "type": "event", "name": "multipleChange"}, {"url": "YUI.html#property_NAME", "access": "", "host": "YUI", "type": "property", "name": "NAME"}, {"url": "YUI.html#config_name", "access": "", "host": "YUI", "type": "config", "name": "name"}, {"url": "YUI.html#event_nameChange", "access": "", "host": "YUI", "type": "event", "name": "nameChange"}, {"url": "YUI.html#method_namespace", "access": "", "host": "YUI", "type": "method", "name": "namespace"}, {"url": "YUI.html#config_nestedList", "access": "", "host": "YUI", "type": "config", "name": "nestedList"}, {"url": "YUI.html#event_nestedListChange", "access": "", "host": "YUI", "type": "event", "name": "nestedListChange"}, {"url": "Queue.html#method_next", "access": "", "host": "Queue", "type": "method", "name": "next"}, {"url": "YUI.html#config_node", "access": "", "host": "YUI", "type": "config", "name": "node"}, {"url": "YUI.html#event_nodeChange", "access": "", "host": "YUI", "type": "event", "name": "nodeChange"}, {"url": "YUI.html#method_Node.plug", "access": "", "host": "YUI", "type": "method", "name": "Node.plug"}, {"url": "YUI.html#method_Node.unplug", "access": "", "host": "YUI", "type": "method", "name": "Node.unplug"}, {"url": "Lang.html#method_now", "access": "", "host": "Lang", "type": "method", "name": "now"}, {"url": "YUI.html#property_NS", "access": "", "host": "YUI", "type": "property", "name": "NS"}, {"url": "Array.html#method_numericSort", "access": "", "host": "Array", "type": "method", "name": "numericSort"}, {"url": "YUI.html#method_on", "access": "", "host": "YUI", "type": "method", "name": "on"}, {"url": "YUI.html#method__onButtonMouseDown", "access": "protected", "host": "YUI", "type": "method", "name": "_onButtonMouseDown"}, {"url": "YUI.html#method_once", "access": "", "host": "YUI", "type": "method", "name": "once"}, {"url": "YUI.html#method__onClickFieldDelete", "access": "", "host": "YUI", "type": "method", "name": "_onClickFieldDelete"}, {"url": "YUI.html#method__onClickFieldDuplicate", "access": "", "host": "YUI", "type": "method", "name": "_onClickFieldDuplicate"}, {"url": "YUI.html#method__onClickFieldEdit", "access": "", "host": "YUI", "type": "method", "name": "_onClickFieldEdit"}, {"url": "YUI.html#method__onClickSettingsButton", "access": "", "host": "YUI", "type": "method", "name": "_onClickSettingsButton"}, {"url": "config.html#property_onCSS", "access": "", "host": "config", "type": "property", "name": "onCSS"}, {"url": "YUI.html#method__onDbClickField", "access": "", "host": "YUI", "type": "method", "name": "_onDbClickField"}, {"url": "YUI.html#method__onDragEndDragNestedList", "access": "", "host": "YUI", "type": "method", "name": "_onDragEndDragNestedList"}, {"url": "YUI.html#method__onDragEndDropNestedList", "access": "", "host": "YUI", "type": "method", "name": "_onDragEndDropNestedList"}, {"url": "YUI.html#method__onDragStartDragNestedList", "access": "", "host": "YUI", "type": "method", "name": "_onDragStartDragNestedList"}, {"url": "YUI.html#method__onInterval", "access": "protected", "host": "YUI", "type": "method", "name": "_onInterval"}, {"url": "YUI.html#method__onMouseEnterField", "access": "", "host": "YUI", "type": "method", "name": "_onMouseEnterField"}, {"url": "YUI.html#method__onMouseLeaveField", "access": "", "host": "YUI", "type": "method", "name": "_onMouseLeaveField"}, {"url": "YUI.html#method__onShowOverlay", "access": "protected", "host": "YUI", "type": "method", "name": "_onShowOverlay"}, {"url": "YUI.html#method__onTextboxBlur", "access": "protected", "host": "YUI", "type": "method", "name": "_onTextboxBlur"}, {"url": "YUI.html#method__onTextboxFocus", "access": "protected", "host": "YUI", "type": "method", "name": "_onTextboxFocus"}, {"url": "YUI.html#method__onTextboxKeyDown", "access": "protected", "host": "YUI", "type": "method", "name": "_onTextboxKeyDown"}, {"url": "YUI.html#method__onTextboxKeyPress", "access": "protected", "host": "YUI", "type": "method", "name": "_onTextboxKeyPress"}, {"url": "YUI.html#method__onTextboxKeyUp", "access": "protected", "host": "YUI", "type": "method", "name": "_onTextboxKeyUp"}, {"url": "YUI.html#method__onValueKeyUp", "access": "", "host": "YUI", "type": "method", "name": "_onValueKeyUp"}, {"url": "UA.html#property_opera", "access": "", "host": "UA", "type": "property", "name": "opera"}, {"url": "YUI.html#config_options", "access": "", "host": "YUI", "type": "config", "name": "options"}, {"url": "YUI.html#event_optionsChange", "access": "", "host": "YUI", "type": "event", "name": "optionsChange"}, {"url": "YUI.html#config_optionTemplate", "access": "", "host": "YUI", "type": "config", "name": "optionTemplate"}, {"url": "YUI.html#event_optionTemplateChange", "access": "", "host": "YUI", "type": "event", "name": "optionTemplateChange"}, {"url": "UA.html#property_os", "access": "", "host": "UA", "type": "property", "name": "os"}, {"url": "Object.html#method_owns", "access": "", "host": "Object", "type": "method", "name": "owns"}, {"url": "YUI.html#config_parent", "access": "", "host": "YUI", "type": "config", "name": "parent"}, {"url": "YUI.html#event_parentChange", "access": "", "host": "YUI", "type": "event", "name": "parentChange"}, {"url": "config.html#property_pollInterval", "access": "", "host": "config", "type": "property", "name": "pollInterval"}, {"url": "YUI.html#config_predefinedValue", "access": "", "host": "YUI", "type": "config", "name": "predefinedValue"}, {"url": "YUI.html#event_predefinedValueChange", "access": "", "host": "YUI", "type": "event", "name": "predefinedValueChange"}, {"url": "YUI.html#config_preserveRatio", "access": "", "host": "YUI", "type": "config", "name": "preserveRatio"}, {"url": "YUI.html#event_preserveRatioChange", "access": "", "host": "YUI", "type": "event", "name": "preserveRatioChange"}, {"url": "YUI.html#method_preventDefault", "access": "", "host": "YUI", "type": "method", "name": "preventDefault"}, {"url": "YUI.html#method_promote", "access": "", "host": "YUI", "type": "method", "name": "promote"}, {"url": "Queue.html#method_promote", "access": "", "host": "Queue", "type": "method", "name": "promote"}, {"url": "YUI.html#config_proxyNode", "access": "", "host": "YUI", "type": "config", "name": "proxyNode"}, {"url": "YUI.html#event_proxyNodeChange", "access": "", "host": "YUI", "type": "event", "name": "proxyNodeChange"}, {"url": "YUI.html#property_PROXY_TEMPLATE", "access": "", "host": "YUI", "type": "property", "name": "PROXY_TEMPLATE"}, {"url": "config.html#property_purgethreshold", "access": "", "host": "config", "type": "property", "name": "purgethreshold"}, {"url": "Queue.html#property__q", "access": "protected", "host": "Queue", "type": "property", "name": "_q"}, {"url": "YUI.html#method_quadraticCurveTo", "access": "", "host": "YUI", "type": "method", "name": "quadraticCurveTo"}, {"url": "YUI.html#method_query", "access": "", "host": "YUI", "type": "method", "name": "query"}, {"url": "YUI.html#method_queryAll", "access": "", "host": "YUI", "type": "method", "name": "queryAll"}, {"url": "YUI.html#config_queryDelay", "access": "", "host": "YUI", "type": "config", "name": "queryDelay"}, {"url": "YUI.html#event_queryDelayChange", "access": "", "host": "YUI", "type": "event", "name": "queryDelayChange"}, {"url": "YUI.html#config_queryInterval", "access": "", "host": "YUI", "type": "config", "name": "queryInterval"}, {"url": "YUI.html#event_queryIntervalChange", "access": "", "host": "YUI", "type": "event", "name": "queryIntervalChange"}, {"url": "YUI.html#config_queryMatchCase", "access": "", "host": "YUI", "type": "config", "name": "queryMatchCase"}, {"url": "YUI.html#event_queryMatchCaseChange", "access": "", "host": "YUI", "type": "event", "name": "queryMatchCaseChange"}, {"url": "YUI.html#config_queryMatchContains", "access": "", "host": "YUI", "type": "config", "name": "queryMatchContains"}, {"url": "YUI.html#event_queryMatchContainsChange", "access": "", "host": "YUI", "type": "event", "name": "queryMatchContainsChange"}, {"url": "YUI.html#config_queryQuestionMark", "access": "", "host": "YUI", "type": "config", "name": "queryQuestionMark"}, {"url": "YUI.html#event_queryQuestionMarkChange", "access": "", "host": "YUI", "type": "event", "name": "queryQuestionMarkChange"}, {"url": "YUI.html#method_queue", "access": "", "host": "YUI", "type": "method", "name": "queue"}, {"url": "YUI.html#config_readOnlyAttributes", "access": "", "host": "YUI", "type": "config", "name": "readOnlyAttributes"}, {"url": "YUI.html#event_readOnlyAttributesChange", "access": "", "host": "YUI", "type": "event", "name": "readOnlyAttributesChange"}, {"url": "Queue.html#method_remove", "access": "", "host": "Queue", "type": "method", "name": "remove"}, {"url": "YUI.html#method_removeListener", "access": "", "host": "YUI", "type": "method", "name": "removeListener"}, {"url": "YUI.html#method__renderCalendar", "access": "protected", "host": "YUI", "type": "method", "name": "_renderCalendar"}, {"url": "YUI.html#method__renderField", "access": "", "host": "YUI", "type": "method", "name": "_renderField"}, {"url": "YUI.html#method__renderInput", "access": "protected", "host": "YUI", "type": "method", "name": "_renderInput"}, {"url": "YUI.html#method__renderProxy", "access": "protected", "host": "YUI", "type": "method", "name": "_renderProxy"}, {"url": "YUI.html#method_renderSettings", "access": "", "host": "YUI", "type": "method", "name": "renderSettings"}, {"url": "YUI.html#method__renderSettingsFields", "access": "", "host": "YUI", "type": "method", "name": "_renderSettingsFields"}, {"url": "YUI.html#method_renderUI", "access": "", "host": "YUI", "type": "method", "name": "renderUI"}, {"url": "YUI.html#method__renderUIInputTextControl", "access": "protected", "host": "YUI", "type": "method", "name": "_renderUIInputTextControl"}, {"url": "YUI.html#method__renderUISearchBrowserView", "access": "protected", "host": "YUI", "type": "method", "name": "_renderUISearchBrowserView"}, {"url": "YUI.html#method__renderUITreeBrowserView", "access": "protected", "host": "YUI", "type": "method", "name": "_renderUITreeBrowserView"}, {"url": "YUI.html#config_required", "access": "", "host": "YUI", "type": "config", "name": "required"}, {"url": "YUI.html#event_requiredChange", "access": "", "host": "YUI", "type": "event", "name": "requiredChange"}, {"url": "config.html#property_requireRegistration", "access": "", "host": "config", "type": "property", "name": "requireRegistration"}, {"url": "YUI.html#method_resolveTextNode", "access": "", "host": "YUI", "type": "method", "name": "resolveTextNode"}, {"url": "config.html#property_rls", "access": "", "host": "config", "type": "property", "name": "rls"}, {"url": "config.html#property_rls_base", "access": "", "host": "config", "type": "property", "name": "rls_base"}, {"url": "Intl.html#method_rls_done", "access": "", "host": "Intl", "type": "method", "name": "rls_done"}, {"url": "rls.html#method_rls_done", "access": "", "host": "rls", "type": "method", "name": "rls_done"}, {"url": "Intl.html#method_rls_oncomplete", "access": "", "host": "Intl", "type": "method", "name": "rls_oncomplete"}, {"url": "rls.html#method_rls_oncomplete", "access": "", "host": "rls", "type": "method", "name": "rls_oncomplete"}, {"url": "config.html#property_rls_tmpl", "access": "", "host": "config", "type": "property", "name": "rls_tmpl"}, {"url": "config.html#property_root", "access": "", "host": "config", "type": "property", "name": "root"}, {"url": "UA.html#property_safari", "access": "", "host": "UA", "type": "property", "name": "safari"}, {"url": "YUI.html#method_saveSettings", "access": "", "host": "YUI", "type": "method", "name": "saveSettings"}, {"url": "YUI.html#config_schema", "access": "", "host": "YUI", "type": "config", "name": "schema"}, {"url": "YUI.html#event_schemaChange", "access": "", "host": "YUI", "type": "event", "name": "schemaChange"}, {"url": "YUI.html#config_schemaType", "access": "", "host": "YUI", "type": "config", "name": "schemaType"}, {"url": "YUI.html#event_schemaTypeChange", "access": "", "host": "YUI", "type": "event", "name": "schemaTypeChange"}, {"url": "Get.html#method_script", "access": "", "host": "Get", "type": "method", "name": "script"}, {"url": "UA.html#property_secure", "access": "", "host": "UA", "type": "property", "name": "secure"}, {"url": "YUI.html#config_selected", "access": "", "host": "YUI", "type": "config", "name": "selected"}, {"url": "YUI.html#event_selectedChange", "access": "", "host": "YUI", "type": "event", "name": "selectedChange"}, {"url": "YUI.html#method_selectField", "access": "", "host": "YUI", "type": "method", "name": "selectField"}, {"url": "YUI.html#event_selectionEnforce", "access": "", "host": "YUI", "type": "event", "name": "selectionEnforce"}, {"url": "YUI.html#method__sendQuery", "access": "protected", "host": "YUI", "type": "method", "name": "_sendQuery"}, {"url": "YUI.html#method_setAttribute", "access": "", "host": "YUI", "type": "method", "name": "setAttribute"}, {"url": "YUI.html#method__setCalendar", "access": "protected", "host": "YUI", "type": "method", "name": "_setCalendar"}, {"url": "YUI.html#method_setHeight", "access": "", "host": "YUI", "type": "method", "name": "setHeight"}, {"url": "Intl.html#method_setLang", "access": "", "host": "Intl", "type": "method", "name": "setLang"}, {"url": "YUI.html#method__setStack", "access": "protected", "host": "YUI", "type": "method", "name": "_setStack"}, {"url": "YUI.html#method__setStrings", "access": "protected", "host": "YUI", "type": "method", "name": "_setStrings"}, {"url": "YUI.html#method_setText", "access": "", "host": "YUI", "type": "method", "name": "setText"}, {"url": "YUI.html#config_settingsNodesMap", "access": "", "host": "YUI", "type": "config", "name": "settingsNodesMap"}, {"url": "YUI.html#event_settingsNodesMapChange", "access": "", "host": "YUI", "type": "event", "name": "settingsNodesMapChange"}, {"url": "YUI.html#method__setTriggerValue", "access": "protected", "host": "YUI", "type": "method", "name": "_setTriggerValue"}, {"url": "YUI.html#config_setValue", "access": "", "host": "YUI", "type": "config", "name": "setValue"}, {"url": "Object.html#method_setValue", "access": "", "host": "Object", "type": "method", "name": "setValue"}, {"url": "YUI.html#event_setValueChange", "access": "", "host": "YUI", "type": "event", "name": "setValueChange"}, {"url": "YUI.html#method_setWidth", "access": "", "host": "YUI", "type": "method", "name": "setWidth"}, {"url": "YUI.html#config_showLabel", "access": "", "host": "YUI", "type": "config", "name": "showLabel"}, {"url": "YUI.html#event_showLabelChange", "access": "", "host": "YUI", "type": "event", "name": "showLabelChange"}, {"url": "YUI.html#method_size", "access": "", "host": "YUI", "type": "method", "name": "size"}, {"url": "Queue.html#method_size", "access": "", "host": "Queue", "type": "method", "name": "size"}, {"url": "Object.html#method_size", "access": "", "host": "Object", "type": "method", "name": "size"}, {"url": "config.html#property_skin", "access": "", "host": "config", "type": "property", "name": "skin"}, {"url": "Array.html#method_some", "access": "", "host": "Array", "type": "method", "name": "some"}, {"url": "Object.html#method_some", "access": "", "host": "Object", "type": "method", "name": "some"}, {"url": "YUI.html#config_stack", "access": "", "host": "YUI", "type": "config", "name": "stack"}, {"url": "YUI.html#event_stackChange", "access": "", "host": "YUI", "type": "event", "name": "stackChange"}, {"url": "YUI.html#method_stamp", "access": "", "host": "YUI", "type": "method", "name": "stamp"}, {"url": "YUI.html#property_START_EVENT", "access": "", "host": "YUI", "type": "property", "name": "START_EVENT"}, {"url": "YUI.html#method_stopEvent", "access": "", "host": "YUI", "type": "method", "name": "stopEvent"}, {"url": "YUI.html#method_stopPropagation", "access": "", "host": "YUI", "type": "method", "name": "stopPropagation"}, {"url": "YUI.html#config_strings", "access": "", "host": "YUI", "type": "config", "name": "strings"}, {"url": "YUI.html#event_stringsChange", "access": "", "host": "YUI", "type": "event", "name": "stringsChange"}, {"url": "Lang.html#method_sub", "access": "", "host": "Lang", "type": "method", "name": "sub"}, {"url": "YUI.html#config_suppressInputUpdate", "access": "", "host": "YUI", "type": "config", "name": "suppressInputUpdate"}, {"url": "YUI.html#event_suppressInputUpdateChange", "access": "", "host": "YUI", "type": "event", "name": "suppressInputUpdateChange"}, {"url": "YUI.html#method__syncDefaultMessage", "access": "", "host": "YUI", "type": "method", "name": "_syncDefaultMessage"}, {"url": "YUI.html#method_syncFieldsUI", "access": "", "host": "YUI", "type": "method", "name": "syncFieldsUI"}, {"url": "YUI.html#method__syncNestedList", "access": "", "host": "YUI", "type": "method", "name": "_syncNestedList"}, {"url": "YUI.html#method__syncNodes", "access": "", "host": "YUI", "type": "method", "name": "_syncNodes"}, {"url": "YUI.html#method__syncProxyUI", "access": "protected", "host": "YUI", "type": "method", "name": "_syncProxyUI"}, {"url": "YUI.html#method__syncSelectedFieldUI", "access": "", "host": "YUI", "type": "method", "name": "_syncSelectedFieldUI"}, {"url": "YUI.html#method_syncStdContent", "access": "protected", "host": "YUI", "type": "method", "name": "syncStdContent"}, {"url": "YUI.html#method_syncUI", "access": "protected", "host": "YUI", "type": "method", "name": "syncUI"}, {"url": "YUI.html#method__syncUniqueFields", "access": "", "host": "YUI", "type": "method", "name": "_syncUniqueFields"}, {"url": "YUI.html#config_template", "access": "", "host": "YUI", "type": "config", "name": "template"}, {"url": "YUI.html#event_templateChange", "access": "", "host": "YUI", "type": "event", "name": "templateChange"}, {"url": "Array.html#method_test", "access": "", "host": "Array", "type": "method", "name": "test"}, {"url": "YUI.html#event_textboxBlur", "access": "", "host": "YUI", "type": "event", "name": "textboxBlur"}, {"url": "YUI.html#event_textboxChange", "access": "", "host": "YUI", "type": "event", "name": "textboxChange"}, {"url": "YUI.html#event_textboxFocus", "access": "", "host": "YUI", "type": "event", "name": "textboxFocus"}, {"url": "YUI.html#event_textboxKey", "access": "", "host": "YUI", "type": "event", "name": "textboxKey"}, {"url": "YUI.html#method_throttle", "access": "", "host": "YUI", "type": "method", "name": "throttle"}, {"url": "config.html#property_throwFail", "access": "", "host": "config", "type": "property", "name": "throwFail"}, {"url": "YUI.html#config_tickX", "access": "", "host": "YUI", "type": "config", "name": "tickX"}, {"url": "YUI.html#event_tickXChange", "access": "", "host": "YUI", "type": "event", "name": "tickXChange"}, {"url": "YUI.html#config_tickY", "access": "", "host": "YUI", "type": "config", "name": "tickY"}, {"url": "YUI.html#event_tickYChange", "access": "", "host": "YUI", "type": "event", "name": "tickYChange"}, {"url": "config.html#property_timeout", "access": "", "host": "config", "type": "property", "name": "timeout"}, {"url": "YUI.html#config_tip", "access": "", "host": "YUI", "type": "config", "name": "tip"}, {"url": "YUI.html#event_tipChange", "access": "", "host": "YUI", "type": "event", "name": "tipChange"}, {"url": "YUI.html#method__toggleButtonsNode", "access": "", "host": "YUI", "type": "method", "name": "_toggleButtonsNode"}, {"url": "YUI.html#method_transport", "access": "", "host": "YUI", "type": "method", "name": "transport"}, {"url": "Lang.html#method_trim", "access": "", "host": "Lang", "type": "method", "name": "trim"}, {"url": "Lang.html#method_trimLeft", "access": "", "host": "Lang", "type": "method", "name": "trimLeft"}, {"url": "Lang.html#method_trimRight", "access": "", "host": "Lang", "type": "method", "name": "trimRight"}, {"url": "YUI.html#config_type", "access": "", "host": "YUI", "type": "config", "name": "type"}, {"url": "Lang.html#method_type", "access": "", "host": "Lang", "type": "method", "name": "type"}, {"url": "YUI.html#method__typeAhead", "access": "protected", "host": "YUI", "type": "method", "name": "_typeAhead"}, {"url": "YUI.html#event_typeAhead", "access": "", "host": "YUI", "type": "event", "name": "typeAhead"}, {"url": "YUI.html#config_typeAhead", "access": "", "host": "YUI", "type": "config", "name": "typeAhead"}, {"url": "YUI.html#event_typeAheadChange", "access": "", "host": "YUI", "type": "event", "name": "typeAheadChange"}, {"url": "YUI.html#config_typeAheadDelay", "access": "", "host": "YUI", "type": "config", "name": "typeAheadDelay"}, {"url": "YUI.html#event_typeAheadDelayChange", "access": "", "host": "YUI", "type": "event", "name": "typeAheadDelayChange"}, {"url": "YUI.html#event_typeChange", "access": "", "host": "YUI", "type": "event", "name": "typeChange"}, {"url": "YUI.html#config_unique", "access": "", "host": "YUI", "type": "config", "name": "unique"}, {"url": "YUI.html#event_uniqueChange", "access": "", "host": "YUI", "type": "event", "name": "uniqueChange"}, {"url": "YUI.html#config_uniqueFields", "access": "", "host": "YUI", "type": "config", "name": "uniqueFields"}, {"url": "YUI.html#event_uniqueFieldsChange", "access": "", "host": "YUI", "type": "event", "name": "uniqueFieldsChange"}, {"url": "YUI.html#config_uniqueName", "access": "", "host": "YUI", "type": "config", "name": "uniqueName"}, {"url": "YUI.html#event_uniqueNameChange", "access": "", "host": "YUI", "type": "event", "name": "uniqueNameChange"}, {"url": "YUI.html#event_unmatchedItemSelect", "access": "", "host": "YUI", "type": "event", "name": "unmatchedItemSelect"}, {"url": "YUI.html#method_use", "access": "", "host": "YUI", "type": "method", "name": "use"}, {"url": "config.html#property_useBrowserConsole", "access": "", "host": "config", "type": "property", "name": "useBrowserConsole"}, {"url": "config.html#property_useHistoryHTML5", "access": "", "host": "config", "type": "property", "name": "useHistoryHTML5"}, {"url": "config.html#property_use_rls", "access": "", "host": "config", "type": "property", "name": "use_rls"}, {"url": "YUI.html#config_value", "access": "", "host": "YUI", "type": "config", "name": "value"}, {"url": "YUI.html#event_valueChange", "access": "", "host": "YUI", "type": "event", "name": "valueChange"}, {"url": "YUI.html#method__valueDragNodesList", "access": "", "host": "YUI", "type": "method", "name": "_valueDragNodesList"}, {"url": "Object.html#method_values", "access": "", "host": "Object", "type": "method", "name": "values"}, {"url": "YUI.html#property_version", "access": "", "host": "YUI", "type": "property", "name": "version"}, {"url": "UA.html#property_webkit", "access": "", "host": "UA", "type": "property", "name": "webkit"}, {"url": "UA.html#property_webos", "access": "", "host": "UA", "type": "property", "name": "webos"}, {"url": "YUI.html#config_widget", "access": "", "host": "YUI", "type": "config", "name": "widget"}, {"url": "YUI.html#event_widgetChange", "access": "", "host": "YUI", "type": "event", "name": "widgetChange"}, {"url": "YUI.html#config_width", "access": "", "host": "YUI", "type": "config", "name": "width"}, {"url": "YUI.html#event_widthChange", "access": "", "host": "YUI", "type": "event", "name": "widthChange"}, {"url": "config.html#property_win", "access": "", "host": "config", "type": "property", "name": "win"}, {"url": "YUI.html#event_windowresize", "access": "", "host": "YUI", "type": "event", "name": "windowresize"}, {"url": "config.html#property_windowResizeDelay", "access": "", "host": "config", "type": "property", "name": "windowResizeDelay"}, {"url": "YUI.html#property_YAHOO.util.CustomEvent.FLAT", "access": "", "host": "YUI", "type": "property", "name": "YAHOO.util.CustomEvent.FLAT"}, {"url": "YUI.html#property_YAHOO.util.CustomEvent.LIST", "access": "", "host": "YUI", "type": "property", "name": "YAHOO.util.CustomEvent.LIST"}, {"url": "YUI.html#method_Y.Event.defineOutside", "access": "", "host": "YUI", "type": "method", "name": "Y.Event.defineOutside"}, {"url": "YUI.html#method_Y.get", "access": "", "host": "YUI", "type": "method", "name": "Y.get"}, {"url": "config.html#property_yui2", "access": "", "host": "config", "type": "property", "name": "yui2"}];
</script>
</body>
</html>
